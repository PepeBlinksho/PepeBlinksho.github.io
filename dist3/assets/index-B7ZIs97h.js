function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/__bundle-2aa1a987-C0BOl5_-.js","assets/_commonjsHelpers-CZnAS8i4.js","assets/__bundle-cd03baa7-DTJfn3HF.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
var pc=Object.defineProperty;var _c=(n,t,e)=>t in n?pc(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Hi=(n,t,e)=>(_c(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();function cr(){}function Xa(n){return n()}function mo(){return Object.create(null)}function yr(n){n.forEach(Xa)}function Ja(n){return typeof n=="function"}function vc(n,t){return n!=n?t==t:n!==t||n&&typeof n=="object"||typeof n=="function"}function mc(n){return Object.keys(n).length===0}function He(n,t){n.appendChild(t)}function Ks(n,t,e){n.insertBefore(t,e||null)}function pi(n){n.parentNode&&n.parentNode.removeChild(n)}function gc(n,t){for(let e=0;e<n.length;e+=1)n[e]&&n[e].d(t)}function at(n){return document.createElement(n)}function eu(n){return document.createTextNode(n)}function Vn(){return eu(" ")}function ms(n,t,e,r){return n.addEventListener(t,e,r),()=>n.removeEventListener(t,e,r)}function Vt(n,t,e){e==null?n.removeAttribute(t):n.getAttribute(t)!==e&&n.setAttribute(t,e)}function yc(n){return Array.from(n.childNodes)}function Ec(n,t){t=""+t,n.data!==t&&(n.data=t)}function go(n,t){n.value=t??""}let Qs;function Kn(n){Qs=n}const mn=[],yo=[];let En=[];const Eo=[],bc=Promise.resolve();let gs=!1;function wc(){gs||(gs=!0,bc.then(tu))}function ys(n){En.push(n)}const $i=new Set;let pn=0;function tu(){if(pn!==0)return;const n=Qs;do{try{for(;pn<mn.length;){const t=mn[pn];pn++,Kn(t),Ic(t.$$)}}catch(t){throw mn.length=0,pn=0,t}for(Kn(null),mn.length=0,pn=0;yo.length;)yo.pop()();for(let t=0;t<En.length;t+=1){const e=En[t];$i.has(e)||($i.add(e),e())}En.length=0}while(mn.length);for(;Eo.length;)Eo.pop()();gs=!1,$i.clear(),Kn(n)}function Ic(n){if(n.fragment!==null){n.update(),yr(n.before_update);const t=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,t),n.after_update.forEach(ys)}}function Tc(n){const t=[],e=[];En.forEach(r=>n.indexOf(r)===-1?t.push(r):e.push(r)),e.forEach(r=>r()),En=t}const Cc=new Set;function Sc(n,t){n&&n.i&&(Cc.delete(n),n.i(t))}function bo(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function Nc(n,t,e){const{fragment:r,after_update:i}=n.$$;r&&r.m(t,e),ys(()=>{const s=n.$$.on_mount.map(Xa).filter(Ja);n.$$.on_destroy?n.$$.on_destroy.push(...s):yr(s),n.$$.on_mount=[]}),i.forEach(ys)}function Ac(n,t){const e=n.$$;e.fragment!==null&&(Tc(e.after_update),yr(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function kc(n,t){n.$$.dirty[0]===-1&&(mn.push(n),wc(),n.$$.dirty.fill(0)),n.$$.dirty[t/31|0]|=1<<t%31}function Oc(n,t,e,r,i,s,o=null,a=[-1]){const u=Qs;Kn(n);const c=n.$$={fragment:null,ctx:[],props:s,update:cr,not_equal:i,bound:mo(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:mo(),dirty:a,skip_bound:!1,root:t.target||u.$$.root};o&&o(c.root);let l=!1;if(c.ctx=e?e(n,t.props||{},(d,p,..._)=>{const m=_.length?_[0]:p;return c.ctx&&i(c.ctx[d],c.ctx[d]=m)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](m),l&&kc(n,d)),p}):[],c.update(),l=!0,yr(c.before_update),c.fragment=r?r(c.ctx):!1,t.target){if(t.hydrate){const d=yc(t.target);c.fragment&&c.fragment.l(d),d.forEach(pi)}else c.fragment&&c.fragment.c();t.intro&&Sc(n.$$.fragment),Nc(n,t.target,t.anchor),tu()}Kn(u)}class Dc{constructor(){Hi(this,"$$");Hi(this,"$$set")}$destroy(){Ac(this,1),this.$destroy=cr}$on(t,e){if(!Ja(e))return cr;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(e),()=>{const i=r.indexOf(e);i!==-1&&r.splice(i,1)}}$set(t){this.$$set&&!mc(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Rc="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Rc);const Uc="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20aria-hidden='true'%20role='img'%20class='iconify%20iconify--logos'%20width='26.6'%20height='32'%20preserveAspectRatio='xMidYMid%20meet'%20viewBox='0%200%20256%20308'%3e%3cpath%20fill='%23FF3E00'%20d='M239.682%2040.707C211.113-.182%20154.69-12.301%20113.895%2013.69L42.247%2059.356a82.198%2082.198%200%200%200-37.135%2055.056a86.566%2086.566%200%200%200%208.536%2055.576a82.425%2082.425%200%200%200-12.296%2030.719a87.596%2087.596%200%200%200%2014.964%2066.244c28.574%2040.893%2084.997%2053.007%20125.787%2027.016l71.648-45.664a82.182%2082.182%200%200%200%2037.135-55.057a86.601%2086.601%200%200%200-8.53-55.577a82.409%2082.409%200%200%200%2012.29-30.718a87.573%2087.573%200%200%200-14.963-66.244'%3e%3c/path%3e%3cpath%20fill='%23FFF'%20d='M106.889%20270.841c-23.102%206.007-47.497-3.036-61.103-22.648a52.685%2052.685%200%200%201-9.003-39.85a49.978%2049.978%200%200%201%201.713-6.693l1.35-4.115l3.671%202.697a92.447%2092.447%200%200%200%2028.036%2014.007l2.663.808l-.245%202.659a16.067%2016.067%200%200%200%202.89%2010.656a17.143%2017.143%200%200%200%2018.397%206.828a15.786%2015.786%200%200%200%204.403-1.935l71.67-45.672a14.922%2014.922%200%200%200%206.734-9.977a15.923%2015.923%200%200%200-2.713-12.011a17.156%2017.156%200%200%200-18.404-6.832a15.78%2015.78%200%200%200-4.396%201.933l-27.35%2017.434a52.298%2052.298%200%200%201-14.553%206.391c-23.101%206.007-47.497-3.036-61.101-22.649a52.681%2052.681%200%200%201-9.004-39.849a49.428%2049.428%200%200%201%2022.34-33.114l71.664-45.677a52.218%2052.218%200%200%201%2014.563-6.398c23.101-6.007%2047.497%203.036%2061.101%2022.648a52.685%2052.685%200%200%201%209.004%2039.85a50.559%2050.559%200%200%201-1.713%206.692l-1.35%204.116l-3.67-2.693a92.373%2092.373%200%200%200-28.037-14.013l-2.664-.809l.246-2.658a16.099%2016.099%200%200%200-2.89-10.656a17.143%2017.143%200%200%200-18.398-6.828a15.786%2015.786%200%200%200-4.402%201.935l-71.67%2045.674a14.898%2014.898%200%200%200-6.73%209.975a15.9%2015.9%200%200%200%202.709%2012.012a17.156%2017.156%200%200%200%2018.404%206.832a15.841%2015.841%200%200%200%204.402-1.935l27.345-17.427a52.147%2052.147%200%200%201%2014.552-6.397c23.101-6.006%2047.497%203.037%2061.102%2022.65a52.681%2052.681%200%200%201%209.003%2039.848a49.453%2049.453%200%200%201-22.34%2033.12l-71.664%2045.673a52.218%2052.218%200%200%201-14.563%206.398'%3e%3c/path%3e%3c/svg%3e",Mc="modulepreload",Lc=function(n){return"/"+n},wo={},Bi=function(t,e,r){let i=Promise.resolve();if(e&&e.length>0){const s=document.getElementsByTagName("link");i=Promise.all(e.map(o=>{if(o=Lc(o),o in wo)return;wo[o]=!0;const a=o.endsWith(".css"),u=a?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const p=s[d];if(p.href===o&&(!a||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${u}`))return;const l=document.createElement("link");if(l.rel=a?"stylesheet":Mc,a||(l.as="script",l.crossOrigin=""),l.href=o,document.head.appendChild(l),a)return new Promise((d,p)=>{l.addEventListener("load",d),l.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${o}`)))})}))}return i.then(()=>t()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})};var Es=function(n,t){return Es=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])},Es(n,t)};function v(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=n}Es(n,t),n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var E=function(){return E=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var i in t=arguments[e])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n},E.apply(this,arguments)};function Pc(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var i=0;for(r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]])}return e}function f(n,t,e,r){return new(e||(e=Promise))(function(i,s){function o(c){try{u(r.next(c))}catch(l){s(l)}}function a(c){try{u(r.throw(c))}catch(l){s(l)}}function u(c){var l;c.done?i(c.value):(l=c.value,l instanceof e?l:new e(function(d){d(l)})).then(o,a)}u((r=r.apply(n,t||[])).next())})}function h(n,t){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(c){return function(l){if(e)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(o=0)),o;)try{if(e=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,r=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(i=o.trys,!((i=i.length>0&&i[i.length-1])||l[0]!==6&&l[0]!==2)){o=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){o.label=l[1];break}if(l[0]===6&&o.label<i[1]){o.label=i[1],i=l;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(l);break}i[2]&&o.ops.pop(),o.trys.pop();continue}l=t.call(n,o)}catch(d){l=[6,d],r=0}finally{e=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}function $(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function G(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r,i,s=e.call(n),o=[];try{for(;(t===void 0||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(e=s.return)&&e.call(s)}finally{if(i)throw i.error}}return o}function Z(n,t,e){if(e||arguments.length===2)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return n.concat(r||Array.prototype.slice.call(t))}var q,nu="4.11.0",Pt=function(){function n(){}return Object.defineProperty(n,"OS_VERSION",{get:function(){return typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"},enumerable:!1,configurable:!0}),Object.defineProperty(n,"SDK_VERSION",{get:function(){return nu},enumerable:!1,configurable:!0}),Object.defineProperty(n,"SDK_MAJOR_VERSION",{get:function(){return n.SDK_VERSION.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(n,"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty(n,"INTERNAL_CALL",{get:function(){return"ic"},enumerable:!1,configurable:!0}),n}();(function(n){n[n.NON_AUTHORIZED=400108]="NON_AUTHORIZED",n[n.INVALID_TOKEN=400111]="INVALID_TOKEN",n[n.NOT_FOUND_IN_DATABASE=400201]="NOT_FOUND_IN_DATABASE",n[n.USER_AUTH_DEACTIVATED=400300]="USER_AUTH_DEACTIVATED",n[n.USER_AUTH_DELETED_OR_NOT_FOUND=400301]="USER_AUTH_DELETED_OR_NOT_FOUND",n[n.SESSION_TOKEN_EXPIRED=400302]="SESSION_TOKEN_EXPIRED",n[n.APPLICATION_NOT_FOUND=400304]="APPLICATION_NOT_FOUND",n[n.SESSION_KEY_EXPIRED=400309]="SESSION_KEY_EXPIRED",n[n.SESSION_REVOKED=400310]="SESSION_REVOKED",n[n.INVALID_SESSION_TYPE=400312]="INVALID_SESSION_TYPE",n[n.STAT_UPLOAD_NOT_ALLOWED=403200]="STAT_UPLOAD_NOT_ALLOWED",n[n.NOT_SUPPORTED_PINNED_MESSAGE_IN_REVIEW_MESSAGE=400940]="NOT_SUPPORTED_PINNED_MESSAGE_IN_REVIEW_MESSAGE",n[n.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",n[n.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",n[n.INVALID_FORM_KEY=400111]="INVALID_FORM_KEY",n[n.INVALID_REQUIRED_FORM_VALUE=400105]="INVALID_REQUIRED_FORM_VALUE",n[n.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",n[n.NOT_SUPPORTED_FEATURE_IN_IN_REVIEW_MESSAGE=901500]="NOT_SUPPORTED_FEATURE_IN_IN_REVIEW_MESSAGE",n[n.ERR_DUPLICATED_DATA=400202]="ERR_DUPLICATED_DATA",n[n.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",n[n.LOST_INSTANCE=700100]="LOST_INSTANCE",n[n.CONNECTION_RENEW=700102]="CONNECTION_RENEW",n[n.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",n[n.INVALID_COMMAND=700700]="INVALID_COMMAND",n[n.XMLHTTPREQUEST_NOT_SUPPORTED=700800]="XMLHTTPREQUEST_NOT_SUPPORTED",n[n.UNKNOWN_ERROR=77e4]="UNKNOWN_ERROR",n[n.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",n[n.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",n[n.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",n[n.INVALID_PARAMETER=800110]="INVALID_PARAMETER",n[n.NOT_SUPPORTED_ERROR=800111]="NOT_SUPPORTED_ERROR",n[n.NETWORK_ERROR=800120]="NETWORK_ERROR",n[n.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",n[n.MALFORMED_DATA=800130]="MALFORMED_DATA",n[n.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",n[n.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",n[n.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",n[n.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",n[n.ACK_TIMEOUT=800180]="ACK_TIMEOUT",n[n.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",n[n.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",n[n.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",n[n.REQUEST_FAILED=800220]="REQUEST_FAILED",n[n.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",n[n.REQUEST_CANCELED=800240]="REQUEST_CANCELED",n[n.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",n[n.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",n[n.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",n[n.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",n[n.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED",n[n.COLLECTION_DISPOSED=800600]="COLLECTION_DISPOSED",n[n.DATABASE_ERROR=800700]="DATABASE_ERROR"})(q||(q={}));var Oe,bs,me,ws,Qn,et=function(n){return!(n instanceof I&&!n.shouldThrowOutside)},I=function(n){function t(e){var r=e.code,i=r===void 0?0:r,s=e.message,o=s===void 0?"":s,a=n.call(this,o)||this;return a.shouldThrowOutside=!1,a._detail="",a.name="SendbirdError",a.code=i,Object.setPrototypeOf(a,t.prototype),a}return v(t,n),Object.defineProperty(t.prototype,"detail",{get:function(){return this._detail},enumerable:!1,configurable:!0}),t.prototype.setDetail=function(e){this._detail=e},Object.defineProperty(t.prototype,"isInvalidTokenError",{get:function(){return this.code===q.INVALID_TOKEN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionExpiredError",{get:function(){return this.isSessionTokenExpiredError||this.isSessionKeyExpiredError},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionTokenExpiredError",{get:function(){return this.code===q.SESSION_TOKEN_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionKeyExpiredError",{get:function(){return this.code===q.SESSION_KEY_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionInvalidatedError",{get:function(){return this.isSessionRevokedError||this.isUserAuthDeactivedError||this.isUserAuthDeletedOrNotFoundError},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionRevokedError",{get:function(){return this.code===q.SESSION_REVOKED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUserAuthDeactivedError",{get:function(){return this.code===q.USER_AUTH_DEACTIVATED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUserAuthDeletedOrNotFoundError",{get:function(){return this.code===q.USER_AUTH_DELETED_OR_NOT_FOUND},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isNetworkError",{get:function(){return this.code===q.NETWORK_ERROR||this.code===q.NETWORK_ROUTING_ERROR},enumerable:!1,configurable:!0}),Object.defineProperty(t,"debugModeRequired",{get:function(){return new t({code:q.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"lostInstance",{get:function(){return new t({code:q.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"invalidCommand",{get:function(){return new t({code:q.INVALID_COMMAND,message:"Cannot send invalid command."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"unknown",{get:function(){return new t({code:q.UNKNOWN_ERROR,message:"Unknown error occurred."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionRenew",{get:function(){return new t({code:q.CONNECTION_RENEW,message:"Connection restarts."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"invalidConnectionStateTransition",{get:function(){return new t({code:q.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"xmlHttpRequestNotSupported",{get:function(){return new t({code:q.XMLHTTPREQUEST_NOT_SUPPORTED,message:"Cannot upload file. XMLHttpRequest is not defined in this environment."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionRequired",{get:function(){return new t({code:q.CONNECTION_REQUIRED,message:"Connection is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionCanceled",{get:function(){return new t({code:q.CONNECTION_CANCELED,message:"Connection is canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"invalidParameters",{get:function(){return new t({code:q.INVALID_PARAMETER,message:"Invalid parameters."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"notSupportedError",{get:function(){return new t({code:q.NOT_SUPPORTED_ERROR,message:"Given parameters are not supported."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"channelTypeNotSupportedError",{get:function(){return new t({code:q.NOT_SUPPORTED_ERROR,message:"Called method is not supported in the current channel's channel type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"networkError",{get:function(){return new t({code:q.NETWORK_ERROR,message:"There was a network error."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"markAsReadAllRateLimitExceeded",{get:function(){return new t({code:q.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"queryInProgress",{get:function(){return new t({code:q.QUERY_IN_PROGRESS,message:"Query in progress."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"noAckTimeout",{get:function(){return new t({code:q.ACK_TIMEOUT,message:"Command received no ack."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"loginTimeout",{get:function(){return new t({code:q.LOGIN_TIMEOUT,message:"Connection timeout."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionClosed",{get:function(){return new t({code:q.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"requestFailed",{get:function(){return new t({code:q.REQUEST_FAILED,message:"Request failed."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"alreadyConnectedAsAnotherUser",{get:function(){return new t({code:q.REQUEST_FAILED,message:"Already logged in as a different user. Call disconnect() first."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"fileUploadCanceled",{get:function(){return new t({code:q.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"requestCanceled",{get:function(){return new t({code:q.REQUEST_CANCELED,message:"Request has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"sessionTokenRefreshFailed",{get:function(){return new t({code:q.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"sessionTokenRequestFailed",{get:function(){return new t({code:q.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"databaseError",{get:function(){return new t({code:q.DATABASE_ERROR,message:"Database error."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"fileSizeLimitExceededError",{get:function(){return new t({code:q.FILE_SIZE_LIMIT_EXCEEDED,message:"File size exceeds the file size limit."})},enumerable:!1,configurable:!0}),t.prototype.throwOutside=function(){throw this.shouldThrowOutside=!0,this},t}(Error),xc=[q.CONNECTION_REQUIRED,q.NETWORK_ERROR,q.ACK_TIMEOUT,q.WEBSOCKET_CONNECTION_CLOSED,q.WEBSOCKET_CONNECTION_FAILED,q.FILE_UPLOAD_CANCEL_FAILED,q.REQUEST_CANCELED,q.INTERNAL_SERVER_ERROR,q.RATE_LIMIT_EXCEEDED,q.UNKNOWN_SERVER_ERROR],Fc=[q.WEBSOCKET_CONNECTION_CLOSED,q.WEBSOCKET_CONNECTION_FAILED,q.CONNECTION_REQUIRED],ru=function(n,t){if(n!==t){var e=E({},n),r=E({},t);return(!e.hasOwnProperty("messageId")||!r.hasOwnProperty("messageId")||e.messageId===r.messageId)&&(!e.hasOwnProperty("reqId")||!r.hasOwnProperty("reqId")||e.reqId===r.reqId)&&(e.hasOwnProperty("messageId")&&delete e.messageId,e.hasOwnProperty("reqId")&&delete e.reqId,r.hasOwnProperty("messageId")&&delete r.messageId,r.hasOwnProperty("reqId")&&delete r.reqId,JSON.stringify(e)===JSON.stringify(r))}return!0},w=function(n,t,e){return e===void 0&&(e=!1),!(!e||!_i(t))||(typeof n!="string"?typeof n=="object"?ce(n,t):qc(n,t):typeof t===n)},ce=function(n,t,e){return e===void 0&&(e=!1),!(!e||!_i(t))||Object.values(n).includes(t)},qc=function(n,t){return t instanceof n},Y=function(n,t,e){return e===void 0&&(e=!1),!(!e||!_i(t))||Array.isArray(t)&&t.every(function(r){return w(n,r)})},zc=function(n){return n>0&&xc.indexOf(n)>=0},ti=function(n){return n>0&&Fc.indexOf(n)>=0},je=function(n,t){if(t===void 0&&(t=!1),t&&_i(n))return!0;var e=typeof n=="object"&&n!==null&&n.hasOwnProperty("name")&&typeof n.name=="string"&&n.hasOwnProperty("uri")&&typeof n.uri=="string"&&n.hasOwnProperty("type")&&typeof n.type=="string";if(!e){if(typeof Blob<"u")return n instanceof Blob;if(typeof File<"u")return n instanceof File}return e},_i=function(n){return n==null},iu=function(){function n(t){var e=t===void 0?{}:t,r=e.useMemberInfoInMessage,i=r===void 0||r,s=e.typingIndicatorInvalidateTime,o=s===void 0?1e4:s,a=e.typingIndicatorThrottle,u=a===void 0?1e3:a,c=e.websocketResponseTimeout,l=c===void 0?1e4:c,d=e.websocketPayloadDecompression,p=d===void 0||d,_=e.sessionTokenRefreshTimeout,m=_===void 0?60:_;this._useMemberInfoInMessage=!0,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._sessionTokenRefreshTimeout=60,this._useMemberInfoInMessage=i,this._typingIndicatorInvalidateTime=o,this._typingIndicatorThrottle=u,this._websocketResponseTimeout=l,this._sessionTokenRefreshTimeout=m,this.websocketPayloadDecompression=p}return Object.defineProperty(n.prototype,"useMemberInfoInMessage",{get:function(){return this._useMemberInfoInMessage},set:function(t){w("boolean",t)&&(this._useMemberInfoInMessage=t)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"typingIndicatorInvalidateTime",{get:function(){return this._typingIndicatorInvalidateTime},set:function(t){w("number",t)&&(this._typingIndicatorInvalidateTime=t)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"typingIndicatorThrottle",{get:function(){return this._typingIndicatorThrottle},set:function(t){w("number",t)&&t>=1e3&&t<=9e3&&(this._typingIndicatorThrottle=t)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"websocketResponseTimeout",{get:function(){return this._websocketResponseTimeout},set:function(t){w("number",t)&&t>=5e3&&t<=3e4&&(this._websocketResponseTimeout=t)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sessionTokenRefreshTimeout",{get:function(){return this._sessionTokenRefreshTimeout},set:function(t){w("number",t)&&(t<60?t=60:t>1800&&(t=1800),this._sessionTokenRefreshTimeout=t)},enumerable:!1,configurable:!0}),n}(),su={encrypt:function(n){return n},decrypt:function(n){return n}},Io=function(){function n(t){var e=t.store;this._preference=new Map,this._store=e}return n.prototype._savePreferenceKeys=function(){return f(this,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:return[4,this._store.set({key:this._keysAddress,value:Z([],G(this._preference.keys()),!1)})];case 1:return t.sent(),[2]}})})},n.prototype.init=function(t,e){var r;return e===void 0&&(e=1),f(this,void 0,void 0,function(){var i,s,o,a,u,c,l,d,p,_;return h(this,function(m){switch(m.label){case 0:return this._version=e,this._keysAddress=t,i="".concat(t,".metadata.version"),[4,this._store.get(i)];case 1:return s=m.sent(),[4,this._store.get(t)];case 2:return o=(r=m.sent())!==null&&r!==void 0?r:[],!s||s.version<this._version?[4,this._resetPreferenceData(o,i)]:[3,4];case 3:return m.sent(),[3,11];case 4:m.trys.push([4,9,10,11]),a=$(o),u=a.next(),m.label=5;case 5:return u.done?[3,8]:(c=u.value,[4,this._store.get(c)]);case 6:(l=m.sent())&&this._preference.set(c,l),m.label=7;case 7:return u=a.next(),[3,5];case 8:return[3,11];case 9:return d=m.sent(),p={error:d},[3,11];case 10:try{u&&!u.done&&(_=a.return)&&_.call(a)}finally{if(p)throw p.error}return[7];case 11:return[2]}})})},n.prototype._resetPreferenceData=function(t,e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return this._preference=new Map,[4,this._store.removeMany(t)];case 1:return r.sent(),[4,this._store.set({key:e,value:{version:this._version}})];case 2:return r.sent(),[2]}})})},n.prototype.get=function(t){return f(this,void 0,void 0,function(){return h(this,function(e){return[2,this._preference.get(t)]})})},n.prototype.set=function(t,e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=!this._preference.has(t),[4,this._store.set({key:t,value:e})];case 1:return i.sent(),this._preference.set(t,e),r?[4,this._savePreferenceKeys()]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}})})},n.prototype.remove=function(t){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this._store.remove(t)];case 1:return e.sent(),this._preference.delete(t),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}})})},n.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:return[4,this._store.removeMany(Z([],G(this._preference.keys()),!1))];case 1:return t.sent(),this._preference.clear(),[4,this._savePreferenceKeys()];case 2:return t.sent(),[2]}})})},n}(),Hc=function(){function n(t){var e=t.encryption,r=t.store,i=t.localCacheEnabled,s=t.localCacheConfig;this.store=r,this.preference=new Io({store:r}),this.encryption=e??su,this.localCacheEnabled=i,this.localCacheConfig=s}return n.prototype.replaceStore=function(t){this.store=t,this.preference=new Io({store:t})},n}();(function(n){n.SUCCESS="success",n.PENDING="pending",n.ERROR="error"})(Oe||(Oe={})),function(n){n.DEFAULT="default",n.ALL="all",n.MENTION_ONLY="mention_only",n.OFF="off"}(bs||(bs={})),function(n){n.FCM="gcm",n.APNS="apns",n.UNKNOWN="unknown"}(me||(me={})),function(n){n.ALTERNATIVE="alternative",n.DEFAULT="default"}(ws||(ws={})),function(n){n.CUSTOM="custom",n.MESSAGE_COLLECTION_ACCESSED_AT="messagecollection_accessed_at"}(Qn||(Qn={}));var lr,ou=function(){function n(t){var e=t===void 0?{}:t,r=e.maxSize,i=r===void 0?256:r,s=e.clearOrder,o=s===void 0?Qn.MESSAGE_COLLECTION_ACCESSED_AT:s,a=e.customClearOrderComparator,u=e.enableAutoResend,c=u===void 0||u;this._clearOrderComparatorUseMessageCollectionAccessedAt=function(l,d){return l.channel.messageCollectionLastAccessedAt===d.channel.messageCollectionLastAccessedAt?l.channel.lastMessage&&!d.channel.lastMessage?1:!l.channel.lastMessage&&d.channel.lastMessage?-1:l.channel.lastMessage||d.channel.lastMessage?l.channel.lastMessage.createdAt-d.channel.lastMessage.createdAt:0:l.channel.messageCollectionLastAccessedAt>d.channel.messageCollectionLastAccessedAt?1:-1},this._maxSize=Math.max(i,64),a?(this._clearOrder=o,this._customClearOrderComparator=a):this._clearOrder=Qn.MESSAGE_COLLECTION_ACCESSED_AT,this._enableAutoResend=c}return Object.defineProperty(n.prototype,"maxSize",{get:function(){return this._maxSize},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"clearOrder",{get:function(){return this._clearOrder},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"clearOrderComparator",{get:function(){var t;return this._clearOrder===Qn.MESSAGE_COLLECTION_ACCESSED_AT?this._clearOrderComparatorUseMessageCollectionAccessedAt:(t=this._customClearOrderComparator)!==null&&t!==void 0?t:this._clearOrderComparatorUseMessageCollectionAccessedAt},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"enableAutoResend",{get:function(){return this._enableAutoResend},enumerable:!1,configurable:!0}),n}();(function(n){n.FEED="feed",n.CHAT="chat"})(lr||(lr={}));var W,ni,To,fe,We,ri,Ue,Be,mt,ue,Co,Is,Ts,$c=function(){function n(){this.isRefreshing=!1}return Object.defineProperty(n.prototype,"hasSession",{get:function(){return!!this.sessionKey},enumerable:!1,configurable:!0}),n.prototype.clear=function(){this.authToken=void 0,this.sessionKey=void 0,this.services=[]},n}(),sn=function(){var n=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(n+16*Math.random())%16|0;return n=Math.floor(n/16),(t==="x"?e:3&e|8).toString(16)})},So=function(){function n(t){var e=t.container;this._container={},this._container=e,this.key=sn()}return n.prototype._register=function(t,e,r){var i;return t in this._container||(this._container[t]=new Map),(i=this._container[t])===null||i===void 0||i.set(this.key,{occurence:e,handler:r}),this},n.prototype.on=function(t,e){return this._register(t,-1,e)},n.prototype.once=function(t,e){return this._register(t,1,e)},n.prototype.close=function(){var t;for(var e in this._container)(t=this._container[e])===null||t===void 0||t.delete(this.key)},n}(),Dn=function(){function n(){this._container={}}return n.prototype.on=function(t,e){return new So({container:this._container}).on(t,e)},n.prototype.once=function(t,e){return new So({container:this._container}).once(t,e)},n.prototype.dispatch=function(t,e){var r,i,s=this._container[t];if(s){var o=[];try{for(var a=$(s.keys()),u=a.next();!u.done;u=a.next()){var c=u.value,l=s.get(c);l.handler(e),l.occurence>0&&(l.occurence--,l.occurence===0&&o.push(c))}}catch(d){r={error:d}}finally{try{u&&!u.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}o.forEach(function(d){return s.delete(d)})}},n}(),Bc=function(){function n(){this._dispatcher=new Dn}return n.prototype.on=function(t){return this._dispatcher.on("event",t)},n.prototype.once=function(t){return this._dispatcher.once("event",t)},n.prototype.dispatch=function(t){this._dispatcher.dispatch("event",t)},n}(),le=function(){},x=function(n){var t={};return n&&Object.keys(n).forEach(function(e){n[e]===void 0||Number.isNaN(n[e])||n[e]===null||(t[e]=n[e])}),t},H=function(n){if(n!=null){if(typeof n=="object"){if(Array.isArray(n)){var t=Z([],G(n),!1);for(var e in t)t[e]=H(t[e]);return t}for(var r in n)n[r]===null&&delete n[r];return n}return n}};(function(n){n.BASE="base",n.GROUP="group",n.OPEN="open",n.FEED="feed"})(W||(W={})),function(n){n.OPERATOR="operator",n.NONE="none"}(ni||(ni={})),function(n){n.MUTED="muted",n.UNMUTED="unmuted"}(To||(To={})),function(n){n.BASE="base",n.USER="user",n.FILE="file",n.ADMIN="admin"}(fe||(fe={})),function(n){n.ALL="",n.USER="MESG",n.FILE="FILE",n.ADMIN="ADMM"}(We||(We={})),function(n){n.USER="MESG",n.FILE="FILE",n.ADMIN="ADMM"}(ri||(ri={})),function(n){n.USERS="users",n.CHANNEL="channel"}(Ue||(Ue={})),function(n){n.ALL="all",n.NONE="none",n.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel"}(Be||(Be={})),function(n){n.DEFAULT="default",n.SUPPRESS="suppress"}(mt||(mt={})),function(n){n.PENDING="pending",n.SCHEDULED="scheduled",n.SUCCEEDED="succeeded",n.FAILED="failed",n.CANCELED="canceled"}(ue||(ue={})),function(n){n.INREVIEW="InReview",n.APPROVED="Approved"}(Co||(Co={})),function(n){n.HIGH="high",n.NORMAL="normal",n.LOW="low"}(Is||(Is={})),function(n){n.CREATED_AT="created_at",n.UPDATED_AT="updated_at"}(Ts||(Ts={}));var O,Ye="v3",ee="/".concat(Ye,"/users"),jc="/".concat(Ye,"/storage/file"),Ws="/".concat(Ye,"/group_channels"),un="/".concat(Ye,"/open_channels"),Gc="/".concat(Ye,"/sdk/open_channels"),Vc="/".concat(Ye,"/search"),Cs="/".concat(Ye,"/report"),Kc="/".concat(Ye,"/emojis"),au="/".concat(Ye,"/emoji_categories"),ut="/".concat(Ye,"/polls"),Qc="/".concat(Ye,"/sdk/ui_kit/configuration"),Wc="/".concat(Ye,"/sdk/statistics"),uu="/".concat(Ye,"/message_templates"),X=function(n){switch(n){case W.FEED:case W.GROUP:return Ws;case W.OPEN:return un;default:return null}},cu=function(n){switch(n){case W.GROUP:return"".concat(Cs,"/group_channels");case W.OPEN:return"".concat(Cs,"/open_channels");default:return null}},In=function(n,t,e){var r,i;switch(n){case Ue.CHANNEL:return!0;case Ue.USERS:if(t)try{for(var s=$(t),o=s.next();!o.done;o=s.next())if(o.value===e)return!0}catch(a){r={error:a}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}}return!1},Ys=function(n,t,e){var r,i,s,o,a=In((r=n.mentionType)!==null&&r!==void 0?r:null,(i=n.mentionedUserIds)!==null&&i!==void 0?i:[],e),u=In((s=t.mentionType)!==null&&s!==void 0?s:null,(o=t.mentionedUserIds)!==null&&o!==void 0?o:[],e);return!a&&u?1:a&&!u?-1:0},lu=function(n,t,e){var r,i=t||new FormData;for(var s in n)if(n.hasOwnProperty(s)){var o=n[s],a=e?"".concat(e,"[").concat(s,"]"):s;je(o)?i.append(a,o,(r=o.name)!==null&&r!==void 0?r:"filename"):typeof o!="object"||o===null||Array.isArray(o)||o instanceof Blob?i.append(a,String(o)):i=lu(o,i,a)}return i};(function(n){n.GET="GET",n.POST="POST",n.PUT="PUT",n.DELETE="DELETE"})(O||(O={}));var De,D=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.params={},e.requireAuth=!0,e.headers={},e.requestId=sn(),e}return v(t,n),t.prototype.encodeParams=function(e){var r=this;return e==null||e===""?encodeURIComponent(""):Array.isArray(e)?e.map(function(i){return r.encodeParams(i)}).join(","):encodeURIComponent(typeof e=="object"?JSON.stringify(e):String(e))},Object.defineProperty(t.prototype,"query",{get:function(){var e=this,r=x(this.params);return"?".concat(Object.keys(r).map(function(i){return"".concat(encodeURIComponent(i),"=").concat(e.encodeParams(r[i]))}).join("&"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"payload",{get:function(){var e=x(this.params);return Object.keys(e).some(function(r){return je(e[r])})?lu(e):JSON.stringify(e)},enumerable:!1,configurable:!0}),t}(le),U=function(n){function t(e,r){var i=n.call(this)||this;return i._iid=e,i._payload=r,i}return v(t,n),Object.defineProperty(t.prototype,"payload",{get:function(){return E({},this._payload)},enumerable:!1,configurable:!0}),t.prototype.as=function(e){return new e(this._iid,this.payload)},t}(le),Yc=function(n){function t(e){var r=n.call(this)||this;return r.requestId=e,r}return v(t,n),t}(le),Tn=function(n){function t(e){var r=e.expires_in,i=e.reason,s=i===void 0?q.SESSION_KEY_EXPIRED:i,o=n.call(this)||this;switch(o.expiresIn=r??0,s){case q.SESSION_KEY_EXPIRED:case q.SESSION_TOKEN_EXPIRED:case q.SESSION_REVOKED:case q.USER_AUTH_DEACTIVATED:case q.USER_AUTH_DELETED_OR_NOT_FOUND:o.error=new I({code:s})}return o}return v(t,n),Object.defineProperty(t.prototype,"invalidateSessionToken",{get:function(){var e;return!!(!((e=this.error)===null||e===void 0)&&e.isSessionTokenExpiredError)},enumerable:!1,configurable:!0}),t}(le),de=function(n){function t(e,r,i,s){s===void 0&&(s="");var o,a=this;return(a=n.call(this)||this)._iid=e,a.code=r,a.payload=i,a.requestId=(o=i.req_id)!==null&&o!==void 0?o:s,a}return v(t,n),t.createFromRawMessage=function(e,r){var i=r.substring(0,4),s={};try{s=JSON.parse(r.substring(4))}catch{i="NOOP"}finally{return new t(e,i,s)}},t.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),`
`)},t.prototype.as=function(e){return new e(this._iid,this.code,this.payload)},t}(le),qe=function(n){function t(e){var r,i=e.code,s=e.ackRequired,o=e.payload,a=o===void 0?{}:o,u=this;return(u=n.call(this)||this).code=i,u.payload=a,u.requestId=(r=u.payload.req_id)!==null&&r!==void 0?r:sn(),u.ackRequired=s,u.payload.req_id=u.requestId,u}return v(t,n),t.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),`
`)},t}(le),Zs=function(n){function t(e){var r=e.userId,i=e.authToken,s=e.services,o=e.expiringSession,a=o===void 0||o,u=n.call(this)||this;return u.path="".concat(ee,"/").concat(r,"/session_key"),u.method=O.POST,u.params=x({token:i,services:s,expiring_session:!!a}),u.requireAuth=!1,u}return v(t,n),t}(D),Zc=function(n){function t(e){var r=e.authToken,i=e.expiringSession,s=i===void 0||i,o=e.requestId,a=o===void 0?void 0:o;return n.call(this,{code:"LOGI",payload:{token:r,expiring_session:s?1:0,req_id:a},ackRequired:!0})||this}return v(t,n),t}(qe),Xc=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.key,o=r.expires_at,a=r.services;return i.key=s,i.expiresAt=o,i.services=a,i}return v(t,n),t}(U),Jc=function(n){function t(e,r,i){var s,o=this;return(o=n.call(this,e,"LOGI",i)||this).error=null,o.newKey=null,o.newKey=(s=i.new_key)!==null&&s!==void 0?s:null,o.error=i.error?new I(i):null,o}return v(t,n),t}(de),Xs=function(n){function t(e){var r=n.call(this)||this;return r.statLog=e,r}return v(t,n),t}(le),du=function(n){function t(e){var r=e.request,i=e.deferred,s=e.error,o=s===void 0?I.requestFailed:s,a=n.call(this)||this;return a.request=r,a.deferred=i,a.error=o,a}return v(t,n),t}(le);(function(n){n.FEATURE_LOCALCACHE="feature:local_cache",n.FEATURE_LOCALCACHE_EVENT="feature:local_cache_event",n.NOTIFICATION="noti:stats",n.WEBSOCKET_CONNECT="ws:connect",n.API_RESULT="api:result"})(De||(De={}));var No,ii,Ao,Cn=function(){function n(t){var e=t.type,r=t.data,i=t.ts,s=i===void 0?Date.now():i;this.type=e,this.createdAt=s,this.data=r}return n.payloadify=function(t){return x({stat_type:t.type,ts:t.createdAt,data:x(t.data)})},n}(),Ss=function(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product=="ReactNative"},ko=function(){return!(typeof navigator>"u"||!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent))};(function(n){n.CHAT="chat",n.CALLS="calls",n.DESK="desk",n.LIVE="live",n.UIKIT_CHAT="uikit-chat",n.UIKIT_LIVE="uikit-live"})(No||(No={})),function(n){n.ANDROID="android",n.IOS="ios",n.JS="js",n.UNREAL="unreal",n.UNITY="unity",n.REACT_NATIVE="react-native",n.FLUTTER="flutter"}(ii||(ii={})),function(n){n.ANDROID="android",n.IOS="ios",n.WEB="web",n.MOBILE_WEB="mobile_web",n.WINDOWS="windows"}(Ao||(Ao={}));var el="^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",si=function(){function n(){}return n.sendbirdSdkUserAgentWithExtension=function(t){var e=Ss()?ii.REACT_NATIVE:ii.JS,r={main_sdk_info:"chat/".concat(e,"/").concat(Pt.SDK_VERSION),device_os_platform:ko()?"mobile-web":"web",os_version:Pt.OS_VERSION};if(t){var i=t.sendbirdExtensions,s=t.deviceOS,o=t.customData,a=o===void 0?{}:o;s.version&&(r.os_version=s.version),s.platform&&(r.device_os_platform=s.platform),i.length>0&&(r.extension_sdk_info=i.map(function(u){var c=u.product,l=u.platform,d=u.version;return"".concat(c,"/").concat(l,"/").concat(d)}).join(",")),Object.keys(r).forEach(function(u){return delete a[u]}),Object.keys(a).length>0&&(r=E(E({},r),a))}return Object.entries(r).map(function(u){var c=G(u,2),l=c[0],d=c[1];return"".concat(l,"=").concat(d)}).join("&")},n.userAgentWithExtension=function(t){var e=Ss()?"reactnative":"JS",r=t.sb_syncmanager?"s".concat(t.sb_syncmanager):"",i=t.sb_uikit?"u".concat(t.sb_uikit):"",s=t["device-os-platform"]?"o".concat(t["device-os-platform"]):ko()?"omobile-web":"oweb";return"".concat(e,"/c").concat(Pt.SDK_VERSION,"/").concat(r,"/").concat(i,"/").concat(s)},n}(),Re=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=function(r){e(r)}})},oi=function(n){function t(e){var r=n.call(this)||this;return r.requestId=e.requestId,r}return v(t,n),t}(le),tl=function(){function n(t,e){var r=e.session,i=e.sdkState,s=e.dispatcher,o=e.logger,a=e.useFetchCompat,u=a!==void 0&&a,c=this;this._abortControl=new Map,this._shouldImportFetchCompat=!1,this._iid=t,this._session=r,this._sdkState=i,this._dispatcher=s,this._dispatcher.on(function(l){l instanceof Yc&&c.cancel(l.requestId)}),this._logger=o,this._shouldImportFetchCompat=u}return n.prototype._createHeader=function(t,e){var r=this._sdkState,i=r.appId,s=r.appVersion,o=r.sendbirdRuntimeEnvironment,a=E(E({},t.headers),{SendBird:"JS,".concat(Pt.OS_VERSION,",").concat(Pt.SDK_VERSION,",").concat(i).concat(s?",".concat(s):""),"SB-User-Agent":si.userAgentWithExtension(this._sdkState.extensions),"Request-Sent-Timestamp":Date.now().toString(),"SB-SDK-User-Agent":si.sendbirdSdkUserAgentWithExtension(o)});return e||(a["Content-Type"]="application/json; charset=utf-8"),t.requireAuth&&this._session.hasSession&&(a["Session-Key"]=this._session.sessionKey),this._session&&this._session.authToken&&(a["App-Id"]=i,a["Access-Token"]=this._session.authToken),a},n.prototype._statLogApiResult=function(t,e,r){this._dispatcher.dispatch(new Xs(new Cn({type:De.API_RESULT,data:{endpoint:t.path,method:t.method,success:!r,latency:Date.now()-e,error_code:r==null?void 0:r.code,error_description:r==null?void 0:r.message}})))},n.prototype.send=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c,l,d,p,_,m,g,y,b,T,C,N,P;return h(this,function(A){switch(A.label){case 0:e=t.path,r=t.method,i=t.uploadProgressHandler,s=![O.GET,O.DELETE].includes(r),o=this._sdkState.api,a="".concat(o.host).concat(e).concat(s?"":t.query),u=s?t.payload:null,c=this._createHeader(t,u instanceof FormData?u:void 0),l=new AbortController,d=l.signal,this._abortControl.set(t.requestId,l),p=Date.now(),A.label=1;case 1:return A.trys.push([1,13,,14]),i?[4,Bi(()=>import("./__bundle-a7f1be50-BKxBhHro.js"),__vite__mapDeps([]))]:[3,6];case 2:_=A.sent().xmlHttpRequest,A.label=3;case 3:return A.trys.push([3,5,,6]),[4,_(this._iid,{requestId:t.requestId,method:t.method,url:a,headers:c,data:u??void 0,uploadProgressHandler:i})];case 4:return m=A.sent(),this._logger.debug("receive api response",t.requestId),this._statLogApiResult(t,p),[2,m];case 5:if(!((g=A.sent())instanceof I&&g.code===q.XMLHTTPREQUEST_NOT_SUPPORTED))throw g;return this._logger.debug("XMLHttpRequest is not available in this environment. progressHandler is ignored."),[3,6];case 6:return this._shouldImportFetchCompat&&(this._shouldImportFetchCompat=!1,(typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{fetch:null}).fetch=null),typeof AbortController<"u"?[3,8]:[4,Bi(()=>import("./__bundle-2aa1a987-C0BOl5_-.js").then(F=>F._),__vite__mapDeps([0,1]))];case 7:A.sent(),A.label=8;case 8:return typeof fetch=="function"?[3,10]:[4,Bi(()=>import("./__bundle-cd03baa7-DTJfn3HF.js").then(F=>F._),__vite__mapDeps([2,1]))];case 9:A.sent(),A.label=10;case 10:return[4,fetch(a,{method:r,body:u,headers:c,signal:d})];case 11:return[4,(y=A.sent()).json()];case 12:if(b=A.sent(),y.ok||y.redirected)return this._logger.debug("receive api response",t.requestId),this._statLogApiResult(t,p),[2,new U(this._iid,b)];if(b){if((T=new I(b)).isSessionExpiredError){if(this._dispatcher.dispatch(new Tn({reason:T.code})),!(t instanceof Zs))return C=new Re,this._dispatcher.dispatch(new du({request:t,deferred:C,error:T})),[2,C.promise];throw T}throw T.isSessionInvalidatedError&&this._dispatcher.dispatch(new Tn({reason:T.code})),T}throw I.requestFailed;case 13:throw N=A.sent(),this._statLogApiResult(t,p,N),N instanceof I?(this._logger.debug("fail api request",N),N):(N==null?void 0:N.name)==="AbortError"?I.requestCanceled:(P=I.networkError,this._logger.debug("fail api request",P),P);case 14:return[2]}})})},n.prototype.cancel=function(t){this._abortControl.has(t)&&(this._abortControl.get(t).abort(),this._abortControl.delete(t)),this._dispatcher.dispatch(new oi({requestId:t}))},n.prototype.cancelAll=function(){var t,e;try{for(var r=$(this._abortControl.values()),i=r.next();!i.done;i=r.next())i.value.abort()}catch(s){t={error:s}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}this._abortControl.clear(),this._dispatcher.dispatch(new oi({}))},n}(),j=function(){};function Rn(n){let t=n.length;for(;--t>=0;)n[t]=0}const Js=256,hu=286,Wn=30,Yn=15,Ns=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Wr=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),nl=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Oo=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),bt=new Array(576);Rn(bt);const Zn=new Array(60);Rn(Zn);const dr=new Array(512);Rn(dr);const Xn=new Array(256);Rn(Xn);const eo=new Array(29);Rn(eo);const ai=new Array(Wn);function ji(n,t,e,r,i){this.static_tree=n,this.extra_bits=t,this.extra_base=e,this.elems=r,this.max_length=i,this.has_stree=n&&n.length}let Do,Ro,Uo;function Gi(n,t){this.dyn_tree=n,this.max_code=0,this.stat_desc=t}Rn(ai);const fu=n=>n<256?dr[n]:dr[256+(n>>>7)],hr=(n,t)=>{n.pending_buf[n.pending++]=255&t,n.pending_buf[n.pending++]=t>>>8&255},$e=(n,t,e)=>{n.bi_valid>16-e?(n.bi_buf|=t<<n.bi_valid&65535,hr(n,n.bi_buf),n.bi_buf=t>>16-n.bi_valid,n.bi_valid+=e-16):(n.bi_buf|=t<<n.bi_valid&65535,n.bi_valid+=e)},ft=(n,t,e)=>{$e(n,e[2*t],e[2*t+1])},pu=(n,t)=>{let e=0;do e|=1&n,n>>>=1,e<<=1;while(--t>0);return e>>>1},_u=(n,t,e)=>{const r=new Array(16);let i,s,o=0;for(i=1;i<=Yn;i++)o=o+e[i-1]<<1,r[i]=o;for(s=0;s<=t;s++){let a=n[2*s+1];a!==0&&(n[2*s]=pu(r[a]++,a))}},vu=n=>{let t;for(t=0;t<hu;t++)n.dyn_ltree[2*t]=0;for(t=0;t<Wn;t++)n.dyn_dtree[2*t]=0;for(t=0;t<19;t++)n.bl_tree[2*t]=0;n.dyn_ltree[512]=1,n.opt_len=n.static_len=0,n.sym_next=n.matches=0},mu=n=>{n.bi_valid>8?hr(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},Mo=(n,t,e,r)=>{const i=2*t,s=2*e;return n[i]<n[s]||n[i]===n[s]&&r[t]<=r[e]},Vi=(n,t,e)=>{const r=n.heap[e];let i=e<<1;for(;i<=n.heap_len&&(i<n.heap_len&&Mo(t,n.heap[i+1],n.heap[i],n.depth)&&i++,!Mo(t,r,n.heap[i],n.depth));)n.heap[e]=n.heap[i],e=i,i<<=1;n.heap[e]=r},Lo=(n,t,e)=>{let r,i,s,o,a=0;if(n.sym_next!==0)do r=255&n.pending_buf[n.sym_buf+a++],r+=(255&n.pending_buf[n.sym_buf+a++])<<8,i=n.pending_buf[n.sym_buf+a++],r===0?ft(n,i,t):(s=Xn[i],ft(n,s+Js+1,t),o=Ns[s],o!==0&&(i-=eo[s],$e(n,i,o)),r--,s=fu(r),ft(n,s,e),o=Wr[s],o!==0&&(r-=ai[s],$e(n,r,o)));while(a<n.sym_next);ft(n,256,t)},Ki=(n,t)=>{const e=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.elems;let o,a,u,c=-1;for(n.heap_len=0,n.heap_max=573,o=0;o<s;o++)e[2*o]!==0?(n.heap[++n.heap_len]=c=o,n.depth[o]=0):e[2*o+1]=0;for(;n.heap_len<2;)u=n.heap[++n.heap_len]=c<2?++c:0,e[2*u]=1,n.depth[u]=0,n.opt_len--,i&&(n.static_len-=r[2*u+1]);for(t.max_code=c,o=n.heap_len>>1;o>=1;o--)Vi(n,e,o);u=s;do o=n.heap[1],n.heap[1]=n.heap[n.heap_len--],Vi(n,e,1),a=n.heap[1],n.heap[--n.heap_max]=o,n.heap[--n.heap_max]=a,e[2*u]=e[2*o]+e[2*a],n.depth[u]=(n.depth[o]>=n.depth[a]?n.depth[o]:n.depth[a])+1,e[2*o+1]=e[2*a+1]=u,n.heap[1]=u++,Vi(n,e,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],((l,d)=>{const p=d.dyn_tree,_=d.max_code,m=d.stat_desc.static_tree,g=d.stat_desc.has_stree,y=d.stat_desc.extra_bits,b=d.stat_desc.extra_base,T=d.stat_desc.max_length;let C,N,P,A,F,z,L=0;for(A=0;A<=Yn;A++)l.bl_count[A]=0;for(p[2*l.heap[l.heap_max]+1]=0,C=l.heap_max+1;C<573;C++)N=l.heap[C],A=p[2*p[2*N+1]+1]+1,A>T&&(A=T,L++),p[2*N+1]=A,N>_||(l.bl_count[A]++,F=0,N>=b&&(F=y[N-b]),z=p[2*N],l.opt_len+=z*(A+F),g&&(l.static_len+=z*(m[2*N+1]+F)));if(L!==0){do{for(A=T-1;l.bl_count[A]===0;)A--;l.bl_count[A]--,l.bl_count[A+1]+=2,l.bl_count[T]--,L-=2}while(L>0);for(A=T;A!==0;A--)for(N=l.bl_count[A];N!==0;)P=l.heap[--C],P>_||(p[2*P+1]!==A&&(l.opt_len+=(A-p[2*P+1])*p[2*P],p[2*P+1]=A),N--)}})(n,t),_u(e,c,n.bl_count)},Po=(n,t,e)=>{let r,i,s=-1,o=t[1],a=0,u=7,c=4;for(o===0&&(u=138,c=3),t[2*(e+1)+1]=65535,r=0;r<=e;r++)i=o,o=t[2*(r+1)+1],++a<u&&i===o||(a<c?n.bl_tree[2*i]+=a:i!==0?(i!==s&&n.bl_tree[2*i]++,n.bl_tree[32]++):a<=10?n.bl_tree[34]++:n.bl_tree[36]++,a=0,s=i,o===0?(u=138,c=3):i===o?(u=6,c=3):(u=7,c=4))},xo=(n,t,e)=>{let r,i,s=-1,o=t[1],a=0,u=7,c=4;for(o===0&&(u=138,c=3),r=0;r<=e;r++)if(i=o,o=t[2*(r+1)+1],!(++a<u&&i===o)){if(a<c)do ft(n,i,n.bl_tree);while(--a!=0);else i!==0?(i!==s&&(ft(n,i,n.bl_tree),a--),ft(n,16,n.bl_tree),$e(n,a-3,2)):a<=10?(ft(n,17,n.bl_tree),$e(n,a-3,3)):(ft(n,18,n.bl_tree),$e(n,a-11,7));a=0,s=i,o===0?(u=138,c=3):i===o?(u=6,c=3):(u=7,c=4)}};let Fo=!1;const gu=(n,t,e,r)=>{$e(n,0+(r?1:0),3),mu(n),hr(n,e),hr(n,~e),e&&n.pending_buf.set(n.window.subarray(t,t+e),n.pending),n.pending+=e};var rl=(n,t,e,r)=>{let i,s,o=0;n.level>0?(n.strm.data_type===2&&(n.strm.data_type=(a=>{let u,c=4093624447;for(u=0;u<=31;u++,c>>>=1)if(1&c&&a.dyn_ltree[2*u]!==0)return 0;if(a.dyn_ltree[18]!==0||a.dyn_ltree[20]!==0||a.dyn_ltree[26]!==0)return 1;for(u=32;u<Js;u++)if(a.dyn_ltree[2*u]!==0)return 1;return 0})(n)),Ki(n,n.l_desc),Ki(n,n.d_desc),o=(a=>{let u;for(Po(a,a.dyn_ltree,a.l_desc.max_code),Po(a,a.dyn_dtree,a.d_desc.max_code),Ki(a,a.bl_desc),u=18;u>=3&&a.bl_tree[2*Oo[u]+1]===0;u--);return a.opt_len+=3*(u+1)+5+5+4,u})(n),i=n.opt_len+3+7>>>3,s=n.static_len+3+7>>>3,s<=i&&(i=s)):i=s=e+5,e+4<=i&&t!==-1?gu(n,t,e,r):n.strategy===4||s===i?($e(n,2+(r?1:0),3),Lo(n,bt,Zn)):($e(n,4+(r?1:0),3),((a,u,c,l)=>{let d;for($e(a,u-257,5),$e(a,c-1,5),$e(a,l-4,4),d=0;d<l;d++)$e(a,a.bl_tree[2*Oo[d]+1],3);xo(a,a.dyn_ltree,u-1),xo(a,a.dyn_dtree,c-1)})(n,n.l_desc.max_code+1,n.d_desc.max_code+1,o+1),Lo(n,n.dyn_ltree,n.dyn_dtree)),vu(n),r&&mu(n)},il={_tr_init:n=>{Fo||((()=>{let t,e,r,i,s;const o=new Array(16);for(r=0,i=0;i<28;i++)for(eo[i]=r,t=0;t<1<<Ns[i];t++)Xn[r++]=i;for(Xn[r-1]=i,s=0,i=0;i<16;i++)for(ai[i]=s,t=0;t<1<<Wr[i];t++)dr[s++]=i;for(s>>=7;i<Wn;i++)for(ai[i]=s<<7,t=0;t<1<<Wr[i]-7;t++)dr[256+s++]=i;for(e=0;e<=Yn;e++)o[e]=0;for(t=0;t<=143;)bt[2*t+1]=8,t++,o[8]++;for(;t<=255;)bt[2*t+1]=9,t++,o[9]++;for(;t<=279;)bt[2*t+1]=7,t++,o[7]++;for(;t<=287;)bt[2*t+1]=8,t++,o[8]++;for(_u(bt,287,o),t=0;t<Wn;t++)Zn[2*t+1]=5,Zn[2*t]=pu(t,5);Do=new ji(bt,Ns,257,hu,Yn),Ro=new ji(Zn,Wr,0,Wn,Yn),Uo=new ji(new Array(0),nl,0,19,7)})(),Fo=!0),n.l_desc=new Gi(n.dyn_ltree,Do),n.d_desc=new Gi(n.dyn_dtree,Ro),n.bl_desc=new Gi(n.bl_tree,Uo),n.bi_buf=0,n.bi_valid=0,vu(n)},_tr_stored_block:gu,_tr_flush_block:rl,_tr_tally:(n,t,e)=>(n.pending_buf[n.sym_buf+n.sym_next++]=t,n.pending_buf[n.sym_buf+n.sym_next++]=t>>8,n.pending_buf[n.sym_buf+n.sym_next++]=e,t===0?n.dyn_ltree[2*e]++:(n.matches++,t--,n.dyn_ltree[2*(Xn[e]+Js+1)]++,n.dyn_dtree[2*fu(t)]++),n.sym_next===n.sym_end),_tr_align:n=>{$e(n,2,3),ft(n,256,bt),(t=>{t.bi_valid===16?(hr(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(n)}},Jn=(n,t,e,r)=>{let i=65535&n|0,s=n>>>16&65535|0,o=0;for(;e!==0;){o=e>2e3?2e3:e,e-=o;do i=i+t[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};const sl=new Uint32Array((()=>{let n,t=[];for(var e=0;e<256;e++){n=e;for(var r=0;r<8;r++)n=1&n?3988292384^n>>>1:n>>>1;t[e]=n}return t})());var we=(n,t,e,r)=>{const i=sl,s=r+e;n^=-1;for(let o=r;o<s;o++)n=n>>>8^i[255&(n^t[o])];return-1^n},on={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},cn={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ol,_tr_stored_block:As,_tr_flush_block:al,_tr_tally:xt,_tr_align:ul}=il,{Z_NO_FLUSH:Ft,Z_PARTIAL_FLUSH:cl,Z_FULL_FLUSH:ll,Z_FINISH:tt,Z_BLOCK:qo,Z_OK:Ce,Z_STREAM_END:zo,Z_STREAM_ERROR:dt,Z_DATA_ERROR:dl,Z_BUF_ERROR:Qi,Z_DEFAULT_COMPRESSION:hl,Z_FILTERED:fl,Z_HUFFMAN_ONLY:Or,Z_RLE:pl,Z_FIXED:_l,Z_DEFAULT_STRATEGY:vl,Z_UNKNOWN:ml,Z_DEFLATED:ui}=cn,Zt=258,vt=262,bn=42,Kt=113,$n=666,Qt=(n,t)=>(n.msg=on[t],t),Ho=n=>2*n-(n>4?9:0),Lt=n=>{let t=n.length;for(;--t>=0;)n[t]=0},gl=n=>{let t,e,r,i=n.w_size;t=n.hash_size,r=t;do e=n.head[--r],n.head[r]=e>=i?e-i:0;while(--t);t=i,r=t;do e=n.prev[--r],n.prev[r]=e>=i?e-i:0;while(--t)};let qt=(n,t,e)=>(t<<n.hash_shift^e)&n.hash_mask;const Ge=n=>{const t=n.state;let e=t.pending;e>n.avail_out&&(e=n.avail_out),e!==0&&(n.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+e),n.next_out),n.next_out+=e,t.pending_out+=e,n.total_out+=e,n.avail_out-=e,t.pending-=e,t.pending===0&&(t.pending_out=0))},Ke=(n,t)=>{al(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,t),n.block_start=n.strstart,Ge(n.strm)},oe=(n,t)=>{n.pending_buf[n.pending++]=t},qn=(n,t)=>{n.pending_buf[n.pending++]=t>>>8&255,n.pending_buf[n.pending++]=255&t},ks=(n,t,e,r)=>{let i=n.avail_in;return i>r&&(i=r),i===0?0:(n.avail_in-=i,t.set(n.input.subarray(n.next_in,n.next_in+i),e),n.state.wrap===1?n.adler=Jn(n.adler,t,i,e):n.state.wrap===2&&(n.adler=we(n.adler,t,i,e)),n.next_in+=i,n.total_in+=i,i)},yu=(n,t)=>{let e,r,i=n.max_chain_length,s=n.strstart,o=n.prev_length,a=n.nice_match;const u=n.strstart>n.w_size-vt?n.strstart-(n.w_size-vt):0,c=n.window,l=n.w_mask,d=n.prev,p=n.strstart+Zt;let _=c[s+o-1],m=c[s+o];n.prev_length>=n.good_match&&(i>>=2),a>n.lookahead&&(a=n.lookahead);do if(e=t,c[e+o]===m&&c[e+o-1]===_&&c[e]===c[s]&&c[++e]===c[s+1]){s+=2,e++;do;while(c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&s<p);if(r=Zt-(p-s),s=p-Zt,r>o){if(n.match_start=t,o=r,r>=a)break;_=c[s+o-1],m=c[s+o]}}while((t=d[t&l])>u&&--i!=0);return o<=n.lookahead?o:n.lookahead},gn=n=>{const t=n.w_size;let e,r,i;do{if(r=n.window_size-n.lookahead-n.strstart,n.strstart>=t+(t-vt)&&(n.window.set(n.window.subarray(t,t+t-r),0),n.match_start-=t,n.strstart-=t,n.block_start-=t,n.insert>n.strstart&&(n.insert=n.strstart),gl(n),r+=t),n.strm.avail_in===0)break;if(e=ks(n.strm,n.window,n.strstart+n.lookahead,r),n.lookahead+=e,n.lookahead+n.insert>=3)for(i=n.strstart-n.insert,n.ins_h=n.window[i],n.ins_h=qt(n,n.ins_h,n.window[i+1]);n.insert&&(n.ins_h=qt(n,n.ins_h,n.window[i+3-1]),n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++,n.insert--,!(n.lookahead+n.insert<3)););}while(n.lookahead<vt&&n.strm.avail_in!==0)},Eu=(n,t)=>{let e,r,i,s=n.pending_buf_size-5>n.w_size?n.w_size:n.pending_buf_size-5,o=0,a=n.strm.avail_in;do{if(e=65535,i=n.bi_valid+42>>3,n.strm.avail_out<i||(i=n.strm.avail_out-i,r=n.strstart-n.block_start,e>r+n.strm.avail_in&&(e=r+n.strm.avail_in),e>i&&(e=i),e<s&&(e===0&&t!==tt||t===Ft||e!==r+n.strm.avail_in)))break;o=t===tt&&e===r+n.strm.avail_in?1:0,As(n,0,0,o),n.pending_buf[n.pending-4]=e,n.pending_buf[n.pending-3]=e>>8,n.pending_buf[n.pending-2]=~e,n.pending_buf[n.pending-1]=~e>>8,Ge(n.strm),r&&(r>e&&(r=e),n.strm.output.set(n.window.subarray(n.block_start,n.block_start+r),n.strm.next_out),n.strm.next_out+=r,n.strm.avail_out-=r,n.strm.total_out+=r,n.block_start+=r,e-=r),e&&(ks(n.strm,n.strm.output,n.strm.next_out,e),n.strm.next_out+=e,n.strm.avail_out-=e,n.strm.total_out+=e)}while(o===0);return a-=n.strm.avail_in,a&&(a>=n.w_size?(n.matches=2,n.window.set(n.strm.input.subarray(n.strm.next_in-n.w_size,n.strm.next_in),0),n.strstart=n.w_size,n.insert=n.strstart):(n.window_size-n.strstart<=a&&(n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,n.insert>n.strstart&&(n.insert=n.strstart)),n.window.set(n.strm.input.subarray(n.strm.next_in-a,n.strm.next_in),n.strstart),n.strstart+=a,n.insert+=a>n.w_size-n.insert?n.w_size-n.insert:a),n.block_start=n.strstart),n.high_water<n.strstart&&(n.high_water=n.strstart),o?4:t!==Ft&&t!==tt&&n.strm.avail_in===0&&n.strstart===n.block_start?2:(i=n.window_size-n.strstart,n.strm.avail_in>i&&n.block_start>=n.w_size&&(n.block_start-=n.w_size,n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,i+=n.w_size,n.insert>n.strstart&&(n.insert=n.strstart)),i>n.strm.avail_in&&(i=n.strm.avail_in),i&&(ks(n.strm,n.window,n.strstart,i),n.strstart+=i,n.insert+=i>n.w_size-n.insert?n.w_size-n.insert:i),n.high_water<n.strstart&&(n.high_water=n.strstart),i=n.bi_valid+42>>3,i=n.pending_buf_size-i>65535?65535:n.pending_buf_size-i,s=i>n.w_size?n.w_size:i,r=n.strstart-n.block_start,(r>=s||(r||t===tt)&&t!==Ft&&n.strm.avail_in===0&&r<=i)&&(e=r>i?i:r,o=t===tt&&n.strm.avail_in===0&&e===r?1:0,As(n,n.block_start,e,o),n.block_start+=e,Ge(n.strm)),o?3:1)},Wi=(n,t)=>{let e,r;for(;;){if(n.lookahead<vt){if(gn(n),n.lookahead<vt&&t===Ft)return 1;if(n.lookahead===0)break}if(e=0,n.lookahead>=3&&(n.ins_h=qt(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),e!==0&&n.strstart-e<=n.w_size-vt&&(n.match_length=yu(n,e)),n.match_length>=3)if(r=xt(n,n.strstart-n.match_start,n.match_length-3),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=3){n.match_length--;do n.strstart++,n.ins_h=qt(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart;while(--n.match_length!=0);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=qt(n,n.ins_h,n.window[n.strstart+1]);else r=xt(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(r&&(Ke(n,!1),n.strm.avail_out===0))return 1}return n.insert=n.strstart<2?n.strstart:2,t===tt?(Ke(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(Ke(n,!1),n.strm.avail_out===0)?1:2},_n=(n,t)=>{let e,r,i;for(;;){if(n.lookahead<vt){if(gn(n),n.lookahead<vt&&t===Ft)return 1;if(n.lookahead===0)break}if(e=0,n.lookahead>=3&&(n.ins_h=qt(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=2,e!==0&&n.prev_length<n.max_lazy_match&&n.strstart-e<=n.w_size-vt&&(n.match_length=yu(n,e),n.match_length<=5&&(n.strategy===fl||n.match_length===3&&n.strstart-n.match_start>4096)&&(n.match_length=2)),n.prev_length>=3&&n.match_length<=n.prev_length){i=n.strstart+n.lookahead-3,r=xt(n,n.strstart-1-n.prev_match,n.prev_length-3),n.lookahead-=n.prev_length-1,n.prev_length-=2;do++n.strstart<=i&&(n.ins_h=qt(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart);while(--n.prev_length!=0);if(n.match_available=0,n.match_length=2,n.strstart++,r&&(Ke(n,!1),n.strm.avail_out===0))return 1}else if(n.match_available){if(r=xt(n,0,n.window[n.strstart-1]),r&&Ke(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return 1}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(r=xt(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<2?n.strstart:2,t===tt?(Ke(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(Ke(n,!1),n.strm.avail_out===0)?1:2};function ct(n,t,e,r,i){this.good_length=n,this.max_lazy=t,this.nice_length=e,this.max_chain=r,this.func=i}const Bn=[new ct(0,0,0,0,Eu),new ct(4,4,8,4,Wi),new ct(4,5,16,8,Wi),new ct(4,6,32,32,Wi),new ct(4,4,16,16,_n),new ct(8,16,32,32,_n),new ct(8,16,128,128,_n),new ct(8,32,128,256,_n),new ct(32,128,258,1024,_n),new ct(32,258,258,4096,_n)];function yl(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ui,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Lt(this.dyn_ltree),Lt(this.dyn_dtree),Lt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Lt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Lt(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const jn=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.status!==bn&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Kt&&t.status!==$n?1:0},bu=n=>{if(jn(n))return Qt(n,dt);n.total_in=n.total_out=0,n.data_type=ml;const t=n.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?bn:Kt,n.adler=t.wrap===2?0:1,t.last_flush=-2,ol(t),Ce},wu=n=>{const t=bu(n);var e;return t===Ce&&((e=n.state).window_size=2*e.w_size,Lt(e.head),e.max_lazy_match=Bn[e.level].max_lazy,e.good_match=Bn[e.level].good_length,e.nice_match=Bn[e.level].nice_length,e.max_chain_length=Bn[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),t},$o=(n,t,e,r,i,s)=>{if(!n)return dt;let o=1;if(t===hl&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>9||e!==ui||r<8||r>15||t<0||t>9||s<0||s>_l||r===8&&o!==1)return Qt(n,dt);r===8&&(r=9);const a=new yl;return n.state=a,a.strm=n,a.status=bn,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=s,a.method=e,wu(n)};var er={deflateInit:(n,t)=>$o(n,t,ui,15,8,vl),deflateInit2:$o,deflateReset:wu,deflateResetKeep:bu,deflateSetHeader:(n,t)=>jn(n)||n.state.wrap!==2?dt:(n.state.gzhead=t,Ce),deflate:(n,t)=>{if(jn(n)||t>qo||t<0)return n?Qt(n,dt):dt;const e=n.state;if(!n.output||n.avail_in!==0&&!n.input||e.status===$n&&t!==tt)return Qt(n,n.avail_out===0?Qi:dt);const r=e.last_flush;if(e.last_flush=t,e.pending!==0){if(Ge(n),n.avail_out===0)return e.last_flush=-1,Ce}else if(n.avail_in===0&&Ho(t)<=Ho(r)&&t!==tt)return Qt(n,Qi);if(e.status===$n&&n.avail_in!==0)return Qt(n,Qi);if(e.status===bn&&e.wrap===0&&(e.status=Kt),e.status===bn){let i=ui+(e.w_bits-8<<4)<<8,s=-1;if(s=e.strategy>=Or||e.level<2?0:e.level<6?1:e.level===6?2:3,i|=s<<6,e.strstart!==0&&(i|=32),i+=31-i%31,qn(e,i),e.strstart!==0&&(qn(e,n.adler>>>16),qn(e,65535&n.adler)),n.adler=1,e.status=Kt,Ge(n),e.pending!==0)return e.last_flush=-1,Ce}if(e.status===57){if(n.adler=0,oe(e,31),oe(e,139),oe(e,8),e.gzhead)oe(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),oe(e,255&e.gzhead.time),oe(e,e.gzhead.time>>8&255),oe(e,e.gzhead.time>>16&255),oe(e,e.gzhead.time>>24&255),oe(e,e.level===9?2:e.strategy>=Or||e.level<2?4:0),oe(e,255&e.gzhead.os),e.gzhead.extra&&e.gzhead.extra.length&&(oe(e,255&e.gzhead.extra.length),oe(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(n.adler=we(n.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=69;else if(oe(e,0),oe(e,0),oe(e,0),oe(e,0),oe(e,0),oe(e,e.level===9?2:e.strategy>=Or||e.level<2?4:0),oe(e,3),e.status=Kt,Ge(n),e.pending!==0)return e.last_flush=-1,Ce}if(e.status===69){if(e.gzhead.extra){let i=e.pending,s=(65535&e.gzhead.extra.length)-e.gzindex;for(;e.pending+s>e.pending_buf_size;){let a=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+a),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>i&&(n.adler=we(n.adler,e.pending_buf,e.pending-i,i)),e.gzindex+=a,Ge(n),e.pending!==0)return e.last_flush=-1,Ce;i=0,s-=a}let o=new Uint8Array(e.gzhead.extra);e.pending_buf.set(o.subarray(e.gzindex,e.gzindex+s),e.pending),e.pending+=s,e.gzhead.hcrc&&e.pending>i&&(n.adler=we(n.adler,e.pending_buf,e.pending-i,i)),e.gzindex=0}e.status=73}if(e.status===73){if(e.gzhead.name){let i,s=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(n.adler=we(n.adler,e.pending_buf,e.pending-s,s)),Ge(n),e.pending!==0)return e.last_flush=-1,Ce;s=0}i=e.gzindex<e.gzhead.name.length?255&e.gzhead.name.charCodeAt(e.gzindex++):0,oe(e,i)}while(i!==0);e.gzhead.hcrc&&e.pending>s&&(n.adler=we(n.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=91}if(e.status===91){if(e.gzhead.comment){let i,s=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(n.adler=we(n.adler,e.pending_buf,e.pending-s,s)),Ge(n),e.pending!==0)return e.last_flush=-1,Ce;s=0}i=e.gzindex<e.gzhead.comment.length?255&e.gzhead.comment.charCodeAt(e.gzindex++):0,oe(e,i)}while(i!==0);e.gzhead.hcrc&&e.pending>s&&(n.adler=we(n.adler,e.pending_buf,e.pending-s,s))}e.status=103}if(e.status===103){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(Ge(n),e.pending!==0))return e.last_flush=-1,Ce;oe(e,255&n.adler),oe(e,n.adler>>8&255),n.adler=0}if(e.status=Kt,Ge(n),e.pending!==0)return e.last_flush=-1,Ce}if(n.avail_in!==0||e.lookahead!==0||t!==Ft&&e.status!==$n){let i=e.level===0?Eu(e,t):e.strategy===Or?((s,o)=>{let a;for(;;){if(s.lookahead===0&&(gn(s),s.lookahead===0)){if(o===Ft)return 1;break}if(s.match_length=0,a=xt(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,a&&(Ke(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===tt?(Ke(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Ke(s,!1),s.strm.avail_out===0)?1:2})(e,t):e.strategy===pl?((s,o)=>{let a,u,c,l;const d=s.window;for(;;){if(s.lookahead<=Zt){if(gn(s),s.lookahead<=Zt&&o===Ft)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(c=s.strstart-1,u=d[c],u===d[++c]&&u===d[++c]&&u===d[++c])){l=s.strstart+Zt;do;while(u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&c<l);s.match_length=Zt-(l-c),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(a=xt(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(a=xt(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),a&&(Ke(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===tt?(Ke(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Ke(s,!1),s.strm.avail_out===0)?1:2})(e,t):Bn[e.level].func(e,t);if(i!==3&&i!==4||(e.status=$n),i===1||i===3)return n.avail_out===0&&(e.last_flush=-1),Ce;if(i===2&&(t===cl?ul(e):t!==qo&&(As(e,0,0,!1),t===ll&&(Lt(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),Ge(n),n.avail_out===0))return e.last_flush=-1,Ce}return t!==tt?Ce:e.wrap<=0?zo:(e.wrap===2?(oe(e,255&n.adler),oe(e,n.adler>>8&255),oe(e,n.adler>>16&255),oe(e,n.adler>>24&255),oe(e,255&n.total_in),oe(e,n.total_in>>8&255),oe(e,n.total_in>>16&255),oe(e,n.total_in>>24&255)):(qn(e,n.adler>>>16),qn(e,65535&n.adler)),Ge(n),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?Ce:zo)},deflateEnd:n=>{if(jn(n))return dt;const t=n.state.status;return n.state=null,t===Kt?Qt(n,dl):Ce},deflateSetDictionary:(n,t)=>{let e=t.length;if(jn(n))return dt;const r=n.state,i=r.wrap;if(i===2||i===1&&r.status!==bn||r.lookahead)return dt;if(i===1&&(n.adler=Jn(n.adler,t,e,0)),r.wrap=0,e>=r.w_size){i===0&&(Lt(r.head),r.strstart=0,r.block_start=0,r.insert=0);let u=new Uint8Array(r.w_size);u.set(t.subarray(e-r.w_size,e),0),t=u,e=r.w_size}const s=n.avail_in,o=n.next_in,a=n.input;for(n.avail_in=e,n.next_in=0,n.input=t,gn(r);r.lookahead>=3;){let u=r.strstart,c=r.lookahead-2;do r.ins_h=qt(r,r.ins_h,r.window[u+3-1]),r.prev[u&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=u,u++;while(--c);r.strstart=u,r.lookahead=2,gn(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,n.next_in=o,n.input=a,n.avail_in=s,r.wrap=i,Ce},deflateInfo:"pako deflate (from Nodeca project)"};const El=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);var vi={assign:function(n){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const r in e)El(e,r)&&(n[r]=e[r])}}return n},flattenChunks:n=>{let t=0;for(let r=0,i=n.length;r<i;r++)t+=n[r].length;const e=new Uint8Array(t);for(let r=0,i=0,s=n.length;r<s;r++){let o=n[r];e.set(o,i),i+=o.length}return e}};let Iu=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Iu=!1}const fr=new Uint8Array(256);for(let n=0;n<256;n++)fr[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;fr[254]=fr[254]=1;var pr={string2buf:n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let t,e,r,i,s,o=n.length,a=0;for(i=0;i<o;i++)e=n.charCodeAt(i),(64512&e)==55296&&i+1<o&&(r=n.charCodeAt(i+1),(64512&r)==56320&&(e=65536+(e-55296<<10)+(r-56320),i++)),a+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(a),s=0,i=0;s<a;i++)e=n.charCodeAt(i),(64512&e)==55296&&i+1<o&&(r=n.charCodeAt(i+1),(64512&r)==56320&&(e=65536+(e-55296<<10)+(r-56320),i++)),e<128?t[s++]=e:e<2048?(t[s++]=192|e>>>6,t[s++]=128|63&e):e<65536?(t[s++]=224|e>>>12,t[s++]=128|e>>>6&63,t[s++]=128|63&e):(t[s++]=240|e>>>18,t[s++]=128|e>>>12&63,t[s++]=128|e>>>6&63,t[s++]=128|63&e);return t},buf2string:(n,t)=>{const e=t||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,t));let r,i;const s=new Array(2*e);for(i=0,r=0;r<e;){let o=n[r++];if(o<128){s[i++]=o;continue}let a=fr[o];if(a>4)s[i++]=65533,r+=a-1;else{for(o&=a===2?31:a===3?15:7;a>1&&r<e;)o=o<<6|63&n[r++],a--;a>1?s[i++]=65533:o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|1023&o)}}return((o,a)=>{if(a<65534&&o.subarray&&Iu)return String.fromCharCode.apply(null,o.length===a?o:o.subarray(0,a));let u="";for(let c=0;c<a;c++)u+=String.fromCharCode(o[c]);return u})(s,i)},utf8border:(n,t)=>{(t=t||n.length)>n.length&&(t=n.length);let e=t-1;for(;e>=0&&(192&n[e])==128;)e--;return e<0||e===0?t:e+fr[n[e]]>t?e:t}},Tu=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Cu=Object.prototype.toString,{Z_NO_FLUSH:bl,Z_SYNC_FLUSH:wl,Z_FULL_FLUSH:Il,Z_FINISH:Tl,Z_OK:ci,Z_STREAM_END:Cl,Z_DEFAULT_COMPRESSION:Sl,Z_DEFAULT_STRATEGY:Nl,Z_DEFLATED:Al}=cn;function tr(n){this.options=vi.assign({level:Sl,method:Al,chunkSize:16384,windowBits:15,memLevel:8,strategy:Nl},n||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Tu,this.strm.avail_out=0;let e=er.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==ci)throw new Error(on[e]);if(t.header&&er.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?pr.string2buf(t.dictionary):Cu.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,e=er.deflateSetDictionary(this.strm,r),e!==ci)throw new Error(on[e]);this._dict_set=!0}}function Yi(n,t){const e=new tr(t);if(e.push(n,!0),e.err)throw e.msg||on[e.err];return e.result}tr.prototype.push=function(n,t){const e=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=t===~~t?t:t===!0?Tl:bl,typeof n=="string"?e.input=pr.string2buf(n):Cu.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;)if(e.avail_out===0&&(e.output=new Uint8Array(r),e.next_out=0,e.avail_out=r),(s===wl||s===Il)&&e.avail_out<=6)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else{if(i=er.deflate(e,s),i===Cl)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),i=er.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===ci;if(e.avail_out!==0){if(s>0&&e.next_out>0)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else if(e.avail_in===0)break}else this.onData(e.output)}return!0},tr.prototype.onData=function(n){this.chunks.push(n)},tr.prototype.onEnd=function(n){n===ci&&(this.result=vi.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var kl={Deflate:tr,deflate:Yi,deflateRaw:function(n,t){return(t=t||{}).raw=!0,Yi(n,t)},gzip:function(n,t){return(t=t||{}).gzip=!0,Yi(n,t)},constants:cn};const Dr=16209;var Ol=function(n,t){let e,r,i,s,o,a,u,c,l,d,p,_,m,g,y,b,T,C,N,P,A,F,z,L;const M=n.state;e=n.next_in,z=n.input,r=e+(n.avail_in-5),i=n.next_out,L=n.output,s=i-(t-n.avail_out),o=i+(n.avail_out-257),a=M.dmax,u=M.wsize,c=M.whave,l=M.wnext,d=M.window,p=M.hold,_=M.bits,m=M.lencode,g=M.distcode,y=(1<<M.lenbits)-1,b=(1<<M.distbits)-1;e:do{_<15&&(p+=z[e++]<<_,_+=8,p+=z[e++]<<_,_+=8),T=m[p&y];t:for(;;){if(C=T>>>24,p>>>=C,_-=C,C=T>>>16&255,C===0)L[i++]=65535&T;else{if(!(16&C)){if(!(64&C)){T=m[(65535&T)+(p&(1<<C)-1)];continue t}if(32&C){M.mode=16191;break e}n.msg="invalid literal/length code",M.mode=Dr;break e}N=65535&T,C&=15,C&&(_<C&&(p+=z[e++]<<_,_+=8),N+=p&(1<<C)-1,p>>>=C,_-=C),_<15&&(p+=z[e++]<<_,_+=8,p+=z[e++]<<_,_+=8),T=g[p&b];n:for(;;){if(C=T>>>24,p>>>=C,_-=C,C=T>>>16&255,!(16&C)){if(!(64&C)){T=g[(65535&T)+(p&(1<<C)-1)];continue n}n.msg="invalid distance code",M.mode=Dr;break e}if(P=65535&T,C&=15,_<C&&(p+=z[e++]<<_,_+=8,_<C&&(p+=z[e++]<<_,_+=8)),P+=p&(1<<C)-1,P>a){n.msg="invalid distance too far back",M.mode=Dr;break e}if(p>>>=C,_-=C,C=i-s,P>C){if(C=P-C,C>c&&M.sane){n.msg="invalid distance too far back",M.mode=Dr;break e}if(A=0,F=d,l===0){if(A+=u-C,C<N){N-=C;do L[i++]=d[A++];while(--C);A=i-P,F=L}}else if(l<C){if(A+=u+l-C,C-=l,C<N){N-=C;do L[i++]=d[A++];while(--C);if(A=0,l<N){C=l,N-=C;do L[i++]=d[A++];while(--C);A=i-P,F=L}}}else if(A+=l-C,C<N){N-=C;do L[i++]=d[A++];while(--C);A=i-P,F=L}for(;N>2;)L[i++]=F[A++],L[i++]=F[A++],L[i++]=F[A++],N-=3;N&&(L[i++]=F[A++],N>1&&(L[i++]=F[A++]))}else{A=i-P;do L[i++]=L[A++],L[i++]=L[A++],L[i++]=L[A++],N-=3;while(N>2);N&&(L[i++]=L[A++],N>1&&(L[i++]=L[A++]))}break}}break}}while(e<r&&i<o);N=_>>3,e-=N,_-=N<<3,p&=(1<<_)-1,n.next_in=e,n.next_out=i,n.avail_in=e<r?r-e+5:5-(e-r),n.avail_out=i<o?o-i+257:257-(i-o),M.hold=p,M.bits=_};const Rr=15,Dl=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Rl=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ul=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Ml=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var nr=(n,t,e,r,i,s,o,a)=>{const u=a.bits;let c,l,d,p,_,m,g=0,y=0,b=0,T=0,C=0,N=0,P=0,A=0,F=0,z=0,L=null;const M=new Uint16Array(16),se=new Uint16Array(16);let Le,st,At,yt=null;for(g=0;g<=Rr;g++)M[g]=0;for(y=0;y<r;y++)M[t[e+y]]++;for(C=u,T=Rr;T>=1&&M[T]===0;T--);if(C>T&&(C=T),T===0)return i[s++]=20971520,i[s++]=20971520,a.bits=1,0;for(b=1;b<T&&M[b]===0;b++);for(C<b&&(C=b),A=1,g=1;g<=Rr;g++)if(A<<=1,A-=M[g],A<0)return-1;if(A>0&&(n===0||T!==1))return-1;for(se[1]=0,g=1;g<Rr;g++)se[g+1]=se[g]+M[g];for(y=0;y<r;y++)t[e+y]!==0&&(o[se[t[e+y]]++]=y);if(n===0?(L=yt=o,m=20):n===1?(L=Dl,yt=Rl,m=257):(L=Ul,yt=Ml,m=0),z=0,y=0,g=b,_=s,N=C,P=0,d=-1,F=1<<C,p=F-1,n===1&&F>852||n===2&&F>592)return 1;for(;;){Le=g-P,o[y]+1<m?(st=0,At=o[y]):o[y]>=m?(st=yt[o[y]-m],At=L[o[y]-m]):(st=96,At=0),c=1<<g-P,l=1<<N,b=l;do l-=c,i[_+(z>>P)+l]=Le<<24|st<<16|At|0;while(l!==0);for(c=1<<g-1;z&c;)c>>=1;if(c!==0?(z&=c-1,z+=c):z=0,y++,--M[g]==0){if(g===T)break;g=t[e+o[y]]}if(g>C&&(z&p)!==d){for(P===0&&(P=C),_+=b,N=g-P,A=1<<N;N+P<T&&(A-=M[N+P],!(A<=0));)N++,A<<=1;if(F+=1<<N,n===1&&F>852||n===2&&F>592)return 1;d=z&p,i[d]=C<<24|N<<16|_-s|0}}return z!==0&&(i[_+z]=g-P<<24|64<<16|0),a.bits=C,0};const{Z_FINISH:Bo,Z_BLOCK:Ll,Z_TREES:Ur,Z_OK:Wt,Z_STREAM_END:Pl,Z_NEED_DICT:xl,Z_STREAM_ERROR:Je,Z_DATA_ERROR:jo,Z_MEM_ERROR:Go,Z_BUF_ERROR:Fl,Z_DEFLATED:Vo}=cn,mi=16180,Mr=16190,Et=16191,Zi=16192,Xi=16194,Lr=16199,Pr=16200,Ji=16206,pe=16209,Ko=n=>(n>>>24&255)+(n>>>8&65280)+((65280&n)<<8)+((255&n)<<24);function ql(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Xt=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.mode<mi||t.mode>16211?1:0},Su=n=>{if(Xt(n))return Je;const t=n.state;return n.total_in=n.total_out=t.total=0,n.msg="",t.wrap&&(n.adler=1&t.wrap),t.mode=mi,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Wt},Nu=n=>{if(Xt(n))return Je;const t=n.state;return t.wsize=0,t.whave=0,t.wnext=0,Su(n)},Au=(n,t)=>{let e;if(Xt(n))return Je;const r=n.state;return t<0?(e=0,t=-t):(e=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Je:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=e,r.wbits=t,Nu(n))},Qo=(n,t)=>{if(!n)return Je;const e=new ql;n.state=e,e.strm=n,e.window=null,e.mode=mi;const r=Au(n,t);return r!==Wt&&(n.state=null),r};let es,ts,Wo=!0;const zl=n=>{if(Wo){es=new Int32Array(512),ts=new Int32Array(32);let t=0;for(;t<144;)n.lens[t++]=8;for(;t<256;)n.lens[t++]=9;for(;t<280;)n.lens[t++]=7;for(;t<288;)n.lens[t++]=8;for(nr(1,n.lens,0,288,es,0,n.work,{bits:9}),t=0;t<32;)n.lens[t++]=5;nr(2,n.lens,0,32,ts,0,n.work,{bits:5}),Wo=!1}n.lencode=es,n.lenbits=9,n.distcode=ts,n.distbits=5},Yo=(n,t,e,r)=>{let i;const s=n.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(e-s.wsize,e),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(t.subarray(e-r,e-r+i),s.wnext),(r-=i)?(s.window.set(t.subarray(e-r,e),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var wt={inflateReset:Nu,inflateReset2:Au,inflateResetKeep:Su,inflateInit:n=>Qo(n,15),inflateInit2:Qo,inflate:(n,t)=>{let e,r,i,s,o,a,u,c,l,d,p,_,m,g,y,b,T,C,N,P,A,F,z=0;const L=new Uint8Array(4);let M,se;const Le=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Xt(n)||!n.output||!n.input&&n.avail_in!==0)return Je;e=n.state,e.mode===Et&&(e.mode=Zi),o=n.next_out,i=n.output,u=n.avail_out,s=n.next_in,r=n.input,a=n.avail_in,c=e.hold,l=e.bits,d=a,p=u,F=Wt;e:for(;;)switch(e.mode){case mi:if(e.wrap===0){e.mode=Zi;break}for(;l<16;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(2&e.wrap&&c===35615){e.wbits===0&&(e.wbits=15),e.check=0,L[0]=255&c,L[1]=c>>>8&255,e.check=we(e.check,L,2,0),c=0,l=0,e.mode=16181;break}if(e.head&&(e.head.done=!1),!(1&e.wrap)||(((255&c)<<8)+(c>>8))%31){n.msg="incorrect header check",e.mode=pe;break}if((15&c)!==Vo){n.msg="unknown compression method",e.mode=pe;break}if(c>>>=4,l-=4,A=8+(15&c),e.wbits===0&&(e.wbits=A),A>15||A>e.wbits){n.msg="invalid window size",e.mode=pe;break}e.dmax=1<<e.wbits,e.flags=0,n.adler=e.check=1,e.mode=512&c?16189:Et,c=0,l=0;break;case 16181:for(;l<16;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(e.flags=c,(255&e.flags)!==Vo){n.msg="unknown compression method",e.mode=pe;break}if(57344&e.flags){n.msg="unknown header flags set",e.mode=pe;break}e.head&&(e.head.text=c>>8&1),512&e.flags&&4&e.wrap&&(L[0]=255&c,L[1]=c>>>8&255,e.check=we(e.check,L,2,0)),c=0,l=0,e.mode=16182;case 16182:for(;l<32;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}e.head&&(e.head.time=c),512&e.flags&&4&e.wrap&&(L[0]=255&c,L[1]=c>>>8&255,L[2]=c>>>16&255,L[3]=c>>>24&255,e.check=we(e.check,L,4,0)),c=0,l=0,e.mode=16183;case 16183:for(;l<16;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}e.head&&(e.head.xflags=255&c,e.head.os=c>>8),512&e.flags&&4&e.wrap&&(L[0]=255&c,L[1]=c>>>8&255,e.check=we(e.check,L,2,0)),c=0,l=0,e.mode=16184;case 16184:if(1024&e.flags){for(;l<16;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}e.length=c,e.head&&(e.head.extra_len=c),512&e.flags&&4&e.wrap&&(L[0]=255&c,L[1]=c>>>8&255,e.check=we(e.check,L,2,0)),c=0,l=0}else e.head&&(e.head.extra=null);e.mode=16185;case 16185:if(1024&e.flags&&(_=e.length,_>a&&(_=a),_&&(e.head&&(A=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(r.subarray(s,s+_),A)),512&e.flags&&4&e.wrap&&(e.check=we(e.check,r,_,s)),a-=_,s+=_,e.length-=_),e.length))break e;e.length=0,e.mode=16186;case 16186:if(2048&e.flags){if(a===0)break e;_=0;do A=r[s+_++],e.head&&A&&e.length<65536&&(e.head.name+=String.fromCharCode(A));while(A&&_<a);if(512&e.flags&&4&e.wrap&&(e.check=we(e.check,r,_,s)),a-=_,s+=_,A)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=16187;case 16187:if(4096&e.flags){if(a===0)break e;_=0;do A=r[s+_++],e.head&&A&&e.length<65536&&(e.head.comment+=String.fromCharCode(A));while(A&&_<a);if(512&e.flags&&4&e.wrap&&(e.check=we(e.check,r,_,s)),a-=_,s+=_,A)break e}else e.head&&(e.head.comment=null);e.mode=16188;case 16188:if(512&e.flags){for(;l<16;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(4&e.wrap&&c!==(65535&e.check)){n.msg="header crc mismatch",e.mode=pe;break}c=0,l=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),n.adler=e.check=0,e.mode=Et;break;case 16189:for(;l<32;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}n.adler=e.check=Ko(c),c=0,l=0,e.mode=Mr;case Mr:if(e.havedict===0)return n.next_out=o,n.avail_out=u,n.next_in=s,n.avail_in=a,e.hold=c,e.bits=l,xl;n.adler=e.check=1,e.mode=Et;case Et:if(t===Ll||t===Ur)break e;case Zi:if(e.last){c>>>=7&l,l-=7&l,e.mode=Ji;break}for(;l<3;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}switch(e.last=1&c,c>>>=1,l-=1,3&c){case 0:e.mode=16193;break;case 1:if(zl(e),e.mode=Lr,t===Ur){c>>>=2,l-=2;break e}break;case 2:e.mode=16196;break;case 3:n.msg="invalid block type",e.mode=pe}c>>>=2,l-=2;break;case 16193:for(c>>>=7&l,l-=7&l;l<32;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if((65535&c)!=(c>>>16^65535)){n.msg="invalid stored block lengths",e.mode=pe;break}if(e.length=65535&c,c=0,l=0,e.mode=Xi,t===Ur)break e;case Xi:e.mode=16195;case 16195:if(_=e.length,_){if(_>a&&(_=a),_>u&&(_=u),_===0)break e;i.set(r.subarray(s,s+_),o),a-=_,s+=_,u-=_,o+=_,e.length-=_;break}e.mode=Et;break;case 16196:for(;l<14;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(e.nlen=257+(31&c),c>>>=5,l-=5,e.ndist=1+(31&c),c>>>=5,l-=5,e.ncode=4+(15&c),c>>>=4,l-=4,e.nlen>286||e.ndist>30){n.msg="too many length or distance symbols",e.mode=pe;break}e.have=0,e.mode=16197;case 16197:for(;e.have<e.ncode;){for(;l<3;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}e.lens[Le[e.have++]]=7&c,c>>>=3,l-=3}for(;e.have<19;)e.lens[Le[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,M={bits:e.lenbits},F=nr(0,e.lens,0,19,e.lencode,0,e.work,M),e.lenbits=M.bits,F){n.msg="invalid code lengths set",e.mode=pe;break}e.have=0,e.mode=16198;case 16198:for(;e.have<e.nlen+e.ndist;){for(;z=e.lencode[c&(1<<e.lenbits)-1],y=z>>>24,b=z>>>16&255,T=65535&z,!(y<=l);){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(T<16)c>>>=y,l-=y,e.lens[e.have++]=T;else{if(T===16){for(se=y+2;l<se;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(c>>>=y,l-=y,e.have===0){n.msg="invalid bit length repeat",e.mode=pe;break}A=e.lens[e.have-1],_=3+(3&c),c>>>=2,l-=2}else if(T===17){for(se=y+3;l<se;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}c>>>=y,l-=y,A=0,_=3+(7&c),c>>>=3,l-=3}else{for(se=y+7;l<se;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}c>>>=y,l-=y,A=0,_=11+(127&c),c>>>=7,l-=7}if(e.have+_>e.nlen+e.ndist){n.msg="invalid bit length repeat",e.mode=pe;break}for(;_--;)e.lens[e.have++]=A}}if(e.mode===pe)break;if(e.lens[256]===0){n.msg="invalid code -- missing end-of-block",e.mode=pe;break}if(e.lenbits=9,M={bits:e.lenbits},F=nr(1,e.lens,0,e.nlen,e.lencode,0,e.work,M),e.lenbits=M.bits,F){n.msg="invalid literal/lengths set",e.mode=pe;break}if(e.distbits=6,e.distcode=e.distdyn,M={bits:e.distbits},F=nr(2,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,M),e.distbits=M.bits,F){n.msg="invalid distances set",e.mode=pe;break}if(e.mode=Lr,t===Ur)break e;case Lr:e.mode=Pr;case Pr:if(a>=6&&u>=258){n.next_out=o,n.avail_out=u,n.next_in=s,n.avail_in=a,e.hold=c,e.bits=l,Ol(n,p),o=n.next_out,i=n.output,u=n.avail_out,s=n.next_in,r=n.input,a=n.avail_in,c=e.hold,l=e.bits,e.mode===Et&&(e.back=-1);break}for(e.back=0;z=e.lencode[c&(1<<e.lenbits)-1],y=z>>>24,b=z>>>16&255,T=65535&z,!(y<=l);){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(b&&!(240&b)){for(C=y,N=b,P=T;z=e.lencode[P+((c&(1<<C+N)-1)>>C)],y=z>>>24,b=z>>>16&255,T=65535&z,!(C+y<=l);){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}c>>>=C,l-=C,e.back+=C}if(c>>>=y,l-=y,e.back+=y,e.length=T,b===0){e.mode=16205;break}if(32&b){e.back=-1,e.mode=Et;break}if(64&b){n.msg="invalid literal/length code",e.mode=pe;break}e.extra=15&b,e.mode=16201;case 16201:if(e.extra){for(se=e.extra;l<se;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}e.length+=c&(1<<e.extra)-1,c>>>=e.extra,l-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=16202;case 16202:for(;z=e.distcode[c&(1<<e.distbits)-1],y=z>>>24,b=z>>>16&255,T=65535&z,!(y<=l);){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(!(240&b)){for(C=y,N=b,P=T;z=e.distcode[P+((c&(1<<C+N)-1)>>C)],y=z>>>24,b=z>>>16&255,T=65535&z,!(C+y<=l);){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}c>>>=C,l-=C,e.back+=C}if(c>>>=y,l-=y,e.back+=y,64&b){n.msg="invalid distance code",e.mode=pe;break}e.offset=T,e.extra=15&b,e.mode=16203;case 16203:if(e.extra){for(se=e.extra;l<se;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}e.offset+=c&(1<<e.extra)-1,c>>>=e.extra,l-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){n.msg="invalid distance too far back",e.mode=pe;break}e.mode=16204;case 16204:if(u===0)break e;if(_=p-u,e.offset>_){if(_=e.offset-_,_>e.whave&&e.sane){n.msg="invalid distance too far back",e.mode=pe;break}_>e.wnext?(_-=e.wnext,m=e.wsize-_):m=e.wnext-_,_>e.length&&(_=e.length),g=e.window}else g=i,m=o-e.offset,_=e.length;_>u&&(_=u),u-=_,e.length-=_;do i[o++]=g[m++];while(--_);e.length===0&&(e.mode=Pr);break;case 16205:if(u===0)break e;i[o++]=e.length,u--,e.mode=Pr;break;case Ji:if(e.wrap){for(;l<32;){if(a===0)break e;a--,c|=r[s++]<<l,l+=8}if(p-=u,n.total_out+=p,e.total+=p,4&e.wrap&&p&&(n.adler=e.check=e.flags?we(e.check,i,p,o-p):Jn(e.check,i,p,o-p)),p=u,4&e.wrap&&(e.flags?c:Ko(c))!==e.check){n.msg="incorrect data check",e.mode=pe;break}c=0,l=0}e.mode=16207;case 16207:if(e.wrap&&e.flags){for(;l<32;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(4&e.wrap&&c!==(4294967295&e.total)){n.msg="incorrect length check",e.mode=pe;break}c=0,l=0}e.mode=16208;case 16208:F=Pl;break e;case pe:F=jo;break e;case 16210:return Go;default:return Je}return n.next_out=o,n.avail_out=u,n.next_in=s,n.avail_in=a,e.hold=c,e.bits=l,(e.wsize||p!==n.avail_out&&e.mode<pe&&(e.mode<Ji||t!==Bo))&&Yo(n,n.output,n.next_out,p-n.avail_out),d-=n.avail_in,p-=n.avail_out,n.total_in+=d,n.total_out+=p,e.total+=p,4&e.wrap&&p&&(n.adler=e.check=e.flags?we(e.check,i,p,n.next_out-p):Jn(e.check,i,p,n.next_out-p)),n.data_type=e.bits+(e.last?64:0)+(e.mode===Et?128:0)+(e.mode===Lr||e.mode===Xi?256:0),(d===0&&p===0||t===Bo)&&F===Wt&&(F=Fl),F},inflateEnd:n=>{if(Xt(n))return Je;let t=n.state;return t.window&&(t.window=null),n.state=null,Wt},inflateGetHeader:(n,t)=>{if(Xt(n))return Je;const e=n.state;return 2&e.wrap?(e.head=t,t.done=!1,Wt):Je},inflateSetDictionary:(n,t)=>{const e=t.length;let r,i,s;return Xt(n)?Je:(r=n.state,r.wrap!==0&&r.mode!==Mr?Je:r.mode===Mr&&(i=1,i=Jn(i,t,e,0),i!==r.check)?jo:(s=Yo(n,t,e,e),s?(r.mode=16210,Go):(r.havedict=1,Wt)))},inflateInfo:"pako inflate (from Nodeca project)"},Hl=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const ku=Object.prototype.toString,{Z_NO_FLUSH:$l,Z_FINISH:Bl,Z_OK:rr,Z_STREAM_END:ns,Z_NEED_DICT:rs,Z_STREAM_ERROR:jl,Z_DATA_ERROR:Zo,Z_MEM_ERROR:Gl}=cn;function ir(n){this.options=vi.assign({chunkSize:65536,windowBits:15,to:""},n||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||n&&n.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Tu,this.strm.avail_out=0;let e=wt.inflateInit2(this.strm,t.windowBits);if(e!==rr)throw new Error(on[e]);if(this.header=new Hl,wt.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=pr.string2buf(t.dictionary):ku.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=wt.inflateSetDictionary(this.strm,t.dictionary),e!==rr)))throw new Error(on[e])}function is(n,t){const e=new ir(t);if(e.push(n),e.err)throw e.msg||on[e.err];return e.result}ir.prototype.push=function(n,t){const e=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(o=t===~~t?t:t===!0?Bl:$l,ku.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(r),e.next_out=0,e.avail_out=r),s=wt.inflate(e,o),s===rs&&i&&(s=wt.inflateSetDictionary(e,i),s===rr?s=wt.inflate(e,o):s===Zo&&(s=rs));e.avail_in>0&&s===ns&&e.state.wrap>0&&n[e.next_in]!==0;)wt.inflateReset(e),s=wt.inflate(e,o);switch(s){case jl:case Zo:case rs:case Gl:return this.onEnd(s),this.ended=!0,!1}if(a=e.avail_out,e.next_out&&(e.avail_out===0||s===ns))if(this.options.to==="string"){let u=pr.utf8border(e.output,e.next_out),c=e.next_out-u,l=pr.buf2string(e.output,u);e.next_out=c,e.avail_out=r-c,c&&e.output.set(e.output.subarray(u,u+c),0),this.onData(l)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(s!==rr||a!==0){if(s===ns)return s=wt.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(e.avail_in===0)break}}return!0},ir.prototype.onData=function(n){this.chunks.push(n)},ir.prototype.onEnd=function(n){n===rr&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=vi.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var Vl={Inflate:ir,inflate:is,inflateRaw:function(n,t){return(t=t||{}).raw=!0,is(n,t)},ungzip:is,constants:cn};const{Deflate:Kl,deflate:Ql,deflateRaw:Wl,gzip:Yl}=kl,{Inflate:Zl,inflate:Xl,inflateRaw:Jl,ungzip:ed}=Vl;var pt,td={Deflate:Kl,deflate:Ql,deflateRaw:Wl,gzip:Yl,Inflate:Zl,inflate:Xl,inflateRaw:Jl,ungzip:ed,constants:cn},Xo=function(n){return f(void 0,void 0,void 0,function(){var t;return h(this,function(e){return t=td.ungzip(n),[2,String.fromCharCode.apply(null,t)]})})};(function(n){n.CONNECTING="CONNECTING",n.OPEN="OPEN",n.CLOSED="CLOSED"})(pt||(pt={}));var ie,nd=function(n){function t(e,r){var i=r.sdkState,s=r.dispatcher,o=r.logger,a=n.call(this)||this;return a.lastActive=0,a._iid=e,a._sdkState=i,a._dispatcher=s,a._logger=o,a}return v(t,n),Object.defineProperty(t.prototype,"isOpen",{get:function(){return this.connectionState===pt.OPEN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connectionState",{get:function(){if(this._ws)switch(this._ws.readyState){case 0:return pt.CONNECTING;case 1:return pt.OPEN}return pt.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ws",{get:function(){var e;return(e=this._ws)!==null&&e!==void 0?e:null},enumerable:!1,configurable:!0}),t.prototype._handleMessage=function(e){var r=this;e.split(`
`).forEach(function(i){if(i){var s=de.createFromRawMessage(r._iid,i);if(r._logger.debug("receive websocket event",s),s.code==="LOGI")r.dispatch("message",s);else if(s.code==="PONG")r.dispatch("pong");else if(s.code==="EXPR"){if(s.payload){var o=new Tn(s.payload);o.expiresIn>=0&&r._dispatcher.dispatch(o)}}else s.code==="NOOP"||r.dispatch("message",s)}})},t.prototype.connect=function(e,r){var i=this;r===void 0&&(r=""),this._ws=new WebSocket(e,encodeURIComponent(r)),this._ws.onopen=function(){i._logger.debug("websocket open"),i.dispatch("open")},this._ws.onmessage=function(s){return f(i,void 0,void 0,function(){var o,a,u,c,l=this;return h(this,function(d){switch(d.label){case 0:return!((c=this._sdkState.websocket)===null||c===void 0)&&c.compression?s.data instanceof Blob?((o=new FileReader).readAsArrayBuffer(s.data),o.onloadend=function(){return f(l,void 0,void 0,function(){var p,_;return h(this,function(m){switch(m.label){case 0:return m.trys.push([0,2,,3]),[4,Xo(o.result)];case 1:return p=m.sent(),this._handleMessage(p),[3,3];case 2:return _=m.sent(),this.error(_),[3,3];case 3:return[2]}})})},[3,7]):[3,1]:[3,8];case 1:if(!(s.data instanceof ArrayBuffer))return[3,6];d.label=2;case 2:return d.trys.push([2,4,,5]),[4,Xo(new Uint8Array(s.data))];case 3:return a=d.sent(),this._handleMessage(a),[3,5];case 4:return u=d.sent(),this.error(u),[3,5];case 5:return[3,7];case 6:typeof s.data=="string"&&this._handleMessage(s.data),d.label=7;case 7:return[3,9];case 8:this._handleMessage(s.data),d.label=9;case 9:return[2]}})})},this._ws.onerror=function(){i._logger.debug("websocket error"),i.dispatch("error",I.networkError)},this._ws.onclose=function(){i._logger.debug("websocket close"),i.dispatch("close")},this.lastActive=Date.now()},t.prototype.disconnect=function(){var e=this;return new Promise(function(r){e._logger.debug("websocket disconnect"),e._ws?(e._ws.onopen=j,e._ws.onmessage=j,e._ws.onerror=j,e.connectionState!==pt.CLOSED?(e._ws.onclose=function(){e.dispatch("close"),r()},e._ws.close(),e._ws=void 0):r()):r()})},t.prototype.send=function(e){if(!this._ws)throw I.connectionClosed;e.code!=="PING"?this.dispatch("ping-refresh"):this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())},t.prototype.error=function(e){this._logger.debug("websocket error",e),this.dispatch("error",e)},t}(Dn),Ou=function(n){function t(e){var r=e.all,i=e.feed,s=e.custom_types,o=e.ts,a=n.call(this)||this;return a.all=r,a.feed=i,a.customTypes=s,a.ts=o,a}return v(t,n),t}(le),rd=function(){function n(t,e){var r=e.session,i=e.sdkState,s=e.dispatcher,o=e.logger,a=e.useFetchCompat,u=a!==void 0&&a,c=this;this._ackStateMap=new Map,this._sdkState=i,this._dispatcher=s,this._logger=o,this.apiClient=new tl(t,{session:r,sdkState:i,dispatcher:s,logger:o,useFetchCompat:u}),this.websocketClient=new nd(t,{sdkState:i,dispatcher:s,logger:o}),this.websocketClient.on("message",function(l){if(l.payload.unread_cnt&&c._dispatcher.dispatch(new Ou(l.payload.unread_cnt)),l.requestId){if(c._ackStateMap.has(l.requestId)){var d=c._ackStateMap.get(l.requestId);l.code!=="EROR"?d.resolve(l):d.reject(new I({code:l.payload.code,message:l.payload.message}))}}else c._dispatcher.dispatch(l)}).on("close",function(){c._ackStateMap.forEach(function(l){l.reject(I.connectionClosed)}),c._ackStateMap.clear()})}return n.prototype._sendApiRequest=function(t){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this.apiClient.send(t)];case 1:return[2,e.sent()]}})})},n.prototype._sendWebsocketRequest=function(t){return f(this,void 0,void 0,function(){var e,r,i,s=this;return h(this,function(o){if(!this._sdkState.websocket)throw I.connectionRequired;if(e=new Re,t.ackRequired){i=function(a,u){s._ackStateMap.has(t.requestId)&&(s._ackStateMap.delete(t.requestId),r&&(clearTimeout(r),r=null),a?(s._logger.debug("fail websocket request",t.requestId,a),e.reject(a)):(s._logger.debug("receive websocket ack",t.requestId,t),s._logger.debug("receive websocket ack",u),e.resolve(u)))};try{r=setTimeout(function(){return i(I.noAckTimeout)},this._sdkState.websocket.responseTimeout),this._ackStateMap.set(t.requestId,{resolve:function(a){return i(void 0,a)},reject:function(a){return i(a)}}),this.websocketClient.send(t)}catch(a){i(a)}}else try{this.websocketClient.send(t),e.resolve()}catch(a){e.reject(a)}return[2,e.promise]})})},n.prototype.send=function(t){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return t instanceof D?[4,this._sendApiRequest(t)]:[3,2];case 1:case 3:return[2,e.sent()];case 2:return t instanceof qe?[4,this._sendWebsocketRequest(t)]:[3,4];case 4:throw I.invalidParameters}})})},n.prototype.cancel=function(t){this.apiClient.cancel(t)},n.prototype.cancelAll=function(){this.apiClient.cancelAll()},n}();(function(n){n[n.NONE=0]="NONE",n[n.INITIALIZED=1]="INITIALIZED",n[n.CONNECTING=2]="CONNECTING",n[n.CONNECTED=3]="CONNECTED",n[n.RECONNECTING=4]="RECONNECTING",n[n.INTERNAL_DISCONNECTED=5]="INTERNAL_DISCONNECTED",n[n.EXTERNAL_DISCONNECTED=6]="EXTERNAL_DISCONNECTED",n[n.LOGOUT=7]="LOGOUT"})(ie||(ie={}));var ln=function(n){function t(e){var r=e.stateType,i=n.call(this)||this;return i.stateType=r,i}return v(t,n),t}(le),Du=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return v(t,n),t}(le),Os=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return v(t,n),t}(le),Ru=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return v(t,n),t}(le),Jo=function(){function n(t){var e,r,i,s;this.isEnabled=(e=t.enabled)!==null&&e!==void 0&&e,this.feedChannels=(r=t.feed_channels)!==null&&r!==void 0?r:{},this.templateListToken=(i=t.template_list_token)!==null&&i!==void 0?i:null,this.settingsUpdatedAt=(s=t.settings_updated_at)!==null&&s!==void 0?s:0}return n.payloadify=function(t){return x(H({enabled:t.isEnabled,feed_channels:t.feedChannels,template_list_token:t.templateListToken,settings_updated_at:t.settingsUpdatedAt}))},n}(),id=function(n){return"sendbird@".concat(n,"/changelog_include_chat_notifications")},ea=function(){function n(t){var e;this.lastUpdatedAt=(e=t.last_updated_at)!==null&&e!==void 0?e:0}return n.payloadify=function(t){return x(H({last_updated_at:t.lastUpdatedAt}))},n}(),ta=function(){function n(t){var e;this.token=(e=t.template_list_token)!==null&&e!==void 0?e:""}return n.payloadify=function(t){return x(H({template_list_token:t.token}))},n}(),na=1048576,sd=5,ra=function(){function n(t){var e,r,i,s,o;t===void 0&&(t={}),this.emojiHash=t.emoji_hash||"",this.uploadSizeLimit=t.file_upload_size_limit?t.file_upload_size_limit*na:Number.MAX_SAFE_INTEGER,this.useReaction=!!t.use_reaction,this.applicationAttributes=(e=t.application_attributes)!==null&&e!==void 0?e:[],this.premiumFeatureList=(r=t.premium_feature_list)!==null&&r!==void 0?r:[],this.deviceTokenCache=this.applicationAttributes.includes("sdk_device_token_cache"),this.enabledChannelMemberShipHistory=this.applicationAttributes.includes("channel_membership_history"),this.multipleFilesMessageFileCountLimit=(i=t.multiple_file_send_max_size)!==null&&i!==void 0?i:5,this.allowSdkStatsUpload=(s=t.allow_sdk_log_ingestion)===null||s===void 0||s,this.uikitConfigInfo=new ea((o=t.uikit_config)!==null&&o!==void 0?o:{}),this.notificationInfo=t.notifications?new Jo(t.notifications):null,this.messageTemplateInfo=t.message_template?new ta(t.message_template):null}return n.payloadify=function(t){return x(H({emoji_hash:t.emojiHash,file_upload_size_limit:t.uploadSizeLimit/na,application_attributes:t.applicationAttributes,premium_feature_list:t.premiumFeatureList,use_reaction:t.useReaction,allow_sdk_log_ingestion:t.allowSdkStatsUpload,uikit_config:t.uikitConfigInfo?ea.payloadify(t.uikitConfigInfo):null,notifications:t.notificationInfo?Jo.payloadify(t.notificationInfo):null,message_template:t.messageTemplateInfo?ta.payloadify(t.messageTemplateInfo):null}))},n}(),Me=function(){function n(t){this._iid="",this._iid=t}return n.payloadify=function(t){return{}},n}(),od=function(n){function t(e){var r=e.userId,i=e.metadata,s=n.call(this)||this;return s.method=O.POST,s.path="".concat(ee,"/").concat(r,"/metadata"),s.params={metadata:i},s}return v(t,n),t}(D),ad=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.metaData=r,i}return v(t,n),t}(U),ud=function(n){function t(e){var r=e.userId,i=e.metadata,s=e.upsert,o=n.call(this)||this;return o.method=O.PUT,o.path="".concat(ee,"/").concat(r,"/metadata"),o.params={metadata:i,upsert:s},o}return v(t,n),t}(D),cd=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.metadata=r,i}return v(t,n),t}(U),ld=function(n){function t(e){var r=e.userId,i=e.metadataKey,s=n.call(this)||this;return s.method=O.DELETE,s.path="".concat(ee,"/").concat(r,"/metadata/").concat(i),s}return v(t,n),t}(D);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}v(t,n)})(U);var dd=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=O.DELETE,i.path="".concat(ee,"/").concat(r,"/metadata"),i}return v(t,n),t}(D);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}v(t,n)})(U);var yn,gi=function(n,t){var e=JSON.parse(JSON.stringify(n));return e._iid&&delete e._iid,t&&t(e),e},_r=function(n,t){var e=JSON.parse(JSON.stringify(n));return t&&t(e),e},R=function(n){return{do:function(t){n||t()},throw:function(t){if(!n)throw t}}};(function(n){n.ONLINE="online",n.OFFLINE="offline",n.NON_AVAILABLE="nonavailable"})(yn||(yn={}));var Sn,V=function(n){function t(e,r){var i,s,o,a,u,c,l,d,p,_,m,g,y=this;return(y=n.call(this,e)||this).userId=(s=(i=r.guest_id)!==null&&i!==void 0?i:r.user_id)!==null&&s!==void 0?s:"",y.nickname=(a=(o=r.nickname)!==null&&o!==void 0?o:r.name)!==null&&a!==void 0?a:"",y.plainProfileUrl=(c=(u=r.profile_url)!==null&&u!==void 0?u:r.image)!==null&&c!==void 0?c:"",y.requireAuth=(l=r.require_auth_for_profile_image)!==null&&l!==void 0&&l,y.metaData=(d=r.metadata)!==null&&d!==void 0?d:{},y.connectionStatus=yn.NON_AVAILABLE,ce(yn,r.is_online)?y.connectionStatus=r.is_online:w("boolean",r.is_online)&&(y.connectionStatus=r.is_online?yn.ONLINE:yn.OFFLINE),y.isActive=(p=r.is_active)===null||p===void 0||p,y.lastSeenAt=(_=r.last_seen_at)!==null&&_!==void 0?_:null,y.preferredLanguages=r.preferred_languages?Z([],G(r.preferred_languages),!1):null,y.friendDiscoveryKey=(m=r.friend_discovery_key)!==null&&m!==void 0?m:null,y.friendName=(g=r.friend_name)!==null&&g!==void 0?g:null,y}return v(t,n),t.payloadify=function(e){return x(H(E(E({},n.payloadify.call(this,e)),{user_id:e.userId,nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth,metadata:e.metaData,is_online:e.connectionStatus,is_active:e.isActive,last_seen_at:e.lastSeenAt,preferred_languages:e.preferredLanguages,friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName})))},Object.defineProperty(t.prototype,"profileUrl",{get:function(){var e=S.of(this._iid).sessionManager;return this.requireAuth&&e.ekey?"".concat(this.plainProfileUrl,"?auth=").concat(e.ekey):this.plainProfileUrl},enumerable:!1,configurable:!0}),t.prototype.serialize=function(){return gi(this)},t.prototype._isValidMetaData=function(e){return!Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map(function(r){return e[r]}).every(function(r){return w("string",r)})},t.prototype._applyMetaData=function(e,r){var i=this;r===void 0&&(r=!1),Object.keys(e).forEach(function(s){r?delete i.metaData[s]:i.metaData[s]=e[s]})},t.prototype.createMetaData=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return R(this._isValidMetaData(e)).throw(I.invalidParameters),r=S.of(this._iid),i=r.sdkState,s=r.requestQueue,o=new od({userId:i.userId,metadata:e}),[4,s.send(o)];case 1:return a=c.sent(),u=a.as(ad).metaData,this._applyMetaData(u),[2,this.metaData]}})})},t.prototype.updateMetaData=function(e,r){return r===void 0&&(r=!1),f(this,void 0,void 0,function(){var i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return R(this._isValidMetaData(e)).throw(I.invalidParameters),i=S.of(this._iid),s=i.sdkState,o=i.requestQueue,a=new ud({userId:s.userId,metadata:e,upsert:r}),[4,o.send(a)];case 1:return u=l.sent(),c=u.as(cd).metadata,this._applyMetaData(c),[2,this.metaData]}})})},t.prototype.deleteMetaData=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return R(w("string",e)).throw(I.invalidParameters),r=S.of(this._iid),i=r.sdkState,s=r.requestQueue,o=new ld({userId:i.userId,metadataKey:e}),[4,s.send(o)];case 1:return u.sent(),this._applyMetaData(((a={})[e]=!0,a),!0),[2,this.metaData]}})})},t.prototype.deleteAllMetaData=function(){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new dd({userId:r.userId}),[4,i.send(s)];case 1:return o.sent(),this.metaData={},[2]}})})},t}(Me),Uu=function(n){function t(e){var r=e.userProfile,i=n.call(this)||this;return i.userProfile=r,i}return v(t,n),t}(le),Ds=function(){function n(t,e){var r,i,s,o,a,u,c,l,d,p,_,m,g,y;this._iid=t,this.appInfo=new ra(e),this.user=new V(t,e),this.connectedAt=(r=e.login_ts)!==null&&r!==void 0?r:0,this.firstConnectedAt=0,this.pingInterval=(i=e.ping_interval)!==null&&i!==void 0?i:15e3,this.pongTimeout=(s=e.pong_timeout)!==null&&s!==void 0?s:5e3,this.reconnectInterval=(a=(o=e.reconnect)===null||o===void 0?void 0:o.interval)!==null&&a!==void 0?a:3e3,this.reconnectMaxInterval=(c=(u=e.reconnect)===null||u===void 0?void 0:u.max_interval)!==null&&c!==void 0?c:6e4,this.reconnectRetryCount=(d=(l=e.reconnect)===null||l===void 0?void 0:l.retry_cnt)!==null&&d!==void 0?d:5,this.reconnectIntervalMultiple=(_=(p=e.reconnect)===null||p===void 0?void 0:p.mul)!==null&&_!==void 0?_:2,this.maxUnreadCountOnSuperGroup=(m=e.max_unread_cnt_on_super_group)!==null&&m!==void 0?m:100,this.profileImageEncryption=!!e.profile_image_encryption,this.concurrentCallLimit=(g=e.concurrent_call_limit)!==null&&g!==void 0?g:5,this.backOffDelay=(y=e.back_off_delay)!==null&&y!==void 0?y:100}return n.payloadify=function(t){return x(H(E(E(E({},V.payloadify(t.user)),ra.payloadify(t.appInfo)),{login_ts:t.connectedAt,ping_interval:t.pingInterval,pong_timeout:t.pongTimeout,reconnect:{interval:t.reconnectInterval,max_interval:t.reconnectMaxInterval,retry_cnt:t.reconnectRetryCount,mul:t.reconnectIntervalMultiple},max_unread_cnt_on_super_group:t.maxUnreadCountOnSuperGroup,profile_image_encryption:t.profileImageEncryption,concurrent_call_limit:t.concurrentCallLimit,back_off_delay:t.backOffDelay})))},n.prototype.apply=function(){var t=this.reconnectInterval,e=this.reconnectMaxInterval,r=this.reconnectIntervalMultiple,i=S.of(this._iid);i.sdkState.websocket&&(i.sdkState.websocket.pingInterval=1e3*this.pingInterval,i.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,i.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,i.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(s){return s>0?1e3*Math.min(t*Math.pow(r,s-1),e):10}}),i.appInfo=this.appInfo,i.sessionManager.currentUser=this.user,i.connectedAt=this.connectedAt,this.firstConnectedAt||(i.firstConnectedAt=this.connectedAt),i.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,i.concurrentCallLimit=this.concurrentCallLimit,i.backOffDelay=this.backOffDelay,i.dispatcher.dispatch(new Uu({userProfile:this}))},n}(),Mu=function(n){function t(e){var r=e.request,i=r===void 0||r,s=e.features,o=s===void 0?{}:s,a=e.options,u=a===void 0?{}:a,c=n.call(this)||this;return c.request=i,c.features=E({localCache:!0,notification:!0},o),c.options=E({ingestion:!0},u),c}return v(t,n),t}(le),Yr=function(n){function t(e,r,i){var s,o,a,u,c=this;return(c=n.call(this,e,r,i)||this).error=null,c.services=[],c.userProfile=new Ds(e,i),c.deviceTokenLastDeletedAt=(s=i.device_token_last_deleted_at)!==null&&s!==void 0?s:0,c.key=(o=i.key)!==null&&o!==void 0?o:"",c.ekey=(a=i.ekey)!==null&&a!==void 0?a:"",c.error=i.error?new I(i):null,c.services=(u=i.services)!==null&&u!==void 0?u:[],c}return v(t,n),t.asError=function(e){return new t("","LOGI",E({user_id:"",error:!0},e))},t.prototype.applyTo=function(e){return f(this,void 0,void 0,function(){var r,i,s;return h(this,function(o){switch(o.label){case 0:return this.error?[3,4]:(r=S.of(e))?(i=r.sessionManager,s=r.dispatcher,[4,i.login(this)]):[3,2];case 1:return o.sent(),this.userProfile.apply(),s.dispatch(new Mu({request:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish"),features:{localCache:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_feature_local_cache_log_publish"),notification:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_noti_stats_log_publish")},options:{ingestion:this.userProfile.appInfo.allowSdkStatsUpload}})),[3,3];case 2:throw I.lostInstance;case 3:return[3,5];case 4:throw this.error;case 5:return[2]}})})},t}(de),dn=function(){function n(){this.type=ie.NONE,this.name="none"}return n.prototype.run=function(t){return f(this,void 0,void 0,function(){return h(this,function(e){return[2]})})},n.prototype.onConnect=function(t,e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2]})})},n.prototype.onReconnect=function(t,e){return e.resetReconnectCount,f(this,void 0,void 0,function(){return h(this,function(r){return[2]})})},n.prototype.onDisconnect=function(t,e){return e.error,e.autoReconnect,e.cause,f(this,void 0,void 0,function(){return h(this,function(r){return[2]})})},n.prototype.onDisconnectWebSocket=function(t,e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2]})})},n.prototype.onLogout=function(t){return f(this,void 0,void 0,function(){return h(this,function(e){return[2]})})},n}(),K=function(n){return f(void 0,void 0,void 0,function(){var t;return h(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,n()];case 1:return e.sent(),[3,3];case 2:if(!((t=e.sent())instanceof I))throw t;return t.throwOutside(),[3,3];case 3:return[2]}})})},Ae=function(n){return f(void 0,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,n()];case 1:case 2:return t.sent(),[3,3];case 3:return[2]}})})},zt=function(n){function t(e){e===void 0&&(e={});var r,i=this;return(i=n.call(this)||this).type=ie.LOGOUT,i.name="logout",i._wasPreviouslyConnected=(r=e.wasPreviouslyConnected)===null||r===void 0||r,i}return v(t,n),t.prototype.run=function(e){return f(this,void 0,void 0,function(){var r,i,s=this;return h(this,function(o){switch(o.label){case 0:return r=Date.now(),i=e.sdkState.userId,[4,e.logout()];case 1:return o.sent(),[4,e.changeState(new no,r)];case 2:return o.sent(),this._wasPreviouslyConnected&&K(function(){return f(s,void 0,void 0,function(){return h(this,function(a){return e.connectionHandlers.forEach(function(u){u.onDisconnected&&u.onDisconnected(i)}),[2]})})}),[2]}})})},t}(dn),yi=function(n){function t(){var e=n.call(this)||this;return e.type=ie.EXTERNAL_DISCONNECTED,e.name="externaldisconnected",e}return v(t,n),t.prototype.run=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return[4,e.disconnect()];case 1:return r.sent(),[2]}})})},t.prototype.onConnect=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=Date.now(),[4,e.disconnect()];case 1:return s.sent(),[4,e.changeState(new Ei({authToken:r}),i)];case 2:return s.sent(),[2]}})})},t.prototype.onReconnect=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new di,r)];case 1:return i.sent(),[2]}})})},t.prototype.onLogout=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new zt,r)];case 1:return i.sent(),[2]}})})},t}(dn),li=function(n){function t(e){var r=e.autoReconnect,i=n.call(this)||this;return i.type=ie.INTERNAL_DISCONNECTED,i.name="internaldisconnected",i._autoReconnect=!1,i._autoReconnect=r,i}return v(t,n),t.prototype.run=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.disconnect()];case 1:return i.sent(),this._autoReconnect?[4,e.changeState(new di,r)]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}})})},t.prototype.onConnect=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=Date.now(),[4,e.disconnect()];case 1:return s.sent(),[4,e.changeState(new Ei({authToken:r}),i)];case 2:return s.sent(),[2]}})})},t.prototype.onReconnect=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new di,r)];case 1:return i.sent(),[2]}})})},t.prototype.onDisconnectWebSocket=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new yi,r)];case 1:return i.sent(),[2]}})})},t.prototype.onLogout=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new zt,r)];case 1:return i.sent(),[2]}})})},t}(dn),Xe=function(n){return f(void 0,void 0,void 0,function(){return h(this,function(t){return[2,new Promise(function(e){return setTimeout(e,n)})]})})},Lu=function(){function n(){}return n.prototype.calcTimeout=function(){return 0},n}(),to=function(n,t,e){return e===void 0&&(e=new Lu),f(void 0,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:r=0,i=null,s=function(l){return i=l??new Error("Halted")},o=function(){r=0},c.label=1;case 1:if(!(t===-1||r<t))return[3,9];c.label=2;case 2:return c.trys.push([2,4,,8]),[4,n(s,o)];case 3:if(a=c.sent(),i)throw i;return[2,a];case 4:if(u=c.sent(),i)return[3,6];if(++r===t)throw u;return[4,Xe(e.calcTimeout(r))];case 5:return c.sent(),[3,7];case 6:throw i;case 7:return[3,8];case 8:return[3,1];case 9:throw"It should not happen."}})})},di=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.type=ie.RECONNECTING,e.name="reconnecting",e._callbacks=[],e}return v(t,n),t.prototype._halt=function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)},t.prototype._flushCallbacks=function(e){this._haltConnect=void 0,this._resetConnect=void 0,this._callbacks.forEach(function(r){return r(e)})},t.prototype.run=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c=this;return h(this,function(l){switch(l.label){case 0:r=Date.now(),i=new Re,this._callbacks.push(function(d){return d?i.reject(d):i.resolve()}),K(function(){return f(c,void 0,void 0,function(){return h(this,function(d){return e.connectionHandlers.forEach(function(p){p.onReconnectStarted&&p.onReconnectStarted()}),[2]})})}),l.label=1;case 1:return l.trys.push([1,4,,9]),s=e.sdkState.websocket,o=s.reconnectMaxRetry,a=s.reconnectRetryStrategy,[4,to(function(d,p){return f(c,void 0,void 0,function(){var _;return h(this,function(m){switch(m.label){case 0:this._haltConnect=d,this._resetConnect=p,m.label=1;case 1:return m.trys.push([1,3,,4]),[4,e.connect()];case 2:return m.sent(),[3,4];case 3:if(_=m.sent(),e.clearLoginTimer(),_ instanceof I){if(_.code===q.CONNECTION_CANCELED)return d(_),[2];if(_.isSessionExpiredError||_.isSessionInvalidatedError)return d(_),[2]}throw _;case 4:return[2]}})})},o,a)];case 2:return l.sent(),[4,e.changeState(new Pu,r)];case 3:return l.sent(),this._flushCallbacks(),K(function(){return f(c,void 0,void 0,function(){return h(this,function(d){return e.connectionHandlers.forEach(function(p){p.onReconnectSucceeded&&p.onReconnectSucceeded()}),[2]})})}),[3,9];case 4:return u=l.sent(),et(u)?[3,7]:u instanceof I?u.code===q.CONNECTION_CANCELED?[3,6]:[4,e.changeState(new li({autoReconnect:!1}),r)]:[3,6];case 5:l.sent(),l.label=6;case 6:return this._flushCallbacks(u),K(function(){return f(c,void 0,void 0,function(){return h(this,function(d){return e.connectionHandlers.forEach(function(p){p.onReconnectFailed&&p.onReconnectFailed()}),[2]})})}),[3,8];case 7:throw u;case 8:return[3,9];case 9:return[2,i.promise]}})})},t.prototype.onConnect=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){return i=new Re,this._halt(I.connectionCanceled),e.cancelConnectForRetry(),this._callbacks.push(function(){var o=Date.now();e.changeState(new Ei({authToken:r}),o).then(function(){i.resolve()}).catch(function(a){i.reject(a)})}),[2,i.promise]})})},t.prototype.onReconnect=function(e,r){var i=r.resetReconnectCount,s=i!==void 0&&i;return f(this,void 0,void 0,function(){var o;return h(this,function(a){return o=new Re,this._resetConnect&&s&&this._resetConnect(),this._callbacks.push(function(u){return u?o.reject(u):o.resolve()}),[2,o.promise]})})},t.prototype.onDisconnect=function(e,r){r.error;var i=r.autoReconnect,s=i===void 0||i;return f(this,void 0,void 0,function(){var o;return h(this,function(a){switch(a.label){case 0:return o=Date.now(),this._halt(I.connectionCanceled),[4,e.changeState(new li({autoReconnect:s}),o)];case 1:return a.sent(),[2]}})})},t.prototype.onDisconnectWebSocket=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),this._halt(I.connectionCanceled),[4,e.changeState(new yi,r)];case 1:return i.sent(),[2]}})})},t.prototype.onLogout=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),this._halt(I.connectionCanceled),[4,e.changeState(new zt,r)];case 1:return i.sent(),[2]}})})},t}(dn),Pu=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.type=ie.CONNECTED,e.name="connected",e}return v(t,n),t.prototype.onReconnect=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.disconnect()];case 1:return i.sent(),[4,e.changeState(new di,r)];case 2:return i.sent(),[2]}})})},t.prototype.onDisconnect=function(e,r){var i=r.autoReconnect;return f(this,void 0,void 0,function(){var s;return h(this,function(o){switch(o.label){case 0:return s=Date.now(),[4,e.changeState(new li({autoReconnect:i}),s)];case 1:return o.sent(),[2]}})})},t.prototype.onDisconnectWebSocket=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new yi,r)];case 1:return i.sent(),[2]}})})},t.prototype.onLogout=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new zt,r)];case 1:return i.sent(),[2]}})})},t}(dn);(function(n){n.ExternalSetBackground="ExternalSetBackground",n.ExternalDisconnectWebSocket="ExternalDisconnectWebSocket"})(Sn||(Sn={}));var hd=function(){function n(t,e){var r=e.sdkState,i=e.cacheContext,s=e.connectionHandlers,o=e.sessionManager,a=e.websocketClient,u=e.dispatcher,c=e.logger,l=e.disableWebSocketCloseEventHandling,d=l!==void 0&&l;this._disableWebSocketCloseEventHandling=!1,this._webSocketClosedCause=null,this._logger=c,this._disableWebSocketCloseEventHandling=d,this._context=new _d(t,{sdkState:r,cacheContext:i,connectionHandlers:s,sessionManager:o,websocketClient:a,dispatcher:u,logger:c}),this._sdkState=r,this._sessionManager=o,this._websocketClient=a}return n.prototype._registerEventDispatcher=function(){var t=this;this._disableWebSocketCloseEventHandling||(this._clearEventDispatcher(),this._sessionEventDispatcherContext=this._sessionManager.on("refresh",function(){t.isConnecting||t.isConnected||(t._logger.debug("try reconnect by session key refresh"),Ae(function(){return f(t,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this.reconnect()];case 1:return e.sent(),[2]}})})}))}),this._websocketEventDispatcherContext=this._websocketClient.on("close",function(){t._sdkState.appState!=="foreground"||t._webSocketClosedCause||Ae(function(){return f(t,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this._sessionManager.isSessionKeyRefreshing?[3,2]:(this._logger.debug("try reconnect by websocket connection closed"),[4,this.reconnect()]);case 1:return e.sent(),[3,4];case 2:return[4,this.disconnectWebSocket()];case 3:e.sent(),e.label=4;case 4:return[2]}})})})}))},n.prototype._clearEventDispatcher=function(){this._sessionEventDispatcherContext&&(this._sessionEventDispatcherContext.close(),this._sessionEventDispatcherContext=void 0),this._websocketEventDispatcherContext&&(this._websocketEventDispatcherContext.close(),this._websocketEventDispatcherContext=void 0)},Object.defineProperty(n.prototype,"isConnected",{get:function(){return this._context.currentState.type===ie.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isConnecting",{get:function(){var t=this._context.currentState;return t.type===ie.CONNECTING||t.type===ie.RECONNECTING},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"websocketClient",{get:function(){return this._websocketClient},enumerable:!1,configurable:!0}),n.prototype.connect=function(t){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return e=this._context.currentState,this._webSocketClosedCause=null,[4,e.onConnect(this._context,t)];case 1:return r.sent(),this._registerEventDispatcher(),[2]}})})},n.prototype.reconnect=function(){return f(this,void 0,void 0,function(){var t;return h(this,function(e){switch(e.label){case 0:return t=this._context.currentState,this._webSocketClosedCause=null,[4,t.onReconnect(this._context,{})];case 1:return e.sent(),[2]}})})},n.prototype.resetAndReconnect=function(){return f(this,void 0,void 0,function(){var t;return h(this,function(e){switch(e.label){case 0:return t=this._context.currentState,this._webSocketClosedCause=null,[4,t.onReconnect(this._context,{resetReconnectCount:!0})];case 1:return e.sent(),[2]}})})},n.prototype.background=function(){return f(this,void 0,void 0,function(){var t;return h(this,function(e){switch(e.label){case 0:return t=this._context.currentState,this._webSocketClosedCause=Sn.ExternalSetBackground,[4,t.onDisconnect(this._context,{autoReconnect:!1,cause:this._webSocketClosedCause})];case 1:return e.sent(),[2]}})})},n.prototype.disconnect=function(t){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{error:t,autoReconnect:!0,cause:this._webSocketClosedCause})];case 1:return e.sent(),[2]}})})},n.prototype.disconnectWebSocket=function(t){return t===void 0&&(t=!1),f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return e=this._context.currentState,t&&(this._webSocketClosedCause=Sn.ExternalDisconnectWebSocket),[4,e.onDisconnectWebSocket(this._context,{cause:this._webSocketClosedCause})];case 1:return r.sent(),[2]}})})},n.prototype.logout=function(){return f(this,void 0,void 0,function(){var t;return h(this,function(e){switch(e.label){case 0:return t=this._context.currentState,this._clearEventDispatcher(),[4,t.onLogout(this._context)];case 1:return e.sent(),[2]}})})},n}(),Ei=function(n){function t(e){var r=e.authToken,i=n.call(this)||this;return i.type=ie.CONNECTING,i.name="connecting",i._authToken="",i._callbacks=[],i._authToken=r,i}return v(t,n),t.prototype._halt=function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)},t.prototype._flushCallbacks=function(e){this._haltConnect=void 0,this._callbacks.forEach(function(r){return r(e)})},t.prototype.run=function(e){return f(this,void 0,void 0,function(){var r,i,s,o=this;return h(this,function(a){switch(a.label){case 0:r=Date.now(),i=new Re,this._callbacks.push(function(u){return u?i.reject(u):i.resolve()}),a.label=1;case 1:return a.trys.push([1,4,,10]),[4,to(function(u){return f(o,void 0,void 0,function(){var c;return h(this,function(l){switch(l.label){case 0:this._haltConnect=u,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,e.connect(this._authToken)];case 2:return l.sent(),[3,4];case 3:if(c=l.sent(),e.clearLoginTimer(),c instanceof I&&c.code===q.CONNECTION_CANCELED)return u(c),[2];throw c;case 4:return[2]}})})},e.sdkState.websocket.connectMaxRetry)];case 2:return a.sent(),[4,e.changeState(new Pu,r)];case 3:return a.sent(),K(function(){return f(o,void 0,void 0,function(){return h(this,function(u){return this._flushCallbacks(),e.connectionHandlers.forEach(function(c){c.onConnected&&c.onConnected(e.sdkState.userId)}),[2]})})}),[3,10];case 4:return s=a.sent(),et(s)?[3,8]:[4,e.disconnect()];case 5:return a.sent(),s instanceof I?s.code===q.CONNECTION_CANCELED?[3,7]:[4,e.changeState(new no,r)]:[3,7];case 6:a.sent(),a.label=7;case 7:return K(function(){return f(o,void 0,void 0,function(){return h(this,function(u){return this._flushCallbacks(s),[2]})})}),[3,9];case 8:throw s;case 9:return[3,10];case 10:return[2,i.promise]}})})},t.prototype.onConnect=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){return r=new Re,this._callbacks.push(function(s){return s?r.reject(s):r.resolve()}),[2,r.promise]})})},t.prototype.onDisconnect=function(e,r){var i=r.error,s=i===void 0?null:i,o=r.autoReconnect,a=o!==void 0&&o,u=r.cause,c=u===void 0?null:u;return f(this,void 0,void 0,function(){var l;return h(this,function(d){switch(d.label){case 0:return l=Date.now(),this._halt(s??ia(c)),e.hasSession?[4,e.changeState(new li({autoReconnect:a}),l)]:[3,2];case 1:return d.sent(),[3,4];case 2:return[4,e.changeState(new zt,l)];case 3:d.sent(),d.label=4;case 4:return[2]}})})},t.prototype.onDisconnectWebSocket=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return this._halt(ia((r==null?void 0:r.cause)||null)),i=Date.now(),e.hasSession?[4,e.changeState(new yi,i)]:[3,2];case 1:return s.sent(),[3,4];case 2:return[4,e.changeState(new zt,i)];case 3:s.sent(),s.label=4;case 4:return[2]}})})},t.prototype.onLogout=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),this._halt(I.connectionCanceled),[4,e.changeState(new zt,r)];case 1:return i.sent(),[2]}})})},t}(dn);function ia(n){var t=I.connectionCanceled;if(n){var e=null;switch(n){case Sn.ExternalSetBackground:e="Connection has been canceled due to the application having externally moved to background while in ConnectingState.";break;case Sn.ExternalDisconnectWebSocket:e="Connection has been canceled because sb.disconnectWebSocket() was called while in ConnectingState."}e&&t.setDetail(e)}return t}var Rt,no=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.type=ie.INITIALIZED,e.name="initialized",e}return v(t,n),t.prototype.onConnect=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=Date.now(),[4,e.changeState(new Ei({authToken:r}),i)];case 1:return s.sent(),[2]}})})},t.prototype.onLogout=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new zt({wasPreviouslyConnected:!1}),r)];case 1:return i.sent(),[2]}})})},t}(dn),fd=function(n){function t(){return n.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})||this}return v(t,n),t}(qe),pd=function(){function n(t){var e=t.pingDelegate,r=t.sdkState,i=t.logger;this.pingDelegate=e,this.sdkState=r,this._logger=i}return Object.defineProperty(n.prototype,"isWaiting",{get:function(){return!!this._pingTimeoutTimer},enumerable:!1,configurable:!0}),n.prototype.ping=function(){var t,e=this;if(!this.sdkState.websocket)throw I.connectionRequired;var r=new fd;try{var i=(t=this.sdkState.websocket.pongTimeout)!==null&&t!==void 0?t:5e3;this._pingTimeoutTimer=setTimeout(function(){e._logger.debug("pinger.ping() timeout"),e.pingDelegate.error()},i),this.pingDelegate.send(r),this._logger.debug("pinger.ping()")}catch(s){this._logger.debug("pinger.ping() error",s),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0),this.pingDelegate.error()}return r},n.prototype.pong=function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)},n.prototype.refreshTimer=function(){var t,e=this;if(!this.sdkState.websocket)throw I.connectionRequired;this._logger.debug("pinger.refreshTimer()");var r=(t=this.sdkState.websocket.pingInterval)!==null&&t!==void 0?t:15e3;this.stop(),this._pingTimer=setInterval(function(){e.ping()},r)},n.prototype.start=function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()},n.prototype.stop=function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=void 0),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)},n}(),xu=["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash","multiple_file_send_max_size","notifications","message_template"],_d=function(n){function t(e,r){var i,s=r.sdkState,o=r.cacheContext,a=r.connectionHandlers,u=r.sessionManager,c=r.websocketClient,l=r.dispatcher,d=r.logger,p=r.entryState,_=p===void 0?new no:p,m=this;return(m=n.call(this)||this)._stateUpdatedAt=0,m._connectingAt=0,m._connectionRequestQueue=[],m._iid=e,m.sdkState=s,m.cacheContext=o,m.connectionHandlers=a,m._sessionManager=u,m._websocketClient=c,m._dispatcher=l,m._logger=d,m._currentState=_,!((i=m.sdkState.websocket)===null||i===void 0)&&i.pingerDisabled||(m._pinger=new pd({pingDelegate:{send:function(g){return m._websocketClient.send(g)},error:function(g){return m._websocketClient.error(g)}},sdkState:m.sdkState,logger:d})),m._websocketClient.on("open",function(){m._tryResolveConnectionRequest()}).on("message",function(g){g.code==="LOGI"&&(m.clearLoginTimer(),m._dispatcher.dispatch(g.as(Yr)))}).on("ping-refresh",function(){var g;return(g=m._pinger)===null||g===void 0?void 0:g.refreshTimer()}).on("pong",function(){var g;return(g=m._pinger)===null||g===void 0?void 0:g.pong()}).on("error",function(){var g;return(g=m._pinger)===null||g===void 0?void 0:g.stop()}).on("close",function(){m._logiProcessingTimer=setTimeout(function(){m._logiProcessingTimer=void 0,m._unresolvedLogi||m._rejectConnectionRequest(I.networkError)},500)}),m._dispatcher.on(function(g){g instanceof Yr&&(m._unresolvedLogi=g,m._tryResolveConnectionRequest())}),m}return v(t,n),Object.defineProperty(t.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasSession",{get:function(){return this._sessionManager.session.hasSession},enumerable:!1,configurable:!0}),t.prototype.changeState=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){switch(i.label){case 0:return r>=this._stateUpdatedAt?(this._currentState=e,this._stateUpdatedAt=r,this._dispatcher.dispatch(new ln({stateType:e.type})),this._logger.debug("connection state changes to ".concat(e.name)),[4,this._currentState.run(this)]):[3,2];case 1:return i.sent(),[2,!0];case 2:return[2,!1]}})})},t.prototype._tryResolveConnectionRequest=function(){var e;return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=this._unresolvedLogi,this._websocketClient.isOpen&&r?(this._unresolvedLogi=void 0,r.error?[3,2]:[4,r.applyTo(this._iid)]):[3,3];case 1:return i.sent(),this._statLogConnection(),(e=this._pinger)===null||e===void 0||e.start(),this._connectionRequestQueue.forEach(function(s){return s.resolve()}),this._connectionRequestQueue=[],this.sdkState.appState="foreground",[3,3];case 2:this._sessionManager.session.authToken=void 0,(r.error.isSessionExpiredError||r.error.isSessionInvalidatedError)&&this._dispatcher.dispatch(new Tn({reason:r.error.code})),this._rejectConnectionRequest(r.error),i.label=3;case 3:return[2]}})})},t.prototype._rejectConnectionRequest=function(e){var r;if((r=this._pinger)===null||r===void 0||r.stop(),this.clearLoginTimer(),this._connectionRequestQueue.length>0){var i=this._connectionRequestQueue;this._connectionRequestQueue=[],i.forEach(function(s){return s.reject(e)}),this._statLogConnection(e)}},t.prototype._url=function(){var e,r=this.sdkState,i=r.appId,s=r.appVersion,o=r.userId,a=r.extensions,u=r.sendbirdRuntimeEnvironment,c=this.cacheContext.localCacheEnabled,l=this._sessionManager.session,d=(e=this.sdkState.websocket)===null||e===void 0?void 0:e.compression,p=!!(a??{}).sb_uikit,_=si.userAgentWithExtension(a);return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(Pt.OS_VERSION),"&sv=").concat(encodeURIComponent(Pt.SDK_VERSION),"&ai=").concat(i).concat(s?"&av=".concat(s):"").concat(l.hasSession?"":"&user_id=".concat(encodeURIComponent(o)),"&pmce=").concat(d?1:0,"&active=1&device_token_types=").concat(encodeURIComponent(["gcm","huawei","apns"].join(",")),"&SB-User-Agent=").concat(_,"&SB-SDK-User-Agent=").concat(encodeURIComponent(si.sendbirdSdkUserAgentWithExtension(u)),"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(xu))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=").concat(c?1:0,"&include_poll_details=1").concat(p?"&uikit_config=1":"")},t.prototype._statLogConnection=function(e){var r;this._dispatcher.dispatch(new Xs(new Cn({type:De.WEBSOCKET_CONNECT,data:{host_url:(r=this.sdkState.websocket)===null||r===void 0?void 0:r.host,success:!e,latency:Date.now()-this._connectingAt,error_code:e==null?void 0:e.code,error_description:e==null?void 0:e.message}})))},t.prototype.connect=function(e){var r;return e===void 0&&(e=""),f(this,void 0,void 0,function(){var i,s,o,a=this;return h(this,function(u){return this._logiProcessingTimer&&(clearTimeout(this._logiProcessingTimer),this._logiProcessingTimer=void 0,this._rejectConnectionRequest(I.connectionCanceled)),i=this._url(),s=new Re,this._connectionRequestQueue.push(s),this._connectionRequestQueue.length===1&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout(function(){a._loginTimer=void 0,a._rejectConnectionRequest(I.loginTimeout)},(r=this.sdkState.websocket)===null||r===void 0?void 0:r.responseTimeout),o=this._sessionManager.session,e&&(o.authToken=e),this._websocketClient.connect(i,JSON.stringify(o.hasSession?{auth:o.sessionKey}:{token:e}))),[2,s.promise]})})},t.prototype.cancelConnectForRetry=function(){this._dispatcher.dispatch(Yr.asError(I.connectionRenew))},t.prototype.disconnect=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this._websocketClient.disconnect()];case 1:return e.sent(),[2]}})})},t.prototype.logout=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this.sdkState.userId=void 0,this._unresolvedLogi=void 0,[4,this.disconnect()];case 1:return e.sent(),[4,this._sessionManager.clear()];case 2:return e.sent(),[2]}})})},t.prototype.clearLoginTimer=function(){this._loginTimer&&(clearTimeout(this._loginTimer),this._loginTimer=void 0)},t}(Dn),Fu=function(n){function t(e){var r=e.appId,i=e.userId,s=e.services,o=e.includeUIKitConfig,a=o!==void 0&&o,u=e.localCacheEnabled,c=u===void 0||u,l=e.expiringSession,d=l===void 0||l,p=n.call(this)||this;return p.path="".concat(ee,"/").concat(i,"/login"),p.method=O.POST,p.params=x({expiring_session:!!d,services:s,include_logi:!0,include_extra_data:String(xu),uikit_config:a,use_local_cache:c,app_id:r}),p.requireAuth=!1,p}return v(t,n),t}(D),vd=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.logi=new Yr(e,"LOGI",r),i}return v(t,n),t}(U);(function(n){n[n.ALL=0]="ALL",n[n.WEBSOCKET=1]="WEBSOCKET",n[n.API=2]="API"})(Rt||(Rt={}));var lt,md=[Zs,Fu],gd=function(){function n(t,e){var r=e.session,i=e.sdkState,s=e.dispatcher,o=e.logger,a=e.useFetchCompat,u=a!==void 0&&a,c=this;this._currentConnectionStateType=ie.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new rd(t,{session:r,sdkState:i,dispatcher:s,logger:o,useFetchCompat:u}),this._session=r,this._logger=o,this._dispatcher=s,this._dispatcher.on(function(l){var d,p,_,m;if(l instanceof ln){var g=l.stateType;switch(c._currentConnectionStateType=g,g){case ie.CONNECTED:c._resolveLazyCallQueue();break;case ie.INITIALIZED:case ie.INTERNAL_DISCONNECTED:case ie.EXTERNAL_DISCONNECTED:case ie.LOGOUT:c._rejectLazyCallQueue(!((_=c._session)===null||_===void 0)&&_.hasSession?I.connectionClosed:I.connectionRequired)}}else if(l instanceof Du)!((m=c._session.services)===null||m===void 0)&&m.includes(lr.CHAT)||c._resolveLazyCallQueue(Rt.API);else if(l instanceof Os||l instanceof Ru)c._rejectLazyCallQueue(I.connectionClosed);else if(l instanceof du){var y=l.request,b=l.deferred,T=l.error;try{for(var C=$(md),N=C.next();!N.done;N=C.next())if(y instanceof N.value)return void b.reject(T)}catch(P){d={error:P}}finally{try{N&&!N.done&&(p=C.return)&&p.call(C)}finally{if(d)throw d.error}}c._lazyCallQueue.push({command:y,deferred:b})}})}return Object.defineProperty(n.prototype,"isReady",{get:function(){return this._currentConnectionStateType===ie.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isLazyCallActivated",{get:function(){return this._currentConnectionStateType===ie.CONNECTING||this._currentConnectionStateType===ie.RECONNECTING||this._session.isRefreshing},enumerable:!1,configurable:!0}),n.prototype._classifyLazyCallQueueByScope=function(t){var e,r=[],i=[];switch(t){case Rt.ALL:e=null;break;case Rt.WEBSOCKET:e=qe;break;case Rt.API:e=D}var s=!1;return this._lazyCallQueue.forEach(function(o){!e||o.command instanceof e||(s=!0),s?i.push(o):r.push(o)}),[r,i]},n.prototype._resolveLazyCallQueue=function(t){var e=this;t===void 0&&(t=Rt.ALL);var r=G(this._classifyLazyCallQueueByScope(t),2),i=r[0],s=r[1];this._lazyCallQueue=s,i.forEach(function(o){return f(e,void 0,void 0,function(){var a,u,c,l,d;return h(this,function(p){switch(p.label){case 0:a=o.command,u=o.deferred,(c=o.timeout)&&clearTimeout(c),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.send(a)];case 2:return l=p.sent(),u.resolve(l),[3,4];case 3:return d=p.sent(),u.reject(d),[3,4];case 4:return[2]}})})})},n.prototype._rejectLazyCallQueue=function(t,e){var r=this;e===void 0&&(e=Rt.ALL);var i=G(this._classifyLazyCallQueueByScope(e),2),s=i[0],o=i[1];this._lazyCallQueue=o,s.forEach(function(a){return f(r,void 0,void 0,function(){var u,c;return h(this,function(l){return u=a.deferred,c=a.timeout,clearTimeout(c),u.reject(t),[2]})})})},n.prototype.send=function(t){return f(this,void 0,void 0,function(){var e,r,i=this;return h(this,function(s){switch(s.label){case 0:return t instanceof qe?this.isReady?(this._logger.debug("send websocket request",t),[4,this.commandRouter.send(t)]):[3,2]:[3,4];case 1:case 5:return[2,s.sent()];case 2:if(this.isLazyCallActivated)return this._logger.debug("wait websocket request",t),e=new Re,this._lazyCallQueue.push({command:t,deferred:e,timeout:setTimeout(function(){return i.timeout(t.requestId)},1e4)}),[2,e.promise];throw this._logger.debug("fail websocket request"),I.connectionRequired;case 3:case 7:return[3,9];case 4:return t instanceof D?this._session.hasSession?(this._logger.debug("send api request",t),[4,this.commandRouter.send(t)]):[3,6]:[3,8];case 6:if(this.isLazyCallActivated)return this._logger.debug("wait api request",t),e=new Re,this._lazyCallQueue.push({command:t,deferred:e,timeout:setTimeout(function(){return i.timeout(t.requestId)},1e4)}),[2,e.promise];throw r=I.connectionRequired,this._logger.debug("fail api request",r),r;case 8:throw I.invalidCommand;case 9:return[2]}})})},n.prototype.forceSend=function(t){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this._logger.debug("send forced request",t),t instanceof qe||t instanceof D?[4,this.commandRouter.send(t)]:[3,2];case 1:return[2,e.sent()];case 2:throw I.invalidCommand}})})},n.prototype.timeout=function(t){this._logger.debug("timeout request",t);var e=this._lazyCallQueue.findIndex(function(r){return r.command.requestId===t});e>-1&&(this._lazyCallQueue[e].deferred.reject(I.connectionRequired),this._lazyCallQueue.splice(e,1))},n.prototype.cancel=function(t){this._logger.debug("cancel api request",t),this.commandRouter.cancel(t)},n.prototype.cancelAll=function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()},n}(),ss="sendbird@devicetokens",os=function(){function n(t){var e=t.type,r=t.token;this.type=e,this.token=r}return n.payloadify=function(t){return x(H({type:t.type,token:t.token}))},n}(),as=new WeakMap,yd=function(n){function t(e){var r=e._iid,i=e.session,s=e.cacheContext,o=e.sdkState,a=e.dispatcher,u=e.requestQueue,c=e.logger,l=n.call(this)||this;return l._currentConnectionStateType=ie.INITIALIZED,l._isRefreshingAuthToken=!1,l.currentUser=null,l.session=i,l._iid=r,l._cacheContext=s,l._sdkState=o,l._dispatcher=a,l._requestQueue=u,l._logger=c,l._deviceTokens=[],l._dispatcher.on(function(d){var p,_;if(d instanceof ln){var m=d.stateType;l._currentConnectionStateType=m}else d instanceof Tn&&l.handler&&!l.isSessionKeyRefreshing&&(d.invalidateSessionToken&&(l.session.authToken=void 0),!((p=d.error)===null||p===void 0)&&p.isSessionInvalidatedError?l.handler.onSessionClosed&&l.handler.onSessionClosed():!((_=d.error)===null||_===void 0)&&_.isSessionExpiredError&&(l._logger.debug("session expired"),l.handler.onSessionExpired&&l.handler.onSessionExpired(),l.refresh().catch(function(g){if(et(g)&&l._sdkState.appState==="foreground")throw g})))}),l}return v(t,n),Object.defineProperty(t.prototype,"ekey",{get:function(){return as.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"deviceTokens",{get:function(){return this._deviceTokens},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"deviceTokenLastDeletedAt",{get:function(){return this._deviceTokenLastDeletedAt},enumerable:!1,configurable:!0}),t.prototype.indexOfDeviceToken=function(e,r){return this._deviceTokens.findIndex(function(i){return i.type===e&&i.token===r})},t.prototype.hasDeviceToken=function(e,r){return this.indexOfDeviceToken(e,r)>=0},t.prototype.createRefreshWebsocketCommand=function(e,r){return new Zc({authToken:e,expiringSession:!0,requestId:r})},t.prototype._refreshSessionKeyByWebSocket=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return r=this.createRefreshWebsocketCommand(e),[4,this._requestQueue.forceSend(r)];case 1:if(i=u.sent(),s=i.as(Jc),o=s.newKey,a=s.error)throw a;return this.session.sessionKey=o??this.session.sessionKey,[2]}})})},t.prototype._refreshSessionKeyByApi=function(e){return f(this,void 0,void 0,function(){var r,i=this;return h(this,function(s){switch(s.label){case 0:return r=new Zs({userId:this._sdkState.userId,authToken:e,services:this.session.services&&this.session.services.length>0?this.session.services:void 0,expiringSession:!0}),[4,to(function(o){return f(i,void 0,void 0,function(){var a,u,c,l,d;return h(this,function(p){switch(p.label){case 0:return p.trys.push([0,2,,3]),[4,this._requestQueue.forceSend(r)];case 1:return a=p.sent(),u=a.as(Xc),c=u.key,l=u.services,this.session.sessionKey=c,this.session.services=l,[3,3];case 2:if(d=p.sent(),!this._isSessionRelatedError(d))throw d;return o(d),[3,3];case 3:return[2]}})})},3)];case 1:return s.sent(),[2]}})})},t.prototype._refreshSessionKey=function(e,r){return r===void 0&&(r=!0),f(this,void 0,void 0,function(){var i,s;return h(this,function(o){switch(o.label){case 0:if(this._currentConnectionStateType!==ie.CONNECTED)return[3,8];o.label=1;case 1:return o.trys.push([1,3,,8]),[4,this._refreshSessionKeyByWebSocket(e)];case 2:return o.sent(),this.complete(),[2];case 3:i=o.sent(),o.label=4;case 4:return o.trys.push([4,6,,7]),[4,this._handleSessionRefreshError(i,r)];case 5:return o.sent(),[2];case 6:return o.sent(),[3,7];case 7:return[3,8];case 8:return o.trys.push([8,10,,12]),[4,this._refreshSessionKeyByApi(e)];case 9:return o.sent(),this.complete(),[3,12];case 10:return s=o.sent(),[4,this._handleSessionRefreshError(s,r)];case 11:return o.sent(),[3,12];case 12:return[2]}})})},t.prototype._receiveNewAuthToken=function(){var e,r=this,i=new Re;if(this._isRefreshingAuthToken=!0,this.session.sessionKey=void 0,this.session.authToken=void 0,(e=this.handler)===null||e===void 0?void 0:e.onSessionTokenRequired){var s=null,o=function(){s&&(clearTimeout(s),s=null)},a=function(c){o(),r._isRefreshingAuthToken&&(r._isRefreshingAuthToken=!1,i.resolve(c))},u=function(c){o(),r._isRefreshingAuthToken&&(r._isRefreshingAuthToken=!1,i.reject(c))};s=setTimeout(function(){return u()},1e3*this._sdkState.sessionTokenRefreshTimeout),K(function(){return f(r,void 0,void 0,function(){var c;return h(this,function(l){return!((c=this.handler)===null||c===void 0)&&c.onSessionTokenRequired&&this.handler.onSessionTokenRequired(a,u),[2]})})})}else i.resolve(null);return i.promise},t.prototype._handleSessionRefreshError=function(e,r){return r===void 0&&(r=!1),f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return e instanceof I&&(e.isSessionTokenExpiredError||e.code===q.APPLICATION_NOT_FOUND)?(this.session.authToken=void 0,r?[4,this._receiveNewAuthToken()]:[3,6]):[3,6];case 1:return(i=s.sent())?(this.session.authToken=i,[4,this._refreshSessionKey(this.session.authToken,!1)]):[3,3];case 2:return s.sent(),this.complete(),[3,5];case 3:return[4,this.clear()];case 4:s.sent(),s.label=5;case 5:return[2];case 6:throw e}})})},t.prototype._isSessionRelatedError=function(e){return e instanceof I&&(e.isSessionExpiredError||e.isSessionInvalidatedError)},Object.defineProperty(t.prototype,"isSessionKeyRefreshing",{get:function(){return this.session.isRefreshing},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRefreshingAuthToken",{get:function(){return this._isRefreshingAuthToken},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionExpiring",{get:function(){return!!this.handler},enumerable:!1,configurable:!0}),t.prototype.authenticateFeed=function(e,r){var i;return f(this,void 0,void 0,function(){var s,o,a;return h(this,function(u){switch(u.label){case 0:return this.session.authToken=r,s=new Fu({appId:this._sdkState.appId,userId:e,services:[lr.FEED],includeUIKitConfig:!!((i=this._sdkState.extensions)!==null&&i!==void 0?i:{}).sb_uikit,localCacheEnabled:this._cacheContext.localCacheEnabled,expiringSession:!r||this.isSessionExpiring}),[4,this._requestQueue.commandRouter.send(s)];case 1:return o=u.sent(),(a=o.as(vd).logi).error?[3,3]:[4,a.applyTo(this._iid)];case 2:return u.sent(),[3,4];case 3:throw a.error;case 4:return[2]}})})},t.prototype.login=function(e){var r;return f(this,void 0,void 0,function(){var i,s,o,a,u,c,l,d;return h(this,function(p){switch(p.label){case 0:return i=e.key,s=e.ekey,o=e.services,a=e.userProfile,u=e.deviceTokenLastDeletedAt,c=u===void 0?0:u,this.session.sessionKey=i,this.session.services=o,as.set(this,s),this._deviceTokenCacheEnabled=(r=a==null?void 0:a.appInfo)===null||r===void 0?void 0:r.deviceTokenCache,l=this._cacheContext.preference,this._deviceTokenCacheEnabled?[4,l.get(ss)]:[3,5];case 1:return!(d=p.sent())||d.lastDeletedAt<c?(this._deviceTokens=[],this._deviceTokenLastDeletedAt=c,[4,this.saveDeviceToken()]):[3,3];case 2:return p.sent(),[3,4];case 3:this._deviceTokens=d.tokens.map(function(_){return new os(os.payloadify(_))}),this._deviceTokenLastDeletedAt=d.lastDeletedAt,p.label=4;case 4:return[3,7];case 5:return[4,l.remove(ss)];case 6:p.sent(),p.label=7;case 7:return[2]}})})},t.prototype.complete=function(){var e=this;this.dispatch("refresh"),this._dispatcher.dispatch(new Du),K(function(){return f(e,void 0,void 0,function(){var r;return h(this,function(i){return this._logger.debug("session refreshed"),!((r=this.handler)===null||r===void 0)&&r.onSessionRefreshed&&this.handler.onSessionRefreshed(),[2]})})})},t.prototype.error=function(e){var r=this;K(function(){return f(r,void 0,void 0,function(){var i;return h(this,function(s){return!((i=this.handler)===null||i===void 0)&&i.onSessionError&&this.handler.onSessionError(e),[2]})})})},t.prototype.close=function(){var e=this;this.dispatch("close"),this._dispatcher.dispatch(new Ru),K(function(){return f(e,void 0,void 0,function(){var r;return h(this,function(i){return this._logger.debug("session closed"),!((r=this.handler)===null||r===void 0)&&r.onSessionClosed&&this.handler.onSessionClosed(),[2]})})})},t.prototype.refresh=function(){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:if(!this.isSessionExpiring)return[3,10];if(this.session.isRefreshing)return[3,10];if(this.session.isRefreshing=!0,this.session.authToken)return[3,7];i.label=1;case 1:return i.trys.push([1,6,,7]),[4,this._receiveNewAuthToken()];case 2:return(e=i.sent())?(this._logger.debug("session refreshing.."),this.session.authToken=e,[3,5]):[3,3];case 3:return[4,this.clear()];case 4:return i.sent(),this.session.isRefreshing=!1,[2];case 5:return[3,7];case 6:throw i.sent(),r=I.sessionTokenRequestFailed,this._dispatcher.dispatch(new Os),this.error(r),this.session.isRefreshing=!1,this._logger.debug("refresh auth token error = ",r),r;case 7:return i.trys.push([7,9,,10]),[4,this._refreshSessionKey(this.session.authToken)];case 8:return i.sent(),this.session.isRefreshing=!1,[3,10];case 9:throw i.sent(),this.session.isRefreshing=!1,r=I.sessionTokenRefreshFailed,this._dispatcher.dispatch(new Os),this.error(r),r;case 10:return[2]}})})},t.prototype.setDeviceToken=function(e,r){return this._deviceTokenCacheEnabled&&this.indexOfDeviceToken(e,r)<0?(this._deviceTokens.push(new os({type:e,token:r})),!0):!1},t.prototype.unsetDeviceToken=function(e,r){if(this._deviceTokenCacheEnabled){var i=this.indexOfDeviceToken(e,r);i>=0&&this._deviceTokens.splice(i,1)}},t.prototype.unsetDeviceTokens=function(e){this._deviceTokenCacheEnabled&&(this._deviceTokens=e?this._deviceTokens.filter(function(r){return r.type!==e}):[])},t.prototype.setDeviceTokenDeletedAt=function(e){e>0&&(this._deviceTokenLastDeletedAt=e)},t.prototype.saveDeviceToken=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this._deviceTokenCacheEnabled?[4,this._cacheContext.preference.set(ss,{tokens:this._deviceTokens,lastDeletedAt:this._deviceTokenLastDeletedAt})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this.currentUser=null,this.session.clear(),this.close(),as.delete(this),this._deviceTokens=[],this._deviceTokenLastDeletedAt=0,[4,this.saveDeviceToken()];case 1:return e.sent(),[2]}})})},t}(Dn),xr=function(n){function t(e){var r,i,s,o,a=e.type,u=e.data,c=e.ts,l=c===void 0?Date.now():c,d=n.call(this,{type:a,data:u,ts:l})||this;return d.date=new Date(l),d.key="".concat((r=d.date,i=r.getFullYear(),s=String(r.getMonth()+1).padStart(2,"0"),o=String(r.getDate()).padStart(2,"0"),"".concat(i).concat(s).concat(o)),"_").concat(a),d}return v(t,n),t}(Cn),Ed=function(n){function t(e){var r=e.deviceId,i=e.statLogs,s=n.call(this)||this;return s.method=O.POST,s.path="".concat(Wc),s.params={device_id:r,log_entries:i.map(function(o){return Cn.payloadify(o)})},s}return v(t,n),t}(D),qu=function(n,t){var e,r;if(n!==null&&t!==null){var i=Object.keys(n),s=Object.keys(t),o=Z([],G(new Set(Z(Z([],G(i),!1),G(s),!1))),!1),a={};try{for(var u=$(o),c=u.next();!c.done;c=u.next()){var l=c.value,d=typeof n[l],p=typeof t[l];d==="undefined"?a[l]=t[l]:p==="undefined"?a[l]=n[l]:d!==p?a[l]=t[l]:d==="object"&&n[l]&&t[l]?a[l]=qu(n[l],t[l]):a[l]=t[l]}}catch(_){e={error:_}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}return a}return t};(function(n){n[n.PENDING=0]="PENDING",n[n.COLLECT_ONLY=1]="COLLECT_ONLY",n[n.ENABLED=2]="ENABLED",n[n.DISABLED=3]="DISABLED"})(lt||(lt={}));var It,bd=function(n){function t(e){var r=e.cacheContext,i=e.requestQueue,s=e.dispatcher,o=e.baseLimit,a=o===void 0?100:o,u=e.maxLimit,c=u===void 0?1e3:u,l=e.minLimit,d=l===void 0?10:l,p=n.call(this)||this;return p.queue=[],p.flushWaitQueue=[],p.enabledState=lt.PENDING,p.isFlushing=!1,p.generation=1,p.lastFlushedAt=Date.now(),p._collectRequestStat=!0,p._collectFeatureLocalCacheStat=!0,p._collectionNotificationStat=!0,p.deviceId=sn(),p.cacheContext=r,p.requestQueue=i,p.dispatcher=s,p.baseLimit=a,p.limit=a,p.maxLimit=c,p.minLimit=d,p}return v(t,n),Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this.enabledState===lt.ENABLED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isReadyToFlush",{get:function(){return this.queue.length>=this.limit||Date.now()-this.lastFlushedAt>=108e5&&this.queue.length>=this.minLimit},enumerable:!1,configurable:!0}),t.prototype._arrangeStat=function(){var e=Z([],G(this.queue),!1);this._collectRequestStat||(e=e.filter(function(r){return r.type!==De.API_RESULT&&r.type!==De.WEBSOCKET_CONNECT})),this._collectFeatureLocalCacheStat||(e=e.filter(function(r){return r.type!==De.FEATURE_LOCALCACHE&&r.type!==De.FEATURE_LOCALCACHE_EVENT})),this._collectionNotificationStat||(e=e.filter(function(r){return r.type!==De.NOTIFICATION})),this.queue=e},t.prototype._save=function(){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return this.isEnabled?(e=Z(Z([],G(this.queue),!1),G(this.flushWaitQueue),!1),[4,this.cacheContext.preference.set(this.key,{deviceId:this.deviceId,statLogs:e.map(function(i){return Cn.payloadify(i)}),generation:this.generation++,lastFlushedAt:this.lastFlushedAt})]):[3,2];case 1:r.sent(),this.dispatch("save",e),r.label=2;case 2:return[2]}})})},t.prototype._flush=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o;return h(this,function(a){switch(a.label){case 0:if(!this.isEnabled)return[3,10];if(this.isFlushing)return[3,10];this.isFlushing=!0,a.label=1;case 1:return a.trys.push([1,5,9,10]),this._arrangeStat(),e=this.queue.filter(function(u){if(u instanceof xr){var c=new Date,l=G([u.date.getFullYear(),c.getFullYear()],2),d=l[0],p=l[1];if(d<p)return!0;if(d===p){var _=G([u.date.getMonth(),c.getMonth()],2),m=_[0],g=_[1];if(m<g)return!0;if(m===g){var y=G([u.date.getDate(),c.getDate()],2);return y[0]<y[1]}}}return!1}),r=this.queue.filter(function(u){return!(u instanceof xr)}),(i=Z(Z([],G(e),!1),G(r),!1).slice(0,Math.min(this.limit,this.maxLimit))).length>0?(s=new Ed({deviceId:this.deviceId,statLogs:i}),[4,this.requestQueue.send(s)]):[3,4];case 2:return a.sent(),this.dispatch("flush",i),this.queue=Z(Z([],G(e),!1),G(r),!1).slice(i.length).concat(this.flushWaitQueue),this.flushWaitQueue=[],this.limit=this.baseLimit,this.lastFlushedAt=Date.now(),[4,this._save()];case 3:a.sent(),a.label=4;case 4:return[3,10];case 5:return(o=a.sent())instanceof I?o.code!==q.NON_AUTHORIZED?[3,7]:[4,this.clear()]:[3,8];case 6:return a.sent(),this.enabledState=lt.DISABLED,[3,8];case 7:o.code===q.STAT_UPLOAD_NOT_ALLOWED&&(this.enabledState=lt.COLLECT_ONLY),a.label=8;case 8:return this.limit=this.limit+20,[3,10];case 9:return this.isFlushing=!1,[7];case 10:return[2]}})})},t.prototype.init=function(e){return f(this,void 0,void 0,function(){var r,i,s=this;return h(this,function(o){switch(o.label){case 0:return this.key=e,[4,this.cacheContext.preference.get(this.key)];case 1:return(r=o.sent())?(this.deviceId=r.deviceId,this.queue=r.statLogs.map(function(a){var u;return a.stat_type===De.FEATURE_LOCALCACHE_EVENT&&(a.data=E({message_init_policy:"",starting_point:0},a.data)),a.stat_type===De.NOTIFICATION&&(a.data=x(E(E({},a.data),{message_id:(u=a.data.notificationId)!==null&&u!==void 0?u:a.data.message_id,notificationId:void 0}))),new Cn({type:a.stat_type,ts:a.ts,data:a.data})}),this.generation=r.generation,this.lastFlushedAt=r.lastFlushedAt,this.isReadyToFlush?(i=Math.min(Math.floor(18e4*Math.random()),100),[4,Xe(i)]):[3,4]):[3,4];case 2:return o.sent(),[4,this._flush()];case 3:o.sent(),o.label=4;case 4:return this.commandEventContext||(this.commandEventContext=this.dispatcher.on(function(a){if(a instanceof Xs){var u=a.statLog;s.put(u)}else if(a instanceof Mu){var c=a.request,l=a.features,d=a.options;s._collectRequestStat=c,s._collectFeatureLocalCacheStat=l==null?void 0:l.localCache,s._collectionNotificationStat=l==null?void 0:l.notification,s._arrangeStat(),s._collectRequestStat||s._collectFeatureLocalCacheStat||s._collectionNotificationStat?s.enabledState=d.ingestion?lt.ENABLED:lt.COLLECT_ONLY:s.enabledState=lt.DISABLED,s.isEnabled?s.isReadyToFlush&&s._flush():s.clear()}})),[2]}})})},t.prototype.put=function(e){return f(this,void 0,void 0,function(){var r,i,s;return h(this,function(o){switch(o.label){case 0:if(this.enabledState===lt.DISABLED)return[3,3];if(r=this.isFlushing?this.flushWaitQueue:this.queue,e instanceof xr)this._collectFeatureLocalCacheStat&&(i=G(this.queue.filter(function(a){return a instanceof xr&&a.key===e.key}),1),(s=i[0])?s.data=qu(s.data,e.data):r.push(e));else switch(e.type){case De.API_RESULT:case De.WEBSOCKET_CONNECT:this._collectRequestStat&&r.push(e);break;case De.FEATURE_LOCALCACHE:case De.FEATURE_LOCALCACHE_EVENT:this._collectFeatureLocalCacheStat&&r.push(e);break;case De.NOTIFICATION:this._collectionNotificationStat&&r.push(e)}return[4,this._save()];case 1:return o.sent(),this.isReadyToFlush?[4,this._flush()]:[3,3];case 2:o.sent(),o.label=3;case 3:return[2]}})})},t.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this.queue=[],this.flushWaitQueue=[],this.generation=1,[4,this._save()];case 1:return e.sent(),[2]}})})},t.prototype.close=function(){this.commandEventContext&&(this.commandEventContext.close(),this.commandEventContext=void 0)},t}(Dn);(function(n){n[n.VERBOSE=0]="VERBOSE",n[n.DEBUG=1]="DEBUG",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.NONE=5]="NONE"})(It||(It={}));var re,wd=function(){function n(){this.level=It.WARN}return n.prototype.verbose=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.level<=It.VERBOSE&&console.log.apply(console,Z(["[verbose]"],G(t),!1))},n.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.level<=It.DEBUG&&console.log.apply(console,Z(["[debug]"],G(t),!1))},n.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.level<=It.INFO&&console.log.apply(console,Z(["[info]"],G(t),!1))},n.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.level<=It.WARN&&console.warn.apply(console,Z(["[warn]"],G(t),!1))},n.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.level<=It.ERROR&&console.error.apply(console,Z(["[error]"],G(t),!1))},n}(),jt={},S=function(){function n(t,e){var r,i,s,o,a,u,c,l,d,p;if(this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!jt[t]){jt[t]=this;var _=(r=e.options)!==null&&r!==void 0?r:new iu,m=this.sdkState={appId:e.appId,appVersion:(i=e.appVersion)!==null&&i!==void 0?i:"",appState:"foreground",userId:void 0,extensions:{},api:{host:(s=e.apiHost)!==null&&s!==void 0?s:"https://api-".concat(e.appId,".sendbird.com")},websocket:{host:(o=e.websocketHost)!==null&&o!==void 0?o:"wss://ws-".concat(e.appId,".sendbird.com"),pingerDisabled:!!e.noPingpong,pingInterval:void 0,pongTimeout:void 0,connectMaxRetry:2,compression:!0,reconnectMaxRetry:-1,reconnectRetryStrategy:new Lu,responseTimeout:_.websocketResponseTimeout},sessionTokenRefreshTimeout:_.sessionTokenRefreshTimeout};this.appInfo=void 0,this.subscribedUnreadMessageCount={all:0,feed:0,customTypes:{},ts:0};var g=this.logger=new wd;this.logger.level=(a=e.logLevel)!==null&&a!==void 0?a:It.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map;var y=this.cacheContext=new Hc({encryption:e.encryption,store:e.store,localCacheEnabled:(u=e.localCacheEnabled)!==null&&u!==void 0&&u,localCacheConfig:(c=e.localCacheConfig)!==null&&c!==void 0?c:new ou});this.debugMode=(l=e.debugMode)!==null&&l!==void 0&&l,this.maxSuperGroupChannelUnreadCount=Pt.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=_.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=_.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=_.typingIndicatorThrottle,this.concurrentCallLimit=void 0,this.backOffDelay=void 0;var b=this.dispatcher=new Bc,T=new $c;this.requestQueue=new gd(t,{session:T,sdkState:m,dispatcher:b,logger:g,useFetchCompat:e.useFetchCompat}),this.sessionManager=new yd({_iid:t,session:T,cacheContext:y,sdkState:m,dispatcher:b,requestQueue:this.requestQueue,logger:g}),this.connectionManager=new hd(t,{sdkState:m,cacheContext:this.cacheContext,connectionHandlers:this.connectionHandlers,dispatcher:b,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,disableWebSocketCloseEventHandling:(d=e.disableWebSocketCloseEventHandling)!==null&&d!==void 0&&d,logger:g}),this.statLogCollector=new bd({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:b}),this.appStateToggleEnabled=(p=e.appStateToggleEnabled)===null||p===void 0||p}return jt[t]}return n.of=function(t){if(jt[t])return jt[t];throw I.lostInstance},n.clear=function(t){jt[t]&&delete jt[t]},n.prototype.hasExtension=function(t){return this.sdkState.extensions&&this.sdkState.extensions[t]},n}(),ro=function(){function n(){}return n.prototype.init=function(t,e){var r=e.sdkState,i=e.dispatcher,s=e.sessionManager,o=e.requestQueue,a=e.logger;e.onlineDetector;var u=e.cacheContext;this._iid=t,this._cacheContext=u,this._sdkState=r,this._dispatcher=i,this._sessionManager=s,this._requestQueue=o,this._logger=a},n}();(function(n){n.UNKNOWN="UNKNOWN",n.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",n.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",n.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",n.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",n.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",n.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",n.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",n.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",n.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",n.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",n.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",n.EVENT_CHANNEL_BANNED="EVENT_CHANNEL_BANNED",n.EVENT_CHANNEL_UNBANNED="EVENT_CHANNEL_UNBANNED",n.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",n.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",n.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",n.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",n.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",n.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",n.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",n.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",n.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",n.EVENT_CHANNEL_METADATA_CREATED="EVENT_CHANNEL_METADATA_CREATED",n.EVENT_CHANNEL_METADATA_UPDATED="EVENT_CHANNEL_METADATA_UPDATED",n.EVENT_CHANNEL_METADATA_DELETED="EVENT_CHANNEL_METADATA_DELETED",n.EVENT_CHANNEL_METACOUNTER_CREATED="EVENT_CHANNEL_METACOUNTER_CREATED",n.EVENT_CHANNEL_METACOUNTER_UPDATED="EVENT_CHANNEL_METACOUNTER_UPDATED",n.EVENT_CHANNEL_METACOUNTER_DELETED="EVENT_CHANNEL_METACOUNTER_DELETED",n.EVENT_THREAD_INFO_UPDATED="EVENT_THREAD_INFO_UPDATED",n.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",n.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",n.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",n.EVENT_PINNED_MESSAGE_UPDATED="EVENT_PINNED_MESSAGE_UPDATED",n.REQUEST_CHANNEL="REQUEST_CHANNEL",n.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",n.REFRESH_CHANNEL="REFRESH_CHANNEL",n.CHANNEL_LASTACCESSEDAT_UPDATED="CHANNEL_LASTACCESSEDAT_UPDATED",n.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",n.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS",n.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",n.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",n.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",n.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",n.EVENT_MESSAGE_FEEDBACK_ADDED="EVENT_MESSAGE_FEEDBACK_ADDED",n.EVENT_MESSAGE_FEEDBACK_UPDATED="EVENT_MESSAGE_FEEDBACK_UPDATED",n.EVENT_MESSAGE_FEEDBACK_DELETED="EVENT_MESSAGE_FEEDBACK_DELETED",n.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",n.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",n.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",n.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",n.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",n.REQUEST_MESSAGE="REQUEST_MESSAGE",n.EVENT_POLL_UPDATED="EVENT_POLL_UPDATED",n.EVENT_POLL_VOTED="EVENT_POLL_VOTED",n.SYNC_POLL_CHANGELOGS="SYNC_POLL_CHANGELOGS",n.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",n.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",n.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",n.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",n.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",n.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",n.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",n.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",n.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",n.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED"})(re||(re={}));var Nn;E({},re);var _e=function(n){function t(e){var r=e.messages,i=e.source,s=e.isWebSocketEventComing,o=s!==void 0&&s,a=n.call(this)||this;return a.messages=r,a.source=i,a.isWebSocketEventComing=o,a}return v(t,n),t}(le),zu=function(n){function t(e){var r=e.messageIds,i=e.source,s=e.isWebSocketEventComing,o=s!==void 0&&s,a=n.call(this)||this;return a.messageIds=r,a.source=i,a.isWebSocketEventComing=o,a}return v(t,n),t}(le),Id=function(n){function t(e){var r=e.event,i=e.source,s=e.isWebSocketEventComing,o=s!==void 0&&s,a=n.call(this)||this;return a.event=r,a.source=i,a.isWebSocketEventComing=o,a}return v(t,n),t}(le),Td=function(n){function t(e){var r=e.event,i=e.source,s=e.isWebSocketEventComing,o=s!==void 0&&s,a=n.call(this)||this;return a.event=r,a.source=i,a.isWebSocketEventComing=o,a}return v(t,n),t}(le),Cd=function(n){function t(e){var r=e.reqId,i=e.source,s=n.call(this)||this;return s.reqId=r,s.source=i,s}return v(t,n),t}(le),Hu=function(n){function t(e){var r=e.polls,i=e.source,s=n.call(this)||this;return s.polls=r,s.source=i,s}return v(t,n),t}(le),$u=function(n){function t(e){var r=e.event,i=e.source,s=n.call(this)||this;return s.event=r,s.source=i,s}return v(t,n),t}(le),io=function(n){function t(e){var r=e.event,i=e.source,s=n.call(this)||this;return s.event=r,s.source=i,s}return v(t,n),t}(le);(function(n){n.OPEN="open",n.CLOSED="closed"})(Nn||(Nn={}));var Sd="removed",Rs=function(n){switch(n){case"open":return Nn.OPEN;case"closed":return Nn.CLOSED;default:return null}},Bu=function(n){return!n||!!n.text&&w("string",n.text)},Zr=function(n){function t(e,r){var i,s,o,a,u,c,l,d=this;return(d=n.call(this,e)||this).pollId=0,d.id=0,d.text=null,d.voteCount=0,d.createdBy=null,d.createdAt=0,d.updatedAt=0,d._lastVotedAt=0,d.pollId=(i=r.poll_id)!==null&&i!==void 0?i:0,d.id=(s=r.id)!==null&&s!==void 0?s:0,d.text=(o=r.text)!==null&&o!==void 0?o:null,d.voteCount=(a=r.vote_count)!==null&&a!==void 0?a:0,d.createdBy=(u=r.created_by)!==null&&u!==void 0?u:null,d.createdAt=(c=r.created_at)!==null&&c!==void 0?c:0,d.updatedAt=(l=r.updated_at)!==null&&l!==void 0?l:0,d}return v(t,n),t.payloadify=function(e){return x(H(E(E({},n.payloadify.call(this,e)),{vote_count:e.voteCount,poll_id:e.pollId,text:e.text,created_at:e.createdAt,id:e.id,created_by:e.createdBy,updated_at:e.updatedAt})))},t}(Me),it=function(n){function t(e,r){var i,s,o,a,u,c,l,d,p,_,m,g,y,b=this;return(b=n.call(this,e)||this).id=0,b.title=null,b.createdAt=0,b.updatedAt=0,b.closeAt=-1,b.status=Nn.CLOSED,b.messageId=0,b.data=null,b.voterCount=-1,b.options=[],b.createdBy=null,b.allowUserSuggestion=!1,b.allowMultipleVotes=!1,b.votedPollOptionIds=[],b.id=(i=r.id)!==null&&i!==void 0?i:0,b.title=(s=r.title)!==null&&s!==void 0?s:null,b.createdAt=(o=r.created_at)!==null&&o!==void 0?o:0,b.updatedAt=(a=r.updated_at)!==null&&a!==void 0?a:0,b.closeAt=(u=r.close_at)!==null&&u!==void 0?u:-1,b.status=(c=Rs(r.status))!==null&&c!==void 0?c:Nn.CLOSED,b.messageId=(l=r.message_id)!==null&&l!==void 0?l:0,b.data=(d=r.data)!==null&&d!==void 0?d:null,b.voterCount=(p=r.voter_count)!==null&&p!==void 0?p:-1,b.options=r.options?r.options.map(function(T){return new Zr(b._iid,T)}):[],b.createdBy=(_=r.created_by)!==null&&_!==void 0?_:null,b.allowUserSuggestion=(m=r.allow_user_suggestion)!==null&&m!==void 0&&m,b.allowMultipleVotes=(g=r.allow_multiple_votes)!==null&&g!==void 0&&g,b.votedPollOptionIds=(y=r.voted_option_ids)!==null&&y!==void 0?y:[],b}return v(t,n),t.prototype._applyPollUpdatePayload=function(e){var r,i,s,o,a,u,c,l,d=this;this.title=(r=e.title)!==null&&r!==void 0?r:this.title,this.updatedAt=(i=e.updated_at)!==null&&i!==void 0?i:this.updatedAt,this.closeAt=(s=e.close_at)!==null&&s!==void 0?s:this.closeAt,this.status=(o=Rs(e.status))!==null&&o!==void 0?o:this.status,this.data=(a=e.data)!==null&&a!==void 0?a:this.data,this.voterCount=(u=e.voter_count)!==null&&u!==void 0?u:this.voterCount,e.options&&(this.options=e.options.map(function(p){return new Zr(d._iid,p)}),this.votedPollOptionIds=e.options.filter(function(p){return p.vote_count>0}).map(function(p){return p.id})),this.allowUserSuggestion=(c=e.allow_user_suggestion)!==null&&c!==void 0?c:this.allowUserSuggestion,this.allowMultipleVotes=(l=e.allow_multiple_votes)!==null&&l!==void 0?l:this.allowMultipleVotes},t.payloadify=function(e){return x(H(E(E({},n.payloadify.call(this,e)),{id:e.id,title:e.title,created_at:e.createdAt,updated_at:e.updatedAt,close_at:e.closeAt,status:e.status,message_id:e.messageId,data:e.data,voter_count:e.voterCount,options:e.options.map(function(r){return Zr.payloadify(r)}),created_by:e.createdBy,allow_user_suggestion:e.allowUserSuggestion,allow_multiple_votes:e.allowMultipleVotes,voted_option_ids:e.votedPollOptionIds})))},t.prototype.applyPollUpdateEvent=function(e){var r=e._payload.poll;return!(!r||this.id!==r.id||r.updated_at<this.updatedAt)&&(this._applyPollUpdatePayload(r),!0)},t.prototype.applyPollVoteEvent=function(e){if(this.id!==e.pollId)return!1;var r=this.options,i=r.map(function(a){return a.id}),s=e._payload,o=Math.floor(s.ts/1e3);return s.updated_vote_counts.forEach(function(a){var u=i.indexOf(a.option_id);if(u>-1){var c=r[u];o>=c._lastVotedAt&&(c.voteCount=a.vote_count,c._lastVotedAt=o)}}),s.req_id&&s.voted_option_ids&&(this.votedPollOptionIds=s.voted_option_ids),typeof s.voter_count=="number"&&(this.voterCount=s.voter_count),!0},t.prototype.serialize=function(){return gi(this)},t}(Me),Un=function(){function n(t,e){var r;this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=t,this.limit=(r=e.limit)!==null&&r!==void 0?r:20}return Object.defineProperty(n.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),n.prototype._validate=function(){return w("number",this.limit)&&this.limit>0},n}(),hn=function(n){function t(e,r,i,s){var o=n.call(this,e,s)||this;return o.channelUrl=r,o.channelType=i,o}return v(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&w("string",this.channelUrl)&&ce(W,this.channelType)},t}(Un),Nd=function(n){this.pollId=0,this.messageId=0,this.pollId=n.poll_id,this.messageId=n.message_id,this._payload=n},Ad=function(n){function t(e){var r=e.title,i=e.optionTexts,s=e.data,o=e.allowUserSuggestion,a=e.allowMultipleVotes,u=e.closeAt,c=n.call(this)||this;return c.method=O.POST,c.path=ut,c.params={title:r,options:i,data:s,allow_user_suggestion:o,allow_multiple_votes:a,close_at:u},c}return v(t,n),t}(D),kd=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new it(e,r),i}return v(t,n),t}(U),Od=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,o=n.call(this)||this;return o.method=O.GET,o.path="".concat(ut,"/").concat(encodeURIComponent(s)),o.params={channel_url:r,channel_type:i},o}return v(t,n),t}(D),Dd=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new it(e,r),i}return v(t,n),t}(U),Rd=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,o=e.pollOptionId,a=n.call(this)||this;return a.method=O.GET,a.path="".concat(ut,"/").concat(encodeURIComponent(s),"/options/").concat(encodeURIComponent(o)),a.params={channel_url:r,channel_type:i},a}return v(t,n),t}(D),Ud=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.pollOption=new Zr(e,r),i}return v(t,n),t}(U),Md=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.timestamp,o=e.token,a=n.call(this)||this;return a.method=O.GET,a.path="".concat(X(r),"/").concat(encodeURIComponent(i),"/polls/changelogs"),a.params=x({change_ts:s,token:o}),a}return v(t,n),t}(D),Ld=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.updatedPolls=r.updated.map(function(s){return function(o,a){return new it(o,a)}(e,s)}),i.deletedPollIds=r.deleted.map(function(s){return s}),i.hasMore=r.has_more,i.nextToken=r.next,i}return v(t,n),t}(U),Pd={title:"",optionTexts:[],data:void 0,allowUserSuggestion:void 0,allowMultipleVotes:void 0,closeAt:-1},ju=function(n){return w("string",n.title)&&(t=n.optionTexts,Y("string",t)&&t.every(function(e){return e.trim()!==""}))&&Bu(n.data)&&w("boolean",n.allowUserSuggestion,!0)&&w("boolean",n.allowMultipleVotes,!0)&&w("number",n.closeAt,!0);var t},xd={channelUrl:"",channelType:W.BASE,pollId:0,pollOptionId:0},Gu=function(n){return w("string",n.channelUrl)&&n.channelUrl!==""&&ce(W,n.channelType)&&w("number",n.pollId)&&n.pollId>0&&w("number",n.pollOptionId)&&n.pollOptionId>0},Fd={channelUrl:"",channelType:W.BASE,pollId:0},Vu=function(n){return w("string",n.channelUrl)&&n.channelUrl!==""&&ce(W,n.channelType)&&w("number",n.pollId)},sa={},Us=function(){function n(t,e){var r=e.sdkState,i=e.dispatcher,s=e.sessionManager,o=e.requestQueue,a=e.logger;this._iid=t,this._sdkState=r,this._sessionManager=s,this._requestQueue=o,this._dispatcher=i,this._logger=a,sa[t]=this}return n.of=function(t){return sa[t]},n.prototype.buildPollFromSerializedData=function(t){var e=_r(t);return new it(this._iid,it.payloadify(e))},n.prototype.get=function(t){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return R(Vu(t)).throw(I.invalidParameters),e=new Od(E({},t)),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(Dd).poll]}})})},n.prototype.create=function(t){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return R(ju(t)).throw(I.invalidParameters),e=new Ad(E({},t)),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(kd).poll]}})})},n.prototype.getOption=function(t){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return R(Gu(t)).throw(I.invalidParameters),e=new Rd(E({},t)),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(Ud).pollOption]}})})},n.prototype.getPollChangeLogs=function(t,e,r,i){return i===void 0&&(i=re.SYNC_POLL_CHANGELOGS),f(this,void 0,void 0,function(){var s,o,a,u,c,l,d;return h(this,function(p){switch(p.label){case 0:return s=new Md(H({channelType:e,channelUrl:t,timestamp:typeof r=="number"?r:null,token:typeof r=="string"?r:null})),[4,this._requestQueue.send(s)];case 1:return o=p.sent(),a=o.as(Ld),u=a.updatedPolls,c=a.deletedPollIds,l=a.hasMore,d=a.nextToken,u.length>0&&this._dispatcher.dispatch(new Hu({polls:u,source:i})),[2,{updatedPolls:u,deletedPollIds:c,hasMore:l,token:d}]}})})},n}(),qd=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.token,o=e.limit,a=n.call(this)||this;return a.method=O.GET,a.path=ut,a.params={channel_url:r,channel_type:i,token:s,limit:o},a}return v(t,n),t}(D),zd=function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,r)||this).polls=((i=r.polls)!==null&&i!==void 0?i:[]).map(function(o){return new it(e,o)}),s.token=r.next,s}return v(t,n),t}(U),Ku=function(n){function t(e,r){return n.call(this,e,r.channelUrl,r.channelType,r)||this}return v(t,n),t.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid).requestQueue,r=new qd(E(E({},this),{token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(zd),o=s.polls,a=s.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,o];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},t}(hn),Hd=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,o=e.pollOptionId,a=e.token,u=e.limit,c=n.call(this)||this;return c.method=O.GET,c.path="".concat(ut,"/").concat(encodeURIComponent(s),"/options/").concat(encodeURIComponent(o),"/voters"),c.params={channel_url:r,channel_type:i,token:a,limit:u},c}return v(t,n),t}(D),$d=function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,r)||this).voters=((i=r.voters)!==null&&i!==void 0?i:[]).map(function(o){return new V(e,o)}),s.token=r.next,s}return v(t,n),t}(U),Qu=function(n){function t(e,r){var i=n.call(this,e,r.channelUrl,r.channelType,r)||this;return i.pollId=r.pollId,i.pollOptionId=r.pollOptionId,i}return v(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&w("number",this.pollId)&&w("number",this.pollOptionId)},t.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid).requestQueue,r=new Hd(E(E({},this),{pollId:this.pollId,pollOptionId:this.pollOptionId,token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as($d),o=s.voters,a=s.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,o];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},t}(hn),vr,$t=function(){function n(t,e,r){var i,s;this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this._requireAuth=!1,this._iid=t,this.plainUrl=e.url,this.width=e.width,this.height=e.height,this.realWidth=(i=e.real_width)!==null&&i!==void 0?i:e.width,this.realHeight=(s=e.real_height)!==null&&s!==void 0?s:e.height,this._requireAuth=r}return n.payloadify=function(t){return x(H(t instanceof n?{url:t.plainUrl,width:t.width,height:t.height,real_width:t.realWidth,real_height:t.realHeight}:{url:"",width:t.maxWidth,height:t.maxHeight,real_width:0,real_height:0}))},Object.defineProperty(n.prototype,"url",{get:function(){var t=S.of(this._iid).sessionManager;return this._requireAuth&&t.ekey?"".concat(this.plainUrl,"?auth=").concat(t.ekey):this.plainUrl},enumerable:!1,configurable:!0}),n}(),Ms=function(n){function t(e){var r=n.call(this)||this;if(r.method=O.POST,r.path="".concat(jc),r.params=x({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(var i=0;i<e.thumbnailSizes.length;i++){var s=e.thumbnailSizes[i],o=s.maxWidth,a=s.maxHeight;r.params["thumbnail".concat(i+1)]="".concat(o,",").concat(a)}return r.requestId=e.requestId,r}return v(t,n),t}(D),Ls=function(n){function t(e,r){var i,s,o,a,u=this;return(u=n.call(this,e,r)||this).url=r.url,u.fileSize=(i=r.file_size)!==null&&i!==void 0?i:0,u.thumbnails=(o=(s=r.thumbnails)===null||s===void 0?void 0:s.map(function(c){return new $t(e,c,!1)}))!==null&&o!==void 0?o:[],u.requireAuth=(a=r.require_auth)!==null&&a!==void 0&&a,u}return v(t,n),t}(U),Ps=function(n){function t(e,r){var i,s,o,a,u,c=this;return(c=n.call(this,e)||this).replyCount=0,c.unreadReplyCount=0,c.memberCount=0,c.lastRepliedAt=0,c.updatedAt=0,c.replyCount=(i=r.reply_count)!==null&&i!==void 0?i:0,c.unreadReplyCount=(s=r.unread_message_count)!==null&&s!==void 0?s:0,c.memberCount=(o=r.member_count)!==null&&o!==void 0?o:0,c.mostRepliedUsers=r.most_replies&&Y("object",r.most_replies)?r.most_replies.map(function(l){return new V(c._iid,l)}):[],c.isPushNotificationEnabled=typeof r.push_enabled=="number"?r.push_enabled>0:void 0,c.lastRepliedAt=(a=r.last_replied_at)!==null&&a!==void 0?a:0,c.updatedAt=(u=r.updated_at)!==null&&u!==void 0?u:0,c}return v(t,n),t.payloadify=function(e){return x(H(E(E({},n.payloadify.call(this,e)),{reply_count:e.replyCount,unread_message_count:e.unreadReplyCount,member_count:e.memberCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map(function(r){return V.payloadify(r)}):[],push_enabled:typeof e.isPushNotificationEnabled=="boolean"?e.isPushNotificationEnabled?1:0:void 0,last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})))},t}(Me);(function(n){n.ADD="add",n.DELETE="delete"})(vr||(vr={}));var oa,so=function(n){this.messageId=0,this.operation=null,this.updatedAt=0;var t=w("string",n.msg_id)?parseInt(n.msg_id):n.msg_id,e=n.user_id,r=n.operation?n.operation.toLowerCase():null,i=n.reaction,s=n.updated_at;t&&w("string",e)&&w("string",r)&&ce(vr,r)&&w("string",i)&&i&&w("number",s)&&(this.messageId=t,this.userId=e,this.key=i,this.operation=r,this.updatedAt=s)},Fr=function(){function n(t){var e,r,i,s=t.key,o=(i=Z([],G(t.user_ids),!1))!==null&&i!==void 0?i:[],a=t.updated_at;w("string",s)&&s&&Y("string",o)&&o.length>0&&w("number",a)&&(this.key=s,this.userIds=o,this.updatedAt=a);var u={};try{for(var c=$(this.userIds),l=c.next();!l.done;l=c.next())u[l.value]=this.updatedAt}catch(d){e={error:d}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(e)throw e.error}}this._version=u}return Object.defineProperty(n.prototype,"isEmpty",{get:function(){return this.userIds.length===0},enumerable:!1,configurable:!0}),n.payloadify=function(t){return x(H({key:t.key,user_ids:t.userIds,updated_at:t.updatedAt}))},n.prototype.applyEvent=function(t){if(t.key===this.key&&this.updatedAt<=t.updatedAt){if(!this._version[t.userId]||this._version[t.userId]<=t.updatedAt){var e=this.userIds.indexOf(t.userId);switch(t.operation){case vr.ADD:e<0&&this.userIds.push(t.userId);break;case vr.DELETE:e>=0&&this.userIds.splice(e,1)}this._version[t.userId]=t.updatedAt}this.updatedAt=Math.max(this.updatedAt,t.updatedAt)}},n}(),aa=function(){function n(t){this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=t.url,t.secure_url&&(this.secureUrl=t.secure_url),t.type&&(this.type=t.type),t.width&&(this.width=t.width),t.height&&(this.height=t.height),t.alt&&(this.alt=t.alt)}return n.payloadify=function(t){var e,r;return x(H({url:t.url,secure_url:t.secureUrl,type:t.type,width:(e=t.width)!==null&&e!==void 0?e:0,height:(r=t.height)!==null&&r!==void 0?r:0,alt:t.alt}))},n}(),ua=function(){function n(t){this.title=null,this.url=null,this.description=null,this.defaultImage=null,t["og:title"]&&(this.title=t["og:title"]),t["og:url"]&&(this.url=t["og:url"]),t["og:description"]&&(this.description=t["og:description"]),t["og:image"]&&(this.defaultImage=new aa(t["og:image"]))}return n.payloadify=function(t){return x(H({"og:title":t.title,"og:url":t.url,"og:description":t.description,"og:image":t.defaultImage?aa.payloadify(t.defaultImage):null}))},n}(),gt=function(){function n(t){var e,r;this.volume=0,this.name=(e=t.name)!==null&&e!==void 0?e:"default",this.volume=(r=t.volume)!==null&&r!==void 0?r:1}return n.prototype.serialize=function(){return{name:this.name,volume:this.volume}},n.payloadify=function(t){return x(H({name:t.name,volume:t.volume}))},n}();(function(n){n.GOOD="good",n.BAD="bad"})(oa||(oa={}));var ca,wn=function(){function n(t){this.id=t.id,this.rating=t.rating,this.comment=t.comment}return n.parseFeedbackStatusFromPayload=function(t){return t&&t.id!==null&&t.rating!==null?"SUBMITTED":"NOT_APPLICABLE"},n.payloadify=function(t){return x(H({id:t.id,rating:t.rating,comment:t.comment}))},n}(),An=function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,r)||this).isBlockedByMe=!1,s.role=ce(ni,r.role)?r.role:ni.NONE,s.isBlockedByMe=(i=r.is_blocked_by_me)!==null&&i!==void 0&&i,s}return v(t,n),t.payloadify=function(e){return x(H(E(E({},n.payloadify.call(this,e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})))},t}(V),Qe=function(){function n(t){this.key=t.key,this.value=Y("string",t.value)?Z([],G(t.value),!1):[]}return n.payloadify=function(t){var e;return x(H({key:t.key,value:(e=t.value)!==null&&e!==void 0?e:[]}))},n}(),Wu=function(n){switch(n){case fe.BASE:return"";case fe.USER:return"MESG";case fe.FILE:return"FILE";case fe.ADMIN:return"ADMM"}},Yu=function(n){function t(e,r){var i,s,o,a,u,c,l,d,p,_,m=this;(m=n.call(this,e)||this).channelType=W.BASE,m.messageType=fe.BASE,m.mentionType=null,m.mentionedUsers=null,m.mentionedUserIds=null,m.metaArrays=[],m.extendedMessage={},m.createdAt=0,m.updatedAt=0,m.channelUrl=r.channel_url,m.channelType=ce(W,r.channel_type)?r.channel_type:W.GROUP,r.channel&&(r.channel.channel_url&&(m.channelUrl=r.channel.channel_url),r.channel.channel_type&&(m.channelType=r.channel.channel_type)),m.data=(i=r.data)!==null&&i!==void 0?i:"",m.customType=(s=r.custom_type)!==null&&s!==void 0?s:"",m.mentionType=ce(Ue,r.mention_type)?r.mention_type:null,m.mentionedUsers=r.mentioned_users?r.mentioned_users.map(function(C){return new V(m._iid,C)}):null,m.mentionedUserIds=(o=r.mentioned_user_ids)!==null&&o!==void 0?o:null,m.mentionedUsers&&!m.mentionedUserIds&&(m.mentionedUserIds=m.mentionedUsers.map(function(C){return C.userId})),m.mentionedMessageTemplate=(a=r.mentioned_message_template)!==null&&a!==void 0?a:"";var g=(u=r.metaarray)!==null&&u!==void 0?u:{},y=(c=r.metaarray_key_order)!==null&&c!==void 0?c:Object.keys(g).sort(function(C,N){return C.localeCompare(N)});m.metaArrays=[];for(var b=0;b<y.length;b++){var T=y[b];m.metaArrays.push(new Qe({key:T,value:g[T]||[]}))}return r.sorted_metaarray&&(m.metaArrays=r.sorted_metaarray.map(function(C){return new Qe(C)})),m.extendedMessage=(l=r.extended_message)!==null&&l!==void 0?l:{},m.extendedMessagePayload=r.extended_message_payload,m.createdAt=(p=(d=r.created_at)!==null&&d!==void 0?d:r.ts)!==null&&p!==void 0?p:0,m.updatedAt=(_=r.updated_at)!==null&&_!==void 0?_:0,m}return v(t,n),t.payloadify=function(e){var r,i;return x(H(E(E({},n.payloadify.call(this,e)),{channel_url:e.channelUrl,channel_type:e.channelType,type:Wu(e.messageType),data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:(r=e.mentionedUsers)===null||r===void 0?void 0:r.map(function(s){return V.payloadify(s)}),mentioned_message_template:e.mentionedMessageTemplate,sorted_metaarray:(i=e.metaArrays)===null||i===void 0?void 0:i.map(function(s){return Qe.payloadify(s)}),extended_message:e.extendedMessage,extended_message_payload:e.extendedMessagePayload,created_at:e.createdAt,updated_at:e.updatedAt})))},t.prototype.isIdentical=function(e){return!0},t.prototype.isEqual=function(e){return ru(this,e)},t.prototype.isUserMessage=function(){return this.messageType===fe.USER},t.prototype.isFileMessage=function(){return this.messageType===fe.FILE&&!Object.prototype.hasOwnProperty.call(this,"fileInfoList")},t.prototype.isMultipleFilesMessage=function(){return this.messageType===fe.FILE&&Object.prototype.hasOwnProperty.call(this,"fileInfoList")},t.prototype.isAdminMessage=function(){return this.messageType===fe.ADMIN},t.prototype.hasForm=function(){var e,r;return!!(!((r=(e=this.extendedMessagePayload)===null||e===void 0?void 0:e.forms)===null||r===void 0)&&r[0])},t.prototype.serialize=function(){return gi(this)},t.prototype.getMetaArraysByKeys=function(e){return this.metaArrays.filter(function(r){return e.includes(r.key)})},t}(Me);(function(n){n.Text="text",n.Phone="phone",n.Email="email",n.Password="password"})(ca||(ca={}));var qr=function(){function n(t,e,r){this.messageId=t,this.key=e,this.fields=r,this.formKey=e}return Object.defineProperty(n.prototype,"isSubmitted",{get:function(){return this.answers!==void 0&&Object.keys(this.answers).length>0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSubmittable",{get:function(){return this.fields.every(function(t){return t.isSubmittable})},enumerable:!1,configurable:!0}),n.prototype.getFieldAnswer=function(t){var e;return(e=this.answers)===null||e===void 0?void 0:e[t]},n.payloadify=function(t){var e;return x(H({key:(e=t.formKey)!==null&&e!==void 0?e:t.key,fields:t.fields.map(function(r){return Zu.payloadify(r)})}))},n.isFormPayload=function(t){var e;return!!(!((e=t==null?void 0:t.forms)===null||e===void 0)&&e[0])},n}(),Zu=function(){function n(t){this.key=t.key,this.inputType=t.input_type,this.title=t.title,this.required=t.required,this.regex=t.regex,this.placeholder=t.placeholder,this.fieldKey=t.key}return n.prototype.isValid=function(t){if(!this.regex)return!0;try{return new RegExp(this.regex).test(t)}catch{return!0}},Object.defineProperty(n.prototype,"isSubmittable",{get:function(){return!(this.temporaryAnswer!=null&&!this.isValid(this.temporaryAnswer)||this.required&&this.temporaryAnswer==null)},enumerable:!1,configurable:!0}),n.payloadify=function(t){var e;return x(H({key:(e=t.fieldKey)!==null&&e!==void 0?e:t.key,input_type:t.inputType,title:t.title,required:t.required,regex:t.regex,placeholder:t.placeholder}))},n}(),Bd=function(n){function t(e,r){var i,s,o=this;return(o=n.call(this,e)||this).channelUrl=(i=r.channel_url)!==null&&i!==void 0?i:"",o.channelType=(s=r.channel_type)!==null&&s!==void 0?s:W.GROUP,o.reader=new V(o._iid,r.user),o.readAt=r.ts,o}return v(t,n),t}(Me);(function(n){function t(e){var r=e.channelUrl;return n.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:r}})||this}return v(t,n),t})(qe);(function(n){function t(e){var r=n.call(this)||this,i=e.channelUrl,s=e.channelType,o=e.userId,a=e.notificationIds;return r.method=O.PUT,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/messages/mark_as_read"),r.params=x(H({user_id:o,message_ids:a})),r}return v(t,n),t})(D);(function(n){function t(e,r,i){var s=n.call(this,e,"READ",i)||this;return s.readStatus=new Bd(e,i),s}return v(t,n),t})(de);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.readAt=r.ts,i.unreadMessageCount=r.unread_message_count,i}return v(t,n),t})(U);var jd=function(n){function t(e){var r=e.channelUrl,i=e.messageId;return n.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:r,parent_message_id:i}})||this}return v(t,n),t}(qe),Gd=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.pushEnabled,a=n.call(this)||this;return a.method=O.PUT,a.path="".concat(X(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/thread_push"),a.params={push_enabled:o},a}return v(t,n),t}(D);(function(n){function t(e,r){return n.call(this,e,r)||this}v(t,n)})(U);var la=function(n){function t(e){var r=n.call(this)||this;return r.method=O.POST,r.path="".concat(Ws,"/").concat(encodeURIComponent(e.channelUrl),"/messages/").concat(e.messageId,"/submit_forms"),r.params=x({forms:e.forms}),r}return v(t,n),t}(D),Vd=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.rating,a=e.comment,u=n.call(this)||this;return u.method=O.POST,u.path="".concat(X(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/feedbacks"),u.params={rating:o,comment:a},u}return v(t,n),t}(D),Kd=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.feedback=new wn(r),i}return v(t,n),t}(U),Qd=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.feedbackId,a=e.rating,u=e.comment,c=n.call(this)||this;return c.method=O.PUT,c.path="".concat(X(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/feedbacks/").concat(o),c.params={rating:a,comment:u},c}return v(t,n),t}(D),Wd=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.feedback=new wn(r),i}return v(t,n),t}(U),Yd=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.feedbackId,a=n.call(this)||this;return a.method=O.DELETE,a.path="".concat(X(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/feedbacks/").concat(o),a}return v(t,n),t}(D);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.feedback=new wn(r),i}v(t,n)})(U);var da,Ut,xs=function(n){function t(e,r){var i,s,o,a,u,c=this;return(c=n.call(this,e)||this).plainUrl="",c.fileName=null,c.mimeType=null,c.fileSize=0,c.thumbnails=[],c._requireAuth=!1,c.plainUrl=(i=r.url)!==null&&i!==void 0?i:"",c.fileName=(s=r.file_name)!==null&&s!==void 0?s:null,c.mimeType=(o=r.file_type)!==null&&o!==void 0?o:null,c.fileSize=(a=r.file_size)!==null&&a!==void 0?a:0,c._requireAuth=(u=r.require_auth)!==null&&u!==void 0&&u,c.thumbnails=r.thumbnails?r.thumbnails.map(function(l){var d;return new $t(c._iid,typeof l=="string"?{url:l,width:0,height:0}:E(E({},l),{url:((d=l.url)!==null&&d!==void 0?d:"").split("auth=")[0]}),c._requireAuth)}):[],c}return v(t,n),t.payloadify=function(e){var r;return x(H({url:e.plainUrl,file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:(r=e.thumbnails)===null||r===void 0?void 0:r.map(function(i){var s;return{url:((s=i.plainUrl)!==null&&s!==void 0?s:"").split("auth=")[0],width:i.width,height:i.height,real_width:i.realWidth,real_height:i.realHeight}}),require_auth:e._requireAuth}))},Object.defineProperty(t.prototype,"url",{get:function(){var e=S.of(this._iid).sessionManager;return this._requireAuth&&e.ekey?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),t}(Me),Zd=function(n){var t=n.channelUrl,e=n.channelType,r=n.parentMessage;this.channelUrl=t,this.channelType=e,this.parentMessage=r};(function(n){n.PENDING="pending",n.SENT="sent",n.FAILED="failed",n.CANCELED="canceled"})(da||(da={})),function(n){n.PENDING="pending",n.IN_QUEUE="in_queue",n.SENT="sent",n.FAILED="failed",n.CANCELED="canceled",n.REMOVED="removed"}(Ut||(Ut={}));var Jt,Ve=function(n){function t(e,r){var i,s,o,a,u,c,l,d,p,_,m=this;return(m=n.call(this,e,r)||this).parentMessage=null,m.silent=!1,m.isOperatorMessage=!1,m.threadInfo=null,m.reactions=[],m.appleCriticalAlertOptions=null,m.scheduledInfo=null,m.suggestedReplies=null,m.myFeedback=null,m.myFeedbackStatus="NOT_APPLICABLE",m.forms=null,m._isContinuousMessages=!1,m._scheduledStatus=null,m.messageId=(s=(i=r.msg_id)!==null&&i!==void 0?i:r.message_id)!==null&&s!==void 0?s:0,m.parentMessageId=(o=typeof r.parent_message_id=="string"?parseInt(r.parent_message_id):r.parent_message_id)!==null&&o!==void 0?o:0,m.threadInfo=r.thread_info?new Ps(m._iid,r.thread_info):null,m.reactions=r.reactions?r.reactions.map(function(g){return new Fr(g)}):[],m.ogMetaData=r.og_tag?new ua(r.og_tag):null,m.silent=(a=r.silent)!==null&&a!==void 0&&a,m.isOperatorMessage=(u=r.is_op_msg)!==null&&u!==void 0&&u,m.appleCriticalAlertOptions=r.apple_critical_alert_options?new gt(r.apple_critical_alert_options):null,typeof r.scheduled_message_id=="number"&&typeof r.scheduled_at=="number"&&r.scheduled_status&&(m.scheduledInfo={scheduledMessageId:r.scheduled_message_id,scheduledAt:r.scheduled_at},m._scheduledStatus=r.scheduled_status),m._isContinuousMessages=(c=r.is_continuous_messages)!==null&&c!==void 0&&c,m.myFeedback=!((l=r.feedback)===null||l===void 0)&&l.id?new wn(r.feedback):null,m.myFeedbackStatus=(d=r.my_feedback_status)!==null&&d!==void 0?d:wn.parseFeedbackStatusFromPayload(r.feedback),m.suggestedReplies=(_=(p=r.extended_message_payload)===null||p===void 0?void 0:p.suggested_replies)!==null&&_!==void 0?_:null,m.forms=qr.isFormPayload(r.extended_message_payload)?r.extended_message_payload.forms.map(function(g){return new qr(m.messageId,g.key,g.fields.map(function(y){return new Zu(y)}))}):null,m}return v(t,n),t.payloadify=function(e){var r,i;return x(H(E(E({},n.payloadify.call(this,e)),{message_id:e.messageId,parent_message_id:e.parentMessageId,thread_info:e.threadInfo?Ps.payloadify(e.threadInfo):null,reactions:e.reactions.map(function(s){return Fr.payloadify(s)}),og_tag:e.ogMetaData?ua.payloadify(e.ogMetaData):null,silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:e.appleCriticalAlertOptions?gt.payloadify(e.appleCriticalAlertOptions):null,scheduled_message_id:(r=e.scheduledInfo)===null||r===void 0?void 0:r.scheduledMessageId,scheduled_at:(i=e.scheduledInfo)===null||i===void 0?void 0:i.scheduledAt,scheduled_status:e._scheduledStatus,feedback:e.myFeedback?wn.payloadify(e.myFeedback):null,my_feedback_status:e.myFeedbackStatus,forms:e.forms?e.forms.map(function(s){return qr.payloadify(s)}):null})))},t._getParentMessageInfoPayload=function(e){return x(H({type:Wu(e.messageType),ts:e.createdAt,user:e.sender?An.payloadify(e.sender):null,message:e.message,file:{url:e.plainUrl,name:e.name,type:e.type,require_auth:e.requireAuth},files:Array.isArray(e.fileInfoList)?e.fileInfoList.map(function(r){return xs.payloadify(r)}):null}))},t.prototype.isIdentical=function(e){return this.messageId===e.messageId},t.prototype.applyThreadInfoUpdateEvent=function(e){var r,i;return this.messageId===e.targetMessageId&&(e.threadInfo&&e.threadInfo.isPushNotificationEnabled===void 0&&((r=this.threadInfo)===null||r===void 0?void 0:r.isPushNotificationEnabled)!==void 0&&(e.threadInfo.isPushNotificationEnabled=(i=this.threadInfo)===null||i===void 0?void 0:i.isPushNotificationEnabled),this.threadInfo=e.threadInfo,!0)},t.prototype.applyReactionEvent=function(e){if(this.messageId===e.messageId){for(var r=!1,i=0;i<this.reactions.length;i++)if(this.reactions[i].key===e.key){this.reactions[i].applyEvent(e),this.reactions[i].isEmpty&&this.reactions.splice(i,1),r=!0;break}r||e.operation!=="add"||this.reactions.push(new Fr(Fr.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}},t.prototype.applyParentMessage=function(e){if(!this.parentMessage)return this.parentMessage=e,!0;if(this.parentMessageId===e.messageId){var r=this.parentMessage.updatedAt;if(e.updatedAt>=r)return this.parentMessage=e,!0}return!1},t.prototype._triggerThreadInfoUpdatedEvent=function(){return f(this,void 0,void 0,function(){var e;return h(this,function(r){return(e=S.of(this._iid).dispatcher).dispatch(new Zd({channelType:W.GROUP,channelUrl:this.channelUrl,parentMessage:this})),e.dispatch(new _e({messages:[this],source:re.EVENT_THREAD_INFO_UPDATED})),[2]})})},t.prototype.markThreadAsRead=function(){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return e=S.of(this._iid).requestQueue,r=new jd({channelUrl:this.channelUrl,messageId:this.messageId}),[4,e.send(r)];case 1:return i.sent(),this.threadInfo&&this.threadInfo.unreadReplyCount>0?(this.threadInfo.unreadReplyCount=0,[4,this._triggerThreadInfoUpdatedEvent()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}})})},t.prototype.setPushNotificationEnabled=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){switch(s.label){case 0:return r=S.of(this._iid).requestQueue,i=new Gd({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,pushEnabled:e}),[4,r.send(i)];case 1:return s.sent(),this.threadInfo&&this.threadInfo.isPushNotificationEnabled!==e&&(this.threadInfo.isPushNotificationEnabled=e),[2]}})})},t.prototype.submitForm=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:if(R(e.form&&e.form instanceof qr||w("string",e.formId)&&w("object",e.answers)).throw(I.invalidParameters),r=S.of(this._iid),i=r.requestQueue,s=r.sdkState,o=r.logger,!e.form)return[3,2];if(!(a=e.form).isSubmittable)throw new I({code:q.INVALID_PARAMETER,message:"The given form is not submittable."});if(a.isSubmitted)throw new I({code:q.INVALID_PARAMETER,message:"The given form is already submitted."});if(a.messageId!=this.messageId)throw new I({code:q.INVALID_PARAMETER,message:"This form does not belong to the message."});return u=a.fields.reduce(function(d,p){return d[p.key]=p.temporaryAnswer,d},{}),c=new la({userId:s.userId,channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,forms:[{form_key:a.key,data:u}]}),[4,i.send(c)];case 1:return l.sent(),[3,4];case 2:return e.formId&&e.answers?(o.warn("The submitForm method with formId and answers is deprecated. Use submitForm({ form: Form }) instead."),c=new la({userId:s.userId,channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,forms:[{form_key:e.formId,data:e.answers}]}),[4,i.send(c)]):[3,4];case 3:l.sent(),l.label=4;case 4:return[2]}})})},t.prototype.submitFeedback=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return r=S.of(this._iid),i=r.requestQueue,s=r.dispatcher,o=new Vd({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,rating:e.rating,comment:e.comment}),[4,i.send(o)];case 1:return a=c.sent(),u=a.as(Kd),this.myFeedback=u.feedback,this.myFeedbackStatus="SUBMITTED",s.dispatch(new _e({messages:[this],source:re.EVENT_MESSAGE_FEEDBACK_ADDED})),[2]}})})},t.prototype.updateFeedback=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return r=S.of(this._iid),i=r.requestQueue,s=r.dispatcher,o=new Qd({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,feedbackId:e.id,rating:e.rating,comment:e.comment}),[4,i.send(o)];case 1:return a=c.sent(),u=a.as(Wd),this.myFeedback=u.feedback,this.myFeedbackStatus="SUBMITTED",s.dispatch(new _e({messages:[this],source:re.EVENT_MESSAGE_FEEDBACK_UPDATED})),[2]}})})},t.prototype.deleteFeedback=function(e){return f(this,void 0,void 0,function(){var r,i,s,o;return h(this,function(a){switch(a.label){case 0:return r=S.of(this._iid),i=r.requestQueue,s=r.dispatcher,o=new Yd({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,feedbackId:e}),[4,i.send(o)];case 1:return a.sent(),this.myFeedback=null,this.myFeedbackStatus="NO_FEEDBACK",s.dispatch(new _e({messages:[this],source:re.EVENT_MESSAGE_FEEDBACK_DELETED})),[2]}})})},t}(Yu),St=function(n){function t(e,r){var i,s,o,a,u=this;if((u=n.call(this,e,r)||this).reqId="",u.replyToChannel=!1,u.errorCode=0,u.sender=r.user?new An(u._iid,r.user):r.sender_id,u.reqId=(s=(i=r.req_id)!==null&&i!==void 0?i:r.request_id)!==null&&s!==void 0?s:"",u.replyToChannel=(o=r.is_reply_to_channel)!==null&&o!==void 0&&o,r.request_state&&ce(ue,r.request_state)&&(u.sendingStatus=r.request_state),!u.sendingStatus)if(u.messageId>0)u.sendingStatus=ue.SUCCEEDED;else if(u.scheduledInfo)switch(r.scheduled_status&&(u._scheduledStatus=r.scheduled_status),r.scheduled_status){case Ut.SENT:case Ut.IN_QUEUE:u.sendingStatus=ue.SUCCEEDED;break;case Ut.PENDING:u.sendingStatus=ue.SCHEDULED;break;case Ut.FAILED:case Ut.REMOVED:u.sendingStatus=ue.FAILED;break;case Ut.CANCELED:u.sendingStatus=ue.CANCELED}else u.sendingStatus=ue.PENDING;return u.errorCode=(a=r.error_code)!==null&&a!==void 0?a:0,u}return v(t,n),t.payloadify=function(e){return x(H(E(E({},n.payloadify.call(this,e)),{user:An.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode})))},Object.defineProperty(t.prototype,"isResendable",{get:function(){return(this.sendingStatus===ue.FAILED||this.sendingStatus===ue.CANCELED)&&zc(this.errorCode)},enumerable:!1,configurable:!0}),t.prototype.isIdentical=function(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId},t}(Ve),Er={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:We.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},bi=function(n){return w("number",n.prevResultSize)&&w("number",n.nextResultSize)&&w("boolean",n.isInclusive)&&w("boolean",n.reverse)&&w("string",n.messageTypeFilter)&&ce(We,n.messageTypeFilter)&&Y("string",n.customTypesFilter,!0)&&Y("string",n.senderUserIdsFilter,!0)&&w("boolean",n.includeMetaArray)&&w("boolean",n.includeReactions)&&w("boolean",n.includeParentMessageInfo)},mr=function(n){function t(e,r){var i,s,o,a,u=this;if((u=n.call(this,e,r)||this).translations={},u.message=(i=r.message)!==null&&i!==void 0?i:"",u.messageType=fe.ADMIN,u.translations=(s=r.translations)!==null&&s!==void 0?s:{},r.parent_message_info){var c=r.parent_message_info;u.parentMessage=Nt(e,x(H(E(E({},c),{message_id:u.parentMessageId,channel_url:u.channelUrl,channel_type:u.channelType,file:c.file,url:(o=c.file)===null||o===void 0?void 0:o.url,require_auth:(a=c.file)===null||a===void 0?void 0:a.require_auth}))))}return u}return v(t,n),t.payloadify=function(e){return x(H(E(E({},n.payloadify.call(this,e)),{message:e.message,translations:e.translations,parent_message_info:e.parentMessage?n._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},t.prototype.getThreadedMessagesByTimestamp=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=E(E({},Er),r),R(this.messageId>0&&w("number",e)&&bi(i)).throw(I.invalidParameters),[4,Ie.of(this._iid).getThreadedMessagesByTimestamp(this,e,i)];case 1:return[2,s.sent()]}})})},t}(Ve),ha=function(){function n(t){var e,r;this.detail={},this.type=(e=t.type)!==null&&e!==void 0?e:"",this.vendor=(r=t.vendor)!==null&&r!==void 0?r:"",t.detail&&w("object",t.detail)&&!Array.isArray(t.detail)&&(this.detail=t.detail)}return n.payloadify=function(t){return x(H({type:t.type,vendor:t.vendor,detail:t.detail}))},n}(),fa=function(){function n(t){this.status=t.status,t.original_message_info&&(this.originalMessageInfo={createdAt:t.original_message_info.ts,messageId:t.original_message_info.id})}return n.payloadify=function(t){return x({status:t.status,original_message_info:t.originalMessageInfo?{id:t.originalMessageInfo.messageId,ts:t.originalMessageInfo.createdAt}:void 0})},n}(),Fe=function(n){function t(e,r){var i,s,o,a,u,c,l,d=this;if((d=n.call(this,e,r)||this).message="",d.messageParams=null,d.translations={},d.translationTargetLanguages=[],d.messageSurvivalSeconds=-1,d.plugins=[],d._poll=null,d.message=r.message,d.messageType=fe.USER,d.translations=(o=r.translations)!==null&&o!==void 0?o:{},d.translationTargetLanguages=(a=r.target_langs)!==null&&a!==void 0?a:[],Object.keys(d.translations).length===0&&d.translationTargetLanguages.length>0)try{for(var p=$(d.translationTargetLanguages),_=p.next();!_.done;_=p.next()){var m=_.value;d.translations[m]=""}}catch(y){i={error:y}}finally{try{_&&!_.done&&(s=p.return)&&s.call(p)}finally{if(i)throw i.error}}if(d.messageSurvivalSeconds=(u=r.message_survival_seconds)!==null&&u!==void 0?u:-1,d.plugins=r.plugins?r.plugins.map(function(y){return new ha(y)}):[],d._poll=r.poll?new it(d._iid,r.poll):null,r.parent_message_info){var g=r.parent_message_info;d.parentMessage=Nt(e,x(H(E(E({},g),{created_at:g.ts,message_id:d.parentMessageId,channel_url:d.channelUrl,channel_type:d.channelType,file:g.file,url:(c=g.file)===null||c===void 0?void 0:c.url,require_auth:(l=g.file)===null||l===void 0?void 0:l.require_auth}))))}return r.review_info&&(d.messageReviewInfo=new fa(r.review_info)),d}return v(t,n),t.payloadify=function(e){return x(H(E(E({},n.payloadify.call(this,e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map(function(r){return ha.payloadify(r)}),poll:e._poll?it.payloadify(e._poll):null,parent_message_info:e.parentMessage?n._getParentMessageInfoPayload.call(this,e.parentMessage):null,review_info:e.messageReviewInfo?fa.payloadify(e.messageReviewInfo):void 0})))},t.prototype.getThreadedMessagesByTimestamp=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=E(E({},Er),r),R(this.messageId>0&&w("number",e)&&bi(i)).throw(I.invalidParameters),[4,Ie.of(this._iid).getThreadedMessagesByTimestamp(this,e,i)];case 1:return[2,s.sent()]}})})},t.prototype.applyPoll=function(e){return!(this._poll&&this._poll.id===e.id&&this._poll.updatedAt>e.updatedAt)&&(this._poll=e,!0)},Object.defineProperty(t.prototype,"poll",{get:function(){return this._poll},enumerable:!1,configurable:!0}),t}(St),rt=function(n){function t(e,r){var i,s,o,a,u,c=this;if((c=n.call(this,e,r)||this).messageParams=null,c.fileInfoList=[],c.messageSurvivalSeconds=-1,c.messageType=fe.FILE,c.fileInfoList=(s=(i=r.files)===null||i===void 0?void 0:i.map(function(d){return new xs(e,d)}))!==null&&s!==void 0?s:[],c.messageSurvivalSeconds=(o=r.message_survival_seconds)!==null&&o!==void 0?o:-1,r.parent_message_info){var l=r.parent_message_info;c.parentMessage=Nt(e,x(H(E(E({},l),{created_at:l.ts,message_id:c.parentMessageId,channel_url:c.channelUrl,channel_type:c.channelType,file:l.file,url:(a=l.file)===null||a===void 0?void 0:a.url,require_auth:(u=l.file)===null||u===void 0?void 0:u.require_auth}))))}return c}return v(t,n),t.prototype.getThreadedMessagesByTimestamp=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=E(E({},Er),r),R(this.messageId>0&&w("number",e)&&bi(i)).throw(I.invalidParameters),[4,Ie.of(this._iid).getThreadedMessagesByTimestamp(this,e,i)];case 1:return[2,s.sent()]}})})},t.payloadify=function(e){return x(H(E(E({},n.payloadify.call(this,e)),{files:Array.isArray(e.fileInfoList)?e.fileInfoList.map(function(r){return xs.payloadify(r)}):null,message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?n._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},t._isMultipleFilesMessagePayload=function(e){var r=e.files;return Array.isArray(r)&&r.length>=2},t._isMultipleFilesMessageSerializedData=function(e){var r=e.fileInfoList;return Array.isArray(r)},t}(St);(function(n){n.SENT="SENT",n.READ="READ"})(Jt||(Jt={}));var gr=function(n){function t(e,r){var i,s,o=this;if((o=n.call(this,e,r)||this).notificationData=null,o.notificationId=r.notification_message_id,o.messageType=fe.ADMIN,o.messageStatus=(i=r.message_status)!==null&&i!==void 0?i:Jt.SENT,o.priority=(s=r.priority)!==null&&s!==void 0?s:Is.NORMAL,o.extendedMessage.sub_type===0)try{var a=JSON.parse(o.extendedMessage.sub_data),u=a.label,c=a.tags,l=c===void 0?[]:c,d=a.template_key,p=a.template_variables;o.notificationData={label:u,tags:l,templateKey:d,templateVariables:p}}catch{}return o}return v(t,n),t.payloadify=function(e){return x(H(E(E({},n.payloadify.call(this,e)),{notification_message_id:e.notificationId,message_status:e.messageStatus,priority:e.priority})))},t.prototype.isIdentical=function(e){return this.notificationId===e.notificationId},t}(Yu),Nt=function(n,t){if(t.notification_message_id)return new gr(n,t);switch(t.type){case"MESG":return new Fe(n,t);case"FILE":return rt._isMultipleFilesMessagePayload(t)?new rt(n,t):new ge(n,t);case"ADMM":case"BRDM":return new mr(n,t);default:return null}},ge=function(n){function t(e,r){var i,s,o,a,u,c,l,d,p,_,m,g,y,b,T=this;(T=n.call(this,e,r)||this).messageParams=null,T.plainUrl="",T.requireAuth=!1,T.thumbnails=[],T.messageSurvivalSeconds=-1,T.messageType=fe.FILE;var C=r.file;if(T.plainUrl=((s=(i=C==null?void 0:C.url)!==null&&i!==void 0?i:r.url)!==null&&s!==void 0?s:"").split("?auth=")[0],T.name=(a=(o=C==null?void 0:C.name)!==null&&o!==void 0?o:r.name)!==null&&a!==void 0?a:"File",T.size=(c=(u=C==null?void 0:C.size)!==null&&u!==void 0?u:r.size)!==null&&c!==void 0?c:0,T.data=(d=(l=C==null?void 0:C.data)!==null&&l!==void 0?l:r.custom)!==null&&d!==void 0?d:"",T.type=C?(p=C.type)!==null&&p!==void 0?p:"":(_=r.type)!==null&&_!==void 0?_:"",T.requireAuth=(m=r.require_auth)!==null&&m!==void 0&&m,T.thumbnails=r.thumbnails?r.thumbnails.map(function(P){var A;return new $t(T._iid,typeof P=="string"?{url:P,width:0,height:0}:E(E({},P),{url:((A=P.url)!==null&&A!==void 0?A:"").split("auth=")[0]}),T.requireAuth)}):[],T.messageSurvivalSeconds=(g=r.message_survival_seconds)!==null&&g!==void 0?g:-1,r.parent_message_info){var N=r.parent_message_info;T.parentMessage=Nt(e,x(H(E(E({},N),{created_at:N.ts,message_id:T.parentMessageId,channel_url:T.channelUrl,channel_type:T.channelType,file:N.file,url:(y=N.file)===null||y===void 0?void 0:y.url,require_auth:(b=N.file)===null||b===void 0?void 0:b.require_auth}))))}return T}return v(t,n),t.payloadify=function(e){var r;return x(H(E(E({},n.payloadify.call(this,e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:(r=e.thumbnails)===null||r===void 0?void 0:r.map(function(i){return{url:i.plainUrl,width:i.width,height:i.height,real_width:i.realWidth,real_height:i.realHeight}}),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?n._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},Object.defineProperty(t.prototype,"url",{get:function(){var e=S.of(this._iid).sessionManager;return this.requireAuth&&e.ekey?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),t.prototype.getThreadedMessagesByTimestamp=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=E(E({},Er),r),R(this.messageId>0&&w("number",e)&&bi(i)).throw(I.invalidParameters),[4,Ie.of(this._iid).getThreadedMessagesByTimestamp(this,e,i)];case 1:return[2,s.sent()]}})})},t}(St),hi=function(n){function t(e,r){var i=r.file,s=r.fileUrl,o=r.fileName,a=r.fileSize,u=r.mimeType,c=r.thumbnailSizes,l=r._uploadedMetaData,d=r._thumbnails,p=n.call(this,e)||this;return p._plainUrl=s,p.file=i,p.fileName=o,p.fileSize=a,p.mimeType=u,p.thumbnailSizes=c,p._uploadedMetaData=l,p._thumbnails=d,p}return v(t,n),t.getPlainUrl=function(e){return e instanceof t?e._plainUrl:e.fileUrl},Object.defineProperty(t.prototype,"fileUrl",{get:function(){var e,r=S.of(this._iid).sessionManager;return this._plainUrl&&(!((e=this._uploadedMetaData)===null||e===void 0)&&e.requireAuth)&&r.ekey?"".concat(this._plainUrl,"?auth=").concat(r.ekey):this._plainUrl},set:function(e){this._plainUrl=e},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{file:this.file,fileUrl:this._plainUrl,fileName:this.fileName,fileSize:this.fileSize,mimeType:this.mimeType,thumbnailSizes:this.thumbnailSizes,_thumbnails:this._thumbnails,_uploadedMetaData:this._uploadedMetaData}},t}(Me),Xd=function(n){function t(e){var r,i,s,o,a=[];return e.mentionType===Ue.USERS&&(e.mentionedUserIds?a=e.mentionedUserIds:e.mentionedUsers&&(a=e.mentionedUsers.map(function(u){return u.userId}))),n.call(this,{code:"FILE",ackRequired:!0,payload:x(H({channel_url:e.channelUrl,files:e.files?Ju(e.files):null,url:e.url,name:(r=e.fileName)!==null&&r!==void 0?r:"",type:(i=e.mimeType)!==null&&i!==void 0?i:"",size:(s=e.fileSize)!==null&&s!==void 0?s:0,custom:e.data,custom_type:e.customType,thumbnails:(o=e._thumbnails)===null||o===void 0?void 0:o.map(function(u){return $t.payloadify(u)}),require_auth:e.requireAuth,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:a,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==mt.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions?gt.payloadify(e.appleCriticalAlertOptions):null,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:e.parentMessageId?e.parentMessageId:null,req_id:e.reqId,pin_message:e.isPinnedMessage}))})||this}return v(t,n),t}(qe),Jd=function(n){function t(e){var r,i,s=this;s=n.call(this)||this;var o=[];return e.mentionType===Ue.USERS&&(e.mentionedUserIds?o=e.mentionedUserIds:e.mentionedUsers&&(o=e.mentionedUsers.map(function(a){return a.userId}))),s.method=O.POST,s.path="".concat(X(e.channelType),"/").concat(encodeURIComponent(e.channelUrl),"/messages"),s.params=x(H({message_type:fe.FILE,user_id:e.userId,files:e.files?Ju(e.files):null,url:e.fileUrl,mention_type:e.mentionType,mentioned_user_ids:o,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,data:e.data,custom_type:e.customType,thumbnails:(r=e._thumbnails)===null||r===void 0?void 0:r.map(function(a){return $t.payloadify(a)}),require_auth:e.requireAuth,sorted_metaarray:(i=e.metaArrays)===null||i===void 0?void 0:i.map(function(a){return Qe.payloadify(a)}),push_option:e.pushNotificationDeliveryOption,parent_message_id:e.parentMessageId?e.parentMessageId:null,apple_critical_alert_options:e.appleCriticalAlertOptions?gt.payloadify(e.appleCriticalAlertOptions):null,reply_to_channel:e.isReplyToChannel,req_id:e.reqId,pin_message:e.isPinnedMessage})),s}return v(t,n),t}(D),Xu=function(n){function t(e,r,i){var s,o,a,u,c=this;(c=n.call(this,e,"FILE",i)||this).message=i.files&&i.files.length>=2?new rt(e,i):new ge(e,i);var l=S.of(e).sdkState;return c.isMentioned=In(c.message.mentionType,(a=(s=c.message.mentionedUserIds)!==null&&s!==void 0?s:(o=c.message.mentionedUsers)===null||o===void 0?void 0:o.map(function(d){return d.userId}))!==null&&a!==void 0?a:[],l.userId),c.forceUpdateLastMessage=(u=i.force_update_last_message)!==null&&u!==void 0&&u,c}return v(t,n),t}(de),eh=function(n){function t(e,r){var i,s,o,a,u=this;(u=n.call(this,e,r)||this).message=r.files&&r.files.length>=2?new rt(e,r):new ge(e,r);var c=S.of(e).sdkState;return u.isMentioned=In(u.message.mentionType,(o=(i=u.message.mentionedUserIds)!==null&&i!==void 0?i:(s=u.message.mentionedUsers)===null||s===void 0?void 0:s.map(function(l){return l.userId}))!==null&&o!==void 0?o:[],c.userId),u.forceUpdateLastMessage=(a=r.force_update_last_message)!==null&&a!==void 0&&a,u}return v(t,n),t}(U);function Ju(n){return n.map(function(t){var e,r;return x(H({url:hi.getPlainUrl(t),file_name:t.fileName,file_type:t.mimeType,file_size:t.fileSize,thumbnails:(e=t._thumbnails)===null||e===void 0?void 0:e.map(function(i){return $t.payloadify(i)}),require_auth:(r=t._uploadedMetaData)===null||r===void 0?void 0:r.requireAuth}))})}var ve;(function(n){n[n.PENDING=0]="PENDING",n[n.UPLOADING=1]="UPLOADING",n[n.UPLOADED=2]="UPLOADED",n[n.SENDING=3]="SENDING",n[n.FAILED=4]="FAILED"})(ve||(ve={}));var th=function(){function n(t,e){var r=e.sdkState,i=e.dispatcher,s=e.requestQueue,o=e.onlineDetector,a=e.cacheContext,u=this;this._queueMap=new Map,this._iid=t,this._sdkState=r,this._requestQueue=s,this._cacheContext=a,this._dispatcher=i,this._dispatcher.on(function(c){c instanceof ln&&(u._connectionState=c.stateType)}),this._onlineDetector=o}return Object.defineProperty(n.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===ie.CONNECTED||this._connectionState===ie.CONNECTING||this._connectionState===ie.RECONNECTING},enumerable:!1,configurable:!0}),n.prototype._sendFileMessage=function(t,e){return f(this,void 0,void 0,function(){var r,i,s;return h(this,function(o){switch(o.label){case 0:return r=this._createSendFileMessageRequestParams(t,e),this._shouldSendThroughWebSocket?(i=new Xd(r),[4,this._requestQueue.send(i)]):[3,2];case 1:return s=o.sent(),[2,s.as(Xu).message];case 2:return i=new Jd(E(E({},r),{userId:this._sdkState.userId})),[4,this._requestQueue.send(i)];case 3:return s=o.sent(),[2,s.as(eh).message]}})})},n.prototype._createSendFileMessageRequestParams=function(t,e){var r=E(E({},e.params),{channelUrl:t.url,channelType:t.channelType,reqId:e.requestId,url:""});if(e.multipleFileUploadInfo){var i=e.params;r.files=i.fileInfoList}else i=e.params,r.url=i.fileUrl,r.requireAuth=i.requireAuth;return r},n.prototype._resolveMessageQueue=function(t){var e;return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l,d,p,_,m,g;return h(this,function(y){switch(y.label){case 0:if(!(r=this._queueMap.get(t.url)))return[3,21];if(r.isResolving)return[3,20];r.isResolving=!0,i=[],s=!0,y.label=1;case 1:y.trys.push([1,15,16,17]),o=$(r.messageQueue),a=o.next(),y.label=2;case 2:if(a.done)return[3,14];switch(u=a.value,u.state){case ve.PENDING:case ve.UPLOADING:return[3,3];case ve.UPLOADED:return[3,4];case ve.FAILED:return[3,12]}return[3,13];case 3:return s=!1,i.push(u),[3,13];case 4:if(!s)return[3,10];y.label=5;case 5:return y.trys.push([5,8,,9]),u.state=ve.SENDING,[4,this._sendFileMessage(t,u)];case 6:return c=y.sent(),u.deferred.resolve(c),[4,Xe(100)];case 7:return y.sent(),[3,9];case 8:return l=y.sent(),u.deferred.reject(l),[3,9];case 9:return[3,11];case 10:i.push(u),y.label=11;case 11:return[3,13];case 12:return d=(e=u.error)!==null&&e!==void 0?e:I.unknown,u.deferred.reject(d.code===q.REQUEST_CANCELED?I.fileUploadCanceled:d),[3,13];case 13:return a=o.next(),[3,2];case 14:return[3,17];case 15:return p=y.sent(),m={error:p},[3,17];case 16:try{a&&!a.done&&(g=o.return)&&g.call(o)}finally{if(m)throw m.error}return[7];case 17:return _=r.isResolveRequestPending,r.messageQueue=i,r.isResolving=!1,r.isResolveRequestPending=!1,_?[4,this._resolveMessageQueue(t)]:[3,19];case 18:y.sent(),y.label=19;case 19:return[3,21];case 20:r.isResolveRequestPending=!0,y.label=21;case 21:return[2]}})})},n.prototype._uploadNextPendingItem=function(t){var e;return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l,d,p;return h(this,function(_){switch(_.label){case 0:return(r=this._queueMap.get(t.url))&&(i=r.messageQueue.find(function(m){return m.state===ve.PENDING}))?i.multipleFileUploadInfo?(s=i.multipleFileUploadInfo,o=s.uploadIndex,a=s.uploadCount,u=s.requestHandler,p=i.params,c=p.fileInfoList[o],!je(c.file)||!((e=c._uploadedMetaData)===null||e===void 0)&&e.isUploaded?[3,2]:[4,this._tryUploadNextItemAndUpdateItemState(t,r,i)]):[3,4]:[3,9];case 1:return _.sent(),[3,3];case 2:i.state=o<a-1?ve.PENDING:ve.UPLOADED,_.label=3;case 3:return l=p.fileInfoList[o],d=i.multipleFileUploadInfo.uploadIndex++,i.multipleFileUploadInfo.isCopy||u==null||u._triggerOnFileUploaded(i.requestId,d,l,i.error),[3,7];case 4:return p=i.params,je(p.file)?[4,this._tryUploadNextItemAndUpdateItemState(t,r,i)]:[3,6];case 5:return _.sent(),[3,7];case 6:p.thumbnailSizes=[],i.state=ve.UPLOADED,_.label=7;case 7:return this._uploadNextPendingItem(t),[4,this._resolveMessageQueue(t)];case 8:_.sent(),_.label=9;case 9:return[2]}})})},n.prototype._tryUploadNextItemAndUpdateItemState=function(t,e,r){return f(this,void 0,void 0,function(){var i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return[4,this._onlineDetector.isOnline()];case 1:if(i=l.sent(),!S.of(this._iid).sessionManager.currentUser||!i)return r.error=I.connectionRequired,r.state=ve.FAILED,[2];if(!(e.uploadQueue.length<6))return[3,9];r.state=ve.UPLOADING,e.uploadQueue.push(r),l.label=2;case 2:return l.trys.push([2,7,,8]),r.multipleFileUploadInfo?(s=r.multipleFileUploadInfo,o=s.uploadIndex,a=s.uploadCount,u=r.params,[4,this._uploadNextFileForMultipleFilesItemAndUpdateParams(t,r,u)]):[3,4];case 3:return l.sent(),r.state=o<a-1?ve.PENDING:ve.UPLOADED,[3,6];case 4:return u=r.params,[4,this._uploadNextFileForSingleFileItemAndUpdateParams(t,r,u)];case 5:l.sent(),r.state=ve.UPLOADED,l.label=6;case 6:return[3,8];case 7:switch((c=l.sent()).code){case q.REQUEST_FAILED:r.error=new I({code:q.NETWORK_ERROR,message:"Failed to upload a file."});break;case q.REQUEST_CANCELED:r.error=I.fileUploadCanceled;break;default:r.error=c}return r.state=ve.FAILED,[3,8];case 8:this._dequeueUploadItem(e,r),l.label=9;case 9:return[2]}})})},n.prototype._dequeueUploadItem=function(t,e){var r=t.uploadQueue.findIndex(function(i){return i.requestId===e.requestId});r>=0&&t.uploadQueue.splice(r,1)},n.prototype._uploadNextFileForSingleFileItemAndUpdateParams=function(t,e,r){var i,s,o;return f(this,void 0,void 0,function(){var a,u,c,l,d,p,_,m,g,y;return h(this,function(b){switch(b.label){case 0:return a=new Ms({file:r.file,channelUrl:t.url,thumbnailSizes:r.thumbnailSizes,requestId:e.requestId}),[4,this._requestQueue.send(a)];case 1:return u=b.sent(),c=u.as(Ls),l=c.url,d=c.fileSize,p=d===void 0?r.fileSize:d,_=c.thumbnails,m=_===void 0?[]:_,g=c.requireAuth,y=g!==void 0&&g,r.fileName=(i=r.fileName)!==null&&i!==void 0?i:r.file.name,r.mimeType=(s=r.mimeType)!==null&&s!==void 0?s:r.file.type,r.fileSize=(o=r.fileSize)!==null&&o!==void 0?o:r.file.size,r.fileUrl=l,r.fileSize=p,r.requireAuth=y,r._thumbnails=m,[2]}})})},n.prototype._uploadNextFileForMultipleFilesItemAndUpdateParams=function(t,e,r){var i,s,o;return f(this,void 0,void 0,function(){var a,u,c,l,d,p,_,m,g,y,b;return h(this,function(T){switch(T.label){case 0:return a=e.multipleFileUploadInfo.uploadIndex,u=r.fileInfoList[a],c=new Ms({file:u.file,channelUrl:t.url,thumbnailSizes:u.thumbnailSizes,requestId:e.requestId}),[4,this._requestQueue.send(c)];case 1:return l=T.sent(),d=l.as(Ls),p=d.url,_=d.fileSize,m=_===void 0?u.fileSize:_,g=d.thumbnails,y=d.requireAuth,b=y!==void 0&&y,u.fileName=(i=u.fileName)!==null&&i!==void 0?i:u.file.name,u.mimeType=(s=u.mimeType)!==null&&s!==void 0?s:u.file.type,u.fileSize=(o=u.fileSize)!==null&&o!==void 0?o:u.file.size,u.file=void 0,u.fileUrl=p,u.fileSize=m,u._thumbnails=g,u._uploadedMetaData=E(E({},u._uploadedMetaData),{requireAuth:b,isUploaded:!0}),u instanceof hi||(r.fileInfoList[a]=new hi(this._iid,u)),[2]}})})},n.prototype.request=function(t,e,r,i){return i===void 0&&(i={}),f(this,void 0,void 0,function(){var s,o,a,u,c;return h(this,function(l){return this._queueMap.has(t.url)||(s={messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1},this._queueMap.set(t.url,s)),o=this._queueMap.get(t.url),a=new Re,u={requestId:e,params:r,state:ve.PENDING,deferred:a},function(d){return"fileInfoList"in d}(r)&&(c=E({uploadIndex:0,uploadCount:r.fileInfoList.length},i),u.multipleFileUploadInfo=c),o.messageQueue.push(u),this._uploadNextPendingItem(t),[2,a.promise]})})},n.prototype.cancel=function(t,e){var r,i,s=this._queueMap.get(t.url);if(s){var o=e?[s.messageQueue.find(function(m){return m.requestId===e})]:Z([],G(s.messageQueue),!1);try{for(var a=$(o),u=a.next();!u.done;u=a.next()){var c=u.value;if(c)switch(c.state){case ve.PENDING:if(c.state=ve.FAILED,c.error=I.requestCanceled,c.multipleFileUploadInfo&&!c.multipleFileUploadInfo.isCopy){var l=c.multipleFileUploadInfo,d=l.uploadIndex,p=l.requestHandler,_=c.params.fileInfoList[d];p==null||p._triggerOnFileUploaded(c.requestId,d,_,I.fileUploadCanceled)}this._resolveMessageQueue(t);break;case ve.UPLOADING:this._requestQueue.cancel(c.requestId),this._dispatcher.dispatch(new oi({requestId:c.requestId}))}}}catch(m){r={error:m}}finally{try{u&&!u.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}}else e&&(this._requestQueue.cancel(e),this._dispatcher.dispatch(new oi({requestId:e})))},n}(),Fs,sr={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:We.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,replyType:Be.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},pa=function(n){return w("number",n.prevResultSize)&&w("number",n.nextResultSize)&&w("boolean",n.isInclusive)&&w("boolean",n.reverse)&&w("string",n.messageTypeFilter)&&ce(We,n.messageTypeFilter)&&Y("string",n.customTypesFilter,!0)&&Y("string",n.senderUserIdsFilter,!0)&&ce(Be,n.replyType)&&w("boolean",n.includeMetaArray)&&w("boolean",n.includeReactions)&&w("boolean",n.includeParentMessageInfo)&&w("boolean",n.includeThreadInfo)&&w("boolean",n.showSubchannelMessagesOnly)},qs={replyType:Be.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1},_a=function(n){return ce(Be,n.replyType)&&w("boolean",n.includeReactions)&&w("boolean",n.includeMetaArray)&&w("boolean",n.includeParentMessageInfo)&&w("boolean",n.includeThreadInfo)},nh=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.includeMetaArray,a=e.includeReactions,u=e.includeThreadInfo,c=e.includeParentMessageInfo,l=n.call(this)||this;return l.method=O.GET,l.path="".concat(X(r),"/").concat(encodeURIComponent(i),"/messages/").concat(encodeURIComponent(s)),l.params={is_sdk:!0,with_sorted_meta_array:o,include_reactions:a,include_thread_info:u,include_parent_message_info:c,include_poll_details:!0},l}return v(t,n),t}(D),rh=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.message=r?Nt(e,E({},r)):null,i}return v(t,n),t}(U),zr=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.timestamp,o=e.token,a=e.prevResultSize,u=e.nextResultSize,c=e.isInclusive,l=e.reverse,d=e.messageTypeFilter,p=e.customTypesFilter,_=e.senderUserIdsFilter,m=e.replyType,g=e.includeMetaArray,y=e.includeReactions,b=e.parentMessageId,T=e.includeThreadInfo,C=e.includeParentMessageInfo,N=e.showSubchannelMessagesOnly,P=e.checkingHasNext,A=e.checkingContinuousMessages,F=n.call(this)||this;return F.method=O.GET,F.path="".concat(X(r),"/").concat(encodeURIComponent(i),"/messages"),F.params=x(H({is_sdk:!0,prev_limit:a,next_limit:u,include:c,reverse:l,message_ts:s,message_id:o,message_type:d??null,custom_types:p,sender_ids:_,include_reply_type:m,with_sorted_meta_array:g,include_reactions:y,parent_message_id:b,include_thread_info:T,include_parent_message_info:C,show_subchannel_message_only:N,include_poll_details:!0,checking_has_next:P,checking_continuous_messages:A})),F}return v(t,n),t}(D),Hr=function(n){function t(e,r){var i=n.call(this,e,r)||this;return r.is_continuous_messages!==void 0&&(i.isContinuousMessages=r.is_continuous_messages),r.has_next!==void 0&&(i.hasNext=r.has_next),i.messages=r.messages.map(function(s){return Nt(e,s)}),i}return v(t,n),t}(U),ih=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.timestamp,o=e.token,a=e.replyType,u=e.includeMetaArray,c=e.includeReactions,l=e.includeThreadInfo,d=e.includeParentMessageInfo,p=n.call(this)||this;return p.method=O.GET,p.path="".concat(X(r),"/").concat(encodeURIComponent(i),"/messages/changelogs"),p.params={change_ts:s,token:o,with_sorted_meta_array:u,include_reactions:c,include_thread_info:l,include_reply_type:a,include_parent_message_info:d,include_poll_details:!0},p}return v(t,n),t}(D),sh=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.updatedMessages=r.updated.map(function(s){return Nt(e,s)}),i.deletedMessagesInfo=r.deleted.map(function(s){return{messageId:s.message_id,deletedAt:s.deleted_at}}),i.hasMore=r.has_more,i.nextToken=r.next,i}return v(t,n),t}(U),oh=function(n){function t(e){var r=e.channelUrl,i=e.scheduledMessageId,s=n.call(this)||this;return s.method=O.GET,s.path="".concat(Ws,"/").concat(encodeURIComponent(r),"/scheduled_messages/").concat(encodeURIComponent(i)),s.params={},s}return v(t,n),t}(D),ah=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.message=r?Nt(e,E({},r)):null,i}return v(t,n),t}(U);(function(n){n.MUTED="muted",n.BANNED="banned"})(Fs||(Fs={}));var va=function(){function n(t){var e,r,i,s;this.restrictionType=null,ce(Fs,t.restriction_type)&&(this.restrictionType=t.restriction_type),this.description=(e=t.description)!==null&&e!==void 0?e:null,this.endAt=(i=(r=t.end_at)!==null&&r!==void 0?r:t.muted_end_at)!==null&&i!==void 0?i:-1,this.remainingDuration=(s=t.remaining_duration)!==null&&s!==void 0?s:-1}return n.payloadify=function(t){return x(H({restriction_type:t.restrictionType,description:t.description,end_at:t.endAt,remaining_duration:t.remainingDuration}))},n}(),Mn=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.restrictionInfo=new va(r),i}return v(t,n),t.payloadify=function(e){return x(H(E(E({},n.payloadify.call(this,e)),va.payloadify(e.restrictionInfo))))},t}(V),uh=function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,r)||this).isMuted=!1,s.isMuted=(i=r.is_muted)!==null&&i!==void 0&&i,s}return v(t,n),t}(V),Xr=function(){function n(){this._onPending=j,this._onFailed=j,this._onSucceeded=j}return n.prototype._trigger=function(t){switch(t==null?void 0:t.sendingStatus){case ue.PENDING:t.errorCode===0&&this._onPending(t);break;case ue.SCHEDULED:case ue.SUCCEEDED:this._onSucceeded(t)}},n.prototype._triggerFailed=function(t,e){switch(e==null?void 0:e.sendingStatus){case ue.FAILED:case ue.CANCELED:this._onFailed(t,e.scheduledInfo?null:e)}},n.prototype.onPending=function(t){return this._onPending=t,this},n.prototype.onFailed=function(t){return this._onFailed=t,this},n.prototype.onSucceeded=function(t){return this._onSucceeded=t,this},n}(),wi={data:void 0,customType:void 0,mentionType:Ue.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,mentionedMessageTemplate:void 0,metaArrays:void 0,parentMessageId:void 0,isReplyToChannel:!1,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0,isPinnedMessage:!1},oo=function(n){return w("string",n.data,!0)&&w("string",n.customType,!0)&&ce(Ue,n.mentionType)&&Y("string",n.mentionedUserIds,!0)&&Y(V,n.mentionedUsers,!0)&&w("string",n.mentionedMessageTemplate,!0)&&Y(Qe,n.metaArrays,!0)&&w("number",n.parentMessageId,!0)&&w("boolean",n.isReplyToChannel)&&ce(mt,n.pushNotificationDeliveryOption,!0)&&w(gt,n.appleCriticalAlertOptions,!0)&&w("boolean",n.isPinnedMessage,!0)},ma=function(n){return{isReplyToChannel:n.isReplyToChannel,pushNotificationDeliveryOption:n.pushNotificationDeliveryOption,pollId:n.pollId}},ec=E(E({},wi),{message:"",translationTargetLanguages:void 0,pollId:void 0,extendedMessagePayload:void 0});function ch(n){var t,e,r;return(t=n.messageParams)!==null&&t!==void 0?t:H(E(E({},n),{mentionType:n.mentionType,mentionedUserIds:(e=n.mentionedUserIds)!==null&&e!==void 0?e:(r=n.mentionedUsers)===null||r===void 0?void 0:r.map(function(i){return i.userId}),translationTargetLanguages:Object.keys(n.translations),pushNotificationDeliveryOption:mt.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1}))}var tn,ga=function(n){var t;return x(H({data:n.data,customType:n.customType,mentionType:n.mentionType,mentionedUsers:n.mentionedUsers,mentionedUserIds:n.mentionedUserIds,mentionedMessageTemplate:n.mentionedMessageTemplate,metaArrays:n.metaArrays,pollId:(t=n.poll)===null||t===void 0?void 0:t.id,parentMessageId:n.parentMessageId,appleCriticalAlertOptions:n.appleCriticalAlertOptions,message:n.message,translationTargetLanguages:Object.keys(n.translations),extendedMessagePayload:n.extendedMessagePayload}))},lh=function(n){return oo(n)&&w("string",n.message)&&Y("string",n.translationTargetLanguages,!0)&&w("number",n.pollId,!0)&&w("object",n.extendedMessagePayload,!0)};(function(n){n.FILE="file",n.BLOB="blob",n.BLOB_LIKE_OBJECT="blobLikeObject",n.URL="url"})(tn||(tn={}));var Jr=function(n){return typeof window<"u"&&"Blob"in window&&typeof Blob<"u"&&n instanceof Blob},us=function(n){return n===tn.BLOB||n===tn.FILE},ya=function(n){return{file:n.file,fileKey:n.fileKey,fileType:n.fileType,isReplyToChannel:n.isReplyToChannel,pushNotificationDeliveryOption:n.pushNotificationDeliveryOption}},Ea=E(E({},wi),{file:void 0,fileKey:void 0,fileUrl:void 0,fileName:void 0,fileType:void 0,fileSize:void 0,mimeType:void 0,thumbnailSizes:void 0,requireAuth:!1});function dh(n){var t,e,r,i;return(t=n.messageParams)!==null&&t!==void 0?t:H(E(E({},n),{fileUrl:n.plainUrl,fileName:n.name,fileSize:n.size,mimeType:n.type,mentionType:n.mentionType,mentionedUserIds:(e=n.mentionedUserIds)!==null&&e!==void 0?e:(r=n.mentionedUsers)===null||r===void 0?void 0:r.map(function(s){return s.userId}),pushNotificationDeliveryOption:mt.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:(i=n.thumbnails)===null||i===void 0?void 0:i.map(function(s){return{maxWidth:s.width,maxHeight:s.height}}),requireAuth:n.requireAuth,isPinnedMessage:!1,_thumbnails:n.thumbnails}))}var or,ba=function(n,t){var e;return n.messageParams?(!n.url&&je(t)&&(n.messageParams.file=t),n.messageParams):x(H({data:n.data,customType:n.customType,mentionType:n.mentionType,mentionedUsers:n.mentionedUsers,mentionedUserIds:n.mentionedUserIds,metaArrays:n.metaArrays,parentMessageId:n.parentMessageId,appleCriticalAlertOptions:n.appleCriticalAlertOptions,file:t,fileUrl:n.url,fileName:n.name,fileSize:n.size,mimeType:n.type,thumbnailSizes:(e=n.thumbnails)===null||e===void 0?void 0:e.map(function(r){return{maxWidth:r.width,maxHeight:r.height}})}))},wa=function(n){return oo(n)&&(je(n.file)||w("string",n.fileUrl))&&w("string",n.fileName,!0)&&w("string",n.mimeType,!0)&&w("number",n.fileSize,!0)&&(n.thumbnailSizes===null||n.thumbnailSizes===void 0||Array.isArray(n.thumbnailSizes)&&n.thumbnailSizes.every(function(t){return w("object",t)&&t.maxWidth>0&&t.maxHeight>0}))},tc={data:void 0,customType:void 0,mentionType:Ue.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,mentionedMessageTemplate:void 0,metaArrays:void 0,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0},nc=function(n){return w("string",n.data,!0)&&w("string",n.customType,!0)&&ce(Ue,n.mentionType)&&Y("string",n.mentionedUserIds,!0)&&Y(V,n.mentionedUsers,!0)&&w("string",n.mentionedMessageTemplate,!0)&&Y(Qe,n.metaArrays,!0)&&ce(mt,n.pushNotificationDeliveryOption,!0)&&w(gt,n.appleCriticalAlertOptions,!0)},hh=E(E({},tc),{message:void 0,translationTargetLanguages:void 0,pollId:void 0}),fh=function(n){return nc(n)&&w("string",n.message,!0)&&Y("string",n.translationTargetLanguages,!0)&&w("number",n.pollId,!0)},ph=E({},tc),_h=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.token,o=e.limit,a=n.call(this)||this;return a.method=O.GET,a.path="".concat(X(i),"/").concat(encodeURIComponent(r),"/operators"),a.params={token:s,limit:o},a}return v(t,n),t}(D),vh=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.operators=r.operators.map(function(s){return new V(e,s)}),i.token=r.next,i}return v(t,n),t}(U),mh=function(n){function t(e,r,i,s){return n.call(this,e,r,i,s)||this}return v(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)},t.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,r=S.of(this._iid).requestQueue,i=new _h(E(E({},this),{channelUrl:this.channelUrl,token:this._token})),[4,r.send(i)]):[3,2]):[3,5];case 1:return s=c.sent(),o=s.as(vh),a=o.operators,u=o.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,[2,a];case 2:return[2,e];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},t}(hn),gh=function(n){function t(e,r,i,s){var o,a,u,c,l,d,p,_,m,g,y=this;return(y=n.call(this,e,r,i,s)||this).reverse=!1,y.messageTypeFilter=We.ALL,y.customTypesFilter=null,y.senderUserIdsFilter=null,y.replyType=Be.NONE,y.includeMetaArray=!1,y.includeReactions=!1,y.includeParentMessageInfo=!1,y.includeThreadInfo=!1,y.showSubchannelMessagesOnly=!1,y._edge=Number.MAX_SAFE_INTEGER,y.reverse=(o=s.reverse)!==null&&o!==void 0&&o,y.messageTypeFilter=(a=s.messageTypeFilter)!==null&&a!==void 0?a:We.ALL,y.customTypesFilter=(u=s.customTypesFilter)!==null&&u!==void 0?u:null,y.senderUserIdsFilter=(c=s.senderUserIdsFilter)!==null&&c!==void 0?c:null,y.replyType=(l=s.replyType)!==null&&l!==void 0?l:Be.NONE,y.includeMetaArray=(d=s.includeMetaArray)!==null&&d!==void 0&&d,y.includeReactions=(p=s.includeReactions)!==null&&p!==void 0&&p,y.includeParentMessageInfo=(_=s.includeParentMessageInfo)!==null&&_!==void 0&&_,y.includeThreadInfo=(m=s.includeThreadInfo)!==null&&m!==void 0&&m,y.showSubchannelMessagesOnly=(g=s.showSubchannelMessagesOnly)!==null&&g!==void 0&&g,y}return v(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&w("boolean",this.reverse)&&ce(We,this.messageTypeFilter)&&ce(Be,this.replyType)&&Y("string",this.customTypesFilter,!0)&&Y("string",this.senderUserIdsFilter,!0)&&w("boolean",this.includeMetaArray)&&w("boolean",this.includeReactions)&&w("boolean",this.includeParentMessageInfo)&&w("boolean",this.includeThreadInfo)&&w("boolean",this.showSubchannelMessagesOnly)},t.prototype.load=function(){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,Ie.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,H({prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly}))]):[3,2]:[3,5];case 1:return e=r.sent(),this._edge=Math.min.apply(Math,Z([Number.MAX_SAFE_INTEGER],G(e.map(function(i){return i.createdAt})),!1)),this._hasNext=e.length>=this.limit,this._isLoading=!1,[2,e];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},t}(hn),yh=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.limit,a=e.token;return(r=n.call(this)||this).method=O.GET,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/mute"),r.params={limit:o,token:a},r}return v(t,n),t}(D),Eh=function(n){function t(e,r){var i=n.call(this,e,r)||this;i.mutedUsers=[];var s=r.next,o=r.muted_list;return i.token=s,o&&o.length>0&&(i.mutedUsers=o.map(function(a){return new Mn(e,a)})),i}return v(t,n),t}(U),bh=function(n){function t(e,r,i,s){return n.call(this,e,r,i,s)||this}return v(t,n),t.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid).requestQueue,r=new yh(E(E({},this),{token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(Eh),o=s.mutedUsers,a=s.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,o];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},t}(hn),wh=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.limit,a=e.token;return(r=n.call(this)||this).method=O.GET,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/ban"),r.params=x({limit:o,token:a}),r}return v(t,n),t}(D),Ih=function(n){function t(e,r){var i=n.call(this,e,r)||this;i.bannedUsers=[];var s=r.next,o=r.banned_list;return i.token=s,o&&o.length>0&&(i.bannedUsers=o.map(function(a){return new Mn(e,a.user)})),i}return v(t,n),t}(U),Th=function(n){function t(e,r,i,s){return n.call(this,e,r,i,s)||this}return v(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)},t.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid).requestQueue,r=new wh(E(E({},this),{token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(Ih),o=s.bannedUsers,a=s.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,o];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},t}(hn);(function(n){n.SPAM="spam",n.HARASSING="harassing",n.SUSPICIOUS="suspicious",n.INAPPROPRIATE="inappropriate"})(or||(or={}));var Ch=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.operatorUserIds;return(r=n.call(this)||this).method=O.POST,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/operators"),r.params={operator_ids:o},r}return v(t,n),t}(D);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}v(t,n)})(U);var Sh=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.operatorUserIds;return(r=n.call(this)||this).method=O.DELETE,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/operators"),r.params={operator_ids:o},r}return v(t,n),t}(D);(function(n){function t(e,r){return n.call(this,e,r)||this}v(t,n)})(U);var Nh=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.userId;return(r=n.call(this)||this).method=O.GET,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/mute/").concat(o),r}return v(t,n),t}(D),Ah=function(n){function t(e,r){var i=n.call(this,e,r)||this;i.isMuted=!1,i.startAt=0,i.endAt=0;var s=r.is_muted,o=r.start_at,a=r.end_at,u=r.remaining_duration,c=r.description;return i.isMuted=s,i.startAt=o,i.endAt=a,i.remainingDuration=u,i.description=c,i}return v(t,n),t}(U),Ia=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.keys;return(r=n.call(this)||this).method=O.GET,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={keys:o,include_ts:!0},r}return v(t,n),t}(D),Ta=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.metadata,o=r.ts;return i.metadata=s,i.ts=o,i}return v(t,n),t}(U),kh=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.metadata;return(r=n.call(this)||this).method=O.POST,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={metadata:o,include_ts:!0},r}return v(t,n),t}(D),Oh=function(n){function t(e,r){var i,s,o=this;return(o=n.call(this,e,r)||this).metaData=(i=r.metadata)!==null&&i!==void 0?i:{},o.ts=(s=r.ts)!==null&&s!==void 0?s:null,o}return v(t,n),t}(U),Dh=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.metadata,a=e.upsert;return(r=n.call(this)||this).method=O.PUT,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={metadata:o,include_ts:!0,upsert:a!=null&&a},r}return v(t,n),t}(D),Rh=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.metadata,o=r.ts;return i.metadata=s,i.ts=o,i}return v(t,n),t}(U),Uh=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return i.data&&(s.created=i.data.created,s.updated=i.data.updated,s.deleted=i.data.deleted),s}return v(t,n),t}(de),Mh=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.key;return(r=n.call(this)||this).method=O.DELETE,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/metadata/").concat(o),r.params={include_ts:!0},r}return v(t,n),t}(D),Lh=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.ts;return i.ts=s,i}return v(t,n),t}(U),Ph=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType;return(r=n.call(this)||this).method=O.DELETE,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={include_ts:!0},r}return v(t,n),t}(D),xh=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.ts;return i.ts=s,i}return v(t,n),t}(U),Ca=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.keys;return(r=n.call(this)||this).method=O.GET,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={keys:o},r}return v(t,n),t}(D),Sa=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.metaCounter=r,i}return v(t,n),t}(U),Fh=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.metaCounter;return(r=n.call(this)||this).method=O.POST,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={metacounter:o},r}return v(t,n),t}(D),qh=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.metaCounter=r,i}return v(t,n),t}(U),cs=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.metaCounter,a=e.upsert,u=a!==void 0&&a,c=e.mode,l=c===void 0?"set":c;return(r=n.call(this)||this).method=O.PUT,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={metacounter:o,upsert:u,mode:l},r}return v(t,n),t}(D),ls=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.metaCounter=r,i}return v(t,n),t}(U),zh=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return i.data&&(s.created=i.data.created,s.updated=i.data.updated,s.deleted=i.data.deleted),s}return v(t,n),t}(de),Hh=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.key;return(r=n.call(this)||this).method=O.DELETE,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/metacounter/").concat(o),r.params={},r}return v(t,n),t}(D);(function(n){function t(e,r){return n.call(this,e,r)||this}v(t,n)})(U);var $h=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType;return(r=n.call(this)||this).method=O.DELETE,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={},r}return v(t,n),t}(D);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}v(t,n)})(U);var Bh=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.userId,a=e.seconds,u=e.description;return(r=n.call(this)||this).method=O.POST,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/mute"),r.params={user_id:o,seconds:a,description:u},r}return v(t,n),t}(D);(function(n){function t(e,r){return n.call(this,e,r)||this}v(t,n)})(U);var jh=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.user=new Mn(e,i.data),s}return v(t,n),t}(de),Gh=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.userId;return(r=n.call(this)||this).method=O.DELETE,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/mute/").concat(encodeURIComponent(o)),r}return v(t,n),t}(D);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}v(t,n)})(U);var Vh=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.user=new Mn(e,i.data),s}return v(t,n),t}(de),Kh=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.userId,a=e.seconds,u=e.description;return(r=n.call(this)||this).method=O.POST,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/ban"),r.params=x({user_id:o,seconds:a,description:u}),r}return v(t,n),t}(D);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}v(t,n)})(U);var Qh=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.user=new Mn(e,i.data),i.data.member_count&&(s.memberCount=i.data.member_count),i.data.joined_member_count&&(s.joinedMemberCount=i.data.joined_member_count),s}return v(t,n),t}(de),Wh=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.userId;return(r=n.call(this)||this).method=O.DELETE,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/ban/").concat(encodeURIComponent(o)),r}return v(t,n),t}(D);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}v(t,n)})(U);var Yh=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.user=new Mn(e,i.data),s}return v(t,n),t}(de),Na=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.freezing;return(r=n.call(this)||this).method=O.PUT,r.path="".concat(X(s),"/").concat(encodeURIComponent(i),"/freeze"),r.params={freeze:o},r}return v(t,n),t}(D);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}v(t,n)})(U);var Zh=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.freeze=i.data.freeze,s}return v(t,n),t}(de),Xh=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.category,a=e.userId,u=e.description;return(r=n.call(this)||this).method=O.POST,r.path="".concat(cu(s),"/").concat(encodeURIComponent(i)),r.params={report_category:o,reporting_user_id:a,report_description:u},r}return v(t,n),t}(D),Jh=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.category,a=e.userId,u=e.offendingUserId,c=e.description;return(r=n.call(this)||this).method=O.POST,r.path="".concat(Cs,"/users/").concat(u),r.params={channel_url:i,channel_type:s===W.OPEN?"open_channels":"group_channels",report_category:o,reporting_user_id:a,report_description:c},r}return v(t,n),t}(D),ef=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.category,a=e.userId,u=e.offendingUserId,c=e.messageId,l=e.description;return(r=n.call(this)||this).method=O.POST,r.path="".concat(cu(s),"/").concat(encodeURIComponent(i),"/messages/").concat(c),r.params={report_category:o,reporting_user_id:a,report_description:l,offending_user_id:u},r}return v(t,n),t}(D),tf=function(n){function t(e){var r=[];return e.mentionType===Ue.USERS&&(e.mentionedUserIds?r=e.mentionedUserIds:e.mentionedUsers&&(r=e.mentionedUsers.map(function(i){return i.userId}))),n.call(this,{code:"MESG",ackRequired:!0,payload:x(H({channel_url:e.channelUrl,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:r,mentioned_message_template:e.mentionedMessageTemplate,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==mt.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:e.parentMessageId?e.parentMessageId:null,req_id:e.reqId,poll_id:e.pollId,pin_message:e.isPinnedMessage,extended_message_payload:e.extendedMessagePayload}))})||this}return v(t,n),t}(qe),rc=function(n){function t(e,r,i){var s,o,a,u,c=this;(c=n.call(this,e,"MESG",i)||this).message=new Fe(e,i);var l=S.of(e).sdkState;return c.isMentioned=In(c.message.mentionType,(a=(s=c.message.mentionedUserIds)!==null&&s!==void 0?s:(o=c.message.mentionedUsers)===null||o===void 0?void 0:o.map(function(d){return d.userId}))!==null&&a!==void 0?a:[],l.userId),c.forceUpdateLastMessage=(u=i.force_update_last_message)!==null&&u!==void 0&&u,c}return v(t,n),t}(de),Aa=function(n){function t(e){var r=null;return e.mentionType===Ue.USERS&&(e.mentionedUserIds?r=e.mentionedUserIds:e.mentionedUsers&&(r=e.mentionedUsers.map(function(i){return i.userId}))),n.call(this,{code:"MEDI",ackRequired:!0,payload:x(H({channel_url:e.channelUrl,msg_id:e.messageId,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:r,mentioned_message_template:e.mentionedMessageTemplate,apple_critical_alert_options:e.appleCriticalAlertOptions?gt.payloadify(e.appleCriticalAlertOptions):null,poll_id:e.pollId}))})||this}return v(t,n),t}(qe),zs=function(n){function t(e,r,i){var s,o,a,u,c,l=this;(l=n.call(this,e,"MEDI",i)||this).message=new Fe(e,i);var d=S.of(e).sdkState;return l.mentionCountChange=Ys({mentionType:(s=i.old_values)===null||s===void 0?void 0:s.mention_type,mentionedUserIds:(a=(o=i.old_values)===null||o===void 0?void 0:o.mentioned_user_ids)!==null&&a!==void 0?a:[]},H({mentionType:l.message.mentionType,mentionedUserIds:(u=l.message.mentionedUserIds)!==null&&u!==void 0?u:(c=l.message.mentionedUsers)===null||c===void 0?void 0:c.map(function(p){return p.userId})}),d.userId),l}return v(t,n),t}(de),ka=function(n){function t(e){var r=null;return e.mentionType===Ue.USERS&&(e.mentionedUserIds?r=e.mentionedUserIds:e.mentionedUsers&&(r=e.mentionedUsers.map(function(i){return i.userId}))),n.call(this,{code:"FEDI",ackRequired:!0,payload:x(H({channel_url:e.channelUrl,msg_id:e.messageId,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:r,apple_critical_alert_options:e.appleCriticalAlertOptions}))})||this}return v(t,n),t}(qe),Hs=function(n){function t(e,r,i){var s,o,a,u,c,l=this;(l=n.call(this,e,"FEDI",i)||this).message=new ge(e,i);var d=S.of(e).sdkState;return l.mentionCountChange=Ys({mentionType:(s=i.old_values)===null||s===void 0?void 0:s.mention_type,mentionedUserIds:(a=(o=i.old_values)===null||o===void 0?void 0:o.mentioned_user_ids)!==null&&a!==void 0?a:[]},H({mentionType:l.message.mentionType,mentionedUserIds:(u=l.message.mentionedUserIds)!==null&&u!==void 0?u:(c=l.message.mentionedUsers)===null||c===void 0?void 0:c.map(function(p){return p.userId})}),d.userId),l}return v(t,n),t}(de),nf=function(n){function t(e){var r=n.call(this)||this;return r.method=O.DELETE,r.path="".concat(X(e.channelType),"/").concat(e.channelUrl,"/messages/").concat(e.messageId),r}return v(t,n),t}(D);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}v(t,n)})(U);var rf=function(n){function t(e,r,i){var s,o=this;return(o=n.call(this,e,"DELM",i)||this).channelUrl=i.channel_url,o.channelType=i.channel_type,o.messageId=Number(i.msg_id),o.silent=i.silent,o.messageCreatedAt=i.message_created_at?Number(i.message_created_at):-1,o.senderId=(s=i.sender_id)!==null&&s!==void 0?s:void 0,o}return v(t,n),t}(de),sf=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.reactionKey,a=n.call(this)||this;return a.method=O.POST,a.path="".concat(X(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/reactions"),a.params={reaction:o},a}return v(t,n),t}(D),of=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.reactionEvent=new so(r),i}return v(t,n),t}(U),af=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.reactionKey,a=n.call(this)||this;return a.method=O.DELETE,a.path="".concat(X(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/reactions"),a.params={reaction:o},a}return v(t,n),t}(D),uf=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.reactionEvent=new so(E({},r)),i}return v(t,n),t}(U),cf=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.translationTargetLanguages,a=n.call(this)||this;return a.method=O.POST,a.path="".concat(X(r),"/").concat(encodeURIComponent(i),"/messages/").concat(encodeURIComponent(s),"/translation"),a.params={target_langs:o},a}return v(t,n),t}(D),lf=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.message=new Fe(e,r),i}return v(t,n),t}(U),df=function(n){function t(e){var r,i=this;i=n.call(this)||this;var s=[];e.mentionType===Ue.USERS&&(e.mentionedUserIds?s=e.mentionedUserIds:e.mentionedUsers&&(s=e.mentionedUsers.map(function(u){return u.userId})));var o=e.channelType,a=e.channelUrl;return i.method=O.POST,i.path="".concat(X(o),"/").concat(encodeURIComponent(a),"/scheduled_messages"),i.params=x(H({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:ri.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:s,sorted_metaarray:(r=e.metaArrays)===null||r===void 0?void 0:r.map(function(u){return Qe.payloadify(u)}),apple_critical_alert_options:e.appleCriticalAlertOptions?gt.payloadify(e.appleCriticalAlertOptions):null,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption})),i}return v(t,n),t}(D),hf=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.message=new Fe(e,r),i}return v(t,n),t}(U),ff=function(n){function t(e){var r,i,s=this;s=n.call(this)||this;var o=[];e.mentionType===Ue.USERS&&(e.mentionedUserIds?o=e.mentionedUserIds:e.mentionedUsers&&(o=e.mentionedUsers.map(function(c){return c.userId})));var a=e.channelType,u=e.channelUrl;return s.method=O.POST,s.path="".concat(X(a),"/").concat(encodeURIComponent(u),"/scheduled_messages"),s.params=H({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:ri.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:(r=e._thumbnails)===null||r===void 0?void 0:r.map(function(c){return $t.payloadify(c)}),custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:o,sorted_metaarray:(i=e.metaArrays)===null||i===void 0?void 0:i.map(function(c){return Qe.payloadify(c)}),apple_critical_alert_options:e.appleCriticalAlertOptions?gt.payloadify(e.appleCriticalAlertOptions):null,push_option:e.pushNotificationDeliveryOption}),s}return v(t,n),t}(D),pf=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.message=new ge(e,r),i}return v(t,n),t}(U),_f=function(n){function t(e){var r=e.pollId,i=e.title,s=e.data,o=e.allowUserSuggestion,a=e.allowMultipleVotes,u=e.closeAt,c=n.call(this)||this;return c.method=O.PUT,c.path="".concat(ut,"/").concat(encodeURIComponent(r)),c.params={title:i,data:s,allow_user_suggestion:o,allow_multiple_votes:a,close_at:u},c}return v(t,n),t}(D),vf=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new it(e,r),i}return v(t,n),t}(U),mf=function(n){function t(e){var r=e.pollId,i=n.call(this)||this;return i.method=O.DELETE,i.path="".concat(ut,"/").concat(encodeURIComponent(r)),i}return v(t,n),t}(D);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}v(t,n)})(U);var gf=function(n){function t(e){var r=e.pollId,i=n.call(this)||this;return i.method=O.PUT,i.path="".concat(ut,"/").concat(encodeURIComponent(r),"/close"),i}return v(t,n),t}(D),yf=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new it(e,r),i}return v(t,n),t}(U),Ef=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,o=e.optionText,a=n.call(this)||this;return a.method=O.POST,a.path="".concat(ut,"/").concat(encodeURIComponent(s),"/options"),a.params={channel_url:r,channel_type:i,text:o},a}return v(t,n),t}(D),bf=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new it(e,r),i}return v(t,n),t}(U),wf=function(n){function t(e){var r=e.pollId,i=e.pollOptionId,s=e.optionText,o=n.call(this)||this;return o.method=O.PUT,o.path="".concat(ut,"/").concat(encodeURIComponent(r),"/options/").concat(encodeURIComponent(i)),o.params={text:s},o}return v(t,n),t}(D),If=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new it(e,r),i}return v(t,n),t}(U),Tf=function(n){function t(e){var r=e.pollId,i=e.pollOptionId,s=n.call(this)||this;return s.method=O.DELETE,s.path="".concat(ut,"/").concat(encodeURIComponent(r),"/options/").concat(encodeURIComponent(i)),s}return v(t,n),t}(D);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}v(t,n)})(U);var Cf=function(n){function t(e){var r=e.reqId,i=e.channelType,s=e.channelUrl,o=e.pollId,a=e.pollOptionIds;return n.call(this,{code:"VOTE",ackRequired:!0,payload:x({req_id:r,channel_type:i===W.OPEN?"open_channels":"group_channels",channel_url:s,poll_id:o,option_ids:a})})||this}return v(t,n),t}(qe),ic=function(n){function t(e,r,i){var s=n.call(this,e,"VOTE",i)||this;return s.event=new Nd(i),s.channelUrl=i.channel_url,s.channelType=i.channel_type,s}return v(t,n),t}(de),Sf="GroupChannel",Nf="url",$s="Message",Af="messageId",sc="NotificationMessage",kf="notificationId",Of="Poll",Df="pollId",Rf="FeedChannel",Uf="url",ze,Mf=E(E({},wi),{fileInfoList:[]}),Lf=function(n){return(je(n.file)||w("string",n.fileUrl))&&w("string",n.fileName,!0)&&w("string",n.mimeType,!0)&&w("number",n.fileSize,!0)&&(n.thumbnailSizes===void 0||Array.isArray(n.thumbnailSizes)&&n.thumbnailSizes.every(function(t){return t.maxWidth>0&&t.maxHeight>0}))},Pf=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e._onFileUploaded=j,e}return v(t,n),t.prototype._triggerOnFileUploaded=function(e,r,i,s){this._onFileUploaded(e,r,i,s)},t.prototype.onFileUploaded=function(e){return this._onFileUploaded=e,this},t.prototype.onPending=function(e){return n.prototype.onPending.call(this,e),this},t.prototype.onFailed=function(e){return n.prototype.onFailed.call(this,e),this},t.prototype.onSucceeded=function(e){return n.prototype.onSucceeded.call(this,e),this},t}(Xr);(function(n){n.SEND="send",n.RESEND="resend",n.COPY="copy"})(ze||(ze={}));var ae,Oa=function(n){function t(e,r){var i,s,o,a,u,c,l=this;return(l=n.call(this,e)||this)._name="",l._createdAt=0,l.channelType=W.BASE,l.coverUrl="",l.customType="",l.data="",l.isFrozen=!1,l.isEphemeral=!1,l.creator=null,l._messageCollectionLastAccessedAt=0,l._url=r.channel_url,l._name=(i=r.name)!==null&&i!==void 0?i:"",l._createdAt=1e3*r.created_at,l.coverUrl=(s=r.cover_url)!==null&&s!==void 0?s:"",l.customType=(o=r.custom_type)!==null&&o!==void 0?o:"",l.data=(a=r.data)!==null&&a!==void 0?a:"",l.isFrozen=(u=r.freeze)!==null&&u!==void 0&&u,l.isEphemeral=(c=r.is_ephemeral)!==null&&c!==void 0&&c,l.creator=r.created_by?new V(l._iid,r.created_by):null,r.metadata&&Object.keys(r.metadata).length>0&&r.ts&&(l._cachedMetaData=new Map,Object.keys(r.metadata).forEach(function(d){l._cachedMetaData.set(d,{value:r.metadata[d],isRemoved:!1,updatedAt:r.ts})})),l}return v(t,n),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"createdAt",{get:function(){return this._createdAt},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return E(E({},this),{url:this._url,name:this._name,createdAt:this._createdAt})},t.payloadify=function(e){return x(H(E(E({},n.payloadify.call(this,e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:e.creator?V.payloadify(e.creator):null,created_at:e.createdAt/1e3})))},t.prototype.isGroupChannel=function(){return this.channelType===W.GROUP},t.prototype.isOpenChannel=function(){return this.channelType===W.OPEN},t.prototype.isFeedChannel=function(){return this.channelType===W.FEED},Object.defineProperty(t.prototype,"cachedMetaData",{get:function(){var e={};return this._cachedMetaData&&this._cachedMetaData.forEach(function(r,i){r.isRemoved||(e[i]=r.value)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"messageCollectionLastAccessedAt",{get:function(){return this._messageCollectionLastAccessedAt},enumerable:!1,configurable:!0}),t.prototype._updateMessageCollectionLastAccessedAt=function(){this._messageCollectionLastAccessedAt=Date.now()},t.prototype._update=function(e){var r=x(e);Object.assign(this,r)},t.prototype._upsertCachedMetaData=function(e,r){var i=this;Object.keys(e).forEach(function(s){i._cachedMetaData||(i._cachedMetaData=new Map);var o=i._cachedMetaData.get(s);(!o||o.updatedAt<=r)&&i._cachedMetaData.set(s,{value:e[s],isRemoved:!1,updatedAt:r})})},t.prototype._updateCachedMetaData=function(e,r){var i=this;this._cachedMetaData?this._cachedMetaData.forEach(function(s,o){var a;s.updatedAt<=r&&i._cachedMetaData.set(o,{value:(a=e[o])!==null&&a!==void 0?a:s.value,isRemoved:!e[o],updatedAt:r})}):(this._cachedMetaData=new Map,Object.keys(e).forEach(function(s){i._cachedMetaData.set(s,{value:e[s],isRemoved:!1,updatedAt:r})}))},t.prototype._removeFromCachedMetaData=function(e,r){var i=this;this._cachedMetaData&&e.forEach(function(s){var o=i._cachedMetaData.get(s);o&&o.updatedAt<r&&(o.isRemoved=!0,o.updatedAt=r)})},t.prototype._runIfHandleableWithGroupChannel=function(e){this.isGroupChannel()?e(this):this.isFeedChannel()&&e(this.groupChannel)},t.prototype._generateRequestId=function(){return"rq-".concat(sn())},t.prototype.isIdentical=function(e){return e&&this.url===e.url},t.prototype.isEqual=function(e){return ru(this,e)},t.prototype.createOperatorListQuery=function(e){return e===void 0&&(e={}),new mh(this._iid,this.url,this.channelType,e)},t.prototype.createMutedUserListQuery=function(e){return e===void 0&&(e={}),new bh(this._iid,this.url,this.channelType,e)},t.prototype.createBannedUserListQuery=function(e){return e===void 0&&(e={}),new Th(this._iid,this.url,this.channelType,e)},t.prototype.createPreviousMessageListQuery=function(e){return e===void 0&&(e={}),new gh(this._iid,this.url,this.channelType,e)},t.prototype.addOperators=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){switch(s.label){case 0:return R(Y("string",e)).throw(I.invalidParameters),r=S.of(this._iid).requestQueue,i=new Ch({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},t.prototype.removeOperators=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){switch(s.label){case 0:return R(Y("string",e)).throw(I.invalidParameters),r=S.of(this._iid).requestQueue,i=new Sh({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},t.prototype.getMyMutedInfo=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c,l,d,p;return h(this,function(_){switch(_.label){case 0:return e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new Nh({channelUrl:this.url,channelType:this.channelType,userId:r.userId}),[4,i.send(s)];case 1:return o=_.sent(),a=o.as(Ah),u=a.isMuted,c=a.startAt,l=a.endAt,d=a.remainingDuration,p=a.description,[2,{isMuted:u,startAt:c,endAt:l,remainingDuration:d,description:p}]}})})},t.prototype.getMetaData=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return R(Y("string",e)).throw(I.invalidParameters),r=S.of(this._iid).requestQueue,i=new Ia({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,r.send(i)];case 1:return s=c.sent(),o=s.as(Ta),a=o.metadata,u=o.ts,this._upsertCachedMetaData(a,u),[2,a]}})})},t.prototype.getAllMetaData=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return e=S.of(this._iid).requestQueue,r=new Ia({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(r)];case 1:return i=u.sent(),s=i.as(Ta),o=s.metadata,a=s.ts,this._updateCachedMetaData(o,a),[2,o]}})})},t.prototype.createMetaData=function(e){return f(this,void 0,void 0,function(){var r,i,s,o;return h(this,function(a){switch(a.label){case 0:return r=S.of(this._iid).requestQueue,i=new kh({channelUrl:this.url,channelType:this.channelType,metadata:e}),[4,r.send(i)];case 1:return s=a.sent(),o=s.as(Oh).metaData,this._upsertCachedMetaData(o,0),[2,o]}})})},t.prototype.updateMetaData=function(e,r){return r===void 0&&(r=!1),f(this,void 0,void 0,function(){var i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return i=S.of(this._iid).requestQueue,s=new Dh({channelUrl:this.url,channelType:this.channelType,metadata:e,upsert:r}),[4,i.send(s)];case 1:return o=l.sent(),a=o.as(Rh),u=a.metadata,c=a.ts,this._upsertCachedMetaData(u,c),[2,u]}})})},t.prototype.deleteMetaData=function(e){return f(this,void 0,void 0,function(){var r,i,s,o;return h(this,function(a){switch(a.label){case 0:return R(w("string",e)).throw(I.invalidParameters),r=S.of(this._iid).requestQueue,i=new Mh({channelUrl:this.url,channelType:this.channelType,key:e}),[4,r.send(i)];case 1:return s=a.sent(),o=s.as(Lh).ts,this._removeFromCachedMetaData([e],o),[2]}})})},t.prototype.deleteAllMetaData=function(){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return e=S.of(this._iid).requestQueue,r=new Ph({channelUrl:this.url,channelType:this.channelType}),[4,e.send(r)];case 1:return i=o.sent(),s=i.as(xh).ts,this._removeFromCachedMetaData(Z([],G(this._cachedMetaData.keys()),!1),s),[2]}})})},t.prototype.getMetaCounters=function(e){return f(this,void 0,void 0,function(){var r,i,s;return h(this,function(o){switch(o.label){case 0:return R(Y("string",e)).throw(I.invalidParameters),r=S.of(this._iid).requestQueue,i=new Ca({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(Sa).metaCounter]}})})},t.prototype.getAllMetaCounters=function(){return f(this,void 0,void 0,function(){var e,r,i;return h(this,function(s){switch(s.label){case 0:return e=S.of(this._iid).requestQueue,r=new Ca({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(r)];case 1:return i=s.sent(),[2,i.as(Sa).metaCounter]}})})},t.prototype.createMetaCounters=function(e){return f(this,void 0,void 0,function(){var r,i,s;return h(this,function(o){switch(o.label){case 0:return r=S.of(this._iid).requestQueue,i=new Fh({channelUrl:this.url,channelType:this.channelType,metaCounter:e}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(qh).metaCounter]}})})},t.prototype.updateMetaCounters=function(e,r){return r===void 0&&(r=!1),f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){switch(a.label){case 0:return i=S.of(this._iid).requestQueue,s=new cs({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:r}),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(ls).metaCounter]}})})},t.prototype.increaseMetaCounters=function(e){return f(this,void 0,void 0,function(){var r,i,s;return h(this,function(o){switch(o.label){case 0:return r=S.of(this._iid).requestQueue,i=new cs({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"increase"}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(ls).metaCounter]}})})},t.prototype.decreaseMetaCounters=function(e){return f(this,void 0,void 0,function(){var r,i,s;return h(this,function(o){switch(o.label){case 0:return r=S.of(this._iid).requestQueue,i=new cs({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"decrease"}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(ls).metaCounter]}})})},t.prototype.deleteMetaCounter=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){switch(s.label){case 0:return R(w("string",e)).throw(I.invalidParameters),r=S.of(this._iid).requestQueue,i=new Hh({channelUrl:this.url,channelType:this.channelType,key:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},t.prototype.deleteAllMetaCounters=function(){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return e=S.of(this._iid).requestQueue,r=new $h({channelUrl:this.url,channelType:this.channelType}),[4,e.send(r)];case 1:return i.sent(),[2]}})})},t.prototype.muteUser=function(e,r,i){return f(this,void 0,void 0,function(){return h(this,function(s){return[2,this.muteUserWithUserId(e.userId,r,i)]})})},t.prototype.muteUserWithUserId=function(e,r,i){return f(this,void 0,void 0,function(){var s,o;return h(this,function(a){switch(a.label){case 0:return R(w("string",e)&&w("number",r,!0)&&w("string",i,!0)).throw(I.invalidParameters),s=S.of(this._iid).requestQueue,o=new Bh({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:r,description:i}),[4,s.send(o)];case 1:return a.sent(),[2]}})})},t.prototype.unmuteUser=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2,this.unmuteUserWithUserId(e.userId)]})})},t.prototype.unmuteUserWithUserId=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){switch(s.label){case 0:return R(w("string",e)).throw(I.invalidParameters),r=S.of(this._iid).requestQueue,i=new Gh({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},t.prototype.banUser=function(e,r,i){return f(this,void 0,void 0,function(){return h(this,function(s){return[2,this.banUserWithUserId(e.userId,r,i)]})})},t.prototype.banUserWithUserId=function(e,r,i){return f(this,void 0,void 0,function(){var s,o;return h(this,function(a){switch(a.label){case 0:return R(w("string",e)&&w("number",r,!0)&&w("string",i,!0)).throw(I.invalidParameters),s=S.of(this._iid).requestQueue,o=new Kh({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:r,description:i}),[4,s.send(o)];case 1:return a.sent(),[2]}})})},t.prototype.unbanUser=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2,this.unbanUserWithUserId(e.userId)]})})},t.prototype.unbanUserWithUserId=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){switch(s.label){case 0:return R(w("string",e)).throw(I.invalidParameters),r=S.of(this._iid).requestQueue,i=new Wh({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},t.prototype.freeze=function(){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return e=S.of(this._iid).requestQueue,r=new Na({channelUrl:this.url,channelType:this.channelType,freezing:!0}),[4,e.send(r)];case 1:return i.sent(),this.isFrozen=!0,[2]}})})},t.prototype.unfreeze=function(){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return e=S.of(this._iid).requestQueue,r=new Na({channelUrl:this.url,channelType:this.channelType,freezing:!1}),[4,e.send(r)];case 1:return i.sent(),this.isFrozen=!1,[2]}})})},t.prototype.getMessagesByMessageId=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=E(E({},sr),r),R(w("number",e)&&pa(i)).throw(I.invalidParameters),[4,Ie.of(this._iid).getMessagesByMessageId(this.url,this.channelType,e,i)];case 1:return[2,s.sent()]}})})},t.prototype.getMessagesByTimestamp=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=E(E({},sr),r),R(w("number",e)&&pa(i)).throw(I.invalidParameters),[4,Ie.of(this._iid).getMessagesByTimestamp(this.url,this.channelType,e,i)];case 1:return[2,s.sent()]}})})},t.prototype.getMessageChangeLogsSinceTimestamp=function(e,r){return r===void 0&&(r={}),f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=E(E({},qs),r),R(w("number",e)&&_a(i)).throw(I.invalidParameters),[4,Ie.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,i)];case 1:return[2,s.sent()]}})})},t.prototype.getMessageChangeLogsSinceToken=function(e,r){return r===void 0&&(r={}),f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=E(E({},qs),r),R(w("string",e)&&_a(i)).throw(I.invalidParameters),[4,Ie.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,i)];case 1:return[2,s.sent()]}})})},t.prototype._createPendingSendableMessagePayload=function(e,r,i){var s,o=S.of(this._iid).sessionManager;return x(H({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,sorted_metaarray:e.metaArrays?e.metaArrays.map(function(a){return Qe.payloadify(a)}):null,apple_critical_alert_options:e.appleCriticalAlertOptions?gt.payloadify(e.appleCriticalAlertOptions):null,created_at:i,user:o.currentUser?An.payloadify(o.currentUser):null,req_id:r,request_state:ue.PENDING,mentioned_user_ids:e.mentionedUserIds,mentioned_users:(s=e.mentionedUsers)===null||s===void 0?void 0:s.map(function(a){return V.payloadify(a)})}))},t.prototype._createPendingUserMessage=function(e,r,i){var s,o,a={};if(e.translationTargetLanguages)try{for(var u=$(e.translationTargetLanguages),c=u.next();!c.done;c=u.next())a[c.value]=""}catch(p){s={error:p}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(s)throw s.error}}var l=x(E(E({},this._createPendingSendableMessagePayload(e,r,i)),{type:fe.USER,message:e.message,translations:a,extended_message_payload:e.extendedMessagePayload})),d=new Fe(this._iid,l);return d.messageParams=e,d},t.prototype._createPendingScheduledUserMessage=function(e,r,i){var s=this._createPendingUserMessage(e,r,i);return s.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},s},t.prototype._createPendingFileMessage=function(e,r,i){var s,o,a,u,c,l,d,p=x(E(E({},this._createPendingSendableMessagePayload(e,r,i)),{type:fe.FILE,url:e.fileUrl,file:{name:(s=e.fileName)!==null&&s!==void 0?s:(o=e.file)===null||o===void 0?void 0:o.name,size:(a=e.fileSize)!==null&&a!==void 0?a:(u=e.file)===null||u===void 0?void 0:u.size,type:(c=e.mimeType)!==null&&c!==void 0?c:(l=e.file)===null||l===void 0?void 0:l.type,data:e.data},thumbnails:(d=e._thumbnails)===null||d===void 0?void 0:d.map(function(m){return $t.payloadify(m)})})),_=new ge(this._iid,p);return _.messageParams=e,_},t.prototype._createPendingMultipleFilesMessage=function(e,r,i){var s=x(E(E({},this._createPendingSendableMessagePayload(e,r,i)),{type:fe.FILE})),o=new rt(this._iid,s);return o.messageParams=e,o},t.prototype._validateFailedFileMessageHasFile=function(e,r){var i;return!!e.url||je(r)||je((i=e.messageParams)===null||i===void 0?void 0:i.file)},t.prototype._createPendingScheduledFileMessage=function(e,r,i){var s=this._createPendingFileMessage(e,r,i);return s.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},s},t.prototype._markMessageAsFailed=function(e,r,i){i===void 0&&(i=!1),e.errorCode=r.code,r.code===q.REQUEST_CANCELED||r.code===q.FILE_UPLOAD_CANCEL_FAILED?e.sendingStatus=ue.CANCELED:i||(e.sendingStatus=ue.FAILED)},t.prototype.sendUserMessage=function(e){var r=E(E({},ec),e);return R(lh(r)).throw(I.invalidParameters),this._sendUserMessage(r)},t.prototype._sendUserMessage=function(e,r,i){var s=this;r===void 0&&(r=ze.SEND);var o=S.of(this._iid),a=o.dispatcher,u=o.requestQueue,c=i??this._generateRequestId(),l=Date.now(),d=new Xr;return Xe(2).then(function(){var p=s._createPendingUserMessage(e,c,l);a.dispatch(new _e({messages:[p],source:r===ze.RESEND?re.LOCAL_MESSAGE_RESEND_STARTED:re.EVENT_MESSAGE_SENT_PENDING})),K(function(){return f(s,void 0,void 0,function(){return h(this,function(m){return[2,d._trigger(p)]})})});var _=new tf(E(E({},e),{channelUrl:s.url,channelType:s.channelType,reqId:c}));u.send(_).then(function(m){var g=m.as(rc).message;a.dispatch(new _e({messages:[g],source:re.EVENT_MESSAGE_SENT_SUCCESS})),K(function(){return f(s,void 0,void 0,function(){return h(this,function(y){return[2,d._trigger(g)]})})})}).catch(function(m){if(et(m))throw m;Xe(2).then(function(){var g=s._createPendingUserMessage(e,c,l),y=S.of(s._iid).cacheContext,b=y.localCacheEnabled&&y.localCacheConfig.enableAutoResend&&ti(m.code);s._markMessageAsFailed(g,m,b),a.dispatch(new _e({messages:[g],source:g.sendingStatus===ue.PENDING?re.REQUEST_RESEND_MESSAGE:re.EVENT_MESSAGE_SENT_FAILED})),K(function(){return f(s,void 0,void 0,function(){return h(this,function(T){return[2,d._triggerFailed(m,g)]})})})})})}),d},t.prototype._autoResendUserMessage=function(e){return R(e instanceof Fe&&!!e.messageParams).throw(I.invalidParameters),this._sendUserMessage(e.messageParams,ze.SEND,e.reqId)},t.prototype.resendUserMessage=function(e){var r;return f(this,void 0,void 0,function(){var i,s;return h(this,function(o){return R(e instanceof Fe&&!e.scheduledInfo).throw(I.invalidParameters),i=new Re,s=(r=e.messageParams)!==null&&r!==void 0?r:ga(e),this._sendUserMessage(s,ze.RESEND,e.reqId).onFailed(function(a){return i.reject(a)}).onSucceeded(function(a){return i.resolve(a)}),[2,i.promise]})})},t.prototype.updateUserMessage=function(e,r){return f(this,void 0,void 0,function(){var i,s,o,a;return h(this,function(u){switch(u.label){case 0:return i=E(E({},hh),r),R(w("number",e)&&fh(i)).throw(I.invalidParameters),s=S.of(this._iid).requestQueue,o=new Aa(E({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:i.metaArrays?{array:i.metaArrays,mode:"add",upsert:!0}:void 0},i)),[4,s.send(o)];case 1:return a=u.sent(),[2,a.as(zs).message]}})})},t.prototype.copyUserMessage=function(e,r){var i,s,o;return f(this,void 0,void 0,function(){var a,u;return h(this,function(c){return R(e instanceof t&&r instanceof Fe&&r.sendingStatus===ue.SUCCEEDED&&this.url===r.channelUrl&&!r.scheduledInfo).throw(I.invalidParameters),R(!r.poll).throw(I.notSupportedError),a=new Re,u=(i=r.messageParams)!==null&&i!==void 0?i:H(E(E({},r),{mentionType:r.mentionType,mentionedUserIds:(s=r.mentionedUserIds)!==null&&s!==void 0?s:(o=r.mentionedUsers)===null||o===void 0?void 0:o.map(function(l){return l.userId}),translationTargetLanguages:Object.keys(r.translations),pushNotificationDeliveryOption:mt.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1})),e._sendUserMessage(u).onSucceeded(function(l){a.resolve(l)}).onFailed(function(l){return a.reject(l)}),[2,a.promise]})})},t.prototype.translateUserMessage=function(e,r){return f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){switch(a.label){case 0:return R(e instanceof Fe&&e.messageId>0&&Y("string",r)).throw(I.invalidParameters),i=S.of(this._iid).requestQueue,s=new cf({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,translationTargetLanguages:r}),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(lf).message]}})})},t.prototype._createScheduledUserMessage=function(e,r){var i=this,s=S.of(this._iid).requestQueue,o=Date.now(),a=this._generateRequestId();Xe(2).then(function(){var c=i._createPendingScheduledUserMessage(e,a,o);K(function(){return f(i,void 0,void 0,function(){return h(this,function(l){return[2,r._trigger(c)]})})})});var u=new df(E({reqId:a,channelType:this.channelType,channelUrl:this.url},e));s.send(u).then(function(c){var l=c.as(hf).message;K(function(){return f(i,void 0,void 0,function(){return h(this,function(d){return[2,r._trigger(l)]})})})}).catch(function(c){if(et(c))throw c;Xe(2).then(function(){var l=i._createPendingScheduledUserMessage(e,a,o);i._markMessageAsFailed(l,c),K(function(){return f(i,void 0,void 0,function(){return h(this,function(d){return[2,r._triggerFailed(c,l)]})})})})})},t.prototype.sendFileMessage=function(e){var r=E(E({},Ea),e);return R(wa(r)).throw(I.invalidParameters),this._sendFileMessage(r)},t.prototype.sendMultipleFilesMessage=function(e){var r,i=E(E({},Mf),e),s=S.of(this._iid);R(function(a,u){return u===void 0&&(u=sd),oo(a)&&Array.isArray(a.fileInfoList)&&a.fileInfoList.length>=2&&a.fileInfoList.length<=u&&a.fileInfoList.every(function(c){return Lf(c)})}(i,(r=s.appInfo)===null||r===void 0?void 0:r.multipleFilesMessageFileCountLimit)).throw(I.invalidParameters);var o=!!e.fileInfoList.find(function(a){var u=s.appInfo.uploadSizeLimit;return a.file instanceof Blob&&a.file.size>u||a.fileSize>u});return R(!o).throw(I.fileSizeLimitExceededError),this._sendMultipleFilesMessage(i)},t.prototype._sendFileMessage=function(e,r,i){var s=this;r===void 0&&(r=ze.SEND);var o=S.of(this._iid).dispatcher,a=Ie.of(this._iid).fileMessageQueue,u=i??this._generateRequestId(),c=Date.now(),l=new Xr;return Xe(2).then(function(){var d=s._createPendingFileMessage(e,u,c);o.dispatch(new _e({messages:[d],source:r===ze.RESEND?re.LOCAL_MESSAGE_RESEND_STARTED:re.EVENT_MESSAGE_SENT_PENDING})),K(function(){return f(s,void 0,void 0,function(){return h(this,function(p){return[2,l._trigger(d)]})})}),a.request(s,u,e).then(function(p){o.dispatch(new _e({messages:[p],source:re.EVENT_MESSAGE_SENT_SUCCESS})),K(function(){return f(s,void 0,void 0,function(){return h(this,function(_){return[2,l._trigger(p)]})})})}).catch(function(p){if(et(p))throw p;Xe(2).then(function(){var _=s._createPendingFileMessage(e,u,c),m=S.of(s._iid).cacheContext,g=m.localCacheEnabled&&m.localCacheConfig.enableAutoResend&&ti(p.code);s._markMessageAsFailed(_,p,g),o.dispatch(new _e({messages:[_],source:_.sendingStatus===ue.PENDING?re.REQUEST_RESEND_MESSAGE:p.code===q.FILE_UPLOAD_CANCEL_FAILED?re.LOCAL_MESSAGE_CANCELED:re.EVENT_MESSAGE_SENT_FAILED})),K(function(){return f(s,void 0,void 0,function(){return h(this,function(y){return[2,l._triggerFailed(p,_)]})})})})})}),l},t.prototype._autoResendFileMessage=function(e){R(e instanceof ge&&!!e.messageParams).throw(I.invalidParameters);var r=S.of(this._iid).logger;return r.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,ze.SEND,e.reqId).onFailed(function(i){r.debug("autoResendFileMessage failed",i)}).onSucceeded(function(i){r.debug("autoResendFileMessage success",i)})},t.prototype._sendMultipleFilesMessage=function(e,r,i){var s=this,o=S.of(this._iid).dispatcher,a=Ie.of(this._iid).fileMessageQueue,u=i??this._generateRequestId(),c=Date.now(),l=new Pf;return Xe(2).then(function(){var d=s._createPendingMultipleFilesMessage(e,u,c);o.dispatch(new _e({messages:[d],source:r===ze.RESEND?re.LOCAL_MESSAGE_RESEND_STARTED:re.EVENT_MESSAGE_SENT_PENDING})),K(function(){return f(s,void 0,void 0,function(){return h(this,function(p){return[2,l._trigger(d)]})})}),a.request(s,u,e,{requestHandler:l,isCopy:r===ze.COPY}).then(function(p){o.dispatch(new _e({messages:[p],source:re.EVENT_MESSAGE_SENT_SUCCESS})),K(function(){return f(s,void 0,void 0,function(){return h(this,function(_){return[2,l._trigger(p)]})})})}).catch(function(p){if(et(p))throw p;Xe(2).then(function(){var _=s._createPendingMultipleFilesMessage(e,u,c);s._markMessageAsFailed(_,p),o.dispatch(new _e({messages:[_],source:re.EVENT_MESSAGE_SENT_FAILED})),K(function(){return f(s,void 0,void 0,function(){return h(this,function(m){return[2,l._triggerFailed(p,_)]})})})})})}),l},t.prototype._createScheduledFileMessage=function(e,r,i,s){var o=this,a=S.of(this._iid).requestQueue,u=new ff(E(E({reqId:i,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));a.send(u).then(function(c){var l=c.as(pf).message;K(function(){return f(o,void 0,void 0,function(){return h(this,function(d){return[2,r._trigger(l)]})})})}).catch(function(c){if(et(c))throw c;Xe(2).then(function(){var l=o._createPendingScheduledFileMessage(e,i,s);o._markMessageAsFailed(l,c),K(function(){return f(o,void 0,void 0,function(){return h(this,function(d){return[2,r._triggerFailed(c,l)]})})})})})},t.prototype.sendFileMessages=function(e){var r,i;R(e.every(function(c){return wa(E(E({},Ea),c))})).throw(I.invalidParameters);var s=new Xr;try{for(var o=$(e),a=o.next();!a.done;a=o.next()){var u=a.value;this.sendFileMessage(u).onPending(function(c){return s._trigger(c)}).onFailed(function(c,l){return s._triggerFailed(c,l)}).onSucceeded(function(c){return s._trigger(c)})}}catch(c){r={error:c}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s},t.prototype.resendFileMessage=function(e,r){return f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){return i=this._validateFailedFileMessageHasFile(e,r),R(e instanceof ge&&i&&!e.scheduledInfo).throw(I.invalidParameters),s=new Re,o=ba(e,r),this._sendFileMessage(o,ze.RESEND,e.reqId).onFailed(function(u){return s.reject(u)}).onSucceeded(function(u){return s.resolve(u)}),[2,s.promise]})})},t.prototype.resendMessage=function(e,r){var i,s;if(R(e instanceof St&&!e.scheduledInfo&&e.isResendable).throw(I.invalidParameters),e.isUserMessage()){var o=(i=e.messageParams)!==null&&i!==void 0?i:ga(e);return this._sendUserMessage(o,ze.RESEND,e.reqId)}if(e.isFileMessage()){var a=this._validateFailedFileMessageHasFile(e,r);return R(a).throw(I.invalidParameters),o=(s=e.messageParams)!==null&&s!==void 0?s:ba(e,r),this._sendFileMessage(o,ze.RESEND,e.reqId)}if(e.isMultipleFilesMessage())throw I.channelTypeNotSupportedError},t.prototype.updateFileMessage=function(e,r){return f(this,void 0,void 0,function(){var i,s,o,a;return h(this,function(u){switch(u.label){case 0:return i=E(E({},ph),r),R(w("number",e)&&function(c){return nc(c)}(i)).throw(I.invalidParameters),s=S.of(this._iid).requestQueue,o=new ka(E({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:i.metaArrays?{array:i.metaArrays,mode:"add",upsert:!0}:void 0},i)),[4,s.send(o)];case 1:return a=u.sent(),[2,a.as(Hs).message]}})})},t.prototype.uploadFile=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return r=S.of(this._iid).requestQueue,i=sn(),(s=new Ms({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:i})).uploadProgressHandler=e.progressHandler,e.uploadStartedHandler&&e.uploadStartedHandler(i),[4,r.send(s)];case 1:return o=l.sent(),a=o.as(Ls),u=a.url,c=a.thumbnails,[2,{requestId:i,url:u,thumbnails:c}]}})})},t.prototype.cancelUploadingFileMessage=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return R(w("string",e)).throw(I.invalidParameters),Ie.of(this._iid).fileMessageQueue.cancel(this,e),[2,!0]})})},t.prototype.copyFileMessage=function(e,r){var i,s,o;return f(this,void 0,void 0,function(){var a,u;return h(this,function(c){return R(e instanceof t&&r instanceof ge&&r.sendingStatus===ue.SUCCEEDED&&this.url===r.channelUrl&&!r.scheduledInfo).throw(I.invalidParameters),a=new Re,u=H(E(E({},r),{fileUrl:r.url,fileName:r.name,fileSize:r.size,mimeType:r.type,mentionType:r.mentionType,mentionedUserIds:(i=r.mentionedUserIds)!==null&&i!==void 0?i:(s=r.mentionedUsers)===null||s===void 0?void 0:s.map(function(l){return l.userId}),pushNotificationDeliveryOption:mt.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:(o=r.thumbnails)===null||o===void 0?void 0:o.map(function(l){return{maxWidth:l.width,maxHeight:l.height}}),requireAuth:r.requireAuth,isPinnedMessage:!1})),e._sendFileMessage(u).onSucceeded(function(l){return a.resolve(l)}).onFailed(function(l){return a.reject(l)}),[2,a.promise]})})},t.prototype.copyMessage=function(e,r){R(e instanceof t&&r instanceof St&&r.sendingStatus===ue.SUCCEEDED&&this.url===r.channelUrl&&!r.scheduledInfo).throw(I.invalidParameters);var i=r,s=e;if(i.isUserMessage()){R(!i.poll).throw(I.notSupportedError);var o=ch(i);return s._sendUserMessage(o)}if(i.isFileMessage())return o=dh(i),s._sendFileMessage(o);if(r.isMultipleFilesMessage())throw I.channelTypeNotSupportedError},t.prototype.deleteMessage=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){switch(s.label){case 0:return R(e instanceof Ve).throw(I.invalidParameters),e.messageId>0?(r=S.of(this._iid).requestQueue,i=new nf({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId}),[4,r.send(i)]):[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})},t.prototype.addReaction=function(e,r){return f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){switch(a.label){case 0:return R(e instanceof Ve&&e.messageId>0&&w("string",r)).throw(I.invalidParameters),i=S.of(this._iid).requestQueue,s=new sf({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:r}),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(of).reactionEvent]}})})},t.prototype.deleteReaction=function(e,r){return f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){switch(a.label){case 0:return R(e instanceof Ve&&e.messageId>0&&w("string",r)).throw(I.invalidParameters),i=S.of(this._iid).requestQueue,s=new af({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:r}),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(uf).reactionEvent]}})})},t.prototype._updateUserMessageMetaArray=function(e,r,i,s){return f(this,void 0,void 0,function(){var o,a,u,c,l,d;return h(this,function(p){switch(p.label){case 0:return o=S.of(this._iid),a=o.dispatcher,u=o.requestQueue,c=new Aa({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:r,mode:i,upsert:s}}),[4,u.send(c)];case 1:return l=p.sent(),d=l.as(zs).message,a.dispatch(new _e({messages:[d],source:re.EVENT_MESSAGE_UPDATED})),[2,d]}})})},t.prototype._updateFileMessageMetaArray=function(e,r,i,s){return f(this,void 0,void 0,function(){var o,a,u,c,l,d;return h(this,function(p){switch(p.label){case 0:return o=S.of(this._iid),a=o.dispatcher,u=o.requestQueue,c=new ka({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:r,mode:i,upsert:s}}),[4,u.send(c)];case 1:return l=p.sent(),d=l.as(Hs).message,a.dispatch(new _e({messages:[d],source:re.EVENT_MESSAGE_UPDATED})),[2,d]}})})},t.prototype.createMessageMetaArrayKeys=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){return R(e instanceof Ve&&e.messageId>0&&Y("string",r)).throw(I.invalidParameters),i=r.map(function(o){return new Qe({key:o})}),e instanceof ge?[2,this._updateFileMessageMetaArray(e.messageId,i,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,i,"add",!0)]})})},t.prototype.deleteMessageMetaArrayKeys=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){return R(e instanceof Ve&&e.messageId>0&&Y("string",r)).throw(I.invalidParameters),i=r.map(function(o){return new Qe({key:o})}),e instanceof ge?[2,this._updateFileMessageMetaArray(e.messageId,i,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,i,"remove",!0)]})})},t.prototype.addMessageMetaArrayValues=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){return R(e instanceof Ve&&e.messageId>0&&r.every(function(s){return s instanceof Qe})).throw(I.invalidParameters),e instanceof ge?[2,this._updateFileMessageMetaArray(e.messageId,r,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,r,"add",!0)]})})},t.prototype.removeMessageMetaArrayValues=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){return R(e instanceof Ve&&e.messageId>0&&r.every(function(s){return s instanceof Qe})).throw(I.invalidParameters),e instanceof ge?[2,this._updateFileMessageMetaArray(e.messageId,r,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,r,"remove",!0)]})})},t.prototype.report=function(e,r){return f(this,void 0,void 0,function(){var i,s,o,a;return h(this,function(u){switch(u.label){case 0:return R(ce(or,e)&&w("string",r)).throw(I.invalidParameters),i=S.of(this._iid),s=i.sdkState,o=i.requestQueue,a=new Xh({channelUrl:this.url,channelType:this.channelType,userId:s.userId,category:e,description:r}),[4,o.send(a)];case 1:return u.sent(),[2]}})})},t.prototype.reportUser=function(e,r,i){return f(this,void 0,void 0,function(){var s,o,a,u;return h(this,function(c){switch(c.label){case 0:return R(e instanceof V&&ce(or,r)&&w("string",i)).throw(I.invalidParameters),s=S.of(this._iid),o=s.sdkState,a=s.requestQueue,u=new Jh({channelUrl:this.url,channelType:this.channelType,userId:o.userId,offendingUserId:e.userId,category:r,description:i}),[4,a.send(u)];case 1:return c.sent(),[2]}})})},t.prototype.reportMessage=function(e,r,i){return f(this,void 0,void 0,function(){var s,o,a,u;return h(this,function(c){switch(c.label){case 0:return R(e instanceof St&&ce(or,r)&&w("string",i)).throw(I.invalidParameters),s=S.of(this._iid),o=s.sdkState,a=s.requestQueue,u=new ef({channelUrl:this.url,channelType:this.channelType,userId:o.userId,offendingUserId:e.sender.userId,messageId:e.messageId,category:r,description:i}),[4,a.send(u)];case 1:return c.sent(),[2]}})})},t.prototype.updatePoll=function(e,r){return f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){switch(a.label){case 0:return R(w("number",e)&&function(u){return w("string",u.title,!0)&&Bu(u.data)&&w("boolean",u.allowUserSuggestion,!0)&&w("boolean",u.allowMultipleVotes,!0)&&w("number",u.closeAt,!0)}(r)).throw(I.invalidParameters),i=S.of(this._iid).requestQueue,s=new _f(E({pollId:e},r)),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(vf).poll]}})})},t.prototype.deletePoll=function(e){return f(this,void 0,void 0,function(){var r,i,s;return h(this,function(o){switch(o.label){case 0:return r=w("number",e),R(r).throw(I.invalidParameters),i=S.of(this._iid).requestQueue,s=new mf({pollId:e}),[4,i.send(s)];case 1:return o.sent(),[2]}})})},t.prototype.closePoll=function(e){return f(this,void 0,void 0,function(){var r,i,s,o;return h(this,function(a){switch(a.label){case 0:return r=w("number",e),R(r).throw(I.invalidParameters),i=S.of(this._iid).requestQueue,s=new gf({pollId:e}),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(yf).poll]}})})},t.prototype.addPollOption=function(e,r){return f(this,void 0,void 0,function(){var i,s,o,a;return h(this,function(u){switch(u.label){case 0:return i=w("number",e)&&w("string",r)&&r.trim()!=="",R(i).throw(I.invalidParameters),s=S.of(this._iid).requestQueue,o=new Ef({channelUrl:this.url,channelType:this.channelType,pollId:e,optionText:r}),[4,s.send(o)];case 1:return a=u.sent(),[2,a.as(bf).poll]}})})},t.prototype.updatePollOption=function(e,r,i){return f(this,void 0,void 0,function(){var s,o,a,u;return h(this,function(c){switch(c.label){case 0:return s=w("number",e)&&w("number",r)&&w("string",i)&&i.trim()!=="",R(s).throw(I.invalidParameters),o=S.of(this._iid).requestQueue,a=new wf({pollId:e,pollOptionId:r,optionText:i}),[4,o.send(a)];case 1:return u=c.sent(),[2,u.as(If).poll]}})})},t.prototype.deletePollOption=function(e,r){return f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){switch(a.label){case 0:return i=w("number",e)&&w("number",r),R(i).throw(I.invalidParameters),s=S.of(this._iid).requestQueue,o=new Tf({pollId:e,pollOptionId:r}),[4,s.send(o)];case 1:return a.sent(),[2]}})})},t.prototype.votePoll=function(e,r){return f(this,void 0,void 0,function(){var i,s,o,a,u,c,l;return h(this,function(d){switch(d.label){case 0:return i=w("number",e)&&Y("number",r),R(i).throw(I.invalidParameters),s=S.of(this._iid),o=s.requestQueue,a=s.dispatcher,u=new Cf({reqId:this._generateRequestId(),channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionIds:r}),[4,o.send(u)];case 1:return c=d.sent(),l=c.as(ic).event,a.dispatch(new io({event:l,source:re.EVENT_POLL_VOTED})),[2,l]}})})},t.prototype.getPollChangeLogsSinceTimestamp=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return R(w("number",e)).throw(I.invalidParameters),[4,Us.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,r.sent()]}})})},t.prototype.getPollChangeLogsSinceToken=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return R(w("string",e,!0)),[4,Us.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,r.sent()]}})})},t.prototype.createPollListQuery=function(e){return e===void 0&&(e=10),new Ku(this._iid,{channelUrl:this.url,channelType:this.channelType,limit:e})},t.prototype.createPollVoterListQuery=function(e,r,i){return i===void 0&&(i=20),new Qu(this._iid,{channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionId:r,limit:i})},t}(Me),xf=function(n){function t(e){e===void 0&&(e={});var r=n.call(this)||this;return Object.keys(e).forEach(function(i){r.hasOwnProperty(i)&&(r[i]=e[i])}),r}return v(t,n),t}(function(){this.onConnected=j,this.onReconnectStarted=j,this.onReconnectSucceeded=j,this.onReconnectFailed=j,this.onDisconnected=j}),Ff=function(n){function t(e){e===void 0&&(e={});var r=n.call(this)||this;return Object.keys(e).forEach(function(i){r.hasOwnProperty(i)&&(r[i]=e[i])}),r}return v(t,n),t}(function(){this.onSessionExpired=j,this.onSessionTokenRequired=function(n){return n(null)},this.onSessionError=j,this.onSessionRefreshed=j,this.onSessionClosed=j}),qf=function(n){function t(e){e===void 0&&(e={});var r=n.call(this)||this;return Object.keys(e).forEach(function(i){r.hasOwnProperty(i)&&(r[i]=e[i])}),r}return v(t,n),t}(function(){this.onFriendsDiscovered=j,this.onTotalUnreadMessageCountChanged=j,this.onTotalUnreadMessageCountUpdated=j}),zf=function(n){function t(e){var r=e.limit,i=e.token,s=e.userIdsFilter,o=e.metaDataKeyFilter,a=e.metaDataValuesFilter,u=e.nicknameStartsWithFilter,c=n.call(this)||this;return c.method=O.GET,c.path=ee,c.params=x({limit:r,token:i,user_ids:s,metadatakey:o,metadatavalues_in:a,nickname_startswith:u}),c}return v(t,n),t}(D),Hf=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.users=r.users.map(function(s){return new V(e,s)}),i.next=r.next,i}return v(t,n),t}(U),$f=function(n){function t(e,r){var i,s,o,a=this;return(a=n.call(this,e,r)||this).userIdsFilter=null,a.metaDataKeyFilter=null,a.metaDataValuesFilter=null,a.nicknameStartsWithFilter=null,a.userIdsFilter=(i=r.userIdsFilter)!==null&&i!==void 0?i:null,a.metaDataKeyFilter=(s=r.metaDataKeyFilter)!==null&&s!==void 0?s:null,a.metaDataValuesFilter=(o=r.metaDataValuesFilter)!==null&&o!==void 0?o:null,a.nicknameStartsWithFilter=r.nicknameStartsWithFilter||null,a}return v(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&Y("string",this.userIdsFilter,!0)&&w("string",this.metaDataKeyFilter,!0)&&Y("string",this.metaDataValuesFilter,!0)&&w("string",this.nicknameStartsWithFilter,!0)},t.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid).requestQueue,r=new zf(H(E(E({},this),{token:this._token}))),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(Hf),o=s.users,a=s.next,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,o];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},t}(Un),Bf=function(n){function t(e){var r=e.userId,i=e.limit,s=e.token,o=e.userIdsFilter,a=n.call(this)||this;return a.method=O.GET,a.path="".concat(ee,"/").concat(r,"/block"),a.params=x({limit:i,token:s,user_ids:o}),a}return v(t,n),t}(D),jf=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.users=r.users.map(function(s){return new V(e,s)}),i.next=r.next,i}return v(t,n),t}(U),Gf=function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,r)||this).userIdsFilter=null,s.userIdsFilter=(i=r.userIdsFilter)!==null&&i!==void 0?i:null,s}return v(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&Y("string",this.userIdsFilter,!0)},t.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new Bf(H(E(E({},this),{userId:r.userId,token:this._token}))),[4,i.send(s)]):[3,2]:[3,5];case 1:return o=l.sent(),a=o.as(jf),u=a.users,c=a.next,this._token=c,this._hasNext=!!c,this._isLoading=!1,[2,u];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},t}(Un),Vf=function(n){function t(e){var r=e.userId,i=e.limit,s=e.token,o=n.call(this)||this;return o.method=O.GET,o.path="".concat(ee,"/").concat(encodeURIComponent(r),"/friends"),o.params={limit:i,token:s},o}return v(t,n),t}(D),Kf=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.hasMore=r.has_more,i.users=r.users.map(function(s){return new V(e,s)}),i.next=r.next,i}return v(t,n),t}(U),Qf=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return v(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)},t.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c,l;return h(this,function(d){switch(d.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new Vf(E(E({},this),{userId:r.userId,token:this._token})),[4,i.send(s)]):[3,2]:[3,5];case 1:return o=d.sent(),a=o.as(Kf),u=a.users,c=a.hasMore,l=a.next,this._token=l,this._hasNext=c,this._isLoading=!1,[2,u];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},t}(Un),$r={},br=function(){function n(t){var e=t.dbname,r=t.itemSizeLimit,i=r===void 0?1048576:r,s=t.cacheLimit,o=s===void 0?256:s,a=t.blockHashBase,u=a===void 0?2:a,c=t.blockHashMultiplier,l=c===void 0?10:c,d=t.blockHashConstant,p=d===void 0?11:d,_=t.transactionApplyDelay,m=_===void 0?200:_,g=t.disableLogger,y=g!==void 0&&g;return $r[e]||(this.itemSizeLimit=i,this.cacheLimit=o,this.blockHashBase=u,this.blockHashMultiplier=l,this.blockHashConstant=p,this.transactionApplyDelay=m,this.disableLogger=y,$r[e]=this),$r[e]}return n.get=function(t){return $r[t]},n}();(function(n){n[n.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",n[n.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",n[n.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",n[n.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",n[n.STORE_IS_FULL=61001003]="STORE_IS_FULL",n[n.STORE_NOT_INITIALIZED=61001004]="STORE_NOT_INITIALIZED",n[n.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",n[n.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",n[n.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",n[n.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",n[n.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",n[n.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",n[n.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",n[n.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",n[n.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",n[n.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",n[n.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",n[n.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",n[n.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",n[n.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",n[n.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",n[n.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",n[n.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",n[n.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",n[n.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",n[n.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND"})(ae||(ae={}));var en,Q=function(n){function t(e){var r=e.code,i=r===void 0?ae.UNKNOWN_ERROR:r,s=e.message,o=s===void 0?"Unknown error occurred.":s,a=n.call(this,o)||this;return a.code=i,Object.setPrototypeOf(a,t.prototype),a}return v(t,n),Object.defineProperty(t,"storeNotDefined",{get:function(){return new t({code:ae.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeNotAvailable",{get:function(){return new t({code:ae.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeNotAvailableInPrivateBrowsing",{get:function(){return new t({code:ae.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeIsFull",{get:function(){return new t({code:ae.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeNotInitialized",{get:function(){return new t({code:ae.STORE_NOT_INITIALIZED,message:"Store is not initialized."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeKeyTypeIsInvalid",{get:function(){return new t({code:ae.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeBrokenIntegrity",{get:function(){return new t({code:ae.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeBrokenBlob",{get:function(){return new t({code:ae.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeEncryptionInvalid",{get:function(){return new t({code:ae.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeItemSizeExceeded",{get:function(){return new t({code:ae.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeReadFailed",{get:function(){return new t({code:ae.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeWriteFailed",{get:function(){return new t({code:ae.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"databaseSchemaNotOnUpgrade",{get:function(){return new t({code:ae.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionNotReady",{get:function(){return new t({code:ae.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotMatch",{get:function(){return new t({code:ae.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionQueryNotValid",{get:function(){return new t({code:ae.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionInsertDuplicate",{get:function(){return new t({code:ae.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotFound",{get:function(){return new t({code:ae.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotGiven",{get:function(){return new t({code:ae.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionWriteFailed",{get:function(){return new t({code:ae.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionItemSizeExceeded",{get:function(){return new t({code:ae.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"indexTableIsRequired",{get:function(){return new t({code:ae.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"indexTypesNotMatch",{get:function(){return new t({code:ae.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"compareTypesNotMatch",{get:function(){return new t({code:ae.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"circularReferenceFound",{get:function(){return new t({code:ae.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0}),t}(Error);(function(n){n.INIT="init",n.READY="ready",n.CLOSED="closed"})(en||(en={}));var Da,xe=function(n,t){if(t===void 0&&(t=new WeakMap),typeof n=="object"&&n!==null){if(t.has(n))throw Q.circularReferenceFound;t.set(n,!0);var e=void 0;if(Array.isArray(n))e=n.map(function(i){return xe(i,t)});else if(n instanceof RegExp)e=n;else if(n instanceof Date)e=n;else for(var r in e={},n)e[r]=xe(n[r],t);return t.delete(n),e}return n},Ct=function(n,t){if(t==null)return 1;if(n==null)return-1;if(typeof n!=typeof t)throw Q.compareTypesNotMatch;var e=0;switch(typeof n){case"boolean":case"number":e=n-t;break;case"string":e=n.localeCompare(t)}return e},Ra=function(n,t){for(var e=0,r=0;r<n.length;r++)e=n.charCodeAt(r)+(e<<6)+(e<<16)-e;return(e>>>0)%t},Br=function(n){return new Promise(function(t){setTimeout(function(){return t()},n)})},nn=function(n,t){if(!t)return!1;if(typeof n!="function"){for(var e in n)if(["/and","&&"].includes(e)){if(n[e].some(function(u){return!nn(u,t)}))return!1}else if(["/or","||"].includes(e)){if(n[e].every(function(u){return!nn(u,t)}))return!1}else if(e==="/where"){if(!(0,n[e])(t))return!1}else{var r=e;if(typeof n[r]=="object"){var i=n[r];for(var s in i)switch(s){case"/eq":case"=":if((o=t[r])!==(a=i[s]))return!1;break;case"/neq":case"!=":if((o=t[r])===(a=i[s]))return!1;break;case"/gt":case">":var o=t[r],a=i[s];if(!(Ct(o,a)>0))return!1;break;case"/gte":case">=":if(o=t[r],a=i[s],!(Ct(o,a)>=0))return!1;break;case"/lt":case"<":if(o=t[r],a=i[s],!(Ct(o,a)<0))return!1;break;case"/lte":case"<=":if(o=t[r],a=i[s],!(Ct(o,a)<=0))return!1;break;case"/in":if(o=t[r],!(a=i[s]).includes(o))return!1;break;case"/nin":if(o=t[r],(a=i[s]).includes(o))return!1;break;case"/contain":if(o=t[r],a=i[s],!o.includes(a))return!1;break;case"/regex":if(o=t[r],!(a=i[s]).test(o))return!1;break;case"/where":if(o=t[r],!(0,i[s])(o))return!1}}else if(typeof n[r]=="function"){if(!n[r](t[r]))return!1}else if(n[r]!==t[r])return!1}return!0}return n(t)},Gn=function(){},Ua=function(){return Promise.resolve()},Wf=function(n){return n},Ma=function(n,t){t()};(function(n){n[n.FORWARD=0]="FORWARD",n[n.BACKWARD=1]="BACKWARD"})(Da||(Da={}));var rn,ke,ht,Yf=function(){function n(t){var e=t.initialPrevValue,r=e===void 0?null:e,i=t.initialNextValue,s=i===void 0?null:i,o=t.iterator,a=t.map,u=a===void 0?Wf:a,c=t.backward,l=c===void 0?Ua:c,d=t.forward,p=d===void 0?Ua:d,_=t.complete,m=_===void 0?Gn:_;this._prevValue=r,this._nextValue=s,this._error=null,this._map=u,this._backward=l,this._forward=p,this._iterator=o,this._complete=m}return Object.defineProperty(n.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasPrevious",{get:function(){return!!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasNext",{get:function(){return!!this._nextValue},enumerable:!1,configurable:!0}),n.prototype.prev=function(){return f(this,void 0,void 0,function(){var t,e,r;return h(this,function(i){switch(i.label){case 0:if(!this.hasPrevious)return[3,6];i.label=1;case 1:return i.trys.push([1,3,,4]),t=this._prevValue,e=this,[4,this._backward()];case 2:return e._prevValue=i.sent()||null,this._nextValue=t,[3,4];case 3:return r=i.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,i.sent()];case 6:this._complete(),i.label=7;case 7:return[2]}})})},n.prototype.next=function(){return f(this,void 0,void 0,function(){var t,e,r;return h(this,function(i){switch(i.label){case 0:if(!this.hasNext)return[3,6];i.label=1;case 1:return i.trys.push([1,3,,4]),t=this._nextValue,e=this,[4,this._forward()];case 2:return e._nextValue=i.sent()||null,this._prevValue=t,[3,4];case 3:return r=i.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,i.sent()];case 6:this._complete(),i.label=7;case 7:return[2]}})})},n.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete()},n}(),Bs=function(){function n(t){var e=t.condition,r=e===void 0?{}:e,i=t.backward,s=i!==void 0&&i,o=t.blockManager,a=t.indexer;this.condition=r,this.backward=s,this._blockManager=o,this._indexer=a}return n.prototype.findOptimizedStartPosition=function(){var t=this,e=["=","/eq",">",">=","/gt","/gte"],r=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var i=this._indexer.origin.length-1;if(typeof this.condition!="function")for(var s in this._indexer.fields){var o=this._indexer.fields[s],a=1;if(o[0]==="-"&&(o=o.slice(1),a=-1),this.condition[o]){if(typeof this.condition[o]=="object"){var u=a>0?r:e;for(var c in this.condition[o])if(u.includes(c)){for(var l=i;l>=0;l--)if(a*Ct(this._indexer.origin[l].columnValues[s],this.condition[o][c])<=0){i=l;break}}}else for(l=i;l>=0;l--)if(a*Ct(this._indexer.origin[l].columnValues[s],this.condition[o])<=0){i=l;break}}}return Math.min(i+1,this._indexer.origin.length-1)}var d=0;if(typeof this.condition!="function")for(var p=function(g){var y=_._indexer.fields[g],b=1;if(y[0]==="-"&&(y=y.slice(1),b=-1),_.condition[y]){if(typeof _.condition[y]=="object")Object.keys(_.condition[y]).forEach(function(C){if((b>0?e:r).includes(C)){for(var N=d;N<t._indexer.origin.length;N++)if(b*Ct(t._indexer.origin[N].columnValues[g],t.condition[y][C])>=0){d=N;break}}});else for(var T=d;T<_._indexer.origin.length;T++)if(b*Ct(_._indexer.origin[T].columnValues[g],_.condition[y])>=0){d=T;break}}},_=this,s=0;s<this._indexer.fields.length;s++)p(s);return Math.max(d-1,0)},n.prototype.each=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c=this;return h(this,function(l){switch(l.label){case 0:if(e=this.findOptimizedStartPosition(),r=0,this.backward&&this._indexer.origin[e]&&(r=this._indexer.origin[e].keys.length-1),i=function(){if(c._indexer.origin[e]){if(!c._indexer.origin[e].keys[++r]){if(!c._indexer.origin[++e])return!1;r=0}return!0}return!1},s=function(){if(c._indexer.origin[e]){if(!c._indexer.origin[e].keys[--r]){if(!c._indexer.origin[--e])return!1;r=c._indexer.origin[e].keys.length-1}return!0}return!1},o=null,!this._indexer.origin[e])return[3,4];a=this.backward?s:i,l.label=1;case 1:return[4,this._blockManager.getFromBlock(this._indexer.origin[e].keys[r])];case 2:if((u=l.sent())&&nn(this.condition,u))return o=u,[3,4];l.label=3;case 3:if(a())return[3,1];l.label=4;case 4:return[4,new Promise(function(d){var p=new Yf({initialNextValue:xe(o),iterator:t,forward:function(){return f(c,void 0,void 0,function(){var _,m;return h(this,function(g){switch(g.label){case 0:_=this.backward?s:i,g.label=1;case 1:return _()?[4,this._blockManager.getFromBlock(this._indexer.origin[e].keys[r])]:[3,3];case 2:return(m=g.sent())&&nn(this.condition,m)?[2,xe(m)]:[3,1];case 3:return[2,null]}})})},backward:function(){return f(c,void 0,void 0,function(){var _,m;return h(this,function(g){switch(g.label){case 0:_=this.backward?i:s,g.label=1;case 1:return _()?[4,this._blockManager.getFromBlock(this._indexer.origin[e].keys[r])]:[3,3];case 2:return(m=g.sent())&&nn(this.condition,m)?[2,xe(m)]:[3,1];case 3:return[2,null]}})})},complete:d});t(p)})];case 5:return[2,l.sent()]}})})},n}(),Zf=function(){function n(t){var e=t.condition,r=e===void 0?{}:e,i=t.backward,s=i!==void 0&&i,o=t.mutex,a=t.blockManager,u=t.indexer;this._mutex=o,this._iterator=new Bs({condition:r,backward:s,blockManager:a,indexer:u})}return n.prototype.fetch=function(t){return t===void 0&&(t={}),f(this,void 0,void 0,function(){var e,r,i,s,o=this;return h(this,function(a){switch(a.label){case 0:if(e=Math.max(t.offset||0,0),(r=typeof t.limit=="number"?t.limit:Number.MAX_SAFE_INTEGER)===0)return[2,[]];if(r<0)throw Q.collectionQueryNotValid;a.label=1;case 1:return a.trys.push([1,4,,5]),i=[],[4,this._mutex.lock()];case 2:return a.sent(),[4,this._iterator.each(function(u){return f(o,void 0,void 0,function(){return h(this,function(c){return u.error?u.stop():u.hasNext?e===0?(i.push(u.nextValue),0<r&&r<=i.length?u.stop():u.next()):(e--,u.next()):u.stop(),[2]})})})];case 3:return a.sent(),this._mutex.unlock(),[2,i];case 4:throw s=a.sent(),this._mutex.unlock(),s;case 5:return[2]}})})},n.prototype.count=function(){return f(this,void 0,void 0,function(){var t,e,r=this;return h(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t=0,[4,this._mutex.lock()];case 1:return i.sent(),[4,this._iterator.each(function(s){return f(r,void 0,void 0,function(){return h(this,function(o){return s.error?s.stop():s.hasNext?(t++,s.next()):s.stop(),[2]})})})];case 2:return i.sent(),this._mutex.unlock(),[2,t];case 3:throw e=i.sent(),this._mutex.unlock(),e;case 4:return[2]}})})},n}(),js=function(n){return"".concat("nest","@").concat(n)},an=function(n,t){return"".concat(js(n),"/").concat(t)},ds=function(n,t){return"".concat(an(n,t),".metadata")},Gs=function(n,t){return"".concat(an(n,t),"/block.")},La=function(n,t){return"".concat(an(n,t),"/blob.")},Xf=function(){function n(t){var e=t.dbname,r=t.collectionName,i=t.store;this.dbname=e,this.collectionName=r,this.store=i}return n.prototype.get=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c,l;return h(this,function(d){switch(d.label){case 0:return[4,this.store.get(t)];case 1:return(e=d.sent())?(r=e.data,i=e.type,typeof fetch>"u"?[3,4]:[4,fetch(r)]):[3,5];case 2:return[4,d.sent().blob()];case 3:return[2,d.sent()];case 4:for(s=[],o=atob(r.split(",")[1]),a=0;a<o.length;a+=512){for(u=o.slice(a,a+512),c=new Array(u.length),l=0;l<u.length;l++)c[l]=u.charCodeAt(l);s.push(new Uint8Array(c))}return[2,new Blob(s,{type:i})];case 5:return[2,null]}})})},n.prototype.save=function(t,e){return e===void 0&&(e="".concat(Date.now())),f(this,void 0,void 0,function(){var r,i,s,o,a=this;return h(this,function(u){switch(u.label){case 0:return[4,new Promise(function(c){var l=function(p,_,m,g){return g===void 0&&(g=0),"".concat(La(p,_)).concat(m,".").concat(g)}(a.dbname,a.collectionName,e),d=new FileReader;d.onload=function(){c({blobId:l,data:d.result,type:t.type})},d.readAsDataURL(t)})];case 1:return r=u.sent(),i=r.blobId,s=r.data,o=r.type,[4,this.store.set({key:i,value:{data:s,type:o}})];case 2:return u.sent(),[2,i]}})})},n.prototype.remove=function(t){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this.store.remove(t)];case 1:return e.sent(),[2]}})})},n.prototype.clear=function(){return f(this,void 0,void 0,function(){var t,e,r=this;return h(this,function(i){switch(i.label){case 0:return t=La(this.dbname,this.collectionName),[4,this.store.getAllKeys()];case 1:return e=i.sent(),[4,Promise.all(e.filter(function(s){return s.startsWith(t)}).map(function(s){return f(r,void 0,void 0,function(){return h(this,function(o){switch(o.label){case 0:return[4,this.store.remove(s)];case 1:return[2,o.sent()]}})})}))];case 2:return i.sent(),[2]}})})},n}();(function(n){n[n.COMMIT=0]="COMMIT",n[n.WRITE=1]="WRITE",n[n.ERROR=2]="ERROR"})(rn||(rn={})),function(n){n.PENDING="pending",n.PERSISTENT="persistent",n.VOLATILE="volatile"}(ke||(ke={})),function(n){n[n.NO_CACHE=0]="NO_CACHE",n[n.DEFAULT=1]="DEFAULT",n[n.PERSISTENT=2]="PERSISTENT"}(ht||(ht={}));var ar,Se,Pa=[ke.PENDING,ke.VOLATILE],jr={},nt=function(){function n(t){var e=t.dbname,r=t.limit,i=r===void 0?256:r;return jr[e]||(this.dbname=e,this._items=[],this._limit=i,jr[e]=this),jr[e]}return n.get=function(t){return jr[t]},Object.defineProperty(n.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),n.prototype.find=function(t,e,r){return r===void 0&&(r=ht.DEFAULT),f(this,void 0,void 0,function(){var i,s;return h(this,function(o){switch(o.label){case 0:return(i=this.get(e))?[3,2]:[4,t.get(e)];case 1:return(s=o.sent())&&(i={key:e,value:s,state:r===ht.PERSISTENT?ke.PERSISTENT:ke.VOLATILE},this.put(i)),[3,3];case 2:r===ht.PERSISTENT&&(i.state=ke.PERSISTENT),o.label=3;case 3:return[2,i]}})})},n.prototype.get=function(t,e){e===void 0&&(e=ht.DEFAULT);var r=this._items.map(function(s){return s.key}).indexOf(t);if(r>-1){var i=this._items[r];return e===ht.PERSISTENT&&(i.state=ke.PERSISTENT),e!==ht.NO_CACHE&&this.put(i),i}return null},n.prototype.put=function(t){var e,r;if(this._limit>0){var i=this._items.map(function(d){return d.key}).indexOf(t.key);if(i>-1)Pa.includes(this._items[i].state)&&Pa.includes(t.state)?(this._items.splice(i,1),this._items.push(t)):(this._items[i].state=t.state,this._items[i].value=t.value);else{this._items.push(t);var s=this._items.filter(function(d){return d.state===ke.VOLATILE}),o=s.length-this._limit;if(o>0){var a=[];try{for(var u=$(this._items),c=u.next();!c.done;c=u.next()){var l=c.value;l.state===ke.VOLATILE&&o>0?o--:a.push(l)}}catch(d){e={error:d}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}this._items=a}}}},n.prototype.remove=function(t){var e=this._items.map(function(r){return r.key}).indexOf(t);e>-1&&this._items.splice(e,1)},n.prototype.clearByCondition=function(t){this._items=this._items.filter(function(e){return!t(e)})},n.prototype.clear=function(t){t===void 0&&(t=!1),this._items=t?[]:this._items.filter(function(e){return e.state!==ke.VOLATILE})},n}(),Jf=function(){function n(t){var e=t.dbname,r=t.collectionName,i=t.store;this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=e,this.collectionName=r,this.metadataKey=function(s,o){return"".concat(an(s,o),"/trans.metadata")}(e,r),this.recordsetKey=function(s,o){return"".concat(an(s,o),"/trans.recordset")}(e,r),this._store=i}return Object.defineProperty(n.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),n.prototype._getReducedRecordset=function(t){return t===void 0&&(t=[]),f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return[4,this._store.get(this.recordsetKey)];case 1:return(e=r.sent()||[]).push.apply(e,Z([],G(t),!1)),[2,this._reduceRecordSet(e)]}})})},n.prototype._reduceRecordSet=function(t){for(var e=[],r={},i=t.length-1;i>=0;i--){for(var s=t[i],o=[],a=s.requests.length-1;a>=0;a--){var u=s.requests[a],c=u.data;r[c.key]||(o.unshift(u),r[c.key]=!0)}o.length>0&&(s.requests=o,e.unshift(s))}return e},n.prototype._applyRecord=function(t,e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l,d;return h(this,function(p){switch(p.label){case 0:r=nt.get(this.dbname),i=e.generation,s=e.requests,o=null,p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this._store.setMany(s.map(function(_){return E(E({},_.data),{generation:i})}))];case 2:for(a=p.sent(),u=0;u<s.length;u++)a[u]instanceof Error&&(o||(o=a[u]),c=s[u].data,r.put(E(E({},c),{state:ke.PERSISTENT})));return[3,4];case 3:return l=p.sent(),o=l,[3,4];case 4:return o?[3,6]:(d=t.filter(function(_){return _.generation!==i}),[4,this._store.set({key:this.recordsetKey,value:d})]);case 5:return p.sent(),this._onWrite.forEach(function(_){_(s.map(function(m){return m.data}))}),[3,7];case 6:this._onError.forEach(function(_){o&&_(o)}),p.label=7;case 7:return[2]}})})},n.prototype.init=function(){return f(this,void 0,void 0,function(){var t,e,r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return t=this,[4,this._store.get(this.metadataKey)];case 1:return t._metadata=c.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:e=c.sent(),c.label=3;case 3:c.trys.push([3,8,9,10]),r=$(e),i=r.next(),c.label=4;case 4:return i.done?[3,7]:(s=i.value,[4,this._applyRecord(e,s)]);case 5:c.sent(),c.label=6;case 6:return i=r.next(),[3,4];case 7:return[3,10];case 8:return o=c.sent(),a={error:o},[3,10];case 9:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(a)throw a.error}return[7];case 10:return[2]}})})},n.prototype.on=function(t,e,r){switch(t){case rn.COMMIT:this._onCommit.set(e,r);break;case rn.WRITE:this._onWrite.set(e,r);break;case rn.ERROR:this._onError.set(e,r)}},n.prototype.requestWrite=function(t,e){this._requests.push({data:t,options:e}),nt.get(this.dbname).put(E({state:ke.PENDING},t))},n.prototype.requestMultipleWrite=function(t,e){var r,i,s=nt.get(this.dbname);try{for(var o=$(t),a=o.next();!a.done;a=o.next()){var u=a.value;this._requests.push({data:u,options:e}),s.put(E({state:ke.PENDING},u))}}catch(c){r={error:c}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},n.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(t){return nt.get(this.dbname).clearByCondition(function(e){return e.state===ke.PENDING}),this._requests=[],[2]})})},n.prototype.commit=function(){return f(this,void 0,void 0,function(){var t,e,r,i,s,o,a,u,c,l,d,p,_=this;return h(this,function(m){switch(m.label){case 0:if(!((t=this._requests).length>0))return[3,4];for(e=[],r={},u=t.length-1;u>=0;u--)i=t[u],l=i.data,r[l.key]||(r[l.key]=!0,e.unshift(i));return s={generation:this.generation,requests:e},[4,this._getReducedRecordset([s])];case 1:return o=m.sent(),[4,this._store.set({key:this.recordsetKey,value:o})];case 2:return m.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata})];case 3:for(m.sent(),a=nt.get(this.dbname),u=0;u<e.length;u++)c=e[u],l=c.data,d=c.options,a.put(E(E({},l),{state:d&&d.persistent?ke.PERSISTENT:ke.VOLATILE}));this._requests=[],this._onCommit.forEach(function(g){g(t.map(function(y){return y.data}))}),p=br.get(this.dbname),setTimeout(function(){try{_._applyRecord(o,s)}catch(g){_._onError.forEach(function(y){return y(g)})}},p.transactionApplyDelay),m.label=4;case 4:return[2]}})})},n}(),ei=function(){function n(t){var e=t.blockId,r=t.keyName,i=t.items,s=i===void 0?[]:i,o=t.limit;this.blockId=e,this.keyName=r,this.limit=o,this._items=Z([],G(s),!1)}return n.createFromCacheItem=function(t){return t?new n(t.value):null},Object.defineProperty(n.prototype,"isEmpty",{get:function(){return this._items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),n.prototype.serialize=function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},n.prototype.getItemByKey=function(t){var e=this,r=this._items.find(function(i){var s=i[e.keyName];return t===s});return r??null},n.prototype.has=function(t){var e=this;return this._items.map(function(r){return r[e.keyName]}).includes(t)},n.prototype.add=function(t){var e=this,r=this._items.map(function(i){return i[e.keyName]}).indexOf(t[this.keyName]);return r<0?this._items.length<this.limit&&(this._items.push(t),!0):(this._items[r]=t,!0)},n.prototype.remove=function(t){for(var e in this._items)if(this._items[e][this.keyName]===t)return this._items.splice(parseInt(e),1),!0;return!1},n.prototype.clear=function(){this._items=[]},n}(),ep=function(){function n(t){var e=t.dbname,r=t.collectionName,i=t.metadata,s=t.hashFunction,o=s===void 0?Ra:s,a=t.transaction,u=t.store;this.dbname=e,this.collectionName=r,this.hashFunction=o,this.metadata=i,this._transaction=a,this._store=u}return Object.defineProperty(n.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),n.prototype.createBlockId=function(t,e){return e===void 0&&(e=this.metadata.blockLevel),r=this.dbname,i=this.collectionName,s=e,o="".concat(function(a,u,c){var l=c.base*Math.pow(c.multiplier,u)+c.constant;return(c.hashFunction||Ra)(a,l)}(t,e,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(Gs(r,i)).concat(s,".").concat(o);var r,i,s,o},n.prototype._findBlock=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o;return h(this,function(a){switch(a.label){case 0:e=nt.get(this.dbname),r=this.metadata.blockLevel,a.label=1;case 1:return r>0?(i=this.createBlockId(t,r),[4,e.find(this._store,i)]):[3,4];case 2:if((s=a.sent())&&(o=ei.createFromCacheItem(s),o==null?void 0:o.getItemByKey(t)))return[2,o];a.label=3;case 3:return r--,[3,1];case 4:return[2,null]}})})},n.prototype.getFromBlock=function(t){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return[4,this._findBlock(t)];case 1:return[2,(e=r.sent())?e.getItemByKey(t):null]}})})},n.prototype.putToBlock=function(t,e){return f(this,void 0,void 0,function(){var r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return r=br.get(this.dbname),i=this.createBlockId(t),s=Math.floor(this._store.itemSizeLimit/r.itemSizeLimit),[4,nt.get(this.dbname).find(this._store,i)];case 1:return o=u.sent(),(a=o?ei.createFromCacheItem(o):new ei({blockId:i,keyName:this.keyName,items:[],limit:s}))!=null&&a.add(e)?(this._transaction.requestWrite({key:a.blockId,value:a.serialize()}),[2,!0]):[2,!1]}})})},n.prototype.removeFromBlock=function(t){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return[4,this._findBlock(t)];case 1:return(e=r.sent())&&e.remove(t)?(this._transaction.requestWrite({key:e.blockId,value:e.serialize()}),[2,!0]):[2,!1]}})})},n.prototype.clearAllBlocks=function(){return f(this,void 0,void 0,function(){var t,e,r;return h(this,function(i){switch(i.label){case 0:return t=Gs(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return e=i.sent(),r=e.filter(function(s){return s.startsWith(t)}),[4,this._store.removeMany(r)];case 2:return i.sent(),[4,this._transaction.clear()];case 3:return i.sent(),nt.get(this.dbname).clearByCondition(function(s){return s.key.startsWith(t)}),[2]}})})},n}(),vn={},Dt=function(){function n(t){var e=t.dbname,r=t.collectionName,i=t.keyName,s=t.fields,o=t.transaction,a=t.store,u=this;this._origin=[],this._table=[];var c=function(l,d,p){return"".concat(an(l,d),"/index.").concat(p)}(e,r,s.join(">"));return vn[c]||(this.dbname=e,this.collectionName=r,this.keyName=i,this.fields=s,this.indexerKey=c,this._transaction=o,this._store=a,this._transaction.on(rn.COMMIT,this.indexerKey,function(){return u.commit()}),this._transaction.on(rn.ERROR,this.indexerKey,function(){return u.abort()})),vn[c]}return n.createKey=function(t){return t.join(">")},n.parseKey=function(t){return t.split(">")},n.clearIndexerMap=function(){for(var t in vn)delete vn[t]},n.prototype._addItem=function(t){var e=t[this.keyName],r=this.getColumnValues(t),i=G(this.indexOf(r),2),s=i[0];return i[1]?!this._table[s].keys.includes(e)&&(this._table[s].keys.push(e),!0):(this._table.splice(s,0,{columnValues:r,keys:[e]}),!0)},n.prototype._removeItem=function(t){var e=t[this.keyName],r=this.getColumnValues(t),i=G(this.indexOf(r),2),s=i[0];if(i[1]){var o=this._table[s].keys.indexOf(e);if(o>-1)return this._table[s].keys.splice(o,1),this._table[s].keys.length===0&&this._table.splice(s,1),!0}return!1},Object.defineProperty(n.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),n.prototype.getColumnValues=function(t){var e,r,i,s,o=[];try{for(var a=$(this.fields),u=a.next();!u.done;u=a.next()){var c=u.value;if(c[0]==="-"&&(c=c.slice(1)),i=t[c],s=void 0,s=typeof i,i!==null&&s!=="undefined"&&s!=="boolean"&&s!=="number"&&s!=="string")throw Q.indexTypesNotMatch;o.push(t[c])}}catch(l){e={error:l}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return o},n.prototype.diff=function(t,e){for(var r in this.fields){var i=this.fields[r][0]==="-"?-1:1,s=Ct(t[r],e[r]);if(s!==0)return i*s}return 0},n.prototype.indexOf=function(t){if(this._table.length>0){for(var e=0,r=this._table.length-1;e<=r;){var i=Math.floor((e+r)/2),s=this.diff(t,this._table[i].columnValues);if(s>0)e=i+1;else{if(!(s<0))return[i,!0];r=i-1}}return[e,!1]}return[0,!1]},n.prototype.ensure=function(){return f(this,void 0,void 0,function(){var t,e,r,i,s,o,a,u,c,l,d,p,_,m,g,y,b;return h(this,function(T){switch(T.label){case 0:return[4,(t=nt.get(this.dbname)).find(this._store,this.indexerKey,ht.PERSISTENT)];case 1:return(e=T.sent())?[3,11]:(r=Gs(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:i=T.sent(),T.label=3;case 3:T.trys.push([3,8,9,10]),s=$(i),o=s.next(),T.label=4;case 4:return o.done?[3,7]:(a=o.value).startsWith(r)?[4,t.find(this._store,a,ht.NO_CACHE)]:[3,6];case 5:if(u=T.sent(),c=ei.createFromCacheItem(u))try{for(y=void 0,l=$(c.items),d=l.next();!d.done;d=l.next())p=d.value,this._addItem(p)}catch(C){y={error:C}}finally{try{d&&!d.done&&(b=l.return)&&b.call(l)}finally{if(y)throw y.error}}T.label=6;case 6:return o=s.next(),[3,4];case 7:return[3,10];case 8:return _=T.sent(),m={error:_},[3,10];case 9:try{o&&!o.done&&(g=s.return)&&g.call(s)}finally{if(m)throw m.error}return[7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=e.value,this._table=xe(this._origin),T.label=12;case 12:return vn[this.indexerKey]=this,[2]}})})},n.prototype.drop=function(){return f(this,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:return nt.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return t.sent(),delete vn[this.indexerKey],[2]}})})},n.prototype.addItem=function(t){return f(this,void 0,void 0,function(){return h(this,function(e){return this._addItem(t)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},n.prototype.removeItem=function(t){return f(this,void 0,void 0,function(){return h(this,function(e){return this._removeItem(t)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},n.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(t){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},n.prototype.commit=function(){this._origin=this._table,this._table=xe(this._origin)},n.prototype.abort=function(){this._table=xe(this._origin)},n}(),fi=function(){return typeof document<"u"&&typeof navigator<"u"&&navigator.product!=="ReactNative"},xa=function(){var n=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(n+16*Math.random())%16|0;return n=Math.floor(n/16),(t==="x"?e:3&e|8).toString(16)})};(function(n){n[n.PROCESSING=0]="PROCESSING",n[n.DONE=1]="DONE"})(ar||(ar={})),function(n){n.NEWNODE="newnode",n.REMOVENODE="removenode",n.CLAIM_HOST="claimhost",n.SYNC_HOST="synchost",n.REQUEST_LOCK="requestlock",n.ACQUIRE_LOCK="acquirelock",n.RELEASE_LOCK="releaselock"}(Se||(Se={}));var ot,hs={},ao=function(){function n(t,e){e===void 0&&(e={});var r=this;return this._state=ar.PROCESSING,this._queue=[],this._activationQueue=[],hs[t]&&!e.forceCreate||(this.nodeId=xa(),this.key=t,fi()&&(e.startAsInvisible?this.registerNode():document.visibilityState==="visible"?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",function(){document.visibilityState==="visible"&&r.claimHost()}),window.addEventListener("message",function(i){var s,o,a=i.data,u=a.nodeId,c=a.requestId,l=a.key,d=a.op,p=a.data;if(u!==r.nodeId&&l===r.key)switch(d){case Se.NEWNODE:r._sendSync();break;case Se.CLAIM_HOST:r._sendSync(),r._hostId=u;break;case Se.SYNC_HOST:if(!r.isInSync){r._activationTimeout&&clearTimeout(r._activationTimeout);var _=p,m=_.currentItemRequestId,g=_.queue,y=function(N){var P=r._queue.findIndex(function(A){return A.requestId===N.requestId});P<0&&r._requestLock({nodeId:N.nodeId,requestId:N.requestId,key:r.key,op:Se.REQUEST_LOCK,ts:N.ts})};try{for(var b=$(g),T=b.next();!T.done;T=b.next())y(T.value)}catch(N){s={error:N}}finally{try{T&&!T.done&&(o=b.return)&&o.call(b)}finally{if(s)throw s.error}}r._currentItem=r._queue.find(function(N){return N.requestId===m}),r._completeSync()}break;case Se.REMOVENODE:r._queue=r._queue.filter(function(N){return N.nodeId!==a.nodeId}),r._currentItem&&r._currentItem.nodeId===a.nodeId&&(r._currentItem=void 0,r._acquire(r._queue[0]));break;case Se.REQUEST_LOCK:r._requestLock(a);break;case Se.ACQUIRE_LOCK:var C=r._queue.find(function(N){return N.requestId===c});r._acquire(C);break;case Se.RELEASE_LOCK:r._release(c)}}),window.addEventListener("beforeunload",function(){r._send(Se.REMOVENODE)})),hs[t]=this),hs[t]}return Object.defineProperty(n.prototype,"locked",{get:function(){return!!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isInSync",{get:function(){return this._state==ar.DONE},enumerable:!1,configurable:!0}),n.prototype._send=function(t,e){var r;e===void 0&&(e={});var i={nodeId:this.nodeId,requestId:(r=e==null?void 0:e.requestId)!==null&&r!==void 0?r:xa(),key:this.key,op:t,data:e.data,ts:Date.now()};return fi()&&window.postMessage(i,"*"),i},n.prototype._acquire=function(t){t?(this._currentItem=t,this._currentItem.onAcquired&&this._currentItem.onAcquired(t.requestId)):this._currentItem=void 0},n.prototype._release=function(t){if(this._currentItem&&this._currentItem.requestId===t){var e=this._currentItem;this._currentItem=void 0,e.nodeId===this.nodeId&&this._send(Se.RELEASE_LOCK,{requestId:e.requestId});var r=this._queue.findIndex(function(i){return i.requestId===t});r>-1&&this._queue.splice(r,1),e.onReleased&&e.onReleased(t)}},n.prototype._requestLock=function(t){var e=this;return new Promise(function(r){var i={nodeId:t.nodeId,requestId:t.requestId,ts:t.ts,onAcquired:function(a){e.isHost&&e._send(Se.ACQUIRE_LOCK,{requestId:a}),r()},onReleased:function(){e._acquire(e._queue[0])}},s=!1;for(var o in e._queue)if(e._queue[o].ts>i.ts){e._queue.splice(parseInt(o),0,i),s=!0;break}s||e._queue.push(i),e._currentItem||e._acquire(e._queue[0])})},n.prototype._sendSync=function(){var t;this.isHost&&this._send(Se.SYNC_HOST,{data:{currentItemRequestId:(t=this._currentItem)===null||t===void 0?void 0:t.requestId,queue:this._queue.map(function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}})}})},n.prototype._waitUntilSyncCompleted=function(){return f(this,void 0,void 0,function(){var t=this;return h(this,function(e){return this.isHost&&!this.isInSync?[2,new Promise(function(r){t._activationQueue.push(r)})]:[2]})})},n.prototype._waitSync=function(){var t=this;this.isInSync||(this._activationTimeout=setTimeout(function(){t._completeSync()},8))},n.prototype._completeSync=function(){this.isInSync||(this._state=ar.DONE,this._activationQueue.forEach(function(t){return t()}),this._activationQueue=[])},n.prototype.registerNode=function(){this._send(Se.NEWNODE),this._waitSync()},n.prototype.claimHost=function(){this._hostId=this.nodeId,this._send(Se.CLAIM_HOST),this._waitSync()},n.prototype.lock=function(){return f(this,void 0,void 0,function(){var t;return h(this,function(e){switch(e.label){case 0:return[4,this._waitUntilSyncCompleted()];case 1:return e.sent(),t=this._send(Se.REQUEST_LOCK),[4,this._requestLock(t)];case 2:return e.sent(),[2]}})})},n.prototype.unlock=function(){var t;!((t=this._currentItem)===null||t===void 0)&&t.requestId&&this._release(this._currentItem.requestId)},n}(),fs=function(){function n(t){var e=t.dbname,r=t.collectionName,i=t.keyName,s=t.keyHash,o=t.indexes,a=t.store,u=this;this._state=en.INIT,this._indexers=[],this.dbname=e,this.name=r,this.keyName=i,this.indexes=Z([[i]],G(o.filter(function(c){return Dt.createKey(c)!==u.keyName})),!1),this._keyHash=s,this._store=a,this._mutex=new ao(function(c,l){return"".concat(an(c,l),".lock")}(e,r)),this._blobContainer=new Xf({dbname:e,collectionName:r,store:a}),this._transaction=new Jf({dbname:e,collectionName:r,store:a})}return n.metadataOf=function(t,e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=ds(t,e),[4,r.get(i)];case 1:return[2,s.sent()]}})})},Object.defineProperty(n.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isReady",{get:function(){return this._state===en.READY},enumerable:!1,configurable:!0}),n.prototype.init=function(){return f(this,void 0,void 0,function(){var t,e,r,i,s,o,a,u,c,l,d,p,_,m,g=this;return h(this,function(y){switch(y.label){case 0:return[4,this._mutex.lock()];case 1:y.sent(),y.label=2;case 2:return y.trys.push([2,9,,10]),t=br.get(this.dbname),[4,n.metadataOf(this.dbname,this.name,this._store)];case 3:return e=y.sent(),this._metadata=e||{keyName:this.keyName,blockLevel:1,blockHashBase:t.blockHashBase,blockHashMultiplier:t.blockHashMultiplier,blockHashConstant:t.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:y.sent(),this._blockManager=new ep({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=Z([],G(this.indexes),!1),i=[],s=r.map(function(b){return Dt.createKey(b)}),o=e?e.indexes.map(function(b){return Dt.createKey(b)}):[];try{for(a=$(o),u=a.next();!u.done;u=a.next())c=u.value,s.includes(c)||i.push(Dt.parseKey(c))}catch(b){_={error:b}}finally{try{u&&!u.done&&(m=a.return)&&m.call(a)}finally{if(_)throw _.error}}return(l=[]).push.apply(l,Z([],G(r.map(function(b){var T=new Dt({dbname:g.dbname,collectionName:g.name,keyName:g.keyName,fields:b,transaction:g._transaction,store:g._store});return g._indexers.push(T),T.ensure()})),!1)),l.push.apply(l,Z([],G(i.map(function(b){return new Dt({dbname:g.dbname,collectionName:g.name,keyName:g.keyName,fields:b,transaction:g._transaction,store:g._store}).drop()})),!1)),[4,Promise.all(l)];case 5:return y.sent(),[4,this._transaction.commit()];case 6:return y.sent(),s.sort().join(",")===o.sort().join(",")?[3,8]:(d=ds(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:d,value:this._metadata})]);case 7:y.sent(),y.label=8;case 8:return this._state=en.READY,this._mutex.unlock(),[3,10];case 9:throw p=y.sent(),this._mutex.unlock(),p;case 10:return[2]}})})},n.prototype.close=function(){this._state=en.CLOSED},n.prototype._hasPropertyOfKeyName=function(t){var e=t[this.keyName];return typeof e=="string"&&!!e},n.prototype._getIndexerBy=function(t){var e,r;t===void 0&&(t=null),t||(t=[this.keyName]);var i=Dt.createKey(t);try{for(var s=$(this._indexers),o=s.next();!o.done;o=s.next()){var a=o.value;if(i===Dt.createKey(a.fields))return a}}catch(u){e={error:u}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}throw Q.indexTableIsRequired},n.prototype._upgradeBlockLevel=function(){return f(this,void 0,void 0,function(){var t;return h(this,function(e){switch(e.label){case 0:return t=ds(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:t,value:this._metadata})];case 1:return e.sent(),[2]}})})},n.prototype._requestInsert=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return e=t[this.keyName],[4,this._blockManager.getFromBlock(e)];case 1:return u.sent()?[3,13]:[4,this._blockManager.putToBlock(e,t)];case 2:return u.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return u.sent(),[4,this._blockManager.putToBlock(e,t)];case 4:u.sent(),u.label=5;case 5:u.trys.push([5,10,11,12]),r=$(this._indexers),i=r.next(),u.label=6;case 6:return i.done?[3,9]:[4,i.value.addItem(t)];case 7:u.sent(),u.label=8;case 8:return i=r.next(),[3,6];case 9:return[3,12];case 10:return s=u.sent(),o={error:s},[3,12];case 11:try{i&&!i.done&&(a=r.return)&&a.call(r)}finally{if(o)throw o.error}return[7];case 12:return[3,14];case 13:throw Q.collectionInsertDuplicate;case 14:return[2]}})})},n.prototype._requestUpsert=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c,l,d,p,_,m;return h(this,function(g){switch(g.label){case 0:return e=t[this.keyName],[4,this._blockManager.getFromBlock(e)];case 1:return(r=g.sent())?[3,13]:[4,this._blockManager.putToBlock(e,t)];case 2:return g.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return g.sent(),[4,this._blockManager.putToBlock(e,t)];case 4:g.sent(),g.label=5;case 5:g.trys.push([5,10,11,12]),i=$(this._indexers),s=i.next(),g.label=6;case 6:return s.done?[3,9]:[4,(c=s.value).addItem(t)];case 7:g.sent(),g.label=8;case 8:return s=i.next(),[3,6];case 9:return[3,12];case 10:return o=g.sent(),d={error:o},[3,12];case 11:try{s&&!s.done&&(p=i.return)&&p.call(i)}finally{if(d)throw d.error}return[7];case 12:return[3,23];case 13:return[4,this._blockManager.putToBlock(e,t)];case 14:g.sent(),g.label=15;case 15:g.trys.push([15,21,22,23]),a=$(this._indexers),u=a.next(),g.label=16;case 16:return u.done?[3,20]:(c=u.value).diff(c.getColumnValues(r),c.getColumnValues(t))===0?[3,19]:[4,c.removeItem(r)];case 17:return g.sent(),[4,c.addItem(t)];case 18:g.sent(),g.label=19;case 19:return u=a.next(),[3,16];case 20:return[3,23];case 21:return l=g.sent(),_={error:l},[3,23];case 22:try{u&&!u.done&&(m=a.return)&&m.call(a)}finally{if(_)throw _.error}return[7];case 23:return[2]}})})},n.prototype._requestUpdate=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return e=t[this.keyName],[4,this._blockManager.getFromBlock(e)];case 1:return(r=l.sent())?[4,this._blockManager.putToBlock(e,t)]:[3,11];case 2:l.sent(),l.label=3;case 3:l.trys.push([3,9,10,11]),i=$(this._indexers),s=i.next(),l.label=4;case 4:return s.done?[3,8]:(o=s.value).diff(o.getColumnValues(r),o.getColumnValues(t))===0?[3,7]:[4,o.removeItem(r)];case 5:return l.sent(),[4,o.addItem(t)];case 6:l.sent(),l.label=7;case 7:return s=i.next(),[3,4];case 8:return[3,11];case 9:return a=l.sent(),u={error:a},[3,11];case 10:try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}return[7];case 11:return[2]}})})},n.prototype._requestRemove=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return[4,this._blockManager.getFromBlock(t)];case 1:return(e=u.sent())?[4,this._blockManager.removeFromBlock(t)]:[3,10];case 2:u.sent(),u.label=3;case 3:u.trys.push([3,8,9,10]),r=$(this._indexers),i=r.next(),u.label=4;case 4:return i.done?[3,7]:[4,i.value.removeItem(e)];case 5:u.sent(),u.label=6;case 6:return i=r.next(),[3,4];case 7:return[3,10];case 8:return s=u.sent(),o={error:s},[3,10];case 9:try{i&&!i.done&&(a=r.return)&&a.call(r)}finally{if(o)throw o.error}return[7];case 10:return[2]}})})},n.prototype._requestClear=function(){return f(this,void 0,void 0,function(){var t,e,r,i,s;return h(this,function(o){switch(o.label){case 0:return[4,this._blockManager.clearAllBlocks()];case 1:o.sent(),o.label=2;case 2:o.trys.push([2,7,8,9]),t=$(this._indexers),e=t.next(),o.label=3;case 3:return e.done?[3,6]:[4,e.value.clear()];case 4:o.sent(),o.label=5;case 5:return e=t.next(),[3,3];case 6:return[3,9];case 7:return r=o.sent(),i={error:r},[3,9];case 8:try{e&&!e.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}return[7];case 9:return[2]}})})},n.prototype.getByKey=function(t){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,6];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(t)];case 3:return e=i.sent(),this._mutex.unlock(),[2,xe(e)];case 4:throw r=i.sent(),this._mutex.unlock(),r;case 5:return[3,7];case 6:throw Q.collectionNotReady;case 7:return[2]}})})},n.prototype.query=function(t){if(t===void 0&&(t={}),this.isReady)return new Zf({condition:t.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(t.index),backward:!!t.backward});throw Q.collectionNotReady},n.prototype.insertOne=function(t){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:r.sent(),r.label=2;case 2:if(r.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(t))throw Q.collectionKeyNotGiven;return[4,this._requestInsert(xe(t))];case 3:return r.sent(),[4,this._transaction.commit()];case 4:return r.sent(),this._mutex.unlock(),[2,t];case 5:return e=r.sent(),[4,this._transaction.clear()];case 6:throw r.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw Q.collectionNotReady;case 9:return[2]}})})},n.prototype.insertMany=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c=this;return h(this,function(l){switch(l.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:l.sent(),l.label=2;case 2:if(l.trys.push([2,12,,14]),t.some(function(d){return!c._hasPropertyOfKeyName(d)}))throw Q.collectionKeyNotGiven;l.label=3;case 3:l.trys.push([3,8,9,10]),e=$(t),r=e.next(),l.label=4;case 4:return r.done?[3,7]:(i=r.value,[4,this._requestInsert(xe(i))]);case 5:l.sent(),l.label=6;case 6:return r=e.next(),[3,4];case 7:return[3,10];case 8:return s=l.sent(),a={error:s},[3,10];case 9:try{r&&!r.done&&(u=e.return)&&u.call(e)}finally{if(a)throw a.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return l.sent(),this._mutex.unlock(),[2,t];case 12:return o=l.sent(),[4,this._transaction.clear()];case 13:throw l.sent(),this._mutex.unlock(),o;case 14:return[3,16];case 15:throw Q.collectionNotReady;case 16:return[2]}})})},n.prototype.upsertOne=function(t){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:r.sent(),r.label=2;case 2:if(r.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(t))throw Q.collectionKeyNotGiven;return[4,this._requestUpsert(xe(t))];case 3:return r.sent(),[4,this._transaction.commit()];case 4:return r.sent(),this._mutex.unlock(),[2,t];case 5:return e=r.sent(),[4,this._transaction.clear()];case 6:throw r.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw Q.collectionNotReady;case 9:return[2]}})})},n.prototype.upsertMany=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c=this;return h(this,function(l){switch(l.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:l.sent(),l.label=2;case 2:if(l.trys.push([2,12,,14]),t.some(function(d){return!c._hasPropertyOfKeyName(d)}))throw Q.collectionKeyNotGiven;l.label=3;case 3:l.trys.push([3,8,9,10]),e=$(t),r=e.next(),l.label=4;case 4:return r.done?[3,7]:(i=r.value,[4,this._requestUpsert(xe(i))]);case 5:l.sent(),l.label=6;case 6:return r=e.next(),[3,4];case 7:return[3,10];case 8:return s=l.sent(),a={error:s},[3,10];case 9:try{r&&!r.done&&(u=e.return)&&u.call(e)}finally{if(a)throw a.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return l.sent(),this._mutex.unlock(),[2,t];case 12:return o=l.sent(),[4,this._transaction.clear()];case 13:throw l.sent(),this._mutex.unlock(),o;case 14:return[3,16];case 15:throw Q.collectionNotReady;case 16:return[2]}})})},n.prototype.update=function(t){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:r.sent(),r.label=2;case 2:if(r.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(t))throw Q.collectionKeyNotGiven;return[4,this._requestUpdate(xe(t))];case 3:return r.sent(),[4,this._transaction.commit()];case 4:return r.sent(),this._mutex.unlock(),[2,t];case 5:return e=r.sent(),[4,this._transaction.clear()];case 6:throw r.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw Q.collectionNotReady;case 9:return[2]}})})},n.prototype.updateIf=function(t,e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l,d,p,_,m,g,y,b=this;return h(this,function(T){switch(T.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,16];case 1:T.sent(),T.label=2;case 2:return T.trys.push([2,13,,15]),r=t.where,i=r===void 0?{}:r,s=t.index,o=s===void 0?null:s,a=t.backward,u=a!==void 0&&a,c=[],[4,new Bs({condition:i,blockManager:this._blockManager,backward:u,indexer:this._getIndexerBy(o)}).each(function(C){return f(b,void 0,void 0,function(){var N,P;return h(this,function(A){if(C.error)throw C.stop(),C.error;if(C.hasNext){if(N=C.nextValue,nn(i,N)&&e.set){if(typeof e.set!="function")for(P in e.set)N[P]=e.set[P];else e.set(N);c.push(N)}C.next()}else C.stop();return[2]})})})];case 3:T.sent(),T.label=4;case 4:T.trys.push([4,9,10,11]),l=$(c),d=l.next(),T.label=5;case 5:return d.done?[3,8]:(p=d.value,[4,this._requestUpdate(xe(p))]);case 6:T.sent(),T.label=7;case 7:return d=l.next(),[3,5];case 8:return[3,11];case 9:return _=T.sent(),g={error:_},[3,11];case 10:try{d&&!d.done&&(y=l.return)&&y.call(l)}finally{if(g)throw g.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return T.sent(),this._mutex.unlock(),[2,c];case 13:return m=T.sent(),[4,this._transaction.clear()];case 14:throw T.sent(),this._mutex.unlock(),m;case 15:return[3,17];case 16:throw this._transaction.clear(),Q.collectionNotReady;case 17:return[2]}})})},n.prototype.remove=function(t){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,5,,7]),[4,this._requestRemove(t)];case 3:return r.sent(),[4,this._transaction.commit()];case 4:return r.sent(),this._mutex.unlock(),[3,7];case 5:return e=r.sent(),[4,this._transaction.clear()];case 6:throw r.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw Q.collectionNotReady;case 9:return[2]}})})},n.prototype.removeIf=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c,l,d,p,_,m,g,y=this;return h(this,function(b){switch(b.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:b.sent(),b.label=2;case 2:return b.trys.push([2,13,,14]),e=t.where,r=e===void 0?{}:e,i=t.index,s=i===void 0?null:i,o=t.backward,a=o!==void 0&&o,u=[],[4,new Bs({condition:r,blockManager:this._blockManager,backward:a,indexer:this._getIndexerBy(s)}).each(function(T){return f(y,void 0,void 0,function(){var C,N;return h(this,function(P){if(T.error)throw T.stop(),T.error;return T.hasNext?(C=T.nextValue,nn(r,C)&&(N=C[this.keyName],u.push(N)),T.next()):T.stop(),[2]})})})];case 3:b.sent(),b.label=4;case 4:b.trys.push([4,9,10,11]),c=$(u),l=c.next(),b.label=5;case 5:return l.done?[3,8]:(d=l.value,[4,this._requestRemove(d)]);case 6:b.sent(),b.label=7;case 7:return l=c.next(),[3,5];case 8:return[3,11];case 9:return p=b.sent(),m={error:p},[3,11];case 10:try{l&&!l.done&&(g=c.return)&&g.call(c)}finally{if(m)throw m.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return b.sent(),this._mutex.unlock(),[2,u];case 13:throw _=b.sent(),this._mutex.unlock(),_;case 14:return[3,16];case 15:throw this._transaction.clear(),Q.collectionNotReady;case 16:return[2]}})})},n.prototype.clear=function(){return f(this,void 0,void 0,function(){var t;return h(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[3,7];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Q.collectionNotReady;case 9:return[2]}})})},n.prototype.getBlob=function(t){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.get(t)];case 1:return[2,e.sent()]}})})},n.prototype.saveBlob=function(t,e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return[4,this._blobContainer.save(t,e)];case 1:return[2,r.sent()]}})})},n.prototype.removeBlob=function(t){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.remove(t)];case 1:return e.sent(),[2]}})})},n.prototype.removeAllBlobs=function(){return f(this,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:return[4,this._blobContainer.clear()];case 1:return t.sent(),[2]}})})},n}(),ps="[NESTDB]",Gr=!0,Gt=function(){function n(){}return n.off=function(){Gr=!1},n.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Gr&&console.log.apply(console,Z(["".concat(ps,"[LOG]")],G(t),!1))},n.warning=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Gr&&console.warn.apply(console,Z(["".concat(ps,"[WARNING]")],G(t),!1))},n.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Gr&&console.error.apply(console,Z(["".concat(ps,"[ERROR]")],G(t),!1))},n}(),tp=[{},{a:700400,n:"error"}],Ii=function(){function n(t){var e,r,i;this.encryption=(e=t.encryption)!==null&&e!==void 0?e:su,this.itemSizeLimit=(r=t.itemSizeLimit)!==null&&r!==void 0?r:4194304,this.metadataBuffer=(i=t.metadataBuffer)!==null&&i!==void 0?i:256}return Object.defineProperty(n.prototype,"_encryptionCheckKey",{get:function(){return"".concat(this.dbname,".encrypt")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_reservedKeys",{get:function(){return[this._encryptionCheckKey]},enumerable:!1,configurable:!0}),n.prototype._getRawKey=function(t,e){return e===void 0&&(e=""),"".concat(t).concat(e)},n.prototype._generateShardPostfixArray=function(t){return t===void 0&&(t=1),Z([],G(Array(t).keys()),!1)},n.prototype._shardify=function(t){var e=this,r=t.key,i=t.value,s=JSON.stringify(this.encryption.encrypt(i)),o=Math.ceil(s.length/this.adjustedItemSizeLimit);return this._generateShardPostfixArray(o).map(function(a){var u={key:e._getRawKey(r,".".concat(a)),data:s.substring(a*e.adjustedItemSizeLimit,(a+1)*e.adjustedItemSizeLimit)};return a===0&&(u.metadata={shards:o}),u})},n.prototype._resetIfEncryptionChanged=function(){return f(this,void 0,void 0,function(){var t,e,r,i,s,o,a,u,c,l=this;return h(this,function(d){switch(d.label){case 0:return[4,this.get(this._encryptionCheckKey)];case 1:if(t=d.sent(),e={encrypted:tp.map(function(p){var _;return(_=l.encryption)===null||_===void 0?void 0:_.encrypt(p)})},!(t&&t.encrypted&&Array.isArray(t.encrypted)))return[3,6];for(s in r=t.encrypted,i=[],r)i.push(s);o=0,d.label=2;case 2:return o<i.length?(s=i[o])in r?(a=s,u=JSON.stringify(t.encrypted[a]),c=JSON.stringify(e.encrypted[a]),u===c?[3,4]:(Gt.warning("Encryption algorithm has changed. Stored data would be cleared."),[4,this.clear()])):[3,4]:[3,5];case 3:return d.sent(),[3,5];case 4:return o++,[3,2];case 5:return[3,8];case 6:return[4,this.clear()];case 7:d.sent(),d.label=8;case 8:return[4,this.set({key:this._encryptionCheckKey,value:e})];case 9:return d.sent(),[2]}})})},Object.defineProperty(n.prototype,"adjustedItemSizeLimit",{get:function(){return Math.max(this.itemSizeLimit-this.metadataBuffer,4)},enumerable:!1,configurable:!0}),n.prototype.usage=function(){return f(this,void 0,void 0,function(){var t,e,r,i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return t=0,[4,this._getAllRawKeys()];case 1:e=l.sent(),l.label=2;case 2:l.trys.push([2,7,8,9]),r=$(e),i=r.next(),l.label=3;case 3:return i.done?[3,6]:(s=i.value,[4,this._getRaw(s)]);case 4:(o=l.sent())&&(t+=JSON.stringify(o).length),l.label=5;case 5:return i=r.next(),[3,3];case 6:return[3,9];case 7:return a=l.sent(),u={error:a},[3,9];case 8:try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}return[7];case 9:return[2,t]}})})},n.prototype.getAllKeys=function(){return f(this,void 0,void 0,function(){var t=this;return h(this,function(e){switch(e.label){case 0:return[4,this._getAllRawKeys()];case 1:return[2,e.sent().filter(function(r){return r.endsWith(".0")}).map(function(r){return r.replace(/\.0$/,"")}).filter(function(r){return!t._reservedKeys.includes(r)})]}})})},n.prototype.get=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u=this;return h(this,function(c){switch(c.label){case 0:return e=this._getRawKey(t,".0"),[4,this._getRaw(e)];case 1:if(!(r=c.sent()))return[3,7];c.label=2;case 2:return c.trys.push([2,6,,7]),i=r.data,(s=r.metadata)!=null&&s.shards&&s.shards>1?[4,Promise.all(this._generateShardPostfixArray(s==null?void 0:s.shards).map(function(l){return f(u,void 0,void 0,function(){var d,p;return h(this,function(_){switch(_.label){case 0:return l>0?(d=this._getRawKey(t,".".concat(l)),[4,this._getRaw(d)]):[3,2];case 1:if(!(p=_.sent()))throw Q.storeBrokenIntegrity;return[2,p.data];case 2:return[2,i]}})})}))]:[3,4];case 3:return a=c.sent(),[3,5];case 4:a=[i],c.label=5;case 5:return o=a,[2,this.encryption.decrypt(JSON.parse(o.join("")))];case 6:return c.sent(),[2,null];case 7:return[2,null]}})})},n.prototype.set=function(t){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return e=this._shardify(t),[4,this._setRaw(e)];case 1:return r.sent(),[2,E({},t.value)]}})})},n.prototype.setMany=function(t){return f(this,void 0,void 0,function(){var e,r=this;return h(this,function(i){switch(i.label){case 0:return e=[],[4,this._setRaw(e.concat.apply(e,Z([],G(t.map(function(s){return r._shardify(s)})),!1)))];case 1:return i.sent(),[2,t.map(function(s){return s.value})]}})})},n.prototype.remove=function(t){return f(this,void 0,void 0,function(){var e,r,i,s=this;return h(this,function(o){switch(o.label){case 0:return e=this._getRawKey(t,".0"),[4,this._getRaw(e)];case 1:return(r=o.sent())?(i=r.metadata,[4,this._removeRaw(this._generateShardPostfixArray(i==null?void 0:i.shards).map(function(a){return s._getRawKey(t,".".concat(a))}))]):[3,3];case 2:return o.sent(),[2,!0];case 3:return[2,!1]}})})},n.prototype.removeMany=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c,l,d=this;return h(this,function(p){switch(p.label){case 0:e=[],r=function(_){var m,g,y;return h(this,function(b){switch(b.label){case 0:return m=i._getRawKey(_,".0"),[4,i._getRaw(m)];case 1:return(g=b.sent())&&(y=g.metadata,e.push.apply(e,Z([],G(i._generateShardPostfixArray(y==null?void 0:y.shards).map(function(T){return d._getRawKey(_,".".concat(T))})),!1))),[2]}})},i=this,p.label=1;case 1:p.trys.push([1,6,7,8]),s=$(t),o=s.next(),p.label=2;case 2:return o.done?[3,5]:(a=o.value,[5,r(a)]);case 3:p.sent(),p.label=4;case 4:return o=s.next(),[3,2];case 5:return[3,8];case 6:return u=p.sent(),c={error:u},[3,8];case 7:try{o&&!o.done&&(l=s.return)&&l.call(s)}finally{if(c)throw c.error}return[7];case 8:return e.length>0?[4,this._removeRaw(e)]:[3,10];case 9:p.sent(),p.label=10;case 10:return[2,t]}})})},n}(),Pe={},Mt=function(n){function t(e){e===void 0&&(e={});var r,i=this;i=n.call(this,E(E({},e),{itemSizeLimit:(r=e.itemSizeLimit)!==null&&r!==void 0?r:4194304}))||this;var s=e.delay,o=s===void 0?1:s;return i.delay=o,i.observer={},i}return v(t,n),Object.defineProperty(t.prototype,"rawData",{get:function(){return Pe[this.dbname]},set:function(e){Pe[this.dbname]=e},enumerable:!1,configurable:!0}),t.prototype._getAllRawKeys=function(){return f(this,void 0,void 0,function(){return h(this,function(e){if(Pe[this.dbname])return[2,Object.keys(Pe[this.dbname])];throw Q.storeNotAvailable})})},t.prototype._getRaw=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return Pe[this.dbname]?[4,Br(this.delay)]:[3,2];case 1:return r.sent(),[2,Pe[this.dbname][e]?E({key:e},Pe[this.dbname][e]):null];case 2:throw Q.storeNotAvailable}})})},t.prototype._setRaw=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l;return h(this,function(d){switch(d.label){case 0:return Pe[this.dbname]?[4,Br(this.delay)]:[3,2];case 1:d.sent();try{for(r=$(e),i=r.next();!i.done;i=r.next())s=i.value,o=s.key,a=s.data,u=s.metadata,Pe[this.dbname][o]=Object.freeze({data:a,metadata:u})}catch(p){c={error:p}}finally{try{i&&!i.done&&(l=r.return)&&l.call(r)}finally{if(c)throw c.error}}return[3,3];case 2:throw Q.storeNotAvailable;case 3:return[2]}})})},t.prototype._removeRaw=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return Pe[this.dbname]?[4,Br(this.delay)]:[3,2];case 1:u.sent();try{for(r=$(e),i=r.next();!i.done;i=r.next())s=i.value,Pe[this.dbname][s]&&delete Pe[this.dbname][s]}catch(c){o={error:c}}finally{try{i&&!i.done&&(a=r.return)&&a.call(r)}finally{if(o)throw o.error}}return[3,3];case 2:throw Q.storeNotAvailable;case 3:return[2]}})})},t.prototype.observe=function(e,r,i){var s=this;this.observer[e]||(this.observer[e]={}),r.forEach(function(o){return s.observer[e][o]=i})},t.prototype.checkAvailability=function(){return f(this,void 0,void 0,function(){return h(this,function(e){return[2]})})},t.prototype.init=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return this.dbname=e,Pe[this.dbname]||(Pe[this.dbname]={}),[4,this._resetIfEncryptionChanged()];case 1:return r.sent(),[2]}})})},t.prototype.set=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){if((r=this.observer[e.key])&&typeof r.set=="function"&&(i=r.set()))throw i;return[2,n.prototype.set.call(this,e)]})})},t.prototype.setMany=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c;return h(this,function(l){try{for(r=$(e),i=r.next();!i.done;i=r.next())if(s=i.value,(o=this.observer[s.key])&&typeof o.set=="function"&&(a=o.set()))throw a}catch(d){u={error:d}}finally{try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}}return[2,n.prototype.setMany.call(this,e)]})})},t.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,Br(this.delay)];case 1:return e.sent(),Pe[this.dbname]={},[2]}})})},t}(Ii),Fa="NestDBStore";(function(n){n[n.UNINITIALIZED=0]="UNINITIALIZED",n[n.OPENING=1]="OPENING",n[n.OPEN=2]="OPEN",n[n.CLOSED=3]="CLOSED"})(ot||(ot={}));var np=function(n){function t(e){e===void 0&&(e={});var r,i=this;return(i=n.call(this,E(E({},e),{itemSizeLimit:(r=e.itemSizeLimit)!==null&&r!==void 0?r:104857600}))||this)._storeName=Fa,i._state=ot.UNINITIALIZED,i._openJobQueue=[],i._window=typeof window<"u"?window:void 0,i._indexedDb=i._window?i._window.indexedDB||i._window.mozIndexedDB||i._window.webkitIndexedDB||i._window.msIndexedDB:void 0,i}return v(t,n),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isTransactionReusable",{get:function(){var e=navigator==null?void 0:navigator.userAgent;if(e){var r="15.0.0";if(e.includes("Safari/")?r=e.split("Safari/")[0].trim().split("Version/")[1]:e.includes("AppleWebKit/")&&(r=e.split("AppleWebKit/")[0].trim().split("Version/")[1]),(r?parseInt(r.split(".")[0]):0)<=14)return!1}return!0},enumerable:!1,configurable:!0}),t.prototype._putToObjectStore=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){return[2,new Promise(function(s,o){var a=e.put(r);a.addEventListener("success",function(u){s(u.target.result)}),a.addEventListener("error",function(){o("Failed to write.")})})]})})},t.prototype._deleteFromObjectStore=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){return[2,new Promise(function(s,o){var a=e.delete(r);a.addEventListener("success",function(){return s(r)}),a.addEventListener("error",function(u){return o(u.target.error)})})]})})},t.prototype._openDatabase=function(e){var r=this;return new Promise(function(i,s){if(r._indexedDb){r._state=ot.OPENING;var o=r._indexedDb.open(e);o.addEventListener("upgradeneeded",function(a){a.target.result.createObjectStore(Fa,{keyPath:"key"})}),o.addEventListener("success",function(a){r._state=ot.OPEN,r._database=a.target.result,r._openJobQueue.forEach(function(u){return u()}),r._openJobQueue=[],r._database.onclose=function(){r._database=void 0,r._state=ot.OPENING,setTimeout(function(){r._openDatabase(e)},5)},i(r._database)}),o.addEventListener("error",function(a){r._state=ot.UNINITIALIZED,s(a.target.error)})}else s(Q.storeNotAvailable)})},t.prototype._getObjectStore=function(e){return f(this,void 0,void 0,function(){var r=this;return h(this,function(i){switch(i.label){case 0:return this._database?[2,this._database.transaction(this._storeName,e).objectStore(this._storeName)]:[3,1];case 1:switch(this._state){case ot.UNINITIALIZED:case ot.OPEN:return[3,2];case ot.OPENING:case ot.CLOSED:return[3,3]}return[3,4];case 2:throw Q.storeNotInitialized;case 3:return[2,new Promise(function(s){r._openJobQueue.push(function(){return s(r._getObjectStore(e))})})];case 4:return[4,this._getObjectStore(e)];case 5:return[2,i.sent()]}})})},t.prototype._getAllRawKeys=function(){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return[4,this._getObjectStore("readonly")];case 1:return e=r.sent(),[4,new Promise(function(i,s){var o=e.getAllKeys();o.addEventListener("success",function(a){i(a.target.result)}),o.addEventListener("error",function(a){return s(a.target.error)})})];case 2:return[2,r.sent()]}})})},t.prototype._getRaw=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return[4,this._getObjectStore("readonly")];case 1:return r=i.sent(),[4,new Promise(function(s,o){var a=r.get(e);a.addEventListener("success",function(u){var c;s((c=u==null?void 0:u.target)===null||c===void 0?void 0:c.result)}),a.addEventListener("error",function(u){return o(u.target.error)})})];case 2:return[2,i.sent()]}})})},t.prototype._setRaw=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l=this;return h(this,function(d){switch(d.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:return r=d.sent(),this.isTransactionReusable?[4,Promise.all(e.map(function(p){return l._putToObjectStore(r,p)}))]:[3,3];case 2:return d.sent(),[3,10];case 3:d.trys.push([3,8,9,10]),i=$(e),s=i.next(),d.label=4;case 4:return s.done?[3,7]:(o=s.value,[4,this._putToObjectStore(r,o)]);case 5:d.sent(),d.label=6;case 6:return s=i.next(),[3,4];case 7:return[3,10];case 8:return a=d.sent(),u={error:a},[3,10];case 9:try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}return[7];case 10:return[2]}})})},t.prototype._removeRaw=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l=this;return h(this,function(d){switch(d.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:return r=d.sent(),this.isTransactionReusable?[4,Promise.all(e.map(function(p){return l._deleteFromObjectStore(r,p)}))]:[3,3];case 2:return d.sent(),[3,10];case 3:d.trys.push([3,8,9,10]),i=$(e),s=i.next(),d.label=4;case 4:return s.done?[3,7]:(o=s.value,[4,this._deleteFromObjectStore(r,o)]);case 5:d.sent(),d.label=6;case 6:return s=i.next(),[3,4];case 7:return[3,10];case 8:return a=d.sent(),u={error:a},[3,10];case 9:try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}return[7];case 10:return[2]}})})},t.prototype._triggerDatabaseClose=function(){this._database&&this._database.onclose&&this._database.onclose(new Event("dummy"))},t.prototype.checkAvailability=function(){return f(this,void 0,void 0,function(){var e,r=this;return h(this,function(i){switch(i.label){case 0:if(!((e=typeof window<"u"?window:null)!=null&&e.indexedDB||e!=null&&e.mozIndexedDB||e!=null&&e.webkitIndexedDB||e!=null&&e.msIndexedDB))return[3,6];if(this._indexedDb=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,!this._window||!fi())return[3,4];if(!(fi()&&navigator.userAgent&&navigator.userAgent.includes("Edge/")))return[3,1];if(!this._window.indexedDB&&(e.PointerEvent||e.MSPointerEvent))throw Q.storeNotAvailableInPrivateBrowsing;return[3,3];case 1:return[4,new Promise(function(s,o){if(r._indexedDb)try{var a=r._indexedDb.open("_testMozilla");a.onerror=function(){return o(Q.storeNotAvailableInPrivateBrowsing)},a.onsuccess=function(u){if(u.target.result.close(),r._indexedDb){var c=r._indexedDb.deleteDatabase("_testMozilla");c.onerror=function(){return s()},c.onsuccess=function(){return s()}}else o(Q.storeNotAvailable)}}catch{o(Q.storeNotAvailableInPrivateBrowsing)}else o(Q.storeNotAvailable)})];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:throw Q.storeNotAvailable;case 5:return[3,7];case 6:throw Q.storeNotAvailable;case 7:return[2]}})})},t.prototype.init=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return this.dbname=e,[4,this.checkAvailability()];case 1:return r.sent(),[4,this._openDatabase(e)];case 2:return r.sent(),[4,this._resetIfEncryptionChanged()];case 3:return r.sent(),[2]}})})},t.prototype.clear=function(){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:return e=r.sent(),[4,new Promise(function(i,s){var o=e.clear();o.addEventListener("success",function(){return i()}),o.addEventListener("error",function(a){return s(a.target.error)})})];case 2:return[2,r.sent()]}})})},t}(Ii),rp=function(n){function t(e){var r=this,i=e.AsyncStorage,s=e.itemSizeLimit,o=s===void 0?6291456:s,a=Pc(e,["AsyncStorage","itemSizeLimit"]);return(r=n.call(this,E(E({},a),{itemSizeLimit:o}))||this)._asyncStorage=i,r}return v(t,n),t.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},t.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},t.prototype._getAllRawKeys=function(){return f(this,void 0,void 0,function(){var e,r=this;return h(this,function(i){switch(i.label){case 0:return[4,this._asyncStorage.getAllKeys()];case 1:return e=i.sent(),[2,e.filter(function(s){return r._isBelonging(s)}).map(function(s){return s.substring("".concat(r.dbname,"/").length)})]}})})},t.prototype._getRaw=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return[4,this._asyncStorage.getItem(this._getActualKey(e))];case 1:return[2,(r=i.sent())?JSON.parse(r):null]}})})},t.prototype._setRaw=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:r=[];try{for(i=$(e),s=i.next();!s.done;s=i.next())o=s.value,a=o.key,o.data.length<=this.adjustedItemSizeLimit&&r.push([this._getActualKey(a),JSON.stringify(o)])}catch(d){u={error:d}}finally{try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}}return[4,this._asyncStorage.multiSet(r)];case 1:return l.sent(),[2]}})})},t.prototype._removeRaw=function(e){return f(this,void 0,void 0,function(){var r=this;return h(this,function(i){switch(i.label){case 0:return[4,this._asyncStorage.multiRemove(e.map(function(s){return r._getActualKey(s)}))];case 1:return i.sent(),[2]}})})},t.prototype.checkAvailability=function(){return f(this,void 0,void 0,function(){return h(this,function(e){if(!this._asyncStorage)throw Q.storeNotAvailable;return[2]})})},t.prototype.init=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return this.dbname=e,[4,this._resetIfEncryptionChanged()];case 1:return r.sent(),[2]}})})},t.prototype.clear=function(){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return[4,this.getAllKeys()];case 1:return e=r.sent(),[4,this.removeMany(e)];case 2:return r.sent(),[2]}})})},t}(Ii);(function(n){function t(e){var r,i=this;return(i=n.call(this,E(E({},e),{itemSizeLimit:(r=e.itemSizeLimit)!==null&&r!==void 0?r:6291456}))||this)._mmkv=e.MMKV,i}v(t,n),t.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},t.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},t.prototype._getAllRawKeys=function(){return f(this,void 0,void 0,function(){var e,r=this;return h(this,function(i){switch(i.label){case 0:return[4,this._mmkv.getAllKeys()];case 1:return e=i.sent(),[2,e.filter(function(s){return r._isBelonging(s)}).map(function(s){return s.substring("".concat(r.dbname,"/").length)})]}})})},t.prototype._getRaw=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return[4,this._mmkv.getString(this._getActualKey(e))];case 1:return[2,(r=i.sent())?JSON.parse(r):null]}})})},t.prototype._setRaw=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){try{for(r=$(e),i=r.next();!i.done;i=r.next())s=i.value,o=s.key,s.data.length<=this.adjustedItemSizeLimit&&this._mmkv.set(this._getActualKey(o),JSON.stringify(s))}catch(l){a={error:l}}finally{try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(a)throw a.error}}return[2]})})},t.prototype._removeRaw=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a;return h(this,function(u){try{for(r=$(e),i=r.next();!i.done;i=r.next())s=i.value,this._mmkv.delete(this._getActualKey(s))}catch(c){o={error:c}}finally{try{i&&!i.done&&(a=r.return)&&a.call(r)}finally{if(o)throw o.error}}return[2]})})},t.prototype.checkAvailability=function(){return f(this,void 0,void 0,function(){return h(this,function(e){if(!this._mmkv)throw Q.storeNotAvailable;return[2]})})},t.prototype.init=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return this.dbname=e,[4,this._resetIfEncryptionChanged()];case 1:return r.sent(),[2]}})})},t.prototype.clear=function(){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return[4,this.getAllKeys()];case 1:return e=r.sent(),[4,this.removeMany(e)];case 2:return r.sent(),[2]}})})}})(Ii);var Tt;(function(n){n.INIT="INIT",n.OPENING="OPENING",n.OPENED="OPENED",n.CLOSED="CLOSED"})(Tt||(Tt={}));var be,ip=function(){function n(t){var e=t.name,r=t.version,i=t.store,s=t.config;this.name=e,this._version=r,this._state=Tt.INIT,this._config=s||new br({dbname:e}),this._store=i,this._event={success:Gn,error:Gn,storeReplaced:Gn,upgrade:Ma},this._collections=new Map,this._globalMutex=new ao("".concat(this.name,".lock")),this._config.disableLogger&&Gt.off(),new nt({dbname:e,limit:this._config.cacheLimit})}return Object.defineProperty(n.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"store",{get:function(){return this._store},enumerable:!1,configurable:!0}),n.prototype.estimateUsage=function(){return f(this,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:return[4,(e=this._store,f(void 0,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return[4,e.usage()];case 1:return[2,r.sent()]}})}))];case 1:return[2,t.sent()]}var e})})},n.prototype.commitSchema=function(t){return f(this,void 0,void 0,function(){var e=this;return h(this,function(r){switch(r.label){case 0:return this._state!==Tt.OPENING?[3,2]:[4,Promise.all(t.map(function(i){return f(e,void 0,void 0,function(){var s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return s=i.collectionName,o=i.keyName,a=i.index,u=a===void 0?[]:a,this._collections.has(s)||this._collections.set(s,new fs({dbname:this.name,collectionName:s,keyName:o,indexes:u,store:this._store})),(c=this._collections.get(s))?[4,c.init()]:[3,2];case 1:l.sent(),l.label=2;case 2:return[2]}})})}))];case 1:return r.sent(),[3,3];case 2:throw Q.databaseSchemaNotOnUpgrade;case 3:return[2]}})})},n.prototype.open=function(){var t;return f(this,void 0,void 0,function(){var e,r,i,s,o=this;return h(this,function(a){switch(a.label){case 0:return[4,this._globalMutex.lock()];case 1:if(a.sent(),this._state===Tt.OPENED)return[3,12];this._state=Tt.OPENING,a.label=2;case 2:return a.trys.push([2,5,,12]),[4,this._store.init(this.name)];case 3:return a.sent(),u=this.name,e="".concat(js(u),".metadata"),r={version:0,collectionNames:[]},[4,this._store.get(e)];case 4:return i=(t=a.sent())!==null&&t!==void 0?t:r,[2,new Promise(function(c,l){var d=function(_){i.version<o._version?o._event.upgrade(i.version,function(m){return f(o,void 0,void 0,function(){var g;return h(this,function(y){switch(y.label){case 0:if(m)return[3,5];i.version++,i.collectionNames=Array.from(this._collections.keys()),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,this._store.set({key:e,value:i})];case 2:return y.sent(),_({continued:!0}),[3,4];case 3:return g=y.sent(),_({continued:!1,err:g}),[3,4];case 4:return[3,6];case 5:_({continued:!1,err:m}),y.label=6;case 6:return[2]}})})}):_({continued:!1})},p=function(_){var m=_.continued,g=m!==void 0&&m,y=_.err,b=y===void 0?null:y;if(g)setTimeout(function(){return d(p)},10);else if(b)Gt.error(b.message),o._globalMutex.unlock(),o._event.error(b),l(b);else{var T=[];i.collectionNames.forEach(function(C){var N=o._collections.get(C);N&&N.state===en.READY||T.push(f(o,void 0,void 0,function(){var P,A;return h(this,function(F){switch(F.label){case 0:return[4,fs.metadataOf(this.name,C,this._store)];case 1:return(P=F.sent())?(A=new fs({dbname:this.name,collectionName:C,keyName:P.keyName,indexes:P.indexes,store:this._store}),this._collections.set(C,A),[4,A.init()]):[3,3];case 2:F.sent(),F.label=3;case 3:return[2]}})}))}),Promise.all(T).then(function(){o._state=Tt.OPENED,o._globalMutex.unlock(),o._event.success(),c()}).catch(function(C){Gt.error(C.message),o._globalMutex.unlock(),o._event.error(C),l(C)})}};d(p)})];case 5:switch(s=a.sent(),s.code){case ae.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return[3,6];case ae.STORE_NOT_AVAILABLE:return[3,8]}return[3,10];case 6:return Gt.warning("Access to the local storage is not allowed. Switched to MemoryStore automatically."),this._store=new Mt({}),this._globalMutex.unlock(),this._event.error(s),this._event.storeReplaced(this._store),[4,this.open()];case 7:return a.sent(),[3,11];case 8:return Gt.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new Mt({}),this._globalMutex.unlock(),this._event.error(s),this._event.storeReplaced(this._store),[4,this.open()];case 9:return a.sent(),[3,11];case 10:throw Gt.error(s.message),this._globalMutex.unlock(),this._event.error(s),s;case 11:return[3,12];case 12:return[2]}var u})})},n.prototype.close=function(){this._collections.forEach(function(t){return t.close()}),this._state=Tt.CLOSED},n.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:return[4,Promise.all(Array.from(this._collections.values()).map(function(e){return e.clear()}))];case 1:return t.sent(),[2]}})})},n.prototype.reset=function(){return f(this,void 0,void 0,function(){var t,e=this;return h(this,function(r){switch(r.label){case 0:return this.close(),(t=nt.get(this.name))&&t.clearByCondition(function(i){return i.key.startsWith(js(e.name))}),[4,this._store.clear()];case 1:return r.sent(),[2]}})})},n.prototype.on=function(t,e){this._event[t]=e},n.prototype.off=function(t){typeof this._event[t]=="function"&&(t==="upgrade"?this._event[t]=Ma:this._event[t]=Gn)},n.prototype.collection=function(t){var e=this._collections.get(t);if(e)return e;throw Q.collectionNotReady},n}(),kn=function(){function n(t){var e,r,i,s;this.messageTypeFilter=(e=t==null?void 0:t.messageTypeFilter)!==null&&e!==void 0?e:We.ALL,this.customTypesFilter=(r=t==null?void 0:t.customTypesFilter)!==null&&r!==void 0?r:null,this.senderUserIdsFilter=(i=t==null?void 0:t.senderUserIdsFilter)!==null&&i!==void 0?i:null,this.replyType=(s=t==null?void 0:t.replyType)!==null&&s!==void 0?s:Be.NONE}return n.prototype.clone=function(){var t=new n,e=JSON.parse(JSON.stringify(this));return Object.keys(e).forEach(function(r){t[r]=e[r]}),t},n.prototype.match=function(t){switch(this.messageTypeFilter){case We.USER:if(t.messageType!==fe.USER)return!1;break;case We.FILE:if(t.messageType!==fe.FILE)return!1;break;case We.ADMIN:if(t.messageType!==fe.ADMIN)return!1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes("*")&&!this.customTypesFilter.includes(t.customType)||this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0&&(!(t instanceof St)||!this.senderUserIdsFilter.includes(t.sender.userId)))return!1;if(t instanceof Ve)switch(this.replyType){case Be.NONE:if(t.parentMessageId>0)return!1;break;case Be.ONLY_REPLY_TO_CHANNEL:if(t instanceof St&&t.parentMessageId>0&&!t.replyToChannel)return!1}return!0},n}();(function(n){n.CHANNEL_LATEST="channel_latest",n.NEWEST_CHILD_MESSAGE="newest_child_message"})(be||(be={}));var ur,_t=function(n){switch(n){case be.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case be.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}},sp=function(){return["channelUrl","-createdAt","-notificationId"]};E(E({},ec),{scheduledAt:void 0});E(E({},wi),{scheduledAt:0,file:void 0,fileUrl:void 0,fileName:void 0,mimeType:void 0,fileSize:void 0,thumbnailSizes:void 0,requireAuth:!1});var oc="UnsentMessage",op="reqId",Vr={},wr=function(n){function t(e){var r=n.call(this,e)||this;return r._mutex=new ao("unsendmessagecache.lock"),Vr[e]=r,r}return v(t,n),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return S.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),t.of=function(e,r){return r===void 0&&(r=!1),Vr[e]&&!r||(Vr[e]=new t(e)),Vr[e]},Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb,r=e==null?void 0:e.collection(oc);if(!r)throw I.databaseError;return r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e){if(e.messageId>0)throw I.invalidParameters;var r,i=E({},e.serialize());return e instanceof Fe?(e.messageParams&&(i.messageParams=ma(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(i.scheduledInfo.scheduledMessageParams=(r=e.scheduledInfo.scheduledMessageParams,E(E({},ma(r)),{scheduledAt:r.scheduledAt})))):e instanceof ge?(e.messageParams&&(i.messageParams=ya(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(i.scheduledInfo.scheduledMessageParams=function(s){return E(E({},ya(s)),{scheduledAt:s.scheduledAt})}(e.scheduledInfo.scheduledMessageParams))):e instanceof rt&&e.messageParams&&(i.messageParams=function(s){return x({fileInfoList:s.fileInfoList,isReplyToChannel:s.isReplyToChannel,pushNotificationDeliveryOption:s.pushNotificationDeliveryOption})}(e.messageParams)),i},t.prototype._deserialize=function(e){return e=E(E({},e),{messageId:parseInt(e.messageId)}),Ie.of(this._iid).buildMessageFromSerializedData(e)},t.prototype._deserializeWithMessageCreateParams=function(e){var r,i,s;return f(this,void 0,void 0,function(){var o,a,u,c,l,d,p=this;return h(this,function(_){switch(_.label){case 0:return o=Ie.of(this._iid),a=this._deserialize(e),e.messageParams?a instanceof Fe?(c=e.messageParams,a.messageParams=o.buildUserMessageCreateParamsFromSerializedData(c,a),[3,6]):[3,1]:[3,6];case 1:return a instanceof ge?(c=e.messageParams).fileKey&&typeof c.fileKey=="string"&&us((r=c.fileType)!==null&&r!==void 0?r:"")?(u=c,[4,this.collection.getBlob(c.fileKey)]):[3,3]:[3,4];case 2:u.file=(i=_.sent())!==null&&i!==void 0?i:void 0,_.label=3;case 3:return a.messageParams=o.buildFileMessageCreateParamsFromSerializedData(c,a),[3,6];case 4:return a instanceof rt&&(c=e.messageParams)&&c.fileInfoList?(a.messageParams=o.buildMultipleFilesMessageCreateParamsFromSerializedData(c,a),[4,Promise.all(a.messageParams.fileInfoList.map(function(m){return f(p,void 0,void 0,function(){var g,y,b,T,C;return h(this,function(N){switch(N.label){case 0:return typeof((y=m._uploadedMetaData)===null||y===void 0?void 0:y.fileKey)=="string"&&us((T=(b=m._uploadedMetaData)===null||b===void 0?void 0:b.fileType)!==null&&T!==void 0?T:"")?(g=m,[4,this.collection.getBlob(m._uploadedMetaData.fileKey)]):[3,2];case 1:g.file=(C=N.sent())!==null&&C!==void 0?C:void 0,N.label=2;case 2:return[2]}})})}))]):[3,6];case 5:_.sent(),_.label=6;case 6:return a.scheduledInfo&&e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams?a instanceof Fe?(l=e.scheduledInfo.scheduledMessageParams,a.scheduledInfo.scheduledMessageParams=o.buildScheduledUserMessageCreateParamsFromSerializedData(l,a),[3,10]):[3,7]:[3,10];case 7:return a instanceof ge?(l=e.scheduledInfo.scheduledMessageParams).fileKey&&typeof l.fileKey=="string"&&typeof l.fileType=="string"&&us(l.fileType)?(d=l,[4,this.collection.getBlob(l.fileKey)]):[3,9]:[3,10];case 8:d.file=(s=_.sent())!==null&&s!==void 0?s:void 0,_.label=9;case 9:a.scheduledInfo.scheduledMessageParams=o.buildScheduledFileMessageCreateParamsFromSerializedData(l,a),_.label=10;case 10:return[2,a]}})})},t.prototype._getFileInfoBlobKey=function(e,r){return"".concat(e,".").concat(r)},t.prototype.get=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(r=i.sent())return[2,this._deserializeWithMessageCreateParams(r)];i.label=2;case 2:return[2,void 0]}})})},t.prototype.fetch=function(e){var r=e.channelUrl,i=e.filter,s=i===void 0?new kn:i,o=e.order,a=o===void 0?be.CHANNEL_LATEST:o,u=e.sendingStatus,c=e.backward,l=c!==void 0&&c,d=e.parentMessageId;return f(this,void 0,void 0,function(){var p,_,m,g,y=this;return h(this,function(b){switch(b.label){case 0:return this.localCacheEnabled?(p=_t(a),_={"/where":function(T){return!!(a!==be.NEWEST_CHILD_MESSAGE||d&&T.parentMessageId!==0&&T.parentMessageId===d)&&s.match(y._deserialize(T))}},r&&(_.channelUrl=r),u&&(_.sendingStatus=u),m={where:_,index:p,backward:l},[4,this.collection.query(m)]):[3,3];case 1:return[4,b.sent().fetch({})];case 2:return g=b.sent(),[2,Promise.all(g.map(function(T){return f(y,void 0,void 0,function(){return h(this,function(C){switch(C.label){case 0:return[4,this._deserializeWithMessageCreateParams(T)];case 1:return[2,C.sent()]}})})}))];case 3:return[2,[]]}})})},t.prototype.getAllChildMessages=function(e,r){return r===void 0&&(r=new kn),f(this,void 0,void 0,function(){return h(this,function(i){switch(i.label){case 0:return[4,this.fetch({filter:r,order:be.NEWEST_CHILD_MESSAGE,channelUrl:e.channelUrl,backward:!1,parentMessageId:e.messageId})];case 1:return[2,i.sent()]}})})},t.prototype.upsert=function(e){return f(this,void 0,void 0,function(){var r=this;return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map(function(s){return f(r,void 0,void 0,function(){var o;return h(this,function(a){switch(a.label){case 0:return s instanceof ge||s instanceof rt?[4,this._mutex.lock()]:[3,4];case 1:return a.sent(),[4,this.saveBlob(s)];case 2:return a.sent(),[4,this._mutex.unlock()];case 3:a.sent(),a.label=4;case 4:return o=this._serialize(s),[4,this.collection.upsertOne(o)];case 5:return a.sent(),[2]}})})}))]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.upsertChildMessages=function(e){return f(this,void 0,void 0,function(){var r=this;return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map(function(s){return f(r,void 0,void 0,function(){var o;return h(this,function(a){switch(a.label){case 0:return o=[],s.threadInfo&&s.threadInfo.replyCount>0?[4,this.getAllChildMessages(s)]:[3,2];case 1:o=a.sent(),a.label=2;case 2:return o.length>0?(o.forEach(function(u){return u.applyParentMessage(s)}),[4,this.upsert(o)]):[3,4];case 3:a.sent(),a.label=4;case 4:return[2]}})})}))]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.remove=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:if(!this.localCacheEnabled)return[3,8];c.label=1;case 1:c.trys.push([1,6,7,8]),r=$(e),i=r.next(),c.label=2;case 2:return i.done?[3,5]:(s=i.value,[4,this.collection.remove(s)]);case 3:c.sent(),c.label=4;case 4:return i=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),a={error:o},[3,8];case 7:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},t.prototype.removeMessagesOfChannel=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e}})]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.saveBlob=function(e){return f(this,void 0,void 0,function(){var r,i,s,o=this;return h(this,function(a){switch(a.label){case 0:return e instanceof ge?e.messageParams&&(s=e.messageParams).file&&Jr(s.file)?[4,this.collection.saveBlob(s.file,e.reqId)]:[3,2]:[3,5];case 1:i=a.sent(),s.fileKey=i,s.fileType=tn.BLOB,a.label=2;case 2:return e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(r=e.scheduledInfo.scheduledMessageParams).file&&Jr(r.file)?[4,this.collection.saveBlob(r.file,e.reqId)]:[3,4];case 3:i=a.sent(),r.fileKey=i,r.fileType=tn.BLOB,a.label=4;case 4:return[3,7];case 5:return e instanceof rt&&(s=e.messageParams)&&s.fileInfoList&&Array.isArray(s.fileInfoList)?[4,Promise.all(s.fileInfoList.map(function(u,c){return f(o,void 0,void 0,function(){var l;return h(this,function(d){switch(d.label){case 0:return u.file&&Jr(u.file)?[4,this.collection.saveBlob(u.file,this._getFileInfoBlobKey(e.reqId,c))]:[3,2];case 1:l=d.sent(),u._uploadedMetaData||(u._uploadedMetaData={}),u._uploadedMetaData.fileKey=l,u._uploadedMetaData.fileType=tn.BLOB,d.label=2;case 2:return[2]}})})}))]:[3,7];case 6:a.sent(),a.label=7;case 7:return[2]}})})},t}(Me),Kr={},uo=function(n){function t(e){var r=n.call(this,e)||this;return Kr[e]=r,r}return v(t,n),Object.defineProperty(t.prototype,"_sdkState",{get:function(){return S.of(this._iid).sdkState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return S.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_unsentMessageCache",{get:function(){return wr.of(this._iid)},enumerable:!1,configurable:!0}),t.of=function(e,r){return r===void 0&&(r=!1),Kr[e]&&!r||(Kr[e]=new t(e)),Kr[e]},Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return R(!!e).throw(I.databaseError),e.collection($s)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e){return E(E({},e.serialize()),{messageId:"".concat(e.messageId)})},t.prototype._deserialize=function(e){return e=E(E({},e),{messageId:parseInt(e.messageId)}),Ie.of(this._iid).buildMessageFromSerializedData(e)},t.prototype.get=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(r=i.sent())return[2,this._deserialize(r)];i.label=2;case 2:return[2,void 0]}})})},t.prototype.fetch=function(e){var r=e.channelUrl,i=e.token,s=e.limit,o=s===void 0?100:s,a=e.filter,u=a===void 0?new kn:a,c=e.order,l=c===void 0?be.CHANNEL_LATEST:c,d=e.backward,p=d!==void 0&&d,_=e.parentMessageId,m=e.isPollOnly,g=m!==void 0&&m,y=e.exactMatch,b=y!==void 0&&y,T=e.inclusive,C=T===void 0||T;return f(this,void 0,void 0,function(){var N,P,A,F=this;return h(this,function(z){switch(z.label){case 0:return this.localCacheEnabled?(N=_t(l),P={where:{channelUrl:r,"/where":function(L){if(i)switch(l){case be.CHANNEL_LATEST:if(b&&L.createdAt!==i)return!1;if(p){if(C&&L.createdAt<i||!C&&L.createdAt<=i)return!1}else if(C&&L.createdAt>i||!C&&L.createdAt>=i)return!1;break;case be.NEWEST_CHILD_MESSAGE:if(!_||L.parentMessageId===0||L.parentMessageId!==_)return!1}return!(g&&!L._poll)&&u.match(F._deserialize(L))}},index:N,backward:p},[4,this.collection.query(P)]):[3,3];case 1:return[4,z.sent().fetch({limit:o??void 0})];case 2:return A=z.sent(),[2,Promise.all(A.map(function(L){return f(F,void 0,void 0,function(){return h(this,function(M){return[2,this._deserialize(L)]})})}))];case 3:return[2,[]]}})})},t.prototype.getAllChildMessages=function(e,r){return r===void 0&&(r=new kn),f(this,void 0,void 0,function(){return h(this,function(i){switch(i.label){case 0:return[4,this.fetch({channelUrl:e.channelUrl,token:Date.now(),limit:null,backward:!1,filter:r,order:be.NEWEST_CHILD_MESSAGE,parentMessageId:e.messageId})];case 1:return[2,i.sent()]}})})},t.prototype.upsert=function(e){return f(this,void 0,void 0,function(){var r,i=this;return h(this,function(s){switch(s.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,5];case 1:return s.sent(),r=e.map(function(o){return i._serialize(o)}),[4,this.collection.upsertMany(r)];case 2:return s.sent(),[4,this.upsertChildMessages(e)];case 3:return s.sent(),[4,this._unsentMessageCache.upsertChildMessages(e)];case 4:s.sent(),s.label=5;case 5:return[2]}})})},t.prototype.upsertChildMessages=function(e){return f(this,void 0,void 0,function(){var r=this;return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map(function(s){return f(r,void 0,void 0,function(){var o,a;return h(this,function(u){switch(u.label){case 0:return o=[],!((a=s.threadInfo)===null||a===void 0)&&a.replyCount&&s.threadInfo.replyCount>0?[4,this.getAllChildMessages(s)]:[3,2];case 1:o=u.sent(),u.label=2;case 2:return o.length>0?(o.forEach(function(c){return c.applyParentMessage(s)}),[4,this.upsert(o)]):[3,4];case 3:u.sent(),u.label=4;case 4:return[2]}})})}))]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.remove=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:if(!this.localCacheEnabled)return[3,8];c.label=1;case 1:c.trys.push([1,6,7,8]),r=$(e),i=r.next(),c.label=2;case 2:return i.done?[3,5]:(s=i.value,[4,this.collection.remove("".concat(s))]);case 3:c.sent(),c.label=4;case 4:return i=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),a={error:o},[3,8];case 7:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},t.prototype.removeMessagesOfChannel=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:_t(be.CHANNEL_LATEST)})]:[3,6];case 1:return i.sent(),[4,(r=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 2:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 3:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 4:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 5:i.sent(),i.label=6;case 6:return[2]}})})},t.prototype.removeUnderOffset=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":r}},index:_t(be.CHANNEL_LATEST)})]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.countBetween=function(e,r,i){return f(this,void 0,void 0,function(){var s,o=this;return h(this,function(a){switch(a.label){case 0:return this.localCacheEnabled?(s=_t(be.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:e,"/where":function(u){var c=o._deserialize(u);return i.includes(c.createdAt)&&r.match(c)}},index:s}).count()]):[3,2];case 1:return[2,a.sent()];case 2:return[2,0]}})})},t.prototype.saveBlobs=function(e){return f(this,void 0,void 0,function(){var r=this;return h(this,function(i){switch(i.label){case 0:return[4,Promise.all(e.map(function(s){return f(r,void 0,void 0,function(){var o,a;return h(this,function(u){switch(u.label){case 0:return s instanceof ge&&s.messageParams&&(o=s.messageParams).file&&Jr(o.file)?[4,this.collection.saveBlob(o.file,s.reqId)]:[3,2];case 1:a=u.sent(),o.fileKey=a,u.label=2;case 2:return[2]}})})}))];case 1:return i.sent(),[2]}})})},t.prototype._getGroupChannelPreferenceSize=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return r=0,[4,(i=this._cacheContext.preference).get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 1:return s=c.sent(),[4,i.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 2:return o=c.sent(),[4,i.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 3:return a=c.sent(),[4,i.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 4:return u=c.sent(),s&&(r+=JSON.stringify(s).length),o&&(r+=JSON.stringify(o).length),a&&(r+=JSON.stringify(a).length),u&&(r+=JSON.stringify(u).length),[2,r]}})})},t}(Me),Qr={},ap=function(n){function t(e){var r=n.call(this,e)||this;return Qr[e]=r,r}return v(t,n),Object.defineProperty(t.prototype,"_sdkState",{get:function(){return S.of(this._iid).sdkState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return S.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),t.of=function(e,r){return r===void 0&&(r=!1),Qr[e]&&!r||(Qr[e]=new t(e)),Qr[e]},Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return R(!!e).throw(I.databaseError),e.collection(sc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e){return E({},e.serialize())},t.prototype._deserialize=function(e){return Ie.of(this._iid).buildMessageFromSerializedData(e)},t.prototype.get=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(r=i.sent())return[2,this._deserialize(r)];i.label=2;case 2:return[2,void 0]}})})},t.prototype.fetch=function(e){var r=e.channelUrl,i=e.token,s=e.limit,o=s===void 0?100:s,a=e.filter,u=a===void 0?new kn:a,c=e.backward,l=c!==void 0&&c,d=e.exactMatch,p=d!==void 0&&d,_=e.inclusive,m=_===void 0||_;return f(this,void 0,void 0,function(){var g,y=this;return h(this,function(b){switch(b.label){case 0:return this.localCacheEnabled?(g={where:{channelUrl:r,"/where":function(T){if(i){if(p&&T.createdAt!==i)return!1;if(l){if(m&&T.createdAt<i||!m&&T.createdAt<=i)return!1}else if(m&&T.createdAt>i||!m&&T.createdAt>=i)return!1}return u.match(y._deserialize(T))}},index:["channelUrl","-createdAt","-notificationId"],backward:l},[4,this.collection.query(g)]):[3,3];case 1:return[4,b.sent().fetch({limit:o??void 0})];case 2:return[2,b.sent().map(function(T){return y._deserialize(T)})];case 3:return[2,[]]}})})},t.prototype.upsert=function(e){return f(this,void 0,void 0,function(){var r,i=this;return h(this,function(s){switch(s.label){case 0:return this.localCacheEnabled?(r=e.map(function(o){return i._serialize(o)}),[4,this.collection.upsertMany(r)]):[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})},t.prototype.remove=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:if(!this.localCacheEnabled)return[3,8];c.label=1;case 1:c.trys.push([1,6,7,8]),r=$(e),i=r.next(),c.label=2;case 2:return i.done?[3,5]:(s=i.value,[4,this.collection.remove(s)]);case 3:c.sent(),c.label=4;case 4:return i=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),a={error:o},[3,8];case 7:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},t.prototype.markAsReadByTimestamp=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.updateIf({where:{channelUrl:e,messageStatus:Jt.SENT,createdAt:{"<":r}}},{set:{messageStatus:Jt.READ}})]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.markAsReadByMessageIds=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.updateIf({where:{channelUrl:e,notificationId:{"/in":r},messageStatus:Jt.SENT}},{set:{messageStatus:Jt.READ}})]:[3,2];case 1:return[2,i.sent().length];case 2:return[2,0]}})})},t.prototype.removeMessagesOfChannel=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:["channelUrl","-createdAt","-notificationId"]})]:[3,6];case 1:return i.sent(),[4,(r=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 2:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 3:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 4:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 5:i.sent(),i.label=6;case 6:return[2]}})})},t.prototype.removeUnderOffset=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":r}},index:_t(be.CHANNEL_LATEST)})]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.countBetween=function(e,r,i){return f(this,void 0,void 0,function(){var s,o=this;return h(this,function(a){switch(a.label){case 0:return this.localCacheEnabled?(s=["channelUrl","-createdAt","-notificationId"],[4,this.collection.query({where:{channelUrl:e,"/where":function(u){var c=o._deserialize(u);return i.includes(c.createdAt)&&r.match(c)}},index:s}).count()]):[3,2];case 1:return[2,a.sent()];case 2:return[2,0]}})})},t}(Me),zn={},ac=function(n){function t(e){var r=n.call(this,e)||this;return r._observers=new Map,r._dispatcherContext=r._dispatcher.on(function(i){return f(r,void 0,void 0,function(){var s,o,a,u,c,l,d,p,_,m,g,y,b,T,C,N,P,A,F,z=this;return h(this,function(L){switch(L.label){case 0:return i instanceof _e?(s=i.messages,F=i.source,l=i.isWebSocketEventComing,o=s.filter(function(M){return M instanceof Ve&&M.channelType!==W.OPEN&&M.messageId>0}),a=s.filter(function(M){return M instanceof Ve&&M.channelType!==W.OPEN&&M.messageId===0}),u=s.filter(function(M){return M instanceof gr}),o.length>0?[4,Ae(function(){return f(z,void 0,void 0,function(){return h(this,function(M){switch(M.label){case 0:return[4,this._messageCache.upsert(o)];case 1:return M.sent(),[4,this._unsentMessageCache.remove(o.map(function(se){return se instanceof St?se.reqId:null}).filter(function(se){return se!==null}))];case 2:return M.sent(),[2]}})})})]:[3,2]):[3,7];case 1:L.sent(),l||this._broadcastUpdateEvent(o,F),L.label=2;case 2:return a.length>0?[4,Ae(function(){return f(z,void 0,void 0,function(){return h(this,function(M){switch(M.label){case 0:return[4,this._unsentMessageCache.upsert(a)];case 1:return M.sent(),[2]}})})})]:[3,4];case 3:L.sent(),l||this._broadcastUpdateEvent(a,F),L.label=4;case 4:return u.length>0?[4,Ae(function(){return f(z,void 0,void 0,function(){return h(this,function(M){switch(M.label){case 0:return[4,this._notificationCache.upsert(u)];case 1:return M.sent(),[2]}})})})]:[3,6];case 5:L.sent(),l||this._broadcastUpdateEvent(u,F),L.label=6;case 6:return[3,24];case 7:return i instanceof zu?(c=i.messageIds,F=i.source,l=i.isWebSocketEventComing,d=c.filter(function(M){return typeof M=="number"}),p=c.filter(function(M){return typeof M=="string"}),[4,Ae(function(){return f(z,void 0,void 0,function(){return h(this,function(M){switch(M.label){case 0:return d.length>0?[4,this._messageCache.remove(d)]:[3,2];case 1:M.sent(),M.label=2;case 2:return p.length>0?[4,this._notificationCache.remove(p)]:[3,4];case 3:M.sent(),M.label=4;case 4:return[2]}})})})]):[3,9];case 8:return L.sent(),l||this._broadcastRemoveEvent(c,F),[3,24];case 9:return i instanceof Cd?(_=i.reqId,F=i.source,[4,Ae(function(){return f(z,void 0,void 0,function(){return h(this,function(M){switch(M.label){case 0:return[4,this._unsentMessageCache.remove([_])];case 1:return M.sent(),[2]}})})})]):[3,11];case 10:return L.sent(),this._broadcastRemoveUnsentEvent(_,F),[3,24];case 11:return i instanceof Hu?(m=i.polls,F=i.source,this._cacheContext.localCacheEnabled?(g=m.map(function(M){return M.messageId}),[4,Promise.all(g.map(function(M){return z._messageCache.get(M)}))]):[3,14]):[3,15];case 12:return(y=L.sent().filter(function(M){return M})).length>0&&m.forEach(function(M){var se=y.find(function(Le){return Le.messageId===M.messageId});se&&se.applyPoll(M)}),[4,Ae(function(){return f(z,void 0,void 0,function(){return h(this,function(M){switch(M.label){case 0:return[4,this._messageCache.upsert(y)];case 1:return[2,M.sent()]}})})})];case 13:L.sent(),L.label=14;case 14:return this._broadcastPollChangeLogEvent(m,F),[3,24];case 15:return i instanceof $u?(b=i.event,F=i.source,[4,this._messageCache.get(b.messageId)]):[3,19];case 16:return(T=L.sent())&&T.isUserMessage()&&T.poll&&T.poll.applyPollUpdateEvent(b)?[4,Ae(function(){return f(z,void 0,void 0,function(){return h(this,function(M){switch(M.label){case 0:return[4,this._messageCache.upsert([T])];case 1:return[2,M.sent()]}})})})]:[3,18];case 17:L.sent(),L.label=18;case 18:return this._broadcastPollUpdateEvent(b,F),[3,24];case 19:return i instanceof io?(C=i.event,F=i.source,[4,this._messageCache.get(C.messageId)]):[3,23];case 20:return(N=L.sent())&&N.isUserMessage()&&N.poll&&N.poll.applyPollVoteEvent(C)?[4,Ae(function(){return f(z,void 0,void 0,function(){return h(this,function(M){switch(M.label){case 0:return[4,this._messageCache.upsert([N])];case 1:return[2,M.sent()]}})})})]:[3,22];case 21:L.sent(),L.label=22;case 22:return this._broadcastPollVoteEvent(C,F),[3,24];case 23:i instanceof Id?(P=i.event,F=i.source,P.messageId>0&&this._broadcastReactionUpdateEvent(P,F)):i instanceof Td&&(A=i.event,F=i.source,this._broadcastThreadUpdateEvent(A,F)),L.label=24;case 24:return[2]}})})}),r}return v(t,n),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return S.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_dispatcher",{get:function(){return S.of(this._iid).dispatcher},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_messageCache",{get:function(){return uo.of(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_unsentMessageCache",{get:function(){return wr.of(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_notificationCache",{get:function(){return ap.of(this._iid)},enumerable:!1,configurable:!0}),t.of=function(e,r){var i;return r===void 0&&(r=!1),zn[e]&&!r||(zn[e]&&((i=zn[e]._dispatcherContext)===null||i===void 0||i.close()),zn[e]=new t(e)),zn[e]},t.prototype._broadcastUpdateEvent=function(e,r){var i,s;try{for(var o=$(this._observers.values()),a=o.next();!a.done;a=o.next()){var u=a.value;u.onUpdate&&u.onUpdate(e,r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype._broadcastPollChangeLogEvent=function(e,r){var i,s;try{for(var o=$(this._observers.values()),a=o.next();!a.done;a=o.next()){var u=a.value;u.onPollChangeLogUpdate&&u.onPollChangeLogUpdate(e,r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype._broadcastPollUpdateEvent=function(e,r){var i,s;try{for(var o=$(this._observers.values()),a=o.next();!a.done;a=o.next()){var u=a.value;u.onPollUpdate&&u.onPollUpdate(e,r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype._broadcastPollVoteEvent=function(e,r){var i,s;try{for(var o=$(this._observers.values()),a=o.next();!a.done;a=o.next()){var u=a.value;u.onPollVote&&u.onPollVote(e,r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype._broadcastRemoveEvent=function(e,r){var i,s;try{for(var o=$(this._observers.values()),a=o.next();!a.done;a=o.next()){var u=a.value;u.onRemove&&u.onRemove(e,r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype._broadcastRemoveUnsentEvent=function(e,r){var i,s;try{for(var o=$(this._observers.values()),a=o.next();!a.done;a=o.next()){var u=a.value;u.onRemoveUnsent&&u.onRemoveUnsent(e,r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype._broadcastReactionUpdateEvent=function(e,r){var i,s;try{for(var o=$(this._observers.values()),a=o.next();!a.done;a=o.next()){var u=a.value;u.onReactionUpdate&&u.onReactionUpdate(e,r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype._broadcastThreadUpdateEvent=function(e,r){var i,s;try{for(var o=$(this._observers.values()),a=o.next();!a.done;a=o.next()){var u=a.value;u.onThreadInfoUpdate&&u.onThreadInfoUpdate(e,r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype.subscribe=function(e,r){this._observers.set(e,r)},t.prototype.unsubscribe=function(e){this._observers.delete(e)},t.prototype.unsubscribeAll=function(){this._observers.clear()},t}(Me),up=function(n){function t(e){var r=this,i=e.reverse,s=i!==void 0&&i,o=e.limit,a=o===void 0?20:o,u=e.token;return(r=n.call(this)||this).method=O.GET,r.path="".concat(uu),r.params=x({token:u,limit:a,reverse:s,order:Ts.UPDATED_AT,show_ui_template:!0,show_color_variables:!0}),r}return v(t,n),t}(D),cp=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.next,o=r.has_more,a=o!==void 0&&o,u=r.templates;return i.nextToken=s,i.hasMore=a,i.templates=u.map(function(c){return{template:JSON.stringify(c)}}),i}return v(t,n),t}(U),lp=function(n){function t(e){var r=this,i=e.key;return(r=n.call(this)||this).method=O.GET,r.path="".concat(uu,"/").concat(i),r}return v(t,n),t}(D),dp=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.template=JSON.stringify(r),i}return v(t,n),t}(U),qa={},Ie=function(){function n(t,e){var r=e.sdkState,i=e.dispatcher,s=e.requestQueue,o=e.onlineDetector,a=e.cacheContext;this._iid=t,this._sdkState=r,this._requestQueue=s,this._dispatcher=i,this._cacheContext=a,uo.of(t),wr.of(t),ac.of(t),this.fileMessageQueue=new th(t,{sdkState:r,dispatcher:i,requestQueue:s,onlineDetector:o,cacheContext:a}),qa[t]=this}return n.of=function(t){return qa[t]},n.prototype.buildMessageFromSerializedData=function(t){var e=_r(t);if(e.notificationId)return new gr(this._iid,gr.payloadify(e));switch(e.messageType){case fe.USER:return new Fe(this._iid,Fe.payloadify(e));case fe.FILE:return rt._isMultipleFilesMessageSerializedData(e)?new rt(this._iid,rt.payloadify(e)):new ge(this._iid,ge.payloadify(e));case fe.ADMIN:return new mr(this._iid,mr.payloadify(e))}throw I.invalidParameters},n.prototype.buildUserMessageCreateParamsFromSerializedData=function(t,e){return x(H({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUserIds:e.mentionedUserIds,mentionedUsers:e.mentionedUsers,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,isReplyToChannel:t.isReplyToChannel,pushNotificationDeliveryOption:t.pushNotificationDeliveryOption,appleCriticalAlertOptions:e.appleCriticalAlertOptions,reqId:e.reqId,message:e.message,translationTargetLanguages:Object.keys(e.translations),pollId:t.pollId}))},n.prototype.buildFileMessageCreateParamsFromSerializedData=function(t,e){var r;return x(H({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUserIds:e.mentionedUserIds,mentionedUsers:e.mentionedUsers,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,isReplyToChannel:t.isReplyToChannel,pushNotificationDeliveryOption:t.pushNotificationDeliveryOption,appleCriticalAlertOptions:e.appleCriticalAlertOptions,reqId:e.reqId,file:t.file,fileKey:t.fileKey,fileUrl:e.plainUrl,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:(r=e.thumbnails)===null||r===void 0?void 0:r.map(function(i){return{maxWidth:i.width,maxHeight:i.height}}),fileType:t.fileType,requireAuth:e.requireAuth}))},n.prototype.buildMultipleFilesMessageCreateParamsFromSerializedData=function(t,e){var r=this;return x({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUserIds:e.mentionedUserIds,mentionedUsers:e.mentionedUsers,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,isReplyToChannel:t.isReplyToChannel,pushNotificationDeliveryOption:t.pushNotificationDeliveryOption,appleCriticalAlertOptions:e.appleCriticalAlertOptions,reqId:e.reqId,fileInfoList:t.fileInfoList.map(function(i){return new hi(r._iid,i)})})},n.prototype.buildScheduledUserMessageCreateParamsFromSerializedData=function(t,e){return E(E({},this.buildUserMessageCreateParamsFromSerializedData(t,e)),{scheduledAt:t.scheduledAt})},n.prototype.buildScheduledFileMessageCreateParamsFromSerializedData=function(t,e){return E(E({},this.buildFileMessageCreateParamsFromSerializedData(t,e)),{scheduledAt:t.scheduledAt})},n.prototype.buildSenderFromSerializedData=function(t){var e=_r(t);return new An(this._iid,An.payloadify(e))},n.prototype.getMessage=function(t){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return e=new nh(t),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(rh).message]}})})},n.prototype.getScheduledMessage=function(t){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return e=new oh(t),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(ah).message]}})})},n.prototype.getMessagesByMessageId=function(t,e,r,i,s){return s===void 0&&(s=re.REQUEST_MESSAGE),f(this,void 0,void 0,function(){var o,a,u;return h(this,function(c){switch(c.label){case 0:return o=new zr(E(E({channelType:e,channelUrl:t,token:String(r)},sr),i)),[4,this._requestQueue.send(o)];case 1:return a=c.sent(),u=a.as(Hr).messages,this._dispatcher.dispatch(new _e({messages:u,source:s})),[2,u]}})})},n.prototype.getMessagesByTimestamp=function(t,e,r,i,s){return s===void 0&&(s=re.REQUEST_MESSAGE),f(this,void 0,void 0,function(){var o,a,u;return h(this,function(c){switch(c.label){case 0:return o=new zr(E(E({channelType:e,channelUrl:t,timestamp:r},sr),i)),[4,this._requestQueue.send(o)];case 1:return a=c.sent(),u=a.as(Hr).messages,this._dispatcher.dispatch(new _e({messages:u,source:s})),[2,u]}})})},n.prototype._getMessagesByTimestampForCollection=function(t,e,r,i,s,o,a){return s===void 0&&(s=re.REQUEST_MESSAGE),f(this,void 0,void 0,function(){var u,c,l,d,p,_;return h(this,function(m){switch(m.label){case 0:return u=new zr(E(E(E({channelType:e,channelUrl:t,timestamp:r},sr),i),{checkingHasNext:o,checkingContinuousMessages:a})),[4,this._requestQueue.send(u)];case 1:return c=m.sent(),l=c.as(Hr),d=l.messages,p=l.isContinuousMessages,_=l.hasNext,this._dispatcher.dispatch(new _e({messages:d,source:s})),[2,{messages:d,isContinuousMessages:p,hasNext:_}]}})})},n.prototype.getThreadedMessagesByTimestamp=function(t,e,r,i){return i===void 0&&(i=re.REQUEST_THREADED_MESSAGE),f(this,void 0,void 0,function(){var s,o,a,u;return h(this,function(c){switch(c.label){case 0:return s=new zr(E(E(E({channelUrl:t.channelUrl,channelType:t.channelType,timestamp:e},Er),r),{replyType:Be.ALL,parentMessageId:t.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(s)];case 1:return o=c.sent(),a=o.as(Hr).messages,(u=a.slice(1)).forEach(function(l){l.parentMessage=t}),this._dispatcher.dispatch(new _e({messages:u,source:i})),[2,{parentMessage:a[0],threadedMessages:u}]}})})},n.prototype.getMessageTemplatesByToken=function(t,e){return e===void 0&&(e={}),f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return r=new up(E({token:t},e)),[4,this._requestQueue.send(r)];case 1:return i=c.sent(),s=i.as(cp),o=s.hasMore,a=s.nextToken,u=s.templates,[2,{hasMore:o,token:a,templates:u}]}})})},n.prototype.getMessageTemplate=function(t){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return e=new lp({key:t}),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,{template:r.as(dp).template}]}})})},n.prototype.getMessageChangelogs=function(t,e,r,i,s){return s===void 0&&(s=re.REQUEST_MESSAGE_CHANGELOGS),f(this,void 0,void 0,function(){var o,a,u,c,l,d,p,_;return h(this,function(m){switch(m.label){case 0:return o=new ih(x(H(E(E({channelType:e,channelUrl:t,timestamp:typeof r=="number"?r:null,token:typeof r=="string"?r:null},qs),i)))),[4,this._requestQueue.send(o)];case 1:return a=m.sent(),u=a.as(sh),c=u.updatedMessages,l=u.deletedMessagesInfo,d=u.hasMore,p=u.nextToken,_=l.map(function(g){return g.messageId}),c.length>0&&this._dispatcher.dispatch(new _e({messages:c,source:s})),_.length>0&&this._dispatcher.dispatch(new zu({messageIds:_,source:s})),[2,{updatedMessages:c,deletedMessageIds:_,hasMore:d,token:p}]}})})},n}(),hp=function(n){function t(e,r){var i=n.call(this,e)||this;i.targetMessageId=0;var s=r.thread_info,o=r.parent_message_id,a=r.channel_url,u=r.channel_type;return s&&w("object",s)&&w("number",o)&&w("string",a)&&w("string",u)&&(i.threadInfo=new Ps(e,s),i.targetMessageId=o,i.channelUrl=a,i.channelType=u),i}return v(t,n),t}(Me),fp={channelUrl:"",channelType:W.BASE,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1},pp=function(n){function t(e){var r=e.channelCustomType,i=e.keyword,s=e.limit,o=e.reverse,a=e.exactMatch,u=e.channelUrl,c=e.order,l=e.messageTimestampFrom,d=e.messageTimestampTo,p=e.advancedQuery,_=e.targetFields,m=e.nextToken,g=n.call(this)||this;return g.method=O.GET,g.path="".concat(Vc,"/messages"),g.params={custom_type:r,query:i,limit:s,reverse:o,exact_match:a,channel_url:u,message_ts_from:l,message_ts_to:d,sort_field:c,advanced_query:p,target_fields:_,after:m},g}return v(t,n),t}(D),_p=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.messages=r.results.map(function(s){return Nt(e,s)}),i.hasNext=r.has_next,i.nextToken=r.end_cursor,i.totalCount=r.total_count,i}return v(t,n),t}(U);(function(n){n.SCORE="score",n.TIMESTAMP="ts"})(ur||(ur={}));var vp=function(n){function t(e,r){var i,s,o,a,u,c,l,d,p,_=this;return(_=n.call(this,e,r)||this).keyword="",_.reverse=!1,_.exactMatch=!1,_.channelUrl="",_.channelCustomType="",_.messageTimestampFrom=null,_.messageTimestampTo=null,_.order=ur.SCORE,_.advancedQuery=!1,_.targetFields=null,_._nextToken="",_.totalCount=-1,_.keyword=r.keyword,_.reverse=(i=r.reverse)!==null&&i!==void 0&&i,_.exactMatch=(s=r.exactMatch)!==null&&s!==void 0&&s,_.channelUrl=(o=r.channelUrl)!==null&&o!==void 0?o:"",_.channelCustomType=(a=r.channelCustomType)!==null&&a!==void 0?a:"",_.messageTimestampFrom=(u=r.messageTimestampFrom)!==null&&u!==void 0?u:null,_.messageTimestampTo=(c=r.messageTimestampTo)!==null&&c!==void 0?c:null,_.order=(l=r.order)!==null&&l!==void 0?l:ur.SCORE,_.advancedQuery=(d=r.advancedQuery)!==null&&d!==void 0&&d,_.targetFields=(p=r.targetFields)!==null&&p!==void 0?p:null,_}return v(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&w("string",this.keyword)&&this.keyword.length>0&&w("boolean",this.reverse)&&w("boolean",this.exactMatch)&&w("string",this.channelUrl)&&w("string",this.channelCustomType)&&(w("number",this.messageTimestampFrom)||this.messageTimestampFrom===null)&&(w("number",this.messageTimestampTo)||this.messageTimestampTo===null)&&ce(ur,this.order)&&w("boolean",this.advancedQuery)&&Y("string",this.targetFields,!0)},t.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid).requestQueue,r=new pp(H(E(E({},this),{nextToken:this._nextToken?this._nextToken:null}))),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=l.sent(),s=i.as(_p),o=s.messages,a=s.hasNext,u=s.nextToken,c=s.totalCount,this._nextToken=u,this._hasNext=a,this._isLoading=!1,this.totalCount=c,[2,o];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},t}(Un),mp={channelUrl:"",scheduledMessageId:0},gp={reverse:!1,limit:20},yp=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.name="message",e}return v(t,n),t.prototype.init=function(e,r){var i=r.sdkState,s=r.dispatcher,o=r.sessionManager,a=r.requestQueue,u=r.logger,c=r.onlineDetector,l=r.cacheContext;n.prototype.init.call(this,e,{sdkState:i,dispatcher:s,sessionManager:o,requestQueue:a,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Ie(e,{sdkState:i,dispatcher:s,requestQueue:a,onlineDetector:c,cacheContext:l})},t.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},t.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},t.prototype.getMessage=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){switch(s.label){case 0:return r=E(E({},fp),e),R(function(o){return w("string",o.channelUrl)&&ce(W,o.channelType)&&w("number",o.messageId)&&w("boolean",o.includeReactions,!0)&&w("boolean",o.includeMetaArray,!0)&&w("boolean",o.includeParentMessageInfo,!0)&&w("boolean",o.includeThreadInfo,!0)}(r)).throw(I.invalidParameters),[4,this._manager.getMessage(r)];case 1:if((i=s.sent())instanceof Ve||i instanceof gr||i===null)return[2,i];throw"Unknown message type is given."}})})},t.prototype.getScheduledMessage=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){return r=E(E({},mp),e),R(function(s){return w("string",s.channelUrl)&&s.channelUrl!==""&&w("number",s.scheduledMessageId)&&s.scheduledMessageId>0}(r)).throw(I.invalidParameters),[2,this._manager.getScheduledMessage(r)]})})},t.prototype.getMessageTemplatesByToken=function(e,r){return r===void 0&&(r={}),f(this,void 0,void 0,function(){var i;return h(this,function(s){return i=E(E({},gp),r),R(w("string",e,!0)&&function(o){return w("boolean",o.reverse,!0)&&w("number",o.limit,!0)}(i)).throw(I.invalidParameters),[2,this._manager.getMessageTemplatesByToken(e,i)]})})},t.prototype.getMessageTemplate=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return R(w("string",e)).throw(I.invalidParameters),[2,this._manager.getMessageTemplate(e)]})})},t}(ro),Ep=function(n,t){this.pollId=0,this.messageId=0,this.pollId=t.poll.id,this.messageId=t.poll.message_id,this._iid=n,this._payload=t},bp=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.name="poll",e}return v(t,n),t.prototype.init=function(e,r){var i=r.sdkState,s=r.dispatcher,o=r.sessionManager,a=r.requestQueue,u=r.logger,c=r.onlineDetector,l=r.cacheContext;n.prototype.init.call(this,e,{sdkState:i,dispatcher:s,sessionManager:o,requestQueue:a,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Us(e,{sdkState:i,dispatcher:s,sessionManager:o,requestQueue:a,logger:u,onlineDetector:c,cacheContext:l})},t.prototype.create=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){return r=E(E({},Pd),e),R(ju(r)).throw(I.invalidParameters),[2,this._manager.create(r)]})})},t.prototype.get=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){return r=E(E({},Fd),e),R(Vu(r)).throw(I.invalidParameters),[2,this._manager.get(r)]})})},t.prototype.getOption=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){return r=E(E({},xd),e),R(Gu(r)).throw(I.invalidParameters),[2,this._manager.getOption(r)]})})},t.prototype.buildPollFromSerializedData=function(e){return this._manager.buildPollFromSerializedData(e)},t}(ro),Ht,za,Ha;(function(n){n.LATEST_LAST_MESSAGE="latest_last_message",n.CHRONOLOGICAL="chronological",n.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",n.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"})(Ht||(Ht={})),function(n){n.CHRONOLOGICAL="chronological",n.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",n.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"}(za||(za={})),function(n){n.CREATED_AT="created_at",n.SCHEDULED_AT="scheduled_at"}(Ha||(Ha={}));var Vs,_s=function(n){switch(n){case Ht.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case Ht.CHRONOLOGICAL:return["-createdAt","syncIndex"];case Ht.CHANNEL_NAME_ALPHABETICAL:return["name"];default:return["-lastMessageUpdatedAt","-createdAt","syncIndex"]}},wp=function(n){function t(e){var r=e.message,i=n.call(this)||this;return i.message=r,i}return v(t,n),t}(le),$a={},Ip=function(){function n(t,e){var r=e.localCacheEnabled,i=e.enableAutoResend,s=e.dispatcher,o=e.sdkState,a=e.logger,u=this;this._iid=t,$a[t]=this,this._localCacheEnabled=r,this._enableAutoResend=i,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=s,this._logger=a,this._sdkState=o,this._localCacheEnabled&&s.on(function(c){if(c instanceof ln)switch(c.stateType){case ie.CONNECTED:u._isProcessingAutoResend||u.processAutoResendRegisteredPendingMessages().then(function(){return u._processNextAutoResend()});break;case ie.INTERNAL_DISCONNECTED:case ie.EXTERNAL_DISCONNECTED:u._isProcessingAutoResend=!1}})}return n.of=function(t){return $a[t]},n.prototype.processNonAutoResendRegisteredPendingMessages=function(){return f(this,void 0,void 0,function(){var t,e,r,i,s,o;return h(this,function(a){switch(a.label){case 0:return this._enableAutoResend?[4,this._fetchAllCachedPendingMessages()]:[2];case 1:t=a.sent();try{for(e=$(t),r=e.next();!r.done;r=e.next())(i=r.value).errorCode===0&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",i.reqId),i.sendingStatus=ue.FAILED,i.errorCode=q.ACK_TIMEOUT,this._dispatcher.dispatch(new _e({messages:[i],source:re.LOCAL_MESSAGE_FAILED})))}catch(u){s={error:u}}finally{try{r&&!r.done&&(o=e.return)&&o.call(e)}finally{if(s)throw s.error}}return[2]}})})},n.prototype.processAutoResendRegisteredPendingMessages=function(){return f(this,void 0,void 0,function(){var t,e,r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:t=c.sent();try{for(e=$(t),r=e.next();!r.done;r=e.next())i=r.value,this._enableAutoResend&&i.errorCode&&ti(i.errorCode)&&(s=new Date().getTime(),o=i.createdAt+2592e5,this._enableAutoResend&&s<=o?this._autoResendQueue.map(function(l){return l.reqId}).indexOf(i.reqId)<0&&this._autoResendQueue.push(i):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(o).toLocaleString()),i.sendingStatus=ue.FAILED,this._dispatcher.dispatch(new _e({messages:[i],source:re.LOCAL_MESSAGE_FAILED}))))}catch(l){a={error:l}}finally{try{r&&!r.done&&(u=e.return)&&u.call(e)}finally{if(a)throw a.error}}return[2]}})})},n.prototype.completeCurrentAndProcessNextAutoResend=function(t){if(this._localCacheEnabled&&this._enableAutoResend&&(t.sendingStatus===ue.SUCCEEDED||t.sendingStatus===ue.FAILED&&!ti(t.errorCode))){var e=this.indexOf(t);e>=0&&this._autoResendQueue.splice(e,1),e===0&&this._processNextAutoResend()}},n.prototype._fetchAllCachedPendingMessages=function(){return f(this,void 0,void 0,function(){var t,e;return h(this,function(r){switch(r.label){case 0:return t=wr.of(this._iid),(e=new kn).replyType=Be.ALL,[4,t.fetch({sendingStatus:ue.PENDING,backward:!0,filter:e})];case 1:return[2,r.sent()]}})})},n.prototype.indexOf=function(t){return this._autoResendQueue.length>0?this._autoResendQueue.map(function(e){return e.reqId}).indexOf(t.reqId):-1},n.prototype._isNotInQueue=function(t){return this._autoResendQueue.map(function(e){return e.reqId}).indexOf(t.reqId)===-1},n.prototype._processNextAutoResend=function(){return f(this,void 0,void 0,function(){var t;return h(this,function(e){if(this._localCacheEnabled&&this._enableAutoResend&&this._sdkState.appState==="foreground")try{this._autoResendQueue.length>0?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),t=this._autoResendQueue[0],this._dispatcher.dispatch(new wp({message:t})),this._logger.debug("processing auto-resend for message request id: ",t.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1)}catch(r){this._logger.warn("process auto-resend error: ",r),this._isProcessingAutoResend=!1}return[2]})})},n}();(function(n){n[n.USER_BLOCK=20001]="USER_BLOCK",n[n.USER_UNBLOCK=2e4]="USER_UNBLOCK",n[n.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED"})(Vs||(Vs={}));var uc=function(){function n(t){this.category=t.cat,this.data=t.data}return n.getDataAsUserBlockEvent=function(t,e){var r=e.data,i=r.blocker,s=r.blockee;return{blocker:new V(t,i),blockee:new V(t,s)}},n.getDataAsFriendDiscoveredEvent=function(t,e){var r=e.data.friend_discoveries;return{friendDiscoveries:Array.isArray(r)?r.map(function(i){return new V(t,i)}):[]}},n}(),Tp=function(n){function t(e,r){var i=r.userId,s=n.call(this)||this;return s._iid=e,s.userId=i,s}return v(t,n),t}(le),Cp=function(n){function t(){return n.call(this)||this}return v(t,n),t}(le),Sp=function(n){function t(e,r,i){var s=n.call(this,e,"USEV",i)||this;return s.event=new uc(i),s}return v(t,n),t}(de),Np=function(n){return["-lastMessageUpdatedAt","-createdAt","syncIndex"]},Ba=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return v(t,n),t}(le),cc=function(n){this.key=n.key,this.url=n.url},lc=function(n){this.id=n.id,this.name=n.name,this.url=n.url,this.emojis=n.emojis?n.emojis.map(function(t){return new cc(t)}):[]},Ap=function(n){this.emojiHash=n.emoji_hash||"",this.emojiCategories=n.emoji_categories?n.emoji_categories.map(function(t){return new lc(t)}):[]},kp={profileImage:void 0,profileUrl:void 0,nickname:void 0},ja=function(n){return function(t,e){return f(void 0,void 0,void 0,function(){var r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:switch(t){case 1:case 2:case 3:return[3,1];case 4:return[3,2];case 5:return[3,9]}return[3,13];case 1:return e(),[3,14];case 2:return u.trys.push([2,7,,8]),[4,n.clear()];case 3:return u.sent(),r=function(c){return{v2:function(){return f(void 0,void 0,void 0,function(){return h(this,function(l){switch(l.label){case 0:return[4,c.commitSchema([{collectionName:Sf,keyName:Nf,index:[_s(Ht.LATEST_LAST_MESSAGE),_s(Ht.CHRONOLOGICAL),_s(Ht.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:$s,keyName:Af,index:[_t(be.CHANNEL_LATEST),_t(be.NEWEST_CHILD_MESSAGE)]},{collectionName:oc,keyName:op,index:[_t(be.CHANNEL_LATEST),_t(be.NEWEST_CHILD_MESSAGE)]},{collectionName:Of,keyName:Df}])];case 1:return[2,l.sent()]}})})},v3:function(){return f(void 0,void 0,void 0,function(){return h(this,function(l){switch(l.label){case 0:return[4,c.commitSchema([{collectionName:Rf,keyName:Uf,index:[Np()]}])];case 1:return[2,l.sent()]}})})},v4:function(){return f(void 0,void 0,void 0,function(){return h(this,function(l){switch(l.label){case 0:return[4,c.commitSchema([{collectionName:sc,keyName:kf,index:[sp()]}])];case 1:return[2,l.sent()]}})})}}}(n),i=r.v2,s=r.v3,o=r.v4,[4,i()];case 4:return u.sent(),[4,s()];case 5:return u.sent(),[4,o()];case 6:return u.sent(),e(),[3,8];case 7:return a=u.sent(),e(a),[3,8];case 8:return[3,14];case 9:return u.trys.push([9,11,,12]),[4,n.collection($s).removeIf({where:{channelType:W.OPEN}})];case 10:case 11:return u.sent(),[3,12];case 12:return e(),[3,14];case 13:e(),u.label=14;case 14:return[2]}})})}},Op=function(){return typeof document<"u"?document.visibilityState:"visible"},Dp=function(n){function t(e){var r=e.getVisibilityState,i=r===void 0?Op:r,s=e.initialState,o=s===void 0?"visible":s,a=e.isEnabled,u=a===void 0||a,c=e.pauseCheckDelay,l=c===void 0?3e4:c,d=n.call(this)||this;return d._pauseCheckDelay=3e4,d._currentState="visible",d._getVisibilityState=i,d._pauseCheckDelay=l,d._currentState=o,d._isEnabled=u,d._boundToggleState=d._toggleState.bind(d),d}return v(t,n),Object.defineProperty(t.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAvailable",{get:function(){return typeof window<"u"&&!!window.addEventListener&&!!window.removeEventListener},enumerable:!1,configurable:!0}),t.prototype._toggleState=function(){var e=this,r=this._getVisibilityState();r!=="hidden"?this._currentState==="hidden"&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=void 0),this.dispatch("resume")):this._currentState!=="hidden"&&(this._pauseDelayTimer=setTimeout(function(){e._pauseDelayTimer=void 0,e.dispatch("pause")},this._pauseCheckDelay)),this._currentState=r},t.prototype.start=function(){this._isEnabled&&this.isAvailable&&(this._boundToggleState=this._toggleState.bind(this),window.addEventListener("visibilitychange",this._boundToggleState,{capture:!0}))},t.prototype.stop=function(){this._isEnabled&&this.isAvailable&&this._boundToggleState&&window.removeEventListener("visibilitychange",this._boundToggleState,{capture:!0})},t}(Dn),Rp=function(){function n(t){var e=t.logger,r=t.connectionDelegate,i=r===void 0?null:r,s=this;this._onlineWorker=function(){var o;return(o=s.connectionDelegate)===null||o===void 0?void 0:o.reconnect()},this._offlineWorker=function(){var o;return(o=s.connectionDelegate)===null||o===void 0?void 0:o.disconnect()},this.unsubscribes=[],this._onlineListener=function(o){if(s.isAvailableOnWeb)return window.addEventListener("online",o),function(){return window.removeEventListener("online",o,!1)}},this._offlineListener=function(o){if(s.isAvailableOnWeb)return window.addEventListener("offline",o),function(){return window.removeEventListener("offline",o,!1)}},this.logger=e,i&&(this.connectionDelegate=i)}return Object.defineProperty(n.prototype,"isAvailableOnWeb",{get:function(){return typeof window<"u"&&!!window.addEventListener&&"ononline"in window&&"onoffline"in window&&typeof navigator<"u"&&navigator.onLine!==void 0},enumerable:!1,configurable:!0}),n.prototype.setOnlineListener=function(t){t&&typeof t=="function"&&(this._onlineListener=t)},n.prototype.setOfflineListener=function(t){t&&typeof t=="function"&&(this._offlineListener=t)},n.prototype.start=function(){this.unsubscribes=[this._onlineListener(this._onlineWorker),this._offlineListener(this._offlineWorker)]},n.prototype.stop=function(){var t=this;this.unsubscribes.forEach(function(e){try{e==null||e()}catch(r){t.logger.warn(r.message)}}),this.unsubscribes=[]},n.prototype.isOnline=function(){return f(this,void 0,void 0,function(){return h(this,function(t){return this.isAvailableOnWeb?[2,navigator.onLine]:[2,new Promise(function(e){fetch("https://www.google.com",{method:O.GET,mode:"no-cors"}).then(function(){return e(!0)}).catch(function(){return e(!1)})})]})})},n}(),Ga=function(n){function t(e){var r=e.userId,i=e.nickname,s=e.profileUrl,o=e.profileImage,a=e.preferredLanguages,u=n.call(this)||this;return u.method=O.PUT,u.path="".concat(ee,"/").concat(encodeURIComponent(r)),u.params=x(H({nickname:i,profile_url:s,profile_file:o,preferred_languages:a})),u}return v(t,n),t}(D),Va=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.user=new V(e,E({},r)),i}return v(t,n),t}(U),Up=function(n){function t(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=O.POST,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/apns"),s.params={apns_device_token:i,always_push:!0},s}return v(t,n),t}(D);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.token=r.token,i.type=r.type?me[r.type.toLowerCase()]:me.UNKNOWN,i.user=new V(e,r.user),i}v(t,n)})(U);var Mp=function(n){function t(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=O.POST,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/gcm"),s.params={gcm_reg_token:i,always_push:!0},s}return v(t,n),t}(D);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.token=r.token,i.type=r.type?me[r.type.toLowerCase()]:me.UNKNOWN,i.user=new V(e,r.user),i}v(t,n)})(U);var Lp=function(n){function t(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=O.DELETE,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/apns/").concat(encodeURIComponent(i)),s}return v(t,n),t}(D);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.token=r.token,i.user=new V(e,r.user),i.lastDeletedAt=r.device_token_last_deleted_at,i}v(t,n)})(U);var Pp=function(n){function t(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=O.DELETE,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/gcm/").concat(encodeURIComponent(i)),s}return v(t,n),t}(D);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.token=r.token,i.user=new V(e,r.user),i.lastDeletedAt=r.device_token_last_deleted_at,i}v(t,n)})(U);var xp=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=O.DELETE,i.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/apns"),i}return v(t,n),t}(D);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.type=r.type?me[r.type.toLowerCase()]:me.UNKNOWN,i.user=new V(e,r.user),i.lastDeletedAt=r.device_token_last_deleted_at,i}v(t,n)})(U);var Fp=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=O.DELETE,i.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/gcm"),i}return v(t,n),t}(D);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.type=r.type?me[r.type.toLowerCase()]:me.UNKNOWN,i.user=new V(e,r.user),i.lastDeletedAt=r.device_token_last_deleted_at,i}v(t,n)})(U);var qp=function(n){function t(e){var r=e.userId,i=e.type,s=e.token,o=e.ts,a=n.call(this)||this;return a.method=O.GET,a.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/").concat(encodeURIComponent(i),"/device_tokens"),a.params={created_ts:o,token:s},a}return v(t,n),t}(D),zp=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.pushTokens={type:r.type?me[r.type.toLowerCase()]:me.UNKNOWN,deviceTokens:r.device_tokens,hasMore:r.has_more,token:r.token},i}return v(t,n),t}(U),Hp=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=O.GET,i.path="".concat(ee,"/").concat(encodeURIComponent(r),"/channel_invitation_preference"),i}return v(t,n),t}(D),$p=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.autoAccept=r.auto_accept,i}return v(t,n),t}(U),Bp=function(n){function t(e){var r=e.userId,i=e.willAutoAccept,s=n.call(this)||this;return s.method=O.PUT,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/channel_invitation_preference"),s.params={auto_accept:i},s}return v(t,n),t}(D),jp=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.autoAccept=r.auto_accept,i}return v(t,n),t}(U),Gp=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=O.GET,i.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push_preference"),i}return v(t,n),t}(D),Vp=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.preference={doNotDisturbOn:r.do_not_disturb,startHour:r.start_hour,startMin:r.start_min,endHour:r.end_hour,endMin:r.end_min,timezone:r.timezone},i}return v(t,n),t}(U),Kp=function(n){function t(e){var r=e.userId,i=e.doNotDisturbOn,s=e.startHour,o=e.startMin,a=e.endHour,u=e.endMin,c=e.timezone,l=n.call(this)||this;return l.method=O.PUT,l.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push_preference"),l.params={do_not_disturb:i,start_hour:s,start_min:o,end_hour:a,end_min:u,timezone:c},l}return v(t,n),t}(D),Qp=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.preference={doNotDisturbOn:r.do_not_disturb,startHour:r.start_hour,startMin:r.start_min,endHour:r.end_hour,endMin:r.end_min,timezone:r.timezone},i}return v(t,n),t}(U),Wp=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=O.GET,i.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push_preference"),i}return v(t,n),t}(D),Yp=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.snoozePeriod={isSnoozeOn:r.snooze_enabled},typeof r.snooze_start_ts=="number"&&(i.snoozePeriod.startTs=r.snooze_start_ts),typeof r.snooze_end_ts=="number"&&(i.snoozePeriod.endTs=r.snooze_end_ts),i}return v(t,n),t}(U),Zp=function(n){function t(e){var r=e.userId,i=e.snoozeOn,s=e.startTs,o=e.endTs,a=n.call(this)||this;return a.method=O.PUT,a.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push_preference"),a.params={snooze_enabled:i,snooze_start_ts:s,snooze_end_ts:o},a}return v(t,n),t}(D),Xp=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.snoozePeriod={isSnoozeOn:r.snooze_enabled},typeof r.snooze_start_ts=="number"&&(i.snoozePeriod.startTs=r.snooze_start_ts),typeof r.snooze_end_ts=="number"&&(i.snoozePeriod.endTs=r.snooze_end_ts),i}return v(t,n),t}(U),Jp=function(n){function t(e){var r=e.userId,i=e.blockedUserId,s=n.call(this)||this;return s.method=O.POST,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/block"),s.params={target_id:i},s}return v(t,n),t}(D);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.user=new V(e,r),i}v(t,n)})(U);var e_=function(n){function t(e){var r=e.userId,i=e.unblockedUserId,s=n.call(this)||this;return s.method=O.DELETE,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/block/").concat(encodeURIComponent(i)),s}return v(t,n),t}(D);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}v(t,n)})(U);var t_=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=O.GET,i.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push_preference"),i}return v(t,n),t}(D),n_=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.pushTriggerOption=r.push_trigger_option,i}return v(t,n),t}(U),r_=function(n){function t(e){var r=e.userId,i=e.pushTriggerOption,s=n.call(this)||this;return s.method=O.PUT,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push_preference"),s.params={push_trigger_option:i},s}return v(t,n),t}(D),i_=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.pushTriggerOption=r.push_trigger_option,i}return v(t,n),t}(U),s_=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=O.GET,i.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/template"),i}return v(t,n),t}(D),o_=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.name=r.name,i}return v(t,n),t}(U),a_=function(n){function t(e){var r=e.userId,i=e.templateName,s=n.call(this)||this;return s.method=O.PUT,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/template"),s.params={name:i},s}return v(t,n),t}(D),u_=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.name=r.name,i}return v(t,n),t}(U),c_=function(n){function t(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=O.GET,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/friends/changelogs"),s.params={token:i},s}return v(t,n),t}(D),l_=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.changelogs={addedUsers:r.added.map(function(s){return new V(e,s)}),updatedUsers:r.updated.map(function(s){return new V(e,s)}),deletedUserIds:r.deleted,hasMore:r.has_more,token:r.next},i}return v(t,n),t}(U),d_=function(n){function t(e){var r=e.userId,i=e.discoveries,s=n.call(this)||this;return s.method=O.PUT,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/friend_discoveries"),s.params={friend_discoveries:i.map(function(o){return{friend_discovery_key:o.friendDiscoveryKey,friend_name:o.friendName}})},s}return v(t,n),t}(D),h_=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.friendDiscoveryRequestId=r.friend_discovery_request_id,i}return v(t,n),t}(U),f_=function(n){function t(e){var r=e.userId,i=e.discoveryKeys,s=n.call(this)||this;return s.method=O.DELETE,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/friend_discoveries"),s.params={friend_discovery_keys:i},s}return v(t,n),t}(D);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}v(t,n)})(U);var p_=function(n){function t(e){var r=e.userId,i=e.userIds,s=n.call(this)||this;return s.method=O.POST,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/friends"),s.params={user_ids:i},s}return v(t,n),t}(D),__=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.users=r.users.map(function(s){return new V(e,s)}),i}return v(t,n),t}(U),v_=function(n){function t(e){var r=e.userId,i=e.userIds,s=n.call(this)||this;return s.method=O.DELETE,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/friends"),s.params={user_ids:i},s}return v(t,n),t}(D);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}v(t,n)})(U);var m_=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=O.GET,i.path="".concat(ee,"/").concat(r,"/allow_friend_discovery"),i.params={},i}return v(t,n),t}(D),g_=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.allowFriendDiscovery=r.allow_friend_discovery,i}return v(t,n),t}(U),y_=function(n){function t(e){var r=e.userId,i=e.allowFriendDiscovery,s=n.call(this)||this;return s.method=O.PUT,s.path="".concat(ee,"/").concat(r,"/allow_friend_discovery"),s.params={allow_friend_discovery:i},s}return v(t,n),t}(D);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}v(t,n)})(U);var Hn,E_=function(n){function t(){var e=n.call(this)||this;return e.method=O.GET,e.path=au,e}return v(t,n),t}(D),b_=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.emojiContainer=new Ap(r),i}return v(t,n),t}(U),w_=function(n){function t(e){var r=e.categoryId,i=n.call(this)||this;return i.method=O.GET,i.path="".concat(au,"/").concat(r),i}return v(t,n),t}(D),I_=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.emojiCategory=new lc(r),i}return v(t,n),t}(U),T_=function(n){function t(e){var r=e.key,i=n.call(this)||this;return i.method=O.GET,i.path="".concat(Kc,"/").concat(r),i}return v(t,n),t}(D),C_=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.emoji=new cc(r),i}return v(t,n),t}(U),S_=function(n){function t(){var e=n.call(this)||this;return e.method=O.GET,e.path="".concat(Qc),e}return v(t,n),t}(D),N_=function(n){function t(e,r){var i,s=this,o=r??{};return(s=n.call(this,e,r)||this).uikitConfiguration={string:JSON.stringify(o),json:o},s.updatedAt=(i=r==null?void 0:r.updated_at)!==null&&i!==void 0?i:0,s}return v(t,n),t}(U),A_=function(){function n(t,e,r){var i=this;this._storeInitialized=!1,this._iid=t,this.options=e;var s=S.of(t),o=s.sdkState,a=s.cacheContext,u=s.dispatcher,c=s.sessionManager,l=s.requestQueue,d=s.logger,p=s.userEventHandlers,_=s.appStateToggleEnabled;this._onlineDetector=new Rp({logger:d,connectionDelegate:{reconnect:function(){return f(i,void 0,void 0,function(){var g,y,b,T,C,N;return h(this,function(P){switch(P.label){case 0:if(g=S.of(t),y=g.sdkState,b=g.connectionManager,(T=g.sessionManager).session.hasSession)return[3,5];P.label=1;case 1:return P.trys.push([1,3,,4]),[4,b.connect(T.session.authToken)];case 2:return P.sent(),[3,4];case 3:if(C=P.sent(),et(C))throw C;return d.debug("connect failed by reconnect event = ",C),[3,4];case 4:return[3,9];case 5:if(y.appState!=="foreground")return[3,9];P.label=6;case 6:return P.trys.push([6,8,,9]),[4,b.resetAndReconnect()];case 7:return P.sent(),[3,9];case 8:if(N=P.sent(),et(N))throw N;return d.debug("resetAndReconnect failed by reconnect event = ",N),[3,9];case 9:return u.dispatch(new Ba),[2]}})})},disconnect:function(){Ae(function(){return f(i,void 0,void 0,function(){return h(this,function(g){switch(g.label){case 0:return[4,S.of(t).connectionManager.disconnect()];case 1:return g.sent(),[2]}})})})}}});var m=new Ip(t,{localCacheEnabled:a.localCacheEnabled,enableAutoResend:a.localCacheConfig.enableAutoResend,dispatcher:u,sdkState:o,logger:d});r.forEach(function(g){g.init(t,{sdkState:o,cacheContext:a,dispatcher:u,sessionManager:c,requestQueue:l,logger:d,onlineDetector:i._onlineDetector}),i[g.name]=g}),this._appStateChangeDetector=new Dp({isEnabled:_}),this._appStateChangeDetector.on("resume",function(){d.debug("the page resumes from freeze"),i.setForegroundState()}).on("pause",function(){d.debug("the page freezes"),i.setBackgroundState()}),u.on(function(g){var y;if(g instanceof ln)g.stateType===ie.CONNECTED&&m.processNonAutoResendRegisteredPendingMessages();else if(g instanceof de){if(g.code==="USEV"){var b=g.as(Sp).event;if(b.category===Vs.FRIEND_DISCOVERED){var T=uc.getDataAsFriendDiscoveredEvent(t,b).friendDiscoveries;K(function(){return f(i,void 0,void 0,function(){return h(this,function(F){return[2,p.forEach(function(z){z.onFriendsDiscovered&&z.onFriendsDiscovered(T)})]})})})}}}else if(g instanceof Ou){var C=S.of(i._iid).subscribedUnreadMessageCount,N=!1,P=g.ts;if(typeof P=="number"&&P>C.ts){if(C.all!==g.all&&(N=!0),C.all=g.all>=0?g.all:0,g.customTypes)for(var A in g.customTypes)C.customTypes[A]!==g.customTypes[A]&&(N=!0),C.customTypes[A]=g.customTypes[A];N=N&&C.ts>0,C.ts=P}N&&K(function(){return f(i,void 0,void 0,function(){return h(this,function(F){return[2,p.forEach(function(z){z.onTotalUnreadMessageCountChanged&&z.onTotalUnreadMessageCountChanged({groupChannelCount:C.all,feedChannelCount:C.feed,customTypeUnreadCount:C.customTypes}),z.onTotalUnreadMessageCountUpdated&&z.onTotalUnreadMessageCountUpdated(C.all,C.customTypes)})]})})})}else g instanceof Uu?(a.preference.set(i._getUserProfileCacheKey(o.userId),Ds.payloadify(g.userProfile)),!((y=g.userProfile.appInfo.notificationInfo)===null||y===void 0)&&y.isEnabled&&a.preference.set(id(i.appId),{value:!0})):g instanceof Tn&&g.error&&g.error.isSessionInvalidatedError&&(d.debug("session revoked."),i.disconnect())})}return n.init=function(t){var e=t.appId,r=t.appVersion,i=t.modules,s=i===void 0?[]:i,o=t.options,a=o===void 0?new iu:o,u=t.debugMode,c=u!==void 0&&u,l=t.customApiHost,d=t.customWebSocketHost,p=t.newInstance,_=p!==void 0&&p,m=t.logLevel,g=t.localCacheEnabled,y=g!==void 0&&g,b=t.localCacheConfig,T=b===void 0?new ou:b,C=t.localCacheEncryption,N=t.useAsyncStorageStore,P=N===void 0?null:N,A=t.appStateToggleEnabled,F=A===void 0||A;if(!Hn||_){var z="su-".concat(sn()),L=C??{encrypt:function(st){return st},decrypt:function(st){return st}},M=new Mt({encryption:L});c||(M=Ss()?P?new rp({AsyncStorage:P,encryption:L}):new Mt({encryption:L}):new np({encryption:L})),new S(z,{appId:e,appVersion:r,options:a,apiHost:l??"https://api-".concat(e,".sendbird.com"),websocketHost:d??"wss://ws-".concat(e,".sendbird.com"),store:M,encryption:L,logLevel:m,localCacheEnabled:y,localCacheConfig:T,debugMode:c,appStateToggleEnabled:F});var se=[new yp,new bp],Le=new n(z,a,Z(Z([],G(s),!1),G(se),!1));return Hn||(Hn=Le),Le}return Hn},Object.defineProperty(n,"instance",{get:function(){return Hn},enumerable:!1,configurable:!0}),Object.defineProperty(n,"version",{get:function(){return nu},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"appId",{get:function(){return S.of(this._iid).sdkState.appId},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"appInfo",{get:function(){var t=S.of(this._iid).appInfo;return t??null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"appVersion",{get:function(){var t;return(t=S.of(this._iid).sdkState.appVersion)!==null&&t!==void 0?t:""},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"debugMode",{get:function(){return!!S.of(this._iid).debugMode},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"logLevel",{get:function(){return S.of(this._iid).logger.level},set:function(t){S.of(this._iid).logger.level=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isCacheEnabled",{get:function(){return S.of(this._iid).cacheContext.localCacheEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"localCacheConfig",{get:function(){var t=S.of(this._iid).cacheContext;return t.localCacheEnabled?t.localCacheConfig:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"ekey",{get:function(){return S.of(this._iid).sessionManager.ekey},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentUser",{get:function(){var t;return(t=S.of(this._iid).sessionManager.currentUser)!==null&&t!==void 0?t:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"connectionState",{get:function(){var t=S.of(this._iid).connectionManager;return t.isConnected?pt.OPEN:t.isConnecting?pt.CONNECTING:pt.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lastConnectedAt",{get:function(){var t=S.of(this._iid),e=t.connectedAt;return t.connectionManager.isConnected?e:0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fcmPushToken",{get:function(){var t;return(t=this._fcmPushToken)!==null&&t!==void 0?t:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"apnsPushToken",{get:function(){var t;return(t=this._apnsPushToken)!==null&&t!==void 0?t:null},enumerable:!1,configurable:!0}),n.prototype._getNestDBVersion=function(){return 6},n.prototype._getPreferenceCacheKey=function(t){return"sendbird@".concat(this.appId,"/").concat(t,".pref")},n.prototype._getUserProfileCacheKey=function(t){return"sendbird@".concat(this.appId,"/").concat(t,".profile")},n.prototype.getMemoryStoreForDebugging=function(){var t=S.of(this._iid),e=t.debugMode,r=t.cacheContext;if(e)return r.store instanceof Mt?r.store:null;throw I.debugModeRequired},n.prototype.addExtension=function(t,e){var r=S.of(this._iid).sdkState;["sb_uikit","sb_syncmanager","device-os-platform"].indexOf(t)>-1&&r.extensions&&(r.extensions[t]=e)},n.prototype.addSendbirdExtensions=function(t,e,r){var i,s,o=S.of(this._iid),a=o.logger,u=o.sdkState,c=new RegExp(el);if(t.length===0)return a.debug("sb.addSendbirdExtensions() has failed because the given sendbirdExtensions is empty."),!1;if(t.find(function(g){return!c.test(g.version)}))return a.debug("sb.addSendbirdExtensions() has failed because the given version did not satisfy the SemVer specification."),!1;if(r)try{for(var l=$(Object.entries(r)),d=l.next();!d.done;d=l.next()){var p=G(d.value,2),_=p[0],m=p[1];if(/&|=/.test(_)||/&|=/.test(m))return a.debug("sb.addSendbirdExtensions() has failed because the given customData includes at least one invalid character: = or &."),!1}}catch(g){i={error:g}}finally{try{d&&!d.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}return u.sendbirdRuntimeEnvironment={sendbirdExtensions:t,deviceOS:e,customData:r},!0},n.prototype.setOnlineListener=function(t){this._onlineDetector.setOnlineListener(t)},n.prototype.setOfflineListener=function(t){this._onlineDetector.setOfflineListener(t)},n.prototype._safeInitializeStore=function(t){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:e=S.of(this._iid).cacheContext,r.label=1;case 1:return r.trys.push([1,3,,5]),[4,e.store.init(t)];case 2:return r.sent(),this._storeInitialized=!0,[3,5];case 3:return r.sent(),e.replaceStore(new Mt),[4,this._safeInitializeStore(t)];case 4:return r.sent(),[3,5];case 5:return[2]}})})},n.prototype.initializeCache=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c,l;return h(this,function(d){switch(d.label){case 0:if(e=S.of(this._iid),r=e.sdkState,i=e.cacheContext,s=e.dispatcher,o=e.logger,r.userId&&r.userId===t)return[3,9];if(a="sendbird@".concat(r.appId,"/").concat(t,".db"),!i.localCacheEnabled)return[3,7];d.label=1;case 1:return d.trys.push([1,4,,6]),i.nestdb&&i.nestdb.state!==Tt.CLOSED&&i.nestdb.name===a?[3,3]:(u="sendbird@".concat(r.appId,"/").concat(t,".db"),(c=i.nestdb=new ip({name:u,version:this._getNestDBVersion(),store:i.store,config:new br({dbname:u,itemSizeLimit:61440})})).on("upgrade",ja(c)),c.on("storeReplaced",function(p){i.replaceStore(p),i.localCacheEnabled=!1,c.on("upgrade",ja(c))}),[4,c.open()]);case 2:d.sent(),this._storeInitialized=!0,s.dispatch(new Tp(this._iid,{userId:t})),d.label=3;case 3:return r.userId=t,[3,6];case 4:return l=d.sent(),o.warn("Nest DB Open Failed. ",l),i.store instanceof Mt||(i.replaceStore(new Mt),i.localCacheEnabled=!1),[4,this._safeInitializeStore(a)];case 5:throw d.sent(),r.userId=t,I.databaseError;case 6:return[3,9];case 7:return[4,this._safeInitializeStore(a)];case 8:d.sent(),r.userId=t,d.label=9;case 9:return[2]}})})},n.prototype.getCacheDataSize=function(){return f(this,void 0,void 0,function(){var t;return h(this,function(e){switch(e.label){case 0:return(t=S.of(this._iid).cacheContext).localCacheEnabled&&t.nestdb?[4,t.nestdb.estimateUsage()]:[3,2];case 1:return[2,e.sent()];case 2:return[2,0]}})})},n.prototype.clearCachedData=function(){return f(this,void 0,void 0,function(){var t;return h(this,function(e){switch(e.label){case 0:return(t=S.of(this._iid).cacheContext).localCacheEnabled&&t.nestdb?[4,t.nestdb.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return this._storeInitialized?[4,t.preference.clear()]:[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})},n.prototype.clearCachedMessages=function(t){return f(this,void 0,void 0,function(){var e,r,i=this;return h(this,function(s){switch(s.label){case 0:return R(Y("string",t)).throw(I.invalidParameters),e=uo.of(this._iid),r=wr.of(this._iid),e&&r?[4,Promise.all(t.map(function(o){return f(i,void 0,void 0,function(){return h(this,function(a){switch(a.label){case 0:return[4,e.removeMessagesOfChannel(o)];case 1:return a.sent(),[4,r.removeMessagesOfChannel(o)];case 2:return a.sent(),[2]}})})}))]:[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})},n.prototype._setupPreference=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o;return h(this,function(a){switch(a.label){case 0:return e=S.of(this._iid),r=e.sdkState,i=e.cacheContext,s=e.statLogCollector,[4,i.preference.init(this._getPreferenceCacheKey(t),this._getNestDBVersion())];case 1:return a.sent(),[4,i.preference.get(this._getUserProfileCacheKey(t))];case 2:return(o=a.sent())&&new Ds(this._iid,o).apply(),[4,s.init("sendbird@".concat(r.appId,"/").concat(t,".statlog"))];case 3:return a.sent(),[2]}})})},n.prototype._ready=function(t,e,r){return r===void 0&&(r={}),f(this,void 0,void 0,function(){var i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return R(w("string",t)&&w("string",e,!0)).throw(I.invalidParameters),i=S.of(this._iid),s=i.sdkState,o=i.cacheContext,a=i.connectionManager,u=r.errorForOtherUser,s.userId&&s.userId!==t?u?[3,2]:[4,a.logout()]:[3,3];case 1:return l.sent(),[3,3];case 2:throw u;case 3:return l.trys.push([3,5,6,8]),[4,this.initializeCache(t)];case 4:return l.sent(),S.of(this._iid).dispatcher.dispatch(new Cp),[3,8];case 5:return l.sent(),c=S.of(this._iid).logger,o.localCacheEnabled=!1,c.warn("Cache initialization failed - cache is not available."),[3,8];case 6:return[4,this._setupPreference(t)];case 7:return l.sent(),[7];case 8:return[2]}})})},n.prototype.authenticateFeed=function(t,e){var r;return f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){switch(a.label){case 0:return i=S.of(this._iid),s=i.sessionManager,o=i.connectionManager,[4,this._ready(t,e,{errorForOtherUser:o.isConnected?I.alreadyConnectedAsAnotherUser:void 0})];case 1:return a.sent(),!((r=s.session.services)===null||r===void 0)&&r.includes(lr.CHAT)?[3,3]:[4,s.authenticateFeed(t,e)];case 2:a.sent(),a.label=3;case 3:return[2,this.currentUser]}})})},n.prototype.connect=function(t,e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return[4,this._ready(t,e)];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,,4,5]),[4,S.of(this._iid).connectionManager.connect(e)];case 3:return r.sent(),[3,5];case 4:return this._onlineDetector.start(),this._appStateChangeDetector.start(),[7];case 5:return[2,this.currentUser]}})})},n.prototype.reconnect=function(){var t=S.of(this._iid),e=t.connectionManager,r=t.sdkState,i=t.sessionManager.session.hasSession;return i&&(this._appStateChangeDetector.start(),this._onlineDetector.start(),e.resetAndReconnect().then(function(){r.appState="foreground"}).catch(function(){})),i},n.prototype.disconnect=function(){return f(this,void 0,void 0,function(){var t,e,r,i;return h(this,function(s){switch(s.label){case 0:return t=S.of(this._iid),e=t.connectionManager,r=t.sdkState,i=t.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),i.cancelAll(),[4,e.logout()];case 1:return s.sent(),[4,this.clearCachedData()];case 2:return s.sent(),r.appState="foreground",[2]}})})},n.prototype.disconnectWebSocket=function(){return f(this,void 0,void 0,function(){var t,e,r;return h(this,function(i){switch(i.label){case 0:return t=S.of(this._iid),e=t.connectionManager,r=t.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),r.cancelAll(),[4,e.disconnectWebSocket(!0)];case 1:return i.sent(),[2]}})})},n.prototype.setBackgroundState=function(){var t=S.of(this._iid),e=t.connectionManager,r=t.sdkState,i=t.logger;r.appState==="foreground"&&(r.appState="background",i.debug("going background state"),e.background().catch(function(s){i.debug("setBackgroundState error = ",s)}))},n.prototype.setForegroundState=function(){var t=S.of(this._iid),e=t.connectionManager,r=t.sdkState,i=t.dispatcher,s=t.logger;r.appState==="background"&&(r.appState="foreground",s.debug("going foreground state"),e.resetAndReconnect().catch(function(o){s.debug("setForgroundState error = ",o)}),i.dispatch(new Ba))},n.prototype.setSessionHandler=function(t){R(t instanceof Ff).throw(I.invalidParameters),S.of(this._iid).sessionManager.handler=t},n.prototype.addUserEventHandler=function(t,e){R(w("string",t)&&e instanceof qf).throw(I.invalidParameters),S.of(this._iid).userEventHandlers.set(t,e)},n.prototype.removeUserEventHandler=function(t){S.of(this._iid).userEventHandlers.delete(t)},n.prototype.removeAllUserEventHandler=function(){S.of(this._iid).userEventHandlers.clear()},n.prototype.addConnectionHandler=function(t,e){R(w("string",t)&&e instanceof xf).throw(I.invalidParameters),S.of(this._iid).connectionHandlers.set(t,e)},n.prototype.removeConnectionHandler=function(t){S.of(this._iid).connectionHandlers.delete(t)},n.prototype.removeAllConnectionHandler=function(){S.of(this._iid).connectionHandlers.clear()},n.prototype.createApplicationUserListQuery=function(t){return t===void 0&&(t={}),new $f(this._iid,t)},n.prototype.createBlockedUserListQuery=function(t){return t===void 0&&(t={}),new Gf(this._iid,t)},n.prototype.createFriendListQuery=function(t){return t===void 0&&(t={}),new Qf(this._iid,t)},n.prototype.createMessageSearchQuery=function(t){return new vp(this._iid,t)},n.prototype.createPollListQuery=function(t){return new Ku(this._iid,E({},t))},n.prototype.createPollVoterListQuery=function(t){return new Qu(this._iid,E({},t))},n.prototype.buildUserFromSerializedData=function(t){var e=_r(t);return new V(this._iid,V.payloadify(e))},n.prototype.updateCurrentUserInfo=function(t){return t===void 0&&(t={}),f(this,void 0,void 0,function(){var e,r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return e=E(E({},kp),t),R(function(l){return je(l.profileImage,!0)&&w("string",l.profileUrl,!0)&&w("string",l.nickname,!0)}(e)).throw(I.invalidParameters),this.currentUser?(r=S.of(this._iid),i=r.sdkState,s=r.requestQueue,o=new Ga(E({userId:i.userId},e)),[4,s.send(o)]):[3,2];case 1:return a=c.sent(),u=a.as(Va).user,this.currentUser&&(e.nickname&&(this.currentUser.nickname=u.nickname),(e.profileUrl||e.profileImage)&&(this.currentUser.plainProfileUrl=u.profileUrl)),[2,u];case 2:throw I.connectionRequired}})})},n.prototype.updateCurrentUserInfoWithPreferredLanguages=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return R(Y("string",t)).throw(I.invalidParameters),this.currentUser?(e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new Ga({userId:r.userId,preferredLanguages:t}),[4,i.send(s)]):[3,2];case 1:return o=u.sent(),a=o.as(Va).user,this.currentUser&&(this.currentUser.preferredLanguages=a.preferredLanguages),[2,a];case 2:throw I.connectionRequired}})})},n.prototype.registerFCMPushTokenForCurrentUser=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a=this;return h(this,function(u){switch(u.label){case 0:if(R(w("string",t)).throw(I.invalidParameters),!this.currentUser)return[3,6];u.label=1;case 1:return u.trys.push([1,4,,5]),e=S.of(this._iid),r=e.sessionManager,i=e.sdkState,s=e.requestQueue,r.hasDeviceToken(me.FCM,t)?[2,Oe.SUCCESS]:(o=new Mp({userId:i.userId,token:t}),[4,s.send(o)]);case 2:return u.sent(),[4,Ae(function(){return f(a,void 0,void 0,function(){return h(this,function(c){switch(c.label){case 0:return r.setDeviceToken(me.FCM,t),[4,r.saveDeviceToken()];case 1:return c.sent(),[2]}})})})];case 3:return u.sent(),this._fcmPushToken="",[2,Oe.SUCCESS];case 4:return u.sent(),[2,Oe.ERROR];case 5:return[3,7];case 6:return this._fcmPushToken=t,[2,Oe.PENDING];case 7:return[2]}})})},n.prototype.unregisterFCMPushTokenForCurrentUser=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u=this;return h(this,function(c){switch(c.label){case 0:if(R(w("string",t)).throw(I.invalidParameters),!this.currentUser)return[3,6];c.label=1;case 1:return c.trys.push([1,4,,5]),e=S.of(this._iid),r=e.sessionManager,i=e.sdkState,s=e.requestQueue,o=new Pp({userId:i.userId,token:t}),[4,s.send(o)];case 2:return a=c.sent().lastDeletedAt,[4,Ae(function(){return f(u,void 0,void 0,function(){return h(this,function(l){switch(l.label){case 0:return r.unsetDeviceToken(me.FCM,t),r.setDeviceTokenDeletedAt(a),[4,r.saveDeviceToken()];case 1:return l.sent(),[2]}})})})];case 3:return c.sent(),this._fcmPushToken="",[2,Oe.SUCCESS];case 4:return c.sent(),[2,Oe.ERROR];case 5:return[3,7];case 6:return this._fcmPushToken=t,[2,Oe.PENDING];case 7:return[2]}})})},n.prototype.unregisterFCMPushTokenAllForCurrentUser=function(){return f(this,void 0,void 0,function(){var t,e,r,i,s,o,a=this;return h(this,function(u){switch(u.label){case 0:return this.currentUser?(t=S.of(this._iid),e=t.sessionManager,r=t.sdkState,i=t.requestQueue,s=new Fp({userId:r.userId}),[4,i.send(s)]):[3,3];case 1:return o=u.sent().lastDeletedAt,[4,Ae(function(){return f(a,void 0,void 0,function(){return h(this,function(c){switch(c.label){case 0:return e.unsetDeviceTokens(me.FCM),e.setDeviceTokenDeletedAt(o),[4,e.saveDeviceToken()];case 1:return c.sent(),[2]}})})})];case 2:u.sent(),u.label=3;case 3:return[2]}})})},n.prototype.registerAPNSPushTokenForCurrentUser=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a=this;return h(this,function(u){switch(u.label){case 0:if(R(w("string",t)).throw(I.invalidParameters),!this.currentUser)return[3,6];u.label=1;case 1:return u.trys.push([1,4,,5]),e=S.of(this._iid),r=e.sessionManager,i=e.sdkState,s=e.requestQueue,r.hasDeviceToken(me.APNS,t)?[2,Oe.SUCCESS]:(o=new Up({userId:i.userId,token:t}),[4,s.send(o)]);case 2:return u.sent(),[4,Ae(function(){return f(a,void 0,void 0,function(){return h(this,function(c){switch(c.label){case 0:return r.setDeviceToken(me.APNS,t),[4,r.saveDeviceToken()];case 1:return c.sent(),[2]}})})})];case 3:return u.sent(),this._apnsPushToken="",[2,Oe.SUCCESS];case 4:return u.sent(),[2,Oe.ERROR];case 5:return[3,7];case 6:return this._apnsPushToken=t,[2,Oe.PENDING];case 7:return[2]}})})},n.prototype.unregisterAPNSPushTokenForCurrentUser=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u=this;return h(this,function(c){switch(c.label){case 0:if(R(w("string",t)).throw(I.invalidParameters),!this.currentUser)return[3,6];c.label=1;case 1:return c.trys.push([1,4,,5]),e=S.of(this._iid),r=e.sessionManager,i=e.sdkState,s=e.requestQueue,o=new Lp({userId:i.userId,token:t}),[4,s.send(o)];case 2:return a=c.sent().lastDeletedAt,[4,Ae(function(){return f(u,void 0,void 0,function(){return h(this,function(l){switch(l.label){case 0:return r.unsetDeviceToken(me.APNS,t),r.setDeviceTokenDeletedAt(a),[4,r.saveDeviceToken()];case 1:return l.sent(),[2]}})})})];case 3:return c.sent(),this._apnsPushToken="",[2,Oe.SUCCESS];case 4:return c.sent(),[2,Oe.ERROR];case 5:return[3,7];case 6:return this._apnsPushToken=t,[2,Oe.PENDING];case 7:return[2]}})})},n.prototype.unregisterAPNSPushTokenAllForCurrentUser=function(){return f(this,void 0,void 0,function(){var t,e,r,i,s,o,a=this;return h(this,function(u){switch(u.label){case 0:return this.currentUser?(t=S.of(this._iid),e=t.sessionManager,r=t.sdkState,i=t.requestQueue,s=new xp({userId:r.userId}),[4,i.send(s)]):[3,3];case 1:return o=u.sent().lastDeletedAt,[4,Ae(function(){return f(a,void 0,void 0,function(){return h(this,function(c){switch(c.label){case 0:return e.unsetDeviceTokens(me.APNS),e.setDeviceTokenDeletedAt(o),[4,e.saveDeviceToken()];case 1:return c.sent(),[2]}})})})];case 2:u.sent(),u.label=3;case 3:return[2]}})})},n.prototype.getChannelInvitationPreference=function(){return f(this,void 0,void 0,function(){var t,e,r,i,s;return h(this,function(o){switch(o.label){case 0:return t=S.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new Hp({userId:e.userId}),[4,r.send(i)];case 1:return s=o.sent(),[2,{autoAccept:s.as($p).autoAccept}]}})})},n.prototype.setChannelInvitationPreference=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o;return h(this,function(a){switch(a.label){case 0:return R(w("boolean",t)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new Bp({userId:r.userId,willAutoAccept:t}),[4,i.send(s)];case 1:return o=a.sent(),[2,{autoAccept:o.as(jp).autoAccept}]}})})},n.prototype.getDoNotDisturb=function(){return f(this,void 0,void 0,function(){var t,e,r,i,s;return h(this,function(o){switch(o.label){case 0:return t=S.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new Gp({userId:e.userId}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(Vp).preference]}})})},n.prototype.setDoNotDisturb=function(t,e,r,i,s,o){return e===void 0&&(e=0),r===void 0&&(r=0),i===void 0&&(i=0),s===void 0&&(s=0),o===void 0&&(o=""),f(this,void 0,void 0,function(){var a,u,c,l,d;return h(this,function(p){switch(p.label){case 0:return R(w("boolean",t)&&w("number",e)&&w("number",r)&&w("number",i)&&w("number",s)&&w("string",o)).throw(I.invalidParameters),a=S.of(this._iid),u=a.sdkState,c=a.requestQueue,l=new Kp({userId:u.userId,doNotDisturbOn:t,startHour:e,startMin:r,endHour:i,endMin:s,timezone:o}),[4,c.send(l)];case 1:return d=p.sent(),[2,d.as(Qp).preference]}})})},n.prototype.getSnoozePeriod=function(){return f(this,void 0,void 0,function(){var t,e,r,i,s;return h(this,function(o){switch(o.label){case 0:return t=S.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new Wp({userId:e.userId}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(Yp).snoozePeriod]}})})},n.prototype.setSnoozePeriod=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=0),f(this,void 0,void 0,function(){var i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return R(w("boolean",t)&&w("number",e)&&w("number",r)).throw(I.invalidParameters),i=S.of(this._iid),s=i.sdkState,o=i.requestQueue,a=new Zp({userId:s.userId,snoozeOn:t,startTs:e,endTs:r}),[4,o.send(a)];case 1:return u=c.sent(),[2,u.as(Xp).snoozePeriod]}})})},n.prototype.getMyPushTokensByToken=function(t,e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l,d,p,_,m;return h(this,function(g){switch(g.label){case 0:return R(w("string",t)&&ce(me,e)).throw(I.invalidParameters),r=S.of(this._iid),i=r.sdkState,s=r.requestQueue,o=r.sessionManager,a=new qp({userId:i.userId,type:e,token:t}),[4,s.send(a)];case 1:u=g.sent(),c=u.as(zp).pushTokens;try{for(l=$(c.deviceTokens),d=l.next();!d.done;d=l.next())p=d.value,o.setDeviceToken(c.type,p)}catch(y){_={error:y}}finally{try{d&&!d.done&&(m=l.return)&&m.call(l)}finally{if(_)throw _.error}}return[4,o.saveDeviceToken()];case 2:return g.sent(),[2,c]}})})},n.prototype.getPushTriggerOption=function(){return f(this,void 0,void 0,function(){var t,e,r,i;return h(this,function(s){switch(s.label){case 0:return t=S.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new t_({userId:e.userId}),[4,r.send(i)];case 1:return[2,s.sent().as(n_).pushTriggerOption]}})})},n.prototype.setPushTriggerOption=function(t){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return R(ce(bs,t)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new r_({userId:r.userId,pushTriggerOption:t}),[4,i.send(s)];case 1:return[2,o.sent().as(i_).pushTriggerOption]}})})},n.prototype.getPushTemplate=function(){return f(this,void 0,void 0,function(){var t,e,r,i;return h(this,function(s){switch(s.label){case 0:return t=S.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new s_({userId:e.userId}),[4,r.send(i)];case 1:return[2,s.sent().as(o_).name]}})})},n.prototype.setPushTemplate=function(t){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return R(ce(ws,t)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new a_({userId:r.userId,templateName:t}),[4,i.send(s)];case 1:return[2,o.sent().as(u_).name]}})})},n.prototype.blockUser=function(t){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return R(t instanceof V||w("string",t)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new Jp({userId:r.userId,blockedUserId:t instanceof V?t.userId:t}),[4,i.send(s)];case 1:return o.sent(),[2]}})})},n.prototype.blockUserWithUserId=function(t){return f(this,void 0,void 0,function(){return h(this,function(e){return[2,this.blockUser(t)]})})},n.prototype.unblockUser=function(t){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return R(t instanceof V||w("string",t)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new e_({userId:r.userId,unblockedUserId:t instanceof V?t.userId:t}),[4,i.send(s)];case 1:return o.sent(),[2]}})})},n.prototype.unblockUserWithUserId=function(t){return f(this,void 0,void 0,function(){return h(this,function(e){return[2,this.unblockUser(t)]})})},n.prototype.getFriendChangeLogsByToken=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o;return h(this,function(a){switch(a.label){case 0:return R(w("string",t)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new c_({userId:r.userId,token:t}),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(l_).changelogs]}})})},n.prototype.getAllowFriendDiscovery=function(){return f(this,void 0,void 0,function(){var t,e,r,i,s;return h(this,function(o){switch(o.label){case 0:return t=S.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new m_({userId:e.userId}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(g_).allowFriendDiscovery]}})})},n.prototype.setAllowFriendDiscovery=function(t){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return R(w("boolean",t)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new y_({userId:r.userId,allowFriendDiscovery:t}),[4,i.send(s)];case 1:return o.sent(),[2,t]}})})},n.prototype.uploadFriendDiscoveries=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o;return h(this,function(a){switch(a.label){case 0:return e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new d_({userId:r.userId,discoveries:t}),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(h_).friendDiscoveryRequestId]}})})},n.prototype.deleteFriendDiscovery=function(t){return f(this,void 0,void 0,function(){return h(this,function(e){return[2,this.deleteFriendDiscoveries([t])]})})},n.prototype.deleteFriendDiscoveries=function(t){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return R(Y("string",t)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new f_({userId:r.userId,discoveryKeys:t}),[4,i.send(s)];case 1:return o.sent(),[2]}})})},n.prototype.addFriends=function(t){return f(this,void 0,void 0,function(){var e,r,i,s,o;return h(this,function(a){switch(a.label){case 0:return R(Y("string",t)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new p_({userId:r.userId,userIds:t}),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(__).users]}})})},n.prototype.deleteFriend=function(t){return f(this,void 0,void 0,function(){return h(this,function(e){return[2,this.deleteFriends([t])]})})},n.prototype.deleteFriends=function(t){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return R(Y("string",t)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new v_({userId:r.userId,userIds:t}),[4,i.send(s)];case 1:return o.sent(),[2]}})})},n.prototype.getAllEmoji=function(){return f(this,void 0,void 0,function(){var t,e,r;return h(this,function(i){switch(i.label){case 0:return t=S.of(this._iid).requestQueue,e=new E_,[4,t.send(e)];case 1:return r=i.sent(),[2,r.as(b_).emojiContainer]}})})},n.prototype.getEmojiCategory=function(t){return f(this,void 0,void 0,function(){var e,r,i;return h(this,function(s){switch(s.label){case 0:return e=S.of(this._iid).requestQueue,r=new w_({categoryId:t}),[4,e.send(r)];case 1:return i=s.sent(),[2,i.as(I_).emojiCategory]}})})},n.prototype.getEmoji=function(t){return f(this,void 0,void 0,function(){var e,r,i;return h(this,function(s){switch(s.label){case 0:return e=S.of(this._iid).requestQueue,r=new T_({key:t}),[4,e.send(r)];case 1:return i=s.sent(),[2,i.as(C_).emoji]}})})},n.prototype.getUIKitConfiguration=function(){return f(this,void 0,void 0,function(){var t,e,r,i;return h(this,function(s){switch(s.label){case 0:return t=S.of(this._iid),R(t.hasExtension("sb_uikit")).throw(I.notSupportedError),e=t.requestQueue,r=new S_,[4,e.send(r)];case 1:return i=s.sent(),[2,i.as(N_).uikitConfiguration]}})})},n}(),Ne;(function(n){n[n.NONE=0]="NONE",n[n.CHANNEL_ENTER=10102]="CHANNEL_ENTER",n[n.CHANNEL_EXIT=10103]="CHANNEL_EXIT",n[n.USER_CHANNEL_MUTE=10201]="USER_CHANNEL_MUTE",n[n.USER_CHANNEL_UNMUTE=10200]="USER_CHANNEL_UNMUTE",n[n.USER_CHANNEL_BAN=10601]="USER_CHANNEL_BAN",n[n.USER_CHANNEL_UNBAN=10600]="USER_CHANNEL_UNBAN",n[n.CHANNEL_FREEZE=10701]="CHANNEL_FREEZE",n[n.CHANNEL_UNFREEZE=10700]="CHANNEL_UNFREEZE",n[n.TYPING_START=10900]="TYPING_START",n[n.TYPING_END=10901]="TYPING_END",n[n.CHANNEL_JOIN=1e4]="CHANNEL_JOIN",n[n.CHANNEL_LEAVE=10001]="CHANNEL_LEAVE",n[n.CHANNEL_OPERATOR_UPDATE=10002]="CHANNEL_OPERATOR_UPDATE",n[n.CHANNEL_INVITE=10020]="CHANNEL_INVITE",n[n.CHANNEL_ACCEPT_INVITE=10021]="CHANNEL_ACCEPT_INVITE",n[n.CHANNEL_DECLINE_INVITE=10022]="CHANNEL_DECLINE_INVITE",n[n.CHANNEL_PROP_CHANGED=11e3]="CHANNEL_PROP_CHANGED",n[n.CHANNEL_DELETED=12e3]="CHANNEL_DELETED",n[n.CHANNEL_META_DATA_CHANGED=11100]="CHANNEL_META_DATA_CHANGED",n[n.CHANNEL_META_COUNTERS_CHANGED=11200]="CHANNEL_META_COUNTERS_CHANGED",n[n.CHANNEL_HIDE=13e3]="CHANNEL_HIDE",n[n.CHANNEL_UNHIDE=13001]="CHANNEL_UNHIDE",n[n.PINNED_MESSAGE_CHANGED=11300]="PINNED_MESSAGE_CHANGED"})(Ne||(Ne={}));var k_=function(){function n(t){var e;this.channelUrl=t.channel_url,this.channelType=t.channel_type,this.category=t.cat,this.data=(e=t.data)!==null&&e!==void 0?e:{},this.ts=t.ts}return Object.defineProperty(n.prototype,"isGroupChannelEvent",{get:function(){return this.channelType===W.GROUP},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isOpenChannelEvent",{get:function(){return this.channelType===W.OPEN},enumerable:!1,configurable:!0}),n}(),Ti=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.event=new k_(i),s}return v(t,n),t}(de),O_=function(n){function t(e,r,i){var s=n.call(this,e,r,i)||this,o=i.data.operators,a=o===void 0?[]:o;return s.operators=a.map(function(u){return new V(s._iid,u)}),s}return v(t,n),t}(Ti),D_=function(n){function t(e,r){var i=n.call(this,e)||this;return i._logger=r.logger,i._sdkState=r.sdkState,i._sessionManager=r.sessionManager,i._requestQueue=r.requestQueue,i._dispatcher=r.dispatcher,i._cacheContext=r.cacheContext,i._channelType=r.channelType,i}return v(t,n),Object.defineProperty(t.prototype,"_messageBroadcast",{get:function(){return ac.of(this._iid)},enumerable:!1,configurable:!0}),t.prototype.subscribeMessageEvent=function(e,r){this._messageBroadcast.subscribe(e,r)},t.prototype.unsubscribeMessageEvent=function(e){this._messageBroadcast.unsubscribe(e)},t.prototype.getMessageFromCache=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2,null]})})},t.prototype.getExactlyMatchingMessagesForTokenFromCache=function(e,r,i){return f(this,void 0,void 0,function(){return h(this,function(s){return[2,[]]})})},t.prototype.getMessagesFromCache=function(e,r,i,s,o,a){return f(this,void 0,void 0,function(){return h(this,function(u){return[2,[]]})})},t.prototype.getPollMessagesFromCache=function(e,r,i,s){return f(this,void 0,void 0,function(){return h(this,function(o){return[2,[]]})})},t.prototype.getCachedMessageCountBetween=function(e,r,i,s){return f(this,void 0,void 0,function(){return h(this,function(o){return[2,0]})})},t.prototype.getUnsentMessagesFromCache=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){return[2,[]]})})},t.prototype.removeFailedMessageFromCache=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2]})})},t}(Me),R_=function(n){function t(e,r,i){var s,o,a,u,c=this;(c=n.call(this,e,"ADMM",i)||this).message=new mr(e,i);var l=S.of(e).sdkState;return c.isMentioned=In(c.message.mentionType,(a=(s=c.message.mentionedUserIds)!==null&&s!==void 0?s:(o=c.message.mentionedUsers)===null||o===void 0?void 0:o.map(function(d){return d.userId}))!==null&&a!==void 0?a:[],l.userId),c.forceUpdateLastMessage=(u=i.force_update_last_message)!==null&&u!==void 0&&u,c}return v(t,n),t}(de),U_=function(n){function t(e,r,i){var s,o,a,u,c,l=this;(l=n.call(this,e,"AEDI",i)||this).message=new mr(e,i);var d=S.of(e).sdkState;return l.mentionCountChange=Ys({mentionType:(s=i.old_values)===null||s===void 0?void 0:s.mention_type,mentionedUserIds:(a=(o=i.old_values)===null||o===void 0?void 0:o.mentioned_user_ids)!==null&&a!==void 0?a:[]},H({mentionType:l.message.mentionType,mentionedUserIds:(u=l.message.mentionedUserIds)!==null&&u!==void 0?u:(c=l.message.mentionedUsers)===null||c===void 0?void 0:c.map(function(p){return p.userId})}),d.userId),l}return v(t,n),t}(de),M_=function(n){function t(e,r,i){var s=n.call(this,e,"MRCT",i)||this;return s.channelUrl=i.channel_url,s.channelType=i.channel_type,s.event=new so(i),s}return v(t,n),t}(de),L_=function(n){function t(e,r,i){var s=n.call(this,e,"MTHD",i)||this;return s.event=new hp(e,i),s}return v(t,n),t}(de),P_=function(n){function t(e,r,i){var s=n.call(this,e,"MCNT",i)||this;return s.groupChannelMemberCounts=i.group_channels.map(function(o){return{channelUrl:o.channel_url,memberCount:o.member_count,joinedMemberCount:o.joined_member_count,updatedAt:o.ts}}),s.openChannelMemberCounts=i.open_channels.map(function(o){return{channelUrl:o.channel_url,participantCount:o.participant_count,updatedAt:o.ts}}),s}return v(t,n),t}(de),x_=function(n){function t(e,r,i){var s=n.call(this,e,"PEDI",i)||this;return s.event=new Ep(e,i),s.status=Rs(i.poll.status)||i.poll.status,s.channelUrl=i.channel_url,s.channelType=i.channel_type,s}return v(t,n),t}(de),F_=function(){this.onUserMuted=j,this.onUserUnmuted=j,this.onUserBanned=j,this.onUserUnbanned=j,this.onChannelChanged=j,this.onChannelDeleted=j,this.onChannelFrozen=j,this.onChannelUnfrozen=j,this.onOperatorUpdated=j,this.onChannelMemberCountChanged=j,this.onMetaDataCreated=j,this.onMetaDataUpdated=j,this.onMetaDataDeleted=j,this.onMetaCounterCreated=j,this.onMetaCounterUpdated=j,this.onMetaCounterDeleted=j,this.onMessageReceived=j,this.onMessageUpdated=j,this.onMessageDeleted=j,this.onMentionReceived=j,this.onReactionUpdated=j,this.onThreadInfoUpdated=j},q_=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e._channels=new Map,e._enteredChannelUrls=[],e}return v(t,n),Object.defineProperty(t.prototype,"enteredChannels",{get:function(){var e=this;return this._enteredChannelUrls.map(function(r){return e._channels.get(r)}).filter(function(r){return!!r})},enumerable:!1,configurable:!0}),t.prototype.isEnteredChannel=function(e){return this._enteredChannelUrls.includes(e)},t.prototype.enter=function(e){this._enteredChannelUrls.indexOf(e)<0&&this._enteredChannelUrls.push(e)},t.prototype.exit=function(e){var r=this._enteredChannelUrls.indexOf(e);r>=0&&this._enteredChannelUrls.splice(r,1)},t.prototype.exitAll=function(){this._enteredChannelUrls=[]},t.prototype.get=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2,this._channels.get(e)]})})},t.prototype.upsert=function(e){return f(this,void 0,void 0,function(){var r,i=this;return h(this,function(s){return r=[],e.forEach(function(o){if(i._channels.has(o.url)){var a=i._channels.get(o.url);Object.assign(a,o),r.push(a)}else i._channels.set(o.url,o),r.push(o)}),[2,r]})})},t.prototype.remove=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return this._channels.delete(e),this.exit(e),[2]})})},t.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(e){return this._channels.clear(),this._enteredChannelUrls=[],[2]})})},t}(Me),dc={channelUrl:void 0,name:void 0,coverUrlOrImage:void 0,data:void 0,customType:void 0,operatorUserIds:void 0,isEphemeral:void 0},z_=function(n){function t(e){var r=e.channelUrl,i=e.isInternalCall,s=n.call(this)||this;return s.method=O.GET,s.path="".concat(i?Gc:un,"/").concat(encodeURIComponent(r)),s}return v(t,n),t}(D),Ka=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.channel=new On(e,r),i}return v(t,n),t}(U),H_=function(n){function t(e){var r=this,i=e.channelUrl,s=e.coverUrlOrImage,o=e.name,a=e.data,u=e.customType,c=e.operatorUserIds,l=e.isEphemeral;return(r=n.call(this)||this).method=O.POST,r.path=un,r.params=x(H({channel_url:i,cover_url:w("string",s)?s:null,cover_file:je(s)?s:null,name:o,data:a,custom_type:u,operators:c,is_ephemeral:l})),r}return v(t,n),t}(D);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.channel=new On(e,r),i}v(t,n)})(U);var $_=function(n){function t(e){var r=e.channelUrl;return n.call(this,{code:"ENTR",payload:{channel_url:r},ackRequired:!0})||this}return v(t,n),t}(qe),hc=function(n){function t(e,r,i){var s,o,a=this;return a=n.call(this,e,"SYEV",i)||this,i.data&&(a.participantCount=(s=i.data.participant_count)!==null&&s!==void 0?s:0,a.user=new V(e,i.data),a.ts=(o=i.data.edge_ts)!==null&&o!==void 0?o:0),a}return v(t,n),t}(Ti),B_=function(n){function t(e){var r=e.channelUrl;return n.call(this,{code:"EXIT",payload:{channel_url:r},ackRequired:!0})||this}return v(t,n),t}(qe),fc=function(n){function t(e,r,i){var s,o,a=this;return a=n.call(this,e,"EXIT",i)||this,i.data&&(a.participantCount=(s=i.data.participant_count)!==null&&s!==void 0?s:0,a.user=new V(e,i.data),a.ts=(o=i.data.edge_ts)!==null&&o!==void 0?o:0),a}return v(t,n),t}(Ti),vs={},Yt=function(n){function t(e,r){var i=n.call(this,e,E(E({},r),{channelType:W.OPEN}))||this;return i.subscribeChannelEvent=j,i.unsubscribeChannelEvent=j,i.refreshChannel=function(){return f(i,void 0,void 0,function(){return h(this,function(s){return[2,j()]})})},i._openChannelCache=new q_(e),i._openChannelHandlers=new Map,i._dispatcher.on(function(s){var o,a;if(s instanceof de)i._handleEvent(s).catch(function(d){if(et(d)&&i._sdkState.appState==="foreground")throw d});else if(s instanceof ln&&s.stateType===ie.CONNECTED){var u=i._openChannelCache.enteredChannels;try{for(var c=$(u),l=c.next();!l.done;l=c.next())l.value.enter()}catch(d){o={error:d}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}}}),vs[e]||(vs[e]=i),i}return v(t,n),t.of=function(e){return vs[e]},t.prototype.buildOpenChannelFromSerializedData=function(e){var r=_r(e);return new On(this._iid,On.payloadify(r))},t.prototype.getChannelFromCache=function(e){var r;return f(this,void 0,void 0,function(){return h(this,function(i){switch(i.label){case 0:return[4,this._openChannelCache.get(e)];case 1:return[2,(r=i.sent())!==null&&r!==void 0?r:null]}})})},t.prototype.upsertChannelsToCache=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return[4,this._openChannelCache.upsert(e)];case 1:return[2,r.sent()]}})})},t.prototype.removeChannelsFromCache=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),r=$(e),i=r.next(),c.label=1;case 1:return i.done?[3,4]:(s=i.value,[4,this._openChannelCache.remove(s)]);case 2:c.sent(),c.label=3;case 3:return i=r.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),a={error:o},[3,7];case 6:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(a)throw a.error}return[7];case 7:return[2]}})})},t.prototype.setEnteredToCache=function(e){this._openChannelCache.enter(e.url)},t.prototype.setExitedToCache=function(e){this._openChannelCache.exit(e.url)},t.prototype._handleEvent=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l,d,p,_,m,g,y,b,T,C,N,P,A,F,z,L,M,se,Le,st,At,yt,Ci,Ze,kt,co,ye,Ir,Si,lo,ho,Tr,Ni,fn,fo,po,Cr,Ai,ki,Oi,Di,Ri,Ui,Mi,Ln,Li,Sr,_o,Bt,Nr,Pn,xn,Fn,Ar,kr,Pi,xi,Fi,qi,zi,vo,Ee=this;return h(this,function(J){switch(J.label){case 0:switch(J.trys.push([0,57,,58]),e.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"MRCT":return[3,10];case"MTHD":return[3,13];case"MCNT":return[3,16];case"PEDI":return[3,27];case"VOTE":return[3,30];case"SYEV":return[3,33]}return[3,56];case 1:return o=null,e.code==="MESG"?o=e.as(rc):e.code==="FILE"?o=e.as(Xu):e.code!=="ADMM"&&e.code!="BRDM"||(o=e.as(R_)),o?(r=o.message,i=o.isMentioned,r.channelType!==W.OPEN?[3,3]:[4,this.getChannel(r.channelUrl,!0)]):[3,3];case 2:s=J.sent(),K(function(){return f(Ee,void 0,void 0,function(){var B,k,te,ne,he;return h(this,function(Ot){try{for(B=$(this._openChannelHandlers.values()),k=B.next();!k.done;k=B.next())te=k.value,this._openChannelCache.isEnteredChannel(s.url)&&(te.onMessageReceived&&te.onMessageReceived(s,r),i&&te.onMentionReceived&&te.onMentionReceived(s,r))}catch(Te){ne={error:Te}}finally{try{k&&!k.done&&(he=B.return)&&he.call(B)}finally{if(ne)throw ne.error}}return[2]})})}),J.label=3;case 3:return[3,56];case 4:return o=null,e.code==="MEDI"?o=e.as(zs):e.code==="FEDI"?o=e.as(Hs):e.code==="AEDI"&&(o=e.as(U_)),o?(a=o.message,u=o.mentionCountChange,a.channelType!==W.OPEN?[3,6]:[4,this.getChannel(a.channelUrl,!0)]):[3,6];case 5:c=J.sent(),K(function(){return f(Ee,void 0,void 0,function(){var B,k,te,ne,he;return h(this,function(Ot){try{for(B=$(this._openChannelHandlers.values()),k=B.next();!k.done;k=B.next())te=k.value,this._openChannelCache.isEnteredChannel(c.url)&&(te.onMessageUpdated&&te.onMessageUpdated(c,a),u>0&&te.onMentionReceived&&te.onMentionReceived(c,a))}catch(Te){ne={error:Te}}finally{try{k&&!k.done&&(he=B.return)&&he.call(B)}finally{if(ne)throw ne.error}}return[2]})})}),J.label=6;case 6:return[3,56];case 7:return l=e.as(rf),Ze=l.channelUrl,kt=l.channelType,d=l.messageId,kt!==W.OPEN?[3,9]:[4,this.getChannel(Ze,!0)];case 8:p=J.sent(),K(function(){return f(Ee,void 0,void 0,function(){var B,k,te,ne,he;return h(this,function(Ot){try{for(B=$(this._openChannelHandlers.values()),k=B.next();!k.done;k=B.next())te=k.value,this._openChannelCache.isEnteredChannel(p.url)&&te.onMessageDeleted&&te.onMessageDeleted(p,d)}catch(Te){ne={error:Te}}finally{try{k&&!k.done&&(he=B.return)&&he.call(B)}finally{if(ne)throw ne.error}}return[2]})})}),J.label=9;case 9:return[3,56];case 10:return _=e.as(M_),Ze=_.channelUrl,kt=_.channelType,m=_.event,kt!==W.OPEN?[3,12]:[4,this.getChannel(Ze,!0)];case 11:g=J.sent(),K(function(){return f(Ee,void 0,void 0,function(){var B,k,te,ne,he;return h(this,function(Ot){try{for(B=$(this._openChannelHandlers.values()),k=B.next();!k.done;k=B.next())te=k.value,this._openChannelCache.isEnteredChannel(g.url)&&te.onReactionUpdated&&te.onReactionUpdated(g,m)}catch(Te){ne={error:Te}}finally{try{k&&!k.done&&(he=B.return)&&he.call(B)}finally{if(ne)throw ne.error}}return[2]})})}),J.label=12;case 12:return[3,56];case 13:return(y=e.as(L_).event).channelType!==W.OPEN?[3,15]:[4,this.getChannel(y.channelUrl,!0)];case 14:b=J.sent(),K(function(){return f(Ee,void 0,void 0,function(){var B,k,te,ne,he;return h(this,function(Ot){try{for(B=$(this._openChannelHandlers.values()),k=B.next();!k.done;k=B.next())te=k.value,this._openChannelCache.isEnteredChannel(b.url)&&te.onThreadInfoUpdated&&te.onThreadInfoUpdated(b,y)}catch(Te){ne={error:Te}}finally{try{k&&!k.done&&(he=B.return)&&he.call(B)}finally{if(ne)throw ne.error}}return[2]})})}),J.label=15;case 15:return[3,56];case 16:T=e.as(P_).openChannelMemberCounts,C=[],J.label=17;case 17:J.trys.push([17,22,23,24]),N=$(T),P=N.next(),J.label=18;case 18:return P.done?[3,21]:(A=P.value,Ze=A.channelUrl,fn=A.participantCount,F=A.updatedAt,[4,this.getChannelFromCache(Ze)]);case 19:(z=J.sent())&&z._updateParticipantCount(fn,F)&&C.push(z),J.label=20;case 20:return P=N.next(),[3,18];case 21:return[3,24];case 22:return L=J.sent(),zi={error:L},[3,24];case 23:try{P&&!P.done&&(vo=N.return)&&vo.call(N)}finally{if(zi)throw zi.error}return[7];case 24:return C.length>0?[4,this.upsertChannelsToCache(C)]:[3,26];case 25:M=J.sent(),K(function(){return f(Ee,void 0,void 0,function(){var B,k,te,ne,he;return h(this,function(Ot){try{for(B=$(this._openChannelHandlers.values()),k=B.next();!k.done;k=B.next())(te=k.value).onChannelMemberCountChanged&&te.onChannelMemberCountChanged(M)}catch(Te){ne={error:Te}}finally{try{k&&!k.done&&(he=B.return)&&he.call(B)}finally{if(ne)throw ne.error}}return[2]})})}),J.label=26;case 26:return[3,56];case 27:return se=e.as(x_),Le=se.event,st=se.status,Ze=se.channelUrl,kt=se.channelType,Ze&&kt===W.OPEN?[4,this.getChannel(Ze,!0)]:[3,29];case 28:At=J.sent(),this._dispatcher.dispatch(new $u({event:Le,source:re.EVENT_POLL_UPDATED})),K(st===Sd?function(){return f(Ee,void 0,void 0,function(){var B,k,te,ne,he;return h(this,function(Ot){try{for(B=$(this._openChannelHandlers.values()),k=B.next();!k.done;k=B.next())(te=k.value).onPollDeleted&&te.onPollDeleted(At,Le.pollId)}catch(Te){ne={error:Te}}finally{try{k&&!k.done&&(he=B.return)&&he.call(B)}finally{if(ne)throw ne.error}}return[2]})})}:function(){return f(Ee,void 0,void 0,function(){var B,k,te,ne,he;return h(this,function(Ot){try{for(B=$(this._openChannelHandlers.values()),k=B.next();!k.done;k=B.next())(te=k.value).onPollUpdated&&te.onPollUpdated(At,Le)}catch(Te){ne={error:Te}}finally{try{k&&!k.done&&(he=B.return)&&he.call(B)}finally{if(ne)throw ne.error}}return[2]})})}),J.label=29;case 29:return[3,56];case 30:return yt=e.as(ic),Ci=yt.event,Ze=yt.channelUrl,kt=yt.channelType,Ze&&kt===W.OPEN?[4,this.getChannel(Ze,!0)]:[3,32];case 31:co=J.sent(),this._dispatcher.dispatch(new io({event:Ci,source:re.EVENT_POLL_VOTED})),K(function(){return f(Ee,void 0,void 0,function(){var B,k,te,ne,he;return h(this,function(Ot){try{for(B=$(this._openChannelHandlers.values()),k=B.next();!k.done;k=B.next())(te=k.value).onPollVoted&&te.onPollVoted(co,Ci)}catch(Te){ne={error:Te}}finally{try{k&&!k.done&&(he=B.return)&&he.call(B)}finally{if(ne)throw ne.error}}return[2]})})}),J.label=32;case 32:return[3,56];case 33:if(!(ye=e.as(Ti).event).isOpenChannelEvent)return[3,55];switch(ye.category){case Ne.CHANNEL_ENTER:return[3,34];case Ne.CHANNEL_EXIT:return[3,36];case Ne.CHANNEL_OPERATOR_UPDATE:return[3,38];case Ne.USER_CHANNEL_MUTE:case Ne.USER_CHANNEL_UNMUTE:return[3,40];case Ne.USER_CHANNEL_BAN:case Ne.USER_CHANNEL_UNBAN:return[3,42];case Ne.CHANNEL_FREEZE:case Ne.CHANNEL_UNFREEZE:return[3,44];case Ne.CHANNEL_DELETED:return[3,46];case Ne.CHANNEL_PROP_CHANGED:return[3,49];case Ne.CHANNEL_META_DATA_CHANGED:return[3,51];case Ne.CHANNEL_META_COUNTERS_CHANGED:return[3,53]}return[3,55];case 34:return[4,this.getChannel(ye.channelUrl,!0)];case 35:return Ir=J.sent(),Si=e.as(hc),fn=Si.participantCount,lo=Si.user,ho=Ir._updateParticipantCount(fn,ye.ts),K(function(){return f(Ee,void 0,void 0,function(){return h(this,function(B){return this._openChannelHandlers.forEach(function(k){k.onUserEntered&&k.onUserEntered(Ir,lo),ho&&k.onChannelParticipantCountChanged&&k.onChannelParticipantCountChanged(Ir)}),[2]})})}),[3,55];case 36:return[4,this.getChannel(ye.channelUrl,!0)];case 37:return Tr=J.sent(),Ni=e.as(fc),fn=Ni.participantCount,fo=Ni.user,po=Tr._updateParticipantCount(fn,ye.ts),K(function(){return f(Ee,void 0,void 0,function(){return h(this,function(B){return this._openChannelHandlers.forEach(function(k){k.onUserExited&&k.onUserExited(Tr,fo),po&&k.onChannelParticipantCountChanged&&k.onChannelParticipantCountChanged(Tr)}),[2]})})}),[3,55];case 38:return[4,this.getChannel(ye.channelUrl,!0)];case 39:return Cr=J.sent(),Ai=e.as(O_).operators,Cr.operators=Ai,this.upsertChannelsToCache([Cr]),K(function(){return f(Ee,void 0,void 0,function(){return h(this,function(B){return this._openChannelHandlers.forEach(function(k){k.onOperatorUpdated&&k.onOperatorUpdated(Cr,Ai)}),[2]})})}),[3,55];case 40:return[4,this.getChannel(ye.channelUrl,!0)];case 41:return ki=J.sent(),Oi=ye.category===Ne.USER_CHANNEL_MUTE,Di=e.as(Oi?jh:Vh).user,K(function(){return f(Ee,void 0,void 0,function(){return h(this,function(B){return this._openChannelHandlers.forEach(function(k){Oi?k.onUserMuted&&k.onUserMuted(ki,Di):k.onUserUnmuted&&k.onUserUnmuted(ki,Di)}),[2]})})}),[3,55];case 42:return[4,this.getChannel(ye.channelUrl,!0)];case 43:return Ri=J.sent(),Ui=ye.category===Ne.USER_CHANNEL_BAN,Mi=e.as(Ui?Qh:Yh).user,K(function(){return f(Ee,void 0,void 0,function(){return h(this,function(B){return this._openChannelHandlers.forEach(function(k){Ui?k.onUserBanned&&k.onUserBanned(Ri,Mi):k.onUserUnbanned&&k.onUserUnbanned(Ri,Mi)}),[2]})})}),[3,55];case 44:return[4,this.getChannel(ye.channelUrl,!0)];case 45:return Ln=J.sent(),Li=e.as(Zh).freeze,Ln.isFrozen=Li,this.upsertChannelsToCache([Ln]),K(function(){return f(Ee,void 0,void 0,function(){return h(this,function(B){return this._openChannelHandlers.forEach(function(k){Li?k.onChannelFrozen&&k.onChannelFrozen(Ln):k.onChannelUnfrozen&&k.onChannelUnfrozen(Ln)}),[2]})})}),[3,55];case 46:return[4,this.getChannel(ye.channelUrl,!0)];case 47:return Sr=J.sent(),[4,this.removeChannelsFromCache([Sr.url])];case 48:return J.sent(),K(function(){return f(Ee,void 0,void 0,function(){return h(this,function(B){return this._openChannelHandlers.forEach(function(k){k.onChannelDeleted&&k.onChannelDeleted(Sr.url,Sr.channelType)}),[2]})})}),[3,55];case 49:return[4,this.getChannelWithoutCache(ye.channelUrl,!0)];case 50:return _o=J.sent(),K(function(){return f(Ee,void 0,void 0,function(){return h(this,function(B){return this._openChannelHandlers.forEach(function(k){k.onChannelChanged&&k.onChannelChanged(_o)}),[2]})})}),[3,55];case 51:return[4,this.getChannel(ye.channelUrl,!0)];case 52:return Bt=J.sent(),Nr=e.as(Uh),Pn=Nr.created,xn=Nr.updated,Fn=Nr.deleted,Pn&&Bt._upsertCachedMetaData(Pn,ye.ts),xn&&Bt._upsertCachedMetaData(xn,ye.ts),Fn&&Bt._removeFromCachedMetaData(Fn,ye.ts),K(function(){return f(Ee,void 0,void 0,function(){return h(this,function(B){return this._openChannelHandlers.forEach(function(k){Pn&&k.onMetaDataCreated&&k.onMetaDataCreated(Bt,Pn),xn&&k.onMetaDataUpdated&&k.onMetaDataUpdated(Bt,xn),Fn&&k.onMetaDataDeleted&&k.onMetaDataDeleted(Bt,Fn)}),[2]})})}),[3,55];case 53:return[4,this.getChannel(ye.channelUrl,!0)];case 54:return Ar=J.sent(),kr=e.as(zh),Pi=kr.created,xi=kr.updated,Fi=kr.deleted,K(function(){return f(Ee,void 0,void 0,function(){return h(this,function(B){return this._openChannelHandlers.forEach(function(k){Pi&&k.onMetaCounterCreated&&k.onMetaCounterCreated(Ar,Pi),xi&&k.onMetaCounterUpdated&&k.onMetaCounterUpdated(Ar,xi),Fi&&k.onMetaCounterDeleted&&k.onMetaCounterDeleted(Ar,Fi)}),[2]})})}),[3,55];case 55:return[3,56];case 56:return[3,58];case 57:if(qi=J.sent(),et(qi))throw qi;return[3,58];case 58:return[2]}})})},t.prototype.addHandler=function(e,r){this._openChannelHandlers.set(e,r)},t.prototype.removeHandler=function(e){this._openChannelHandlers.delete(e)},t.prototype.clearHandler=function(){this._openChannelHandlers.clear()},t.prototype.getChannel=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:R(w("string",e)).throw(I.invalidParameters),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.getChannelFromCache(e)];case 2:return(i=s.sent())?[2,i]:[3,4];case 3:return s.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(e)];case 5:return[2,s.sent()]}})})},t.prototype.getChannelWithoutCache=function(e,r){return r===void 0&&(r=!1),f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){switch(a.label){case 0:return R(w("string",e)).throw(I.invalidParameters),i=new z_({channelUrl:e,isInternalCall:r}),[4,this._requestQueue.send(i)];case 1:return s=a.sent(),o=s.as(Ka).channel,[4,this.upsertChannelsToCache([o])];case 2:return[2,a.sent()[0]]}})})},t.prototype.createChannel=function(e){return f(this,void 0,void 0,function(){var r,i,s,o;return h(this,function(a){switch(a.label){case 0:return r=E(E({},dc),e),R(function(u){return Y("string",u.operatorUserIds,!0)&&(w("string",u.coverUrlOrImage,!0)||je(u.coverUrlOrImage,!0))&&w("string",u.name,!0)&&w("string",u.data,!0)&&w("string",u.customType,!0)&&(w("string",u.channelUrl)&&/^\w+$/.test(u.channelUrl)||u.channelUrl===null||u.channelUrl===void 0)&&w("boolean",u.isEphemeral,!0)}(r)).throw(I.invalidParameters),i=new H_(r),[4,this._requestQueue.send(i)];case 1:return s=a.sent(),o=s.as(Ka).channel,this.upsertChannelsToCache([o]),[2,o]}})})},t}(D_),Qa={name:void 0,coverUrlOrImage:void 0,data:void 0,customType:void 0,operatorUserIds:void 0},j_=function(n){function t(e){var r=this,i=e.channelUrl,s=e.token,o=e.limit;return(r=n.call(this)||this).method=O.GET,r.path="".concat(un,"/").concat(encodeURIComponent(i),"/participants"),r.params={token:s,limit:o},r}return v(t,n),t}(D),G_=function(n){function t(e,r){var i=n.call(this,e,r)||this;i.participants=[];var s=r.next,o=r.participants;return i.token=s,i.participants=o.map(function(a){return new uh(e,a)}),i}return v(t,n),t}(U),V_=function(n){function t(e,r,i){return n.call(this,e,r,W.OPEN,i)||this}return v(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)},t.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid).requestQueue,r=new j_(E(E({},this),{token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(G_),o=s.participants,a=s.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,o];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},t}(hn),K_=function(n){function t(e){var r=this,i=e.channelUrl,s=e.coverUrlOrImage,o=e.name,a=e.data,u=e.customType,c=e.operatorUserIds;return(r=n.call(this)||this).method=O.PUT,r.path="".concat(un,"/").concat(encodeURIComponent(i)),r.params=x(H({cover_url:w("string",s)?s:null,cover_file:je(s)?s:null,name:o,data:a,custom_type:u,operators:c})),r}return v(t,n),t}(D),Q_=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.channel=new On(e,r),i}return v(t,n),t}(U),W_=function(n){function t(e){var r=this,i=e.channelUrl;return(r=n.call(this)||this).method=O.DELETE,r.path="".concat(un,"/").concat(encodeURIComponent(i)),r}return v(t,n),t}(D);(function(n){function t(e,r){return n.call(this,e,r)||this}v(t,n)})(U);var On=function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,r)||this)._lastParticipantCountUpdated=0,s.participantCount=0,s.operators=[],s.channelType=W.OPEN,s.participantCount=(i=r.participant_count)!==null&&i!==void 0?i:0,s.operators=Array.isArray(r.operators)?r.operators.map(function(o){return new V(e,o)}):[],s}return v(t,n),t.payloadify=function(e){return x(H(E(E({},Oa.payloadify(e)),{participant_count:e.participantCount,operators:e.operators.map(function(r){return V.payloadify(r)})})))},t.prototype.serialize=function(){return gi(this)},t.prototype.isOperator=function(e){return e instanceof V?this.isOperator(e.userId):this.operators.some(function(r){return r.userId===e})},t.prototype._updateParticipantCount=function(e,r){return r>this._lastParticipantCountUpdated&&(this.participantCount=e,this._lastParticipantCountUpdated=r,!0)},t.prototype.createParticipantListQuery=function(e){return new V_(this._iid,this.url,e)},t.prototype.refresh=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,Yt.of(this._iid).getChannelWithoutCache(this.url)];case 1:return[2,e.sent()]}})})},t.prototype.enter=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return e=S.of(this._iid).requestQueue,r=new $_({channelUrl:this.url}),[4,e.send(r)];case 1:return i=u.sent(),s=i.as(hc),o=s.participantCount,a=s.ts,this._updateParticipantCount(o,a),Yt.of(this._iid).setEnteredToCache(this),[2]}})})},t.prototype.exit=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return e=S.of(this._iid).requestQueue,r=new B_({channelUrl:this.url}),[4,e.send(r)];case 1:return i=u.sent(),s=i.as(fc),o=s.participantCount,a=s.ts,this._updateParticipantCount(o,a),Yt.of(this._iid).setExitedToCache(this),Ie.of(this._iid).fileMessageQueue.cancel(this),[2]}})})},t.prototype.updateChannel=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return r=E(E({},Qa),e),R(function(c){return Y("string",c.operatorUserIds,!0)&&(w("string",c.coverUrlOrImage,!0)||je(c.coverUrlOrImage,!0))&&w("string",c.name,!0)&&w("string",c.data,!0)&&w("string",c.customType,!0)}(r)).throw(I.invalidParameters),i=S.of(this._iid).requestQueue,s=new K_(E({channelUrl:this.url},r)),[4,i.send(s)];case 1:return o=u.sent(),a=o.as(Q_).channel,this._update(a),[4,Yt.of(this._iid).upsertChannelsToCache([a])];case 2:return u.sent(),[2,this]}})})},t.prototype.updateChannelWithOperatorUserIds=function(e,r,i,s,o){return f(this,void 0,void 0,function(){var a;return h(this,function(u){return a=E(E({},Qa),{name:e,coverUrlOrImage:r,data:i,operatorUserIds:s,customType:o}),[2,this.updateChannel(a)]})})},t.prototype.delete=function(){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return e=S.of(this._iid).requestQueue,r=new W_({channelUrl:this.url}),[4,e.send(r)];case 1:return i.sent(),[4,Yt.of(this._iid).removeChannelsFromCache([this.url])];case 2:return i.sent(),[2]}})})},t.prototype.sendUserMessage=function(e){return R(!e.isPinnedMessage).throw(I.notSupportedError),n.prototype.sendUserMessage.call(this,e)},t.prototype.sendFileMessage=function(e){return R(!e.isPinnedMessage).throw(I.notSupportedError),n.prototype.sendFileMessage.call(this,e)},t}(Oa),Y_=function(n){function t(e){e===void 0&&(e={});var r=n.call(this)||this;return Object.keys(e).forEach(function(i){r.hasOwnProperty(i)&&(r[i]=e[i])}),r}return v(t,n),t}(function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.onUserEntered=j,e.onUserExited=j,e.onChannelParticipantCountChanged=j,e.onPollUpdated=j,e.onPollVoted=j,e.onPollDeleted=j,e}return v(t,n),t}(F_)),Z_=function(n){function t(e){var r=this,i=e.token,s=e.limit,o=e.nameKeyword,a=e.urlKeyword,u=e.customTypes,c=e.includeFrozen,l=e.includeMetaData;return(r=n.call(this)||this).method=O.GET,r.path=un,r.params=x({token:i,limit:s,name_contains:o,url_contains:a,custom_types:u,show_frozen:c,show_metadata:l}),r}return v(t,n),t}(D),X_=function(n){function t(e,r){var i=n.call(this,e,r)||this;i.channels=[];var s=r.next,o=r.channels,a=r.ts;return i.token=s,o&&o.length>0&&(i.channels=o.map(function(u){return new On(e,u)})),i.ts=typeof a=="number"?a:null,i}return v(t,n),t}(U),J_=function(n){function t(e,r){var i,s,o,a,u,c=this;return(c=n.call(this,e,r)||this).includeFrozen=!0,c.includeMetaData=!0,c.nameKeyword=null,c.urlKeyword=null,c.customTypes=null,c.includeFrozen=(i=r.includeFrozen)===null||i===void 0||i,c.includeMetaData=(s=r.includeMetaData)===null||s===void 0||s,c.nameKeyword=(o=r.nameKeyword)!==null&&o!==void 0?o:null,c.urlKeyword=(a=r.urlKeyword)!==null&&a!==void 0?a:null,c.customTypes=(u=r.customTypes)!==null&&u!==void 0?u:null,c}return v(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&w("boolean",this.includeFrozen)&&w("boolean",this.includeMetaData)&&w("string",this.nameKeyword,!0)&&w("string",this.urlKeyword,!0)&&Y("string",this.customTypes,!0)},t.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,4]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid).requestQueue,r=new Z_(H(E(E({},this),{token:this._token}))),[4,e.send(r)]):[3,3]:[3,6];case 1:return i=u.sent(),s=i.as(X_),o=s.channels,a=s.token,this._token=a,this._hasNext=!!a,[4,Yt.of(this._iid).upsertChannelsToCache(o)];case 2:return u.sent(),this._isLoading=!1,[2,o];case 3:return[2,[]];case 4:throw I.queryInProgress;case 5:return[3,7];case 6:throw I.invalidParameters;case 7:return[2]}})})},t}(Un),ev=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.name="openChannel",e}return v(t,n),t.prototype.init=function(e,r){var i=r.sdkState,s=r.dispatcher,o=r.sessionManager,a=r.requestQueue,u=r.logger,c=r.onlineDetector,l=r.cacheContext;n.prototype.init.call(this,e,{sdkState:i,dispatcher:s,sessionManager:o,requestQueue:a,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Yt(e,{sdkState:i,dispatcher:s,requestQueue:a,logger:u,cacheContext:l,sessionManager:o})},t.prototype.createOpenChannelListQuery=function(e){return e===void 0&&(e={}),new J_(this._iid,e)},t.prototype.addOpenChannelHandler=function(e,r){this._manager.addHandler(e,r)},t.prototype.removeOpenChannelHandler=function(e){this._manager.removeHandler(e)},t.prototype.removeAllOpenChannelHandlers=function(){this._manager.clearHandler()},t.prototype.buildOpenChannelFromSerializedData=function(e){return this._manager.buildOpenChannelFromSerializedData(e)},t.prototype.getChannel=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2,this._manager.getChannel(e)]})})},t.prototype.getChannelWithoutCache=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2,this._manager.getChannelWithoutCache(e)]})})},t.prototype.createChannel=function(e){return e===void 0&&(e={}),f(this,void 0,void 0,function(){return h(this,function(r){return[2,this._manager.createChannel(e)]})})},t.prototype.createChannelWithOperatorUserIds=function(e,r,i,s,o){return f(this,void 0,void 0,function(){var a;return h(this,function(u){return(a=E({},dc)).name=e,a.coverUrlOrImage=r,a.data=i,a.operatorUserIds=s,a.customType=o,[2,this._manager.createChannel(a)]})})},t}(ro);function Wa(n,t,e){const r=n.slice();return r[13]=t[e],r[15]=e,r}function Ya(n){let t,e,r,i,s,o,a,u,c,l,d,p,_=bo(n[2]),m=[];for(let g=0;g<_.length;g+=1)m[g]=Za(Wa(n,_,g));return{c(){t=at("div"),e=at("div"),e.textContent="Docs AI Assistant",r=Vn(),i=at("div"),s=at("div");for(let g=0;g<m.length;g+=1)m[g].c();o=Vn(),a=at("div"),u=at("input"),c=Vn(),l=at("button"),l.textContent="",Vt(e,"class","header"),Vt(u,"type","text"),Vt(u,"placeholder",""),Vt(i,"class","main-contents flex flex-col justify-between"),Vt(t,"class","flex flex-col gap-2 justify-end justify-items-end p-6 shadow-2xl rounded-lg")},m(g,y){Ks(g,t,y),He(t,e),He(t,r),He(t,i),He(i,s);for(let b=0;b<m.length;b+=1)m[b]&&m[b].m(s,null);He(i,o),He(i,a),He(a,u),go(u,n[1]),He(a,c),He(a,l),d||(p=[ms(u,"input",n[5]),ms(l,"click",n[4])],d=!0)},p(g,y){if(y&4){_=bo(g[2]);let b;for(b=0;b<_.length;b+=1){const T=Wa(g,_,b);m[b]?m[b].p(T,y):(m[b]=Za(T),m[b].c(),m[b].m(s,null))}for(;b<m.length;b+=1)m[b].d(1);m.length=_.length}y&2&&u.value!==g[1]&&go(u,g[1])},d(g){g&&pi(t),gc(m,g),d=!1,yr(p)}}}function Za(n){let t,e=n[13]+"",r,i;return{c(){t=at("div"),r=eu(e),i=Vn()},m(s,o){Ks(s,t,o),He(t,r),He(t,i)},p(s,o){o&4&&e!==(e=s[13]+"")&&Ec(r,e)},d(s){s&&pi(t)}}}function tv(n){let t,e,r,i,s,o,a=n[0]&&Ya(n);return{c(){t=at("main"),e=at("div"),a&&a.c(),r=Vn(),i=at("div"),i.innerHTML=`<img src="${Uc}" class="logo svelte svelte-wx6zqz" alt="Svelte Logo"/>`,Vt(i,"class","flex justify-end"),Vt(e,"class","img-wrapper svelte-wx6zqz")},m(u,c){Ks(u,t,c),He(t,e),a&&a.m(e,null),He(e,r),He(e,i),s||(o=ms(i,"click",n[3]),s=!0)},p(u,[c]){u[0]?a?a.p(u,c):(a=Ya(u),a.c(),a.m(e,r)):a&&(a.d(1),a=null)},i:cr,o:cr,d(u){u&&pi(t),a&&a.d(),s=!1,o()}}}const nv="testkun",rv="sendbird_open_channel_72664_f6edf60ba5071a58433ae0746545fc5665f7e839";function iv(n,t,e){let r=!1,i="",s=null,o=["aaaaaaaaaaaaaaaa"];const a=A_.init({appId:"0CBCE5B8-CABA-476F-9079-D7FCAF0A58DC",modules:[new ev]}),u=new Y_;u.onMessageReceived=(y,b)=>{l(b.message)};const c=async y=>{try{const b={nextResultSize:20,prevResultSize:0},C=(await y.getMessagesByTimestamp(0,b)).map(N=>N.message);return l(C),C}catch(b){return console.log(b),null}},l=y=>{console.log(y),console.log(typeof y=="string"),e(2,o=typeof y=="string"?[...o,y]:[...o,...y])},d=async()=>{e(0,r=!r),r&&(await _(),s=await m(),s&&(await s.enter(),await c(s),a.openChannel.addOpenChannelHandler("jonouagebrgojnerjogbouabrionaojbrb",u)))},p=async()=>{if(!s)return;const y={message:i};s.sendUserMessage(y).onPending(b=>{}).onFailed((b,T)=>{}).onSucceeded(b=>{e(1,i=""),l(b.message)})},_=async()=>{try{const y=await a.connect(nv)}catch{}},m=async()=>{try{return await a.openChannel.getChannel(rv)}catch{return null}};function g(){i=this.value,e(1,i)}return[r,i,o,d,p,g]}class sv extends Dc{constructor(t){super(),Oc(this,t,iv,tv,vc,{})}}new sv({target:document.getElementById("relation-widget")});export{du as H,S as L,Zs as P,U as R,oi as X,Re as Y,Tn as a,I as g};
