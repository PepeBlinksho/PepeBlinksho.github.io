var svelteproject=function(){"use strict";var qv=Object.defineProperty;var zv=(Mt,We,Lt)=>We in Mt?qv(Mt,We,{enumerable:!0,configurable:!0,writable:!0,value:Lt}):Mt[We]=Lt;var So=(Mt,We,Lt)=>(zv(Mt,typeof We!="symbol"?We+"":We,Lt),Lt);function Mt(t,n){for(var e=0;e<n.length;e++){const r=n[e];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}function We(){}function Lt(t){return t()}function Ao(){return Object.create(null)}function Gn(t){t.forEach(Lt)}function No(t){return typeof t=="function"}function qc(t,n){return t!=t?n==n:t!==n||t&&typeof t=="object"||typeof t=="function"}function zc(t){return Object.keys(t).length===0}function ze(t,n){t.appendChild(n)}function zi(t,n,e){t.insertBefore(n,e||null)}function Pr(t){t.parentNode&&t.parentNode.removeChild(t)}function Hc(t,n){for(let e=0;e<t.length;e+=1)t[e]&&t[e].d(n)}function nt(t){return document.createElement(t)}function Oo(t){return document.createTextNode(t)}function Vn(){return Oo(" ")}function Hi(t,n,e,r){return t.addEventListener(n,e,r),()=>t.removeEventListener(n,e,r)}function Zt(t,n,e){e==null?t.removeAttribute(n):t.getAttribute(n)!==e&&t.setAttribute(n,e)}function $c(t){return Array.from(t.childNodes)}function jc(t,n){n=""+n,t.data!==n&&(t.data=n)}function ko(t,n){t.value=n??""}let $i;function Kn(t){$i=t}const wn=[],Ro=[];let In=[];const Do=[],Bc=Promise.resolve();let ji=!1;function Gc(){ji||(ji=!0,Bc.then(Uo))}function Bi(t){In.push(t)}const Gi=new Set;let Tn=0;function Uo(){if(Tn!==0)return;const t=$i;do{try{for(;Tn<wn.length;){const n=wn[Tn];Tn++,Kn(n),Vc(n.$$)}}catch(n){throw wn.length=0,Tn=0,n}for(Kn(null),wn.length=0,Tn=0;Ro.length;)Ro.pop()();for(let n=0;n<In.length;n+=1){const e=In[n];Gi.has(e)||(Gi.add(e),e())}In.length=0}while(wn.length);for(;Do.length;)Do.pop()();ji=!1,Gi.clear(),Kn(t)}function Vc(t){if(t.fragment!==null){t.update(),Gn(t.before_update);const n=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,n),t.after_update.forEach(Bi)}}function Kc(t){const n=[],e=[];In.forEach(r=>t.indexOf(r)===-1?n.push(r):e.push(r)),e.forEach(r=>r()),In=n}const Qc=new Set;function Wc(t,n){t&&t.i&&(Qc.delete(t),t.i(n))}function Mo(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Yc(t,n,e){const{fragment:r,after_update:i}=t.$$;r&&r.m(n,e),Bi(()=>{const s=t.$$.on_mount.map(Lt).filter(No);t.$$.on_destroy?t.$$.on_destroy.push(...s):Gn(s),t.$$.on_mount=[]}),i.forEach(Bi)}function Zc(t,n){const e=t.$$;e.fragment!==null&&(Kc(e.after_update),Gn(e.on_destroy),e.fragment&&e.fragment.d(n),e.on_destroy=e.fragment=null,e.ctx=[])}function Xc(t,n){t.$$.dirty[0]===-1&&(wn.push(t),Gc(),t.$$.dirty.fill(0)),t.$$.dirty[n/31|0]|=1<<n%31}function Jc(t,n,e,r,i,s,o=null,a=[-1]){const u=$i;Kn(t);const c=t.$$={fragment:null,ctx:[],props:s,update:We,not_equal:i,bound:Ao(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(u?u.$$.context:[])),callbacks:Ao(),dirty:a,skip_bound:!1,root:n.target||u.$$.root};o&&o(c.root);let l=!1;if(c.ctx=e?e(t,n.props||{},(d,p,..._)=>{const v=_.length?_[0]:p;return c.ctx&&i(c.ctx[d],c.ctx[d]=v)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](v),l&&Xc(t,d)),p}):[],c.update(),l=!0,Gn(c.before_update),c.fragment=r?r(c.ctx):!1,n.target){if(n.hydrate){const d=$c(n.target);c.fragment&&c.fragment.l(d),d.forEach(Pr)}else c.fragment&&c.fragment.c();n.intro&&Wc(t.$$.fragment),Yc(t,n.target,n.anchor),Uo()}Kn(u)}class el{constructor(){So(this,"$$");So(this,"$$set")}$destroy(){Zc(this,1),this.$destroy=We}$on(n,e){if(!No(e))return We;const r=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return r.push(e),()=>{const i=r.indexOf(e);i!==-1&&r.splice(i,1)}}$set(n){this.$$set&&!zc(n)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}}const tl="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(tl);const nl="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20aria-hidden='true'%20role='img'%20class='iconify%20iconify--logos'%20width='26.6'%20height='32'%20preserveAspectRatio='xMidYMid%20meet'%20viewBox='0%200%20256%20308'%3e%3cpath%20fill='%23FF3E00'%20d='M239.682%2040.707C211.113-.182%20154.69-12.301%20113.895%2013.69L42.247%2059.356a82.198%2082.198%200%200%200-37.135%2055.056a86.566%2086.566%200%200%200%208.536%2055.576a82.425%2082.425%200%200%200-12.296%2030.719a87.596%2087.596%200%200%200%2014.964%2066.244c28.574%2040.893%2084.997%2053.007%20125.787%2027.016l71.648-45.664a82.182%2082.182%200%200%200%2037.135-55.057a86.601%2086.601%200%200%200-8.53-55.577a82.409%2082.409%200%200%200%2012.29-30.718a87.573%2087.573%200%200%200-14.963-66.244'%3e%3c/path%3e%3cpath%20fill='%23FFF'%20d='M106.889%20270.841c-23.102%206.007-47.497-3.036-61.103-22.648a52.685%2052.685%200%200%201-9.003-39.85a49.978%2049.978%200%200%201%201.713-6.693l1.35-4.115l3.671%202.697a92.447%2092.447%200%200%200%2028.036%2014.007l2.663.808l-.245%202.659a16.067%2016.067%200%200%200%202.89%2010.656a17.143%2017.143%200%200%200%2018.397%206.828a15.786%2015.786%200%200%200%204.403-1.935l71.67-45.672a14.922%2014.922%200%200%200%206.734-9.977a15.923%2015.923%200%200%200-2.713-12.011a17.156%2017.156%200%200%200-18.404-6.832a15.78%2015.78%200%200%200-4.396%201.933l-27.35%2017.434a52.298%2052.298%200%200%201-14.553%206.391c-23.101%206.007-47.497-3.036-61.101-22.649a52.681%2052.681%200%200%201-9.004-39.849a49.428%2049.428%200%200%201%2022.34-33.114l71.664-45.677a52.218%2052.218%200%200%201%2014.563-6.398c23.101-6.007%2047.497%203.036%2061.101%2022.648a52.685%2052.685%200%200%201%209.004%2039.85a50.559%2050.559%200%200%201-1.713%206.692l-1.35%204.116l-3.67-2.693a92.373%2092.373%200%200%200-28.037-14.013l-2.664-.809l.246-2.658a16.099%2016.099%200%200%200-2.89-10.656a17.143%2017.143%200%200%200-18.398-6.828a15.786%2015.786%200%200%200-4.402%201.935l-71.67%2045.674a14.898%2014.898%200%200%200-6.73%209.975a15.9%2015.9%200%200%200%202.709%2012.012a17.156%2017.156%200%200%200%2018.404%206.832a15.841%2015.841%200%200%200%204.402-1.935l27.345-17.427a52.147%2052.147%200%200%201%2014.552-6.397c23.101-6.006%2047.497%203.037%2061.102%2022.65a52.681%2052.681%200%200%201%209.003%2039.848a49.453%2049.453%200%200%201-22.34%2033.12l-71.664%2045.673a52.218%2052.218%200%200%201-14.563%206.398'%3e%3c/path%3e%3c/svg%3e";var Vi=function(t,n){return Vi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])},Vi(t,n)};function g(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=t}Vi(t,n),t.prototype=n===null?Object.create(n):(e.prototype=n.prototype,new e)}var b=function(){return b=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},b.apply(this,arguments)};function rl(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function"){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)n.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(e[r[i]]=t[r[i]])}return e}function f(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(c){try{u(r.next(c))}catch(l){s(l)}}function a(c){try{u(r.throw(c))}catch(l){s(l)}}function u(c){var l;c.done?i(c.value):(l=c.value,l instanceof e?l:new e(function(d){d(l)})).then(o,a)}u((r=r.apply(t,n||[])).next())})}function h(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(c){return function(l){if(e)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(o=0)),o;)try{if(e=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,r=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(i=o.trys,!((i=i.length>0&&i[i.length-1])||l[0]!==6&&l[0]!==2)){o=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){o.label=l[1];break}if(l[0]===6&&o.label<i[1]){o.label=i[1],i=l;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(l);break}i[2]&&o.ops.pop(),o.trys.pop();continue}l=n.call(t,o)}catch(d){l=[6,d],r=0}finally{e=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}function $(t){var n=typeof Symbol=="function"&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function G(t,n){var e=typeof Symbol=="function"&&t[Symbol.iterator];if(!e)return t;var r,i,s=e.call(t),o=[];try{for(;(n===void 0||n-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(e=s.return)&&e.call(s)}finally{if(i)throw i.error}}return o}function Z(t,n,e){if(e||arguments.length===2)for(var r,i=0,s=n.length;i<s;i++)!r&&i in n||(r||(r=Array.prototype.slice.call(n,0,i)),r[i]=n[i]);return t.concat(r||Array.prototype.slice.call(n))}typeof SuppressedError=="function"&&SuppressedError;var z,Lo="4.11.0",Pt=function(){function t(){}return Object.defineProperty(t,"OS_VERSION",{get:function(){return typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"SDK_VERSION",{get:function(){return Lo},enumerable:!1,configurable:!0}),Object.defineProperty(t,"SDK_MAJOR_VERSION",{get:function(){return t.SDK_VERSION.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty(t,"INTERNAL_CALL",{get:function(){return"ic"},enumerable:!1,configurable:!0}),t}();(function(t){t[t.NON_AUTHORIZED=400108]="NON_AUTHORIZED",t[t.INVALID_TOKEN=400111]="INVALID_TOKEN",t[t.NOT_FOUND_IN_DATABASE=400201]="NOT_FOUND_IN_DATABASE",t[t.USER_AUTH_DEACTIVATED=400300]="USER_AUTH_DEACTIVATED",t[t.USER_AUTH_DELETED_OR_NOT_FOUND=400301]="USER_AUTH_DELETED_OR_NOT_FOUND",t[t.SESSION_TOKEN_EXPIRED=400302]="SESSION_TOKEN_EXPIRED",t[t.APPLICATION_NOT_FOUND=400304]="APPLICATION_NOT_FOUND",t[t.SESSION_KEY_EXPIRED=400309]="SESSION_KEY_EXPIRED",t[t.SESSION_REVOKED=400310]="SESSION_REVOKED",t[t.INVALID_SESSION_TYPE=400312]="INVALID_SESSION_TYPE",t[t.STAT_UPLOAD_NOT_ALLOWED=403200]="STAT_UPLOAD_NOT_ALLOWED",t[t.NOT_SUPPORTED_PINNED_MESSAGE_IN_REVIEW_MESSAGE=400940]="NOT_SUPPORTED_PINNED_MESSAGE_IN_REVIEW_MESSAGE",t[t.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",t[t.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",t[t.INVALID_FORM_KEY=400111]="INVALID_FORM_KEY",t[t.INVALID_REQUIRED_FORM_VALUE=400105]="INVALID_REQUIRED_FORM_VALUE",t[t.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",t[t.NOT_SUPPORTED_FEATURE_IN_IN_REVIEW_MESSAGE=901500]="NOT_SUPPORTED_FEATURE_IN_IN_REVIEW_MESSAGE",t[t.ERR_DUPLICATED_DATA=400202]="ERR_DUPLICATED_DATA",t[t.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",t[t.LOST_INSTANCE=700100]="LOST_INSTANCE",t[t.CONNECTION_RENEW=700102]="CONNECTION_RENEW",t[t.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",t[t.INVALID_COMMAND=700700]="INVALID_COMMAND",t[t.XMLHTTPREQUEST_NOT_SUPPORTED=700800]="XMLHTTPREQUEST_NOT_SUPPORTED",t[t.UNKNOWN_ERROR=77e4]="UNKNOWN_ERROR",t[t.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",t[t.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",t[t.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",t[t.INVALID_PARAMETER=800110]="INVALID_PARAMETER",t[t.NOT_SUPPORTED_ERROR=800111]="NOT_SUPPORTED_ERROR",t[t.NETWORK_ERROR=800120]="NETWORK_ERROR",t[t.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",t[t.MALFORMED_DATA=800130]="MALFORMED_DATA",t[t.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",t[t.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",t[t.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",t[t.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",t[t.ACK_TIMEOUT=800180]="ACK_TIMEOUT",t[t.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",t[t.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",t[t.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",t[t.REQUEST_FAILED=800220]="REQUEST_FAILED",t[t.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",t[t.REQUEST_CANCELED=800240]="REQUEST_CANCELED",t[t.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",t[t.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",t[t.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",t[t.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",t[t.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED",t[t.COLLECTION_DISPOSED=800600]="COLLECTION_DISPOSED",t[t.DATABASE_ERROR=800700]="DATABASE_ERROR"})(z||(z={}));var Pe,Ki,me,Qi,Qn,rt=function(t){return!(t instanceof I&&!t.shouldThrowOutside)},I=function(t){function n(e){var r=e.code,i=r===void 0?0:r,s=e.message,o=s===void 0?"":s,a=t.call(this,o)||this;return a.shouldThrowOutside=!1,a._detail="",a.name="SendbirdError",a.code=i,Object.setPrototypeOf(a,n.prototype),a}return g(n,t),Object.defineProperty(n.prototype,"detail",{get:function(){return this._detail},enumerable:!1,configurable:!0}),n.prototype.setDetail=function(e){this._detail=e},Object.defineProperty(n.prototype,"isInvalidTokenError",{get:function(){return this.code===z.INVALID_TOKEN},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionExpiredError",{get:function(){return this.isSessionTokenExpiredError||this.isSessionKeyExpiredError},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionTokenExpiredError",{get:function(){return this.code===z.SESSION_TOKEN_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionKeyExpiredError",{get:function(){return this.code===z.SESSION_KEY_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionInvalidatedError",{get:function(){return this.isSessionRevokedError||this.isUserAuthDeactivedError||this.isUserAuthDeletedOrNotFoundError},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionRevokedError",{get:function(){return this.code===z.SESSION_REVOKED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isUserAuthDeactivedError",{get:function(){return this.code===z.USER_AUTH_DEACTIVATED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isUserAuthDeletedOrNotFoundError",{get:function(){return this.code===z.USER_AUTH_DELETED_OR_NOT_FOUND},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isNetworkError",{get:function(){return this.code===z.NETWORK_ERROR||this.code===z.NETWORK_ROUTING_ERROR},enumerable:!1,configurable:!0}),Object.defineProperty(n,"debugModeRequired",{get:function(){return new n({code:z.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"lostInstance",{get:function(){return new n({code:z.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"invalidCommand",{get:function(){return new n({code:z.INVALID_COMMAND,message:"Cannot send invalid command."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"unknown",{get:function(){return new n({code:z.UNKNOWN_ERROR,message:"Unknown error occurred."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionRenew",{get:function(){return new n({code:z.CONNECTION_RENEW,message:"Connection restarts."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"invalidConnectionStateTransition",{get:function(){return new n({code:z.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"xmlHttpRequestNotSupported",{get:function(){return new n({code:z.XMLHTTPREQUEST_NOT_SUPPORTED,message:"Cannot upload file. XMLHttpRequest is not defined in this environment."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionRequired",{get:function(){return new n({code:z.CONNECTION_REQUIRED,message:"Connection is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionCanceled",{get:function(){return new n({code:z.CONNECTION_CANCELED,message:"Connection is canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"invalidParameters",{get:function(){return new n({code:z.INVALID_PARAMETER,message:"Invalid parameters."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"notSupportedError",{get:function(){return new n({code:z.NOT_SUPPORTED_ERROR,message:"Given parameters are not supported."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"channelTypeNotSupportedError",{get:function(){return new n({code:z.NOT_SUPPORTED_ERROR,message:"Called method is not supported in the current channel's channel type."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"networkError",{get:function(){return new n({code:z.NETWORK_ERROR,message:"There was a network error."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"markAsReadAllRateLimitExceeded",{get:function(){return new n({code:z.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"queryInProgress",{get:function(){return new n({code:z.QUERY_IN_PROGRESS,message:"Query in progress."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"noAckTimeout",{get:function(){return new n({code:z.ACK_TIMEOUT,message:"Command received no ack."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"loginTimeout",{get:function(){return new n({code:z.LOGIN_TIMEOUT,message:"Connection timeout."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionClosed",{get:function(){return new n({code:z.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"requestFailed",{get:function(){return new n({code:z.REQUEST_FAILED,message:"Request failed."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"alreadyConnectedAsAnotherUser",{get:function(){return new n({code:z.REQUEST_FAILED,message:"Already logged in as a different user. Call disconnect() first."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"fileUploadCanceled",{get:function(){return new n({code:z.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"requestCanceled",{get:function(){return new n({code:z.REQUEST_CANCELED,message:"Request has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"sessionTokenRefreshFailed",{get:function(){return new n({code:z.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"sessionTokenRequestFailed",{get:function(){return new n({code:z.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"databaseError",{get:function(){return new n({code:z.DATABASE_ERROR,message:"Database error."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"fileSizeLimitExceededError",{get:function(){return new n({code:z.FILE_SIZE_LIMIT_EXCEEDED,message:"File size exceeds the file size limit."})},enumerable:!1,configurable:!0}),n.prototype.throwOutside=function(){throw this.shouldThrowOutside=!0,this},n}(Error),il=[z.CONNECTION_REQUIRED,z.NETWORK_ERROR,z.ACK_TIMEOUT,z.WEBSOCKET_CONNECTION_CLOSED,z.WEBSOCKET_CONNECTION_FAILED,z.FILE_UPLOAD_CANCEL_FAILED,z.REQUEST_CANCELED,z.INTERNAL_SERVER_ERROR,z.RATE_LIMIT_EXCEEDED,z.UNKNOWN_SERVER_ERROR],sl=[z.WEBSOCKET_CONNECTION_CLOSED,z.WEBSOCKET_CONNECTION_FAILED,z.CONNECTION_REQUIRED],Po=function(t,n){if(t!==n){var e=b({},t),r=b({},n);return(!e.hasOwnProperty("messageId")||!r.hasOwnProperty("messageId")||e.messageId===r.messageId)&&(!e.hasOwnProperty("reqId")||!r.hasOwnProperty("reqId")||e.reqId===r.reqId)&&(e.hasOwnProperty("messageId")&&delete e.messageId,e.hasOwnProperty("reqId")&&delete e.reqId,r.hasOwnProperty("messageId")&&delete r.messageId,r.hasOwnProperty("reqId")&&delete r.reqId,JSON.stringify(e)===JSON.stringify(r))}return!0},T=function(t,n,e){return e===void 0&&(e=!1),!(!e||!Fr(n))||(typeof t!="string"?typeof t=="object"?ue(t,n):ol(t,n):typeof n===t)},ue=function(t,n,e){return e===void 0&&(e=!1),!(!e||!Fr(n))||Object.values(t).includes(n)},ol=function(t,n){return n instanceof t},X=function(t,n,e){return e===void 0&&(e=!1),!(!e||!Fr(n))||Array.isArray(n)&&n.every(function(r){return T(t,r)})},al=function(t){return t>0&&il.indexOf(t)>=0},xr=function(t){return t>0&&sl.indexOf(t)>=0},Ge=function(t,n){if(n===void 0&&(n=!1),n&&Fr(t))return!0;var e=typeof t=="object"&&t!==null&&t.hasOwnProperty("name")&&typeof t.name=="string"&&t.hasOwnProperty("uri")&&typeof t.uri=="string"&&t.hasOwnProperty("type")&&typeof t.type=="string";if(!e){if(typeof Blob<"u")return t instanceof Blob;if(typeof File<"u")return t instanceof File}return e},Fr=function(t){return t==null},xo=function(){function t(n){var e=n===void 0?{}:n,r=e.useMemberInfoInMessage,i=r===void 0||r,s=e.typingIndicatorInvalidateTime,o=s===void 0?1e4:s,a=e.typingIndicatorThrottle,u=a===void 0?1e3:a,c=e.websocketResponseTimeout,l=c===void 0?1e4:c,d=e.websocketPayloadDecompression,p=d===void 0||d,_=e.sessionTokenRefreshTimeout,v=_===void 0?60:_;this._useMemberInfoInMessage=!0,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._sessionTokenRefreshTimeout=60,this._useMemberInfoInMessage=i,this._typingIndicatorInvalidateTime=o,this._typingIndicatorThrottle=u,this._websocketResponseTimeout=l,this._sessionTokenRefreshTimeout=v,this.websocketPayloadDecompression=p}return Object.defineProperty(t.prototype,"useMemberInfoInMessage",{get:function(){return this._useMemberInfoInMessage},set:function(n){T("boolean",n)&&(this._useMemberInfoInMessage=n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"typingIndicatorInvalidateTime",{get:function(){return this._typingIndicatorInvalidateTime},set:function(n){T("number",n)&&(this._typingIndicatorInvalidateTime=n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"typingIndicatorThrottle",{get:function(){return this._typingIndicatorThrottle},set:function(n){T("number",n)&&n>=1e3&&n<=9e3&&(this._typingIndicatorThrottle=n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"websocketResponseTimeout",{get:function(){return this._websocketResponseTimeout},set:function(n){T("number",n)&&n>=5e3&&n<=3e4&&(this._websocketResponseTimeout=n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sessionTokenRefreshTimeout",{get:function(){return this._sessionTokenRefreshTimeout},set:function(n){T("number",n)&&(n<60?n=60:n>1800&&(n=1800),this._sessionTokenRefreshTimeout=n)},enumerable:!1,configurable:!0}),t}(),Fo={encrypt:function(t){return t},decrypt:function(t){return t}},qo=function(){function t(n){var e=n.store;this._preference=new Map,this._store=e}return t.prototype._savePreferenceKeys=function(){return f(this,void 0,void 0,function(){return h(this,function(n){switch(n.label){case 0:return[4,this._store.set({key:this._keysAddress,value:Z([],G(this._preference.keys()),!1)})];case 1:return n.sent(),[2]}})})},t.prototype.init=function(n,e){var r;return e===void 0&&(e=1),f(this,void 0,void 0,function(){var i,s,o,a,u,c,l,d,p,_;return h(this,function(v){switch(v.label){case 0:return this._version=e,this._keysAddress=n,i="".concat(n,".metadata.version"),[4,this._store.get(i)];case 1:return s=v.sent(),[4,this._store.get(n)];case 2:return o=(r=v.sent())!==null&&r!==void 0?r:[],!s||s.version<this._version?[4,this._resetPreferenceData(o,i)]:[3,4];case 3:return v.sent(),[3,11];case 4:v.trys.push([4,9,10,11]),a=$(o),u=a.next(),v.label=5;case 5:return u.done?[3,8]:(c=u.value,[4,this._store.get(c)]);case 6:(l=v.sent())&&this._preference.set(c,l),v.label=7;case 7:return u=a.next(),[3,5];case 8:return[3,11];case 9:return d=v.sent(),p={error:d},[3,11];case 10:try{u&&!u.done&&(_=a.return)&&_.call(a)}finally{if(p)throw p.error}return[7];case 11:return[2]}})})},t.prototype._resetPreferenceData=function(n,e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return this._preference=new Map,[4,this._store.removeMany(n)];case 1:return r.sent(),[4,this._store.set({key:e,value:{version:this._version}})];case 2:return r.sent(),[2]}})})},t.prototype.get=function(n){return f(this,void 0,void 0,function(){return h(this,function(e){return[2,this._preference.get(n)]})})},t.prototype.set=function(n,e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=!this._preference.has(n),[4,this._store.set({key:n,value:e})];case 1:return i.sent(),this._preference.set(n,e),r?[4,this._savePreferenceKeys()]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}})})},t.prototype.remove=function(n){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this._store.remove(n)];case 1:return e.sent(),this._preference.delete(n),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}})})},t.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(n){switch(n.label){case 0:return[4,this._store.removeMany(Z([],G(this._preference.keys()),!1))];case 1:return n.sent(),this._preference.clear(),[4,this._savePreferenceKeys()];case 2:return n.sent(),[2]}})})},t}(),ul=function(){function t(n){var e=n.encryption,r=n.store,i=n.localCacheEnabled,s=n.localCacheConfig;this.store=r,this.preference=new qo({store:r}),this.encryption=e??Fo,this.localCacheEnabled=i,this.localCacheConfig=s}return t.prototype.replaceStore=function(n){this.store=n,this.preference=new qo({store:n})},t}();(function(t){t.SUCCESS="success",t.PENDING="pending",t.ERROR="error"})(Pe||(Pe={})),function(t){t.DEFAULT="default",t.ALL="all",t.MENTION_ONLY="mention_only",t.OFF="off"}(Ki||(Ki={})),function(t){t.FCM="gcm",t.APNS="apns",t.UNKNOWN="unknown"}(me||(me={})),function(t){t.ALTERNATIVE="alternative",t.DEFAULT="default"}(Qi||(Qi={})),function(t){t.CUSTOM="custom",t.MESSAGE_COLLECTION_ACCESSED_AT="messagecollection_accessed_at"}(Qn||(Qn={}));var Wn,zo=function(){function t(n){var e=n===void 0?{}:n,r=e.maxSize,i=r===void 0?256:r,s=e.clearOrder,o=s===void 0?Qn.MESSAGE_COLLECTION_ACCESSED_AT:s,a=e.customClearOrderComparator,u=e.enableAutoResend,c=u===void 0||u;this._clearOrderComparatorUseMessageCollectionAccessedAt=function(l,d){return l.channel.messageCollectionLastAccessedAt===d.channel.messageCollectionLastAccessedAt?l.channel.lastMessage&&!d.channel.lastMessage?1:!l.channel.lastMessage&&d.channel.lastMessage?-1:l.channel.lastMessage||d.channel.lastMessage?l.channel.lastMessage.createdAt-d.channel.lastMessage.createdAt:0:l.channel.messageCollectionLastAccessedAt>d.channel.messageCollectionLastAccessedAt?1:-1},this._maxSize=Math.max(i,64),a?(this._clearOrder=o,this._customClearOrderComparator=a):this._clearOrder=Qn.MESSAGE_COLLECTION_ACCESSED_AT,this._enableAutoResend=c}return Object.defineProperty(t.prototype,"maxSize",{get:function(){return this._maxSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearOrder",{get:function(){return this._clearOrder},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearOrderComparator",{get:function(){var n;return this._clearOrder===Qn.MESSAGE_COLLECTION_ACCESSED_AT?this._clearOrderComparatorUseMessageCollectionAccessedAt:(n=this._customClearOrderComparator)!==null&&n!==void 0?n:this._clearOrderComparatorUseMessageCollectionAccessedAt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enableAutoResend",{get:function(){return this._enableAutoResend},enumerable:!1,configurable:!0}),t}();(function(t){t.FEED="feed",t.CHAT="chat"})(Wn||(Wn={}));var W,qr,Ho,he,Ye,zr,xe,Ve,pt,ce,$o,Wi,Yi,cl=function(){function t(){this.isRefreshing=!1}return Object.defineProperty(t.prototype,"hasSession",{get:function(){return!!this.sessionKey},enumerable:!1,configurable:!0}),t.prototype.clear=function(){this.authToken=void 0,this.sessionKey=void 0,this.services=[]},t}(),Xt=function(){var t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var e=(t+16*Math.random())%16|0;return t=Math.floor(t/16),(n==="x"?e:3&e|8).toString(16)})},jo=function(){function t(n){var e=n.container;this._container={},this._container=e,this.key=Xt()}return t.prototype._register=function(n,e,r){var i;return n in this._container||(this._container[n]=new Map),(i=this._container[n])===null||i===void 0||i.set(this.key,{occurence:e,handler:r}),this},t.prototype.on=function(n,e){return this._register(n,-1,e)},t.prototype.once=function(n,e){return this._register(n,1,e)},t.prototype.close=function(){var n;for(var e in this._container)(n=this._container[e])===null||n===void 0||n.delete(this.key)},t}(),Cn=function(){function t(){this._container={}}return t.prototype.on=function(n,e){return new jo({container:this._container}).on(n,e)},t.prototype.once=function(n,e){return new jo({container:this._container}).once(n,e)},t.prototype.dispatch=function(n,e){var r,i,s=this._container[n];if(s){var o=[];try{for(var a=$(s.keys()),u=a.next();!u.done;u=a.next()){var c=u.value,l=s.get(c);l.handler(e),l.occurence>0&&(l.occurence--,l.occurence===0&&o.push(c))}}catch(d){r={error:d}}finally{try{u&&!u.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}o.forEach(function(d){return s.delete(d)})}},t}(),ll=function(){function t(){this._dispatcher=new Cn}return t.prototype.on=function(n){return this._dispatcher.on("event",n)},t.prototype.once=function(n){return this._dispatcher.once("event",n)},t.prototype.dispatch=function(n){this._dispatcher.dispatch("event",n)},t}(),le=function(){},x=function(t){var n={};return t&&Object.keys(t).forEach(function(e){t[e]===void 0||Number.isNaN(t[e])||t[e]===null||(n[e]=t[e])}),n},H=function(t){if(t!=null){if(typeof t=="object"){if(Array.isArray(t)){var n=Z([],G(t),!1);for(var e in n)n[e]=H(n[e]);return n}for(var r in t)t[r]===null&&delete t[r];return t}return t}};(function(t){t.BASE="base",t.GROUP="group",t.OPEN="open",t.FEED="feed"})(W||(W={})),function(t){t.OPERATOR="operator",t.NONE="none"}(qr||(qr={})),function(t){t.MUTED="muted",t.UNMUTED="unmuted"}(Ho||(Ho={})),function(t){t.BASE="base",t.USER="user",t.FILE="file",t.ADMIN="admin"}(he||(he={})),function(t){t.ALL="",t.USER="MESG",t.FILE="FILE",t.ADMIN="ADMM"}(Ye||(Ye={})),function(t){t.USER="MESG",t.FILE="FILE",t.ADMIN="ADMM"}(zr||(zr={})),function(t){t.USERS="users",t.CHANNEL="channel"}(xe||(xe={})),function(t){t.ALL="all",t.NONE="none",t.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel"}(Ve||(Ve={})),function(t){t.DEFAULT="default",t.SUPPRESS="suppress"}(pt||(pt={})),function(t){t.PENDING="pending",t.SCHEDULED="scheduled",t.SUCCEEDED="succeeded",t.FAILED="failed",t.CANCELED="canceled"}(ce||(ce={})),function(t){t.INREVIEW="InReview",t.APPROVED="Approved"}($o||($o={})),function(t){t.HIGH="high",t.NORMAL="normal",t.LOW="low"}(Wi||(Wi={})),function(t){t.CREATED_AT="created_at",t.UPDATED_AT="updated_at"}(Yi||(Yi={}));var k,Ze="v3",ee="/".concat(Ze,"/users"),dl="/".concat(Ze,"/storage/file"),Zi="/".concat(Ze,"/group_channels"),Jt="/".concat(Ze,"/open_channels"),hl="/".concat(Ze,"/sdk/open_channels"),fl="/".concat(Ze,"/search"),Xi="/".concat(Ze,"/report"),pl="/".concat(Ze,"/emojis"),Bo="/".concat(Ze,"/emoji_categories"),dt="/".concat(Ze,"/polls"),_l="/".concat(Ze,"/sdk/ui_kit/configuration"),vl="/".concat(Ze,"/sdk/statistics"),Go="/".concat(Ze,"/message_templates"),J=function(t){switch(t){case W.FEED:case W.GROUP:return Zi;case W.OPEN:return Jt;default:return null}},Vo=function(t){switch(t){case W.GROUP:return"".concat(Xi,"/group_channels");case W.OPEN:return"".concat(Xi,"/open_channels");default:return null}},Sn=function(t,n,e){var r,i;switch(t){case xe.CHANNEL:return!0;case xe.USERS:if(n)try{for(var s=$(n),o=s.next();!o.done;o=s.next())if(o.value===e)return!0}catch(a){r={error:a}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}}return!1},Ji=function(t,n,e){var r,i,s,o,a=Sn((r=t.mentionType)!==null&&r!==void 0?r:null,(i=t.mentionedUserIds)!==null&&i!==void 0?i:[],e),u=Sn((s=n.mentionType)!==null&&s!==void 0?s:null,(o=n.mentionedUserIds)!==null&&o!==void 0?o:[],e);return!a&&u?1:a&&!u?-1:0},Ko=function(t,n,e){var r,i=n||new FormData;for(var s in t)if(t.hasOwnProperty(s)){var o=t[s],a=e?"".concat(e,"[").concat(s,"]"):s;Ge(o)?i.append(a,o,(r=o.name)!==null&&r!==void 0?r:"filename"):typeof o!="object"||o===null||Array.isArray(o)||o instanceof Blob?i.append(a,String(o)):i=Ko(o,i,a)}return i};(function(t){t.GET="GET",t.POST="POST",t.PUT="PUT",t.DELETE="DELETE"})(k||(k={}));var Fe,R=function(t){function n(){var e=t!==null&&t.apply(this,arguments)||this;return e.params={},e.requireAuth=!0,e.headers={},e.requestId=Xt(),e}return g(n,t),n.prototype.encodeParams=function(e){var r=this;return e==null||e===""?encodeURIComponent(""):Array.isArray(e)?e.map(function(i){return r.encodeParams(i)}).join(","):encodeURIComponent(typeof e=="object"?JSON.stringify(e):String(e))},Object.defineProperty(n.prototype,"query",{get:function(){var e=this,r=x(this.params);return"?".concat(Object.keys(r).map(function(i){return"".concat(encodeURIComponent(i),"=").concat(e.encodeParams(r[i]))}).join("&"))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"payload",{get:function(){var e=x(this.params);return Object.keys(e).some(function(r){return Ge(e[r])})?Ko(e):JSON.stringify(e)},enumerable:!1,configurable:!0}),n}(le),M=function(t){function n(e,r){var i=t.call(this)||this;return i._iid=e,i._payload=r,i}return g(n,t),Object.defineProperty(n.prototype,"payload",{get:function(){return b({},this._payload)},enumerable:!1,configurable:!0}),n.prototype.as=function(e){return new e(this._iid,this.payload)},n}(le),ml=function(t){function n(e){var r=t.call(this)||this;return r.requestId=e,r}return g(n,t),n}(le),xt=function(t){function n(e){var r=e.expires_in,i=e.reason,s=i===void 0?z.SESSION_KEY_EXPIRED:i,o=t.call(this)||this;switch(o.expiresIn=r??0,s){case z.SESSION_KEY_EXPIRED:case z.SESSION_TOKEN_EXPIRED:case z.SESSION_REVOKED:case z.USER_AUTH_DEACTIVATED:case z.USER_AUTH_DELETED_OR_NOT_FOUND:o.error=new I({code:s})}return o}return g(n,t),Object.defineProperty(n.prototype,"invalidateSessionToken",{get:function(){var e;return!!(!((e=this.error)===null||e===void 0)&&e.isSessionTokenExpiredError)},enumerable:!1,configurable:!0}),n}(le),de=function(t){function n(e,r,i,s){s===void 0&&(s="");var o,a=this;return(a=t.call(this)||this)._iid=e,a.code=r,a.payload=i,a.requestId=(o=i.req_id)!==null&&o!==void 0?o:s,a}return g(n,t),n.createFromRawMessage=function(e,r){var i=r.substring(0,4),s={};try{s=JSON.parse(r.substring(4))}catch{i="NOOP"}finally{return new n(e,i,s)}},n.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),`
`)},n.prototype.as=function(e){return new e(this._iid,this.code,this.payload)},n}(le),He=function(t){function n(e){var r,i=e.code,s=e.ackRequired,o=e.payload,a=o===void 0?{}:o,u=this;return(u=t.call(this)||this).code=i,u.payload=a,u.requestId=(r=u.payload.req_id)!==null&&r!==void 0?r:Xt(),u.ackRequired=s,u.payload.req_id=u.requestId,u}return g(n,t),n.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),`
`)},n}(le),Hr=function(t){function n(e){var r=e.userId,i=e.authToken,s=e.services,o=e.expiringSession,a=o===void 0||o,u=t.call(this)||this;return u.path="".concat(ee,"/").concat(r,"/session_key"),u.method=k.POST,u.params=x({token:i,services:s,expiring_session:!!a}),u.requireAuth=!1,u}return g(n,t),n}(R),gl=function(t){function n(e){var r=e.authToken,i=e.expiringSession,s=i===void 0||i,o=e.requestId,a=o===void 0?void 0:o;return t.call(this,{code:"LOGI",payload:{token:r,expiring_session:s?1:0,req_id:a},ackRequired:!0})||this}return g(n,t),n}(He),yl=function(t){function n(e,r){var i=t.call(this,e,r)||this,s=r.key,o=r.expires_at,a=r.services;return i.key=s,i.expiresAt=o,i.services=a,i}return g(n,t),n}(M),bl=function(t){function n(e,r,i){var s,o=this;return(o=t.call(this,e,"LOGI",i)||this).error=null,o.newKey=null,o.newKey=(s=i.new_key)!==null&&s!==void 0?s:null,o.error=i.error?new I(i):null,o}return g(n,t),n}(de),es=function(t){function n(e){var r=t.call(this)||this;return r.statLog=e,r}return g(n,t),n}(le),ts=function(t){function n(e){var r=e.request,i=e.deferred,s=e.error,o=s===void 0?I.requestFailed:s,a=t.call(this)||this;return a.request=r,a.deferred=i,a.error=o,a}return g(n,t),n}(le);(function(t){t.FEATURE_LOCALCACHE="feature:local_cache",t.FEATURE_LOCALCACHE_EVENT="feature:local_cache_event",t.NOTIFICATION="noti:stats",t.WEBSOCKET_CONNECT="ws:connect",t.API_RESULT="api:result"})(Fe||(Fe={}));var Qo,$r,Wo,An=function(){function t(n){var e=n.type,r=n.data,i=n.ts,s=i===void 0?Date.now():i;this.type=e,this.createdAt=s,this.data=r}return t.payloadify=function(n){return x({stat_type:n.type,ts:n.createdAt,data:x(n.data)})},t}(),ns=function(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product=="ReactNative"},Yo=function(){return!(typeof navigator>"u"||!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent))};(function(t){t.CHAT="chat",t.CALLS="calls",t.DESK="desk",t.LIVE="live",t.UIKIT_CHAT="uikit-chat",t.UIKIT_LIVE="uikit-live"})(Qo||(Qo={})),function(t){t.ANDROID="android",t.IOS="ios",t.JS="js",t.UNREAL="unreal",t.UNITY="unity",t.REACT_NATIVE="react-native",t.FLUTTER="flutter"}($r||($r={})),function(t){t.ANDROID="android",t.IOS="ios",t.WEB="web",t.MOBILE_WEB="mobile_web",t.WINDOWS="windows"}(Wo||(Wo={}));var El="^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",jr=function(){function t(){}return t.sendbirdSdkUserAgentWithExtension=function(n){var e=ns()?$r.REACT_NATIVE:$r.JS,r={main_sdk_info:"chat/".concat(e,"/").concat(Pt.SDK_VERSION),device_os_platform:Yo()?"mobile-web":"web",os_version:Pt.OS_VERSION};if(n){var i=n.sendbirdExtensions,s=n.deviceOS,o=n.customData,a=o===void 0?{}:o;s.version&&(r.os_version=s.version),s.platform&&(r.device_os_platform=s.platform),i.length>0&&(r.extension_sdk_info=i.map(function(u){var c=u.product,l=u.platform,d=u.version;return"".concat(c,"/").concat(l,"/").concat(d)}).join(",")),Object.keys(r).forEach(function(u){return delete a[u]}),Object.keys(a).length>0&&(r=b(b({},r),a))}return Object.entries(r).map(function(u){var c=G(u,2),l=c[0],d=c[1];return"".concat(l,"=").concat(d)}).join("&")},t.userAgentWithExtension=function(n){var e=ns()?"reactnative":"JS",r=n.sb_syncmanager?"s".concat(n.sb_syncmanager):"",i=n.sb_uikit?"u".concat(n.sb_uikit):"",s=n["device-os-platform"]?"o".concat(n["device-os-platform"]):Yo()?"omobile-web":"oweb";return"".concat(e,"/c").concat(Pt.SDK_VERSION,"/").concat(r,"/").concat(i,"/").concat(s)},t}(),Ae=function(){var t=this;this.promise=new Promise(function(n,e){t.resolve=n,t.reject=function(r){e(r)}})},Yn=function(t){function n(e){var r=t.call(this)||this;return r.requestId=e.requestId,r}return g(n,t),n}(le),wl=function(){function t(n,e){var r=e.session,i=e.sdkState,s=e.dispatcher,o=e.logger,a=e.useFetchCompat,u=a!==void 0&&a,c=this;this._abortControl=new Map,this._shouldImportFetchCompat=!1,this._iid=n,this._session=r,this._sdkState=i,this._dispatcher=s,this._dispatcher.on(function(l){l instanceof ml&&c.cancel(l.requestId)}),this._logger=o,this._shouldImportFetchCompat=u}return t.prototype._createHeader=function(n,e){var r=this._sdkState,i=r.appId,s=r.appVersion,o=r.sendbirdRuntimeEnvironment,a=b(b({},n.headers),{SendBird:"JS,".concat(Pt.OS_VERSION,",").concat(Pt.SDK_VERSION,",").concat(i).concat(s?",".concat(s):""),"SB-User-Agent":jr.userAgentWithExtension(this._sdkState.extensions),"Request-Sent-Timestamp":Date.now().toString(),"SB-SDK-User-Agent":jr.sendbirdSdkUserAgentWithExtension(o)});return e||(a["Content-Type"]="application/json; charset=utf-8"),n.requireAuth&&this._session.hasSession&&(a["Session-Key"]=this._session.sessionKey),this._session&&this._session.authToken&&(a["App-Id"]=i,a["Access-Token"]=this._session.authToken),a},t.prototype._statLogApiResult=function(n,e,r){this._dispatcher.dispatch(new es(new An({type:Fe.API_RESULT,data:{endpoint:n.path,method:n.method,success:!r,latency:Date.now()-e,error_code:r==null?void 0:r.code,error_description:r==null?void 0:r.message}})))},t.prototype.send=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c,l,d,p,_,v,m,y,E,w,C,A,P;return h(this,function(N){switch(N.label){case 0:e=n.path,r=n.method,i=n.uploadProgressHandler,s=![k.GET,k.DELETE].includes(r),o=this._sdkState.api,a="".concat(o.host).concat(e).concat(s?"":n.query),u=s?n.payload:null,c=this._createHeader(n,u instanceof FormData?u:void 0),l=new AbortController,d=l.signal,this._abortControl.set(n.requestId,l),p=Date.now(),N.label=1;case 1:return N.trys.push([1,13,,14]),i?[4,Promise.resolve().then(()=>kv)]:[3,6];case 2:_=N.sent().xmlHttpRequest,N.label=3;case 3:return N.trys.push([3,5,,6]),[4,_(this._iid,{requestId:n.requestId,method:n.method,url:a,headers:c,data:u??void 0,uploadProgressHandler:i})];case 4:return v=N.sent(),this._logger.debug("receive api response",n.requestId),this._statLogApiResult(n,p),[2,v];case 5:if(!((m=N.sent())instanceof I&&m.code===z.XMLHTTPREQUEST_NOT_SUPPORTED))throw m;return this._logger.debug("XMLHttpRequest is not available in this environment. progressHandler is ignored."),[3,6];case 6:return this._shouldImportFetchCompat&&(this._shouldImportFetchCompat=!1,(typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{fetch:null}).fetch=null),typeof AbortController<"u"?[3,8]:[4,Promise.resolve().then(()=>Rv)];case 7:N.sent(),N.label=8;case 8:return typeof fetch=="function"?[3,10]:[4,Promise.resolve().then(()=>Fv)];case 9:N.sent(),N.label=10;case 10:return[4,fetch(a,{method:r,body:u,headers:c,signal:d})];case 11:return[4,(y=N.sent()).json()];case 12:if(E=N.sent(),y.ok||y.redirected)return this._logger.debug("receive api response",n.requestId),this._statLogApiResult(n,p),[2,new M(this._iid,E)];if(E){if((w=new I(E)).isSessionExpiredError){if(this._dispatcher.dispatch(new xt({reason:w.code})),!(n instanceof Hr))return C=new Ae,this._dispatcher.dispatch(new ts({request:n,deferred:C,error:w})),[2,C.promise];throw w}throw w.isSessionInvalidatedError&&this._dispatcher.dispatch(new xt({reason:w.code})),w}throw I.requestFailed;case 13:throw A=N.sent(),this._statLogApiResult(n,p,A),A instanceof I?(this._logger.debug("fail api request",A),A):(A==null?void 0:A.name)==="AbortError"?I.requestCanceled:(P=I.networkError,this._logger.debug("fail api request",P),P);case 14:return[2]}})})},t.prototype.cancel=function(n){this._abortControl.has(n)&&(this._abortControl.get(n).abort(),this._abortControl.delete(n)),this._dispatcher.dispatch(new Yn({requestId:n}))},t.prototype.cancelAll=function(){var n,e;try{for(var r=$(this._abortControl.values()),i=r.next();!i.done;i=r.next())i.value.abort()}catch(s){n={error:s}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(n)throw n.error}}this._abortControl.clear(),this._dispatcher.dispatch(new Yn({}))},t}(),B=function(){};function Nn(t){let n=t.length;for(;--n>=0;)t[n]=0}const rs=256,Zo=286,Zn=30,Xn=15,is=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Br=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Il=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Xo=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),St=new Array(576);Nn(St);const Jn=new Array(60);Nn(Jn);const er=new Array(512);Nn(er);const tr=new Array(256);Nn(tr);const ss=new Array(29);Nn(ss);const Gr=new Array(Zn);function os(t,n,e,r,i){this.static_tree=t,this.extra_bits=n,this.extra_base=e,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}let Jo,ea,ta;function as(t,n){this.dyn_tree=t,this.max_code=0,this.stat_desc=n}Nn(Gr);const na=t=>t<256?er[t]:er[256+(t>>>7)],nr=(t,n)=>{t.pending_buf[t.pending++]=255&n,t.pending_buf[t.pending++]=n>>>8&255},Ke=(t,n,e)=>{t.bi_valid>16-e?(t.bi_buf|=n<<t.bi_valid&65535,nr(t,t.bi_buf),t.bi_buf=n>>16-t.bi_valid,t.bi_valid+=e-16):(t.bi_buf|=n<<t.bi_valid&65535,t.bi_valid+=e)},_t=(t,n,e)=>{Ke(t,e[2*n],e[2*n+1])},ra=(t,n)=>{let e=0;do e|=1&t,t>>>=1,e<<=1;while(--n>0);return e>>>1},ia=(t,n,e)=>{const r=new Array(16);let i,s,o=0;for(i=1;i<=Xn;i++)o=o+e[i-1]<<1,r[i]=o;for(s=0;s<=n;s++){let a=t[2*s+1];a!==0&&(t[2*s]=ra(r[a]++,a))}},sa=t=>{let n;for(n=0;n<Zo;n++)t.dyn_ltree[2*n]=0;for(n=0;n<Zn;n++)t.dyn_dtree[2*n]=0;for(n=0;n<19;n++)t.bl_tree[2*n]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},oa=t=>{t.bi_valid>8?nr(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},aa=(t,n,e,r)=>{const i=2*n,s=2*e;return t[i]<t[s]||t[i]===t[s]&&r[n]<=r[e]},us=(t,n,e)=>{const r=t.heap[e];let i=e<<1;for(;i<=t.heap_len&&(i<t.heap_len&&aa(n,t.heap[i+1],t.heap[i],t.depth)&&i++,!aa(n,r,t.heap[i],t.depth));)t.heap[e]=t.heap[i],e=i,i<<=1;t.heap[e]=r},ua=(t,n,e)=>{let r,i,s,o,a=0;if(t.sym_next!==0)do r=255&t.pending_buf[t.sym_buf+a++],r+=(255&t.pending_buf[t.sym_buf+a++])<<8,i=t.pending_buf[t.sym_buf+a++],r===0?_t(t,i,n):(s=tr[i],_t(t,s+rs+1,n),o=is[s],o!==0&&(i-=ss[s],Ke(t,i,o)),r--,s=na(r),_t(t,s,e),o=Br[s],o!==0&&(r-=Gr[s],Ke(t,r,o)));while(a<t.sym_next);_t(t,256,n)},cs=(t,n)=>{const e=n.dyn_tree,r=n.stat_desc.static_tree,i=n.stat_desc.has_stree,s=n.stat_desc.elems;let o,a,u,c=-1;for(t.heap_len=0,t.heap_max=573,o=0;o<s;o++)e[2*o]!==0?(t.heap[++t.heap_len]=c=o,t.depth[o]=0):e[2*o+1]=0;for(;t.heap_len<2;)u=t.heap[++t.heap_len]=c<2?++c:0,e[2*u]=1,t.depth[u]=0,t.opt_len--,i&&(t.static_len-=r[2*u+1]);for(n.max_code=c,o=t.heap_len>>1;o>=1;o--)us(t,e,o);u=s;do o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],us(t,e,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,e[2*u]=e[2*o]+e[2*a],t.depth[u]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,e[2*o+1]=e[2*a+1]=u,t.heap[1]=u++,us(t,e,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((l,d)=>{const p=d.dyn_tree,_=d.max_code,v=d.stat_desc.static_tree,m=d.stat_desc.has_stree,y=d.stat_desc.extra_bits,E=d.stat_desc.extra_base,w=d.stat_desc.max_length;let C,A,P,N,q,F,L=0;for(N=0;N<=Xn;N++)l.bl_count[N]=0;for(p[2*l.heap[l.heap_max]+1]=0,C=l.heap_max+1;C<573;C++)A=l.heap[C],N=p[2*p[2*A+1]+1]+1,N>w&&(N=w,L++),p[2*A+1]=N,A>_||(l.bl_count[N]++,q=0,A>=E&&(q=y[A-E]),F=p[2*A],l.opt_len+=F*(N+q),m&&(l.static_len+=F*(v[2*A+1]+q)));if(L!==0){do{for(N=w-1;l.bl_count[N]===0;)N--;l.bl_count[N]--,l.bl_count[N+1]+=2,l.bl_count[w]--,L-=2}while(L>0);for(N=w;N!==0;N--)for(A=l.bl_count[N];A!==0;)P=l.heap[--C],P>_||(p[2*P+1]!==N&&(l.opt_len+=(N-p[2*P+1])*p[2*P],p[2*P+1]=N),A--)}})(t,n),ia(e,c,t.bl_count)},ca=(t,n,e)=>{let r,i,s=-1,o=n[1],a=0,u=7,c=4;for(o===0&&(u=138,c=3),n[2*(e+1)+1]=65535,r=0;r<=e;r++)i=o,o=n[2*(r+1)+1],++a<u&&i===o||(a<c?t.bl_tree[2*i]+=a:i!==0?(i!==s&&t.bl_tree[2*i]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,s=i,o===0?(u=138,c=3):i===o?(u=6,c=3):(u=7,c=4))},la=(t,n,e)=>{let r,i,s=-1,o=n[1],a=0,u=7,c=4;for(o===0&&(u=138,c=3),r=0;r<=e;r++)if(i=o,o=n[2*(r+1)+1],!(++a<u&&i===o)){if(a<c)do _t(t,i,t.bl_tree);while(--a!=0);else i!==0?(i!==s&&(_t(t,i,t.bl_tree),a--),_t(t,16,t.bl_tree),Ke(t,a-3,2)):a<=10?(_t(t,17,t.bl_tree),Ke(t,a-3,3)):(_t(t,18,t.bl_tree),Ke(t,a-11,7));a=0,s=i,o===0?(u=138,c=3):i===o?(u=6,c=3):(u=7,c=4)}};let da=!1;const ha=(t,n,e,r)=>{Ke(t,0+(r?1:0),3),oa(t),nr(t,e),nr(t,~e),e&&t.pending_buf.set(t.window.subarray(n,n+e),t.pending),t.pending+=e};var Tl=(t,n,e,r)=>{let i,s,o=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(a=>{let u,c=4093624447;for(u=0;u<=31;u++,c>>>=1)if(1&c&&a.dyn_ltree[2*u]!==0)return 0;if(a.dyn_ltree[18]!==0||a.dyn_ltree[20]!==0||a.dyn_ltree[26]!==0)return 1;for(u=32;u<rs;u++)if(a.dyn_ltree[2*u]!==0)return 1;return 0})(t)),cs(t,t.l_desc),cs(t,t.d_desc),o=(a=>{let u;for(ca(a,a.dyn_ltree,a.l_desc.max_code),ca(a,a.dyn_dtree,a.d_desc.max_code),cs(a,a.bl_desc),u=18;u>=3&&a.bl_tree[2*Xo[u]+1]===0;u--);return a.opt_len+=3*(u+1)+5+5+4,u})(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=e+5,e+4<=i&&n!==-1?ha(t,n,e,r):t.strategy===4||s===i?(Ke(t,2+(r?1:0),3),ua(t,St,Jn)):(Ke(t,4+(r?1:0),3),((a,u,c,l)=>{let d;for(Ke(a,u-257,5),Ke(a,c-1,5),Ke(a,l-4,4),d=0;d<l;d++)Ke(a,a.bl_tree[2*Xo[d]+1],3);la(a,a.dyn_ltree,u-1),la(a,a.dyn_dtree,c-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),ua(t,t.dyn_ltree,t.dyn_dtree)),sa(t),r&&oa(t)},Cl={_tr_init:t=>{da||((()=>{let n,e,r,i,s;const o=new Array(16);for(r=0,i=0;i<28;i++)for(ss[i]=r,n=0;n<1<<is[i];n++)tr[r++]=i;for(tr[r-1]=i,s=0,i=0;i<16;i++)for(Gr[i]=s,n=0;n<1<<Br[i];n++)er[s++]=i;for(s>>=7;i<Zn;i++)for(Gr[i]=s<<7,n=0;n<1<<Br[i]-7;n++)er[256+s++]=i;for(e=0;e<=Xn;e++)o[e]=0;for(n=0;n<=143;)St[2*n+1]=8,n++,o[8]++;for(;n<=255;)St[2*n+1]=9,n++,o[9]++;for(;n<=279;)St[2*n+1]=7,n++,o[7]++;for(;n<=287;)St[2*n+1]=8,n++,o[8]++;for(ia(St,287,o),n=0;n<Zn;n++)Jn[2*n+1]=5,Jn[2*n]=ra(n,5);Jo=new os(St,is,257,Zo,Xn),ea=new os(Jn,Br,0,Zn,Xn),ta=new os(new Array(0),Il,0,19,7)})(),da=!0),t.l_desc=new as(t.dyn_ltree,Jo),t.d_desc=new as(t.dyn_dtree,ea),t.bl_desc=new as(t.bl_tree,ta),t.bi_buf=0,t.bi_valid=0,sa(t)},_tr_stored_block:ha,_tr_flush_block:Tl,_tr_tally:(t,n,e)=>(t.pending_buf[t.sym_buf+t.sym_next++]=n,t.pending_buf[t.sym_buf+t.sym_next++]=n>>8,t.pending_buf[t.sym_buf+t.sym_next++]=e,n===0?t.dyn_ltree[2*e]++:(t.matches++,n--,t.dyn_ltree[2*(tr[e]+rs+1)]++,t.dyn_dtree[2*na(n)]++),t.sym_next===t.sym_end),_tr_align:t=>{Ke(t,2,3),_t(t,256,St),(n=>{n.bi_valid===16?(nr(n,n.bi_buf),n.bi_buf=0,n.bi_valid=0):n.bi_valid>=8&&(n.pending_buf[n.pending++]=255&n.bi_buf,n.bi_buf>>=8,n.bi_valid-=8)})(t)}},rr=(t,n,e,r)=>{let i=65535&t|0,s=t>>>16&65535|0,o=0;for(;e!==0;){o=e>2e3?2e3:e,e-=o;do i=i+n[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};const Sl=new Uint32Array((()=>{let t,n=[];for(var e=0;e<256;e++){t=e;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;n[e]=t}return n})());var Ce=(t,n,e,r)=>{const i=Sl,s=r+e;t^=-1;for(let o=r;o<s;o++)t=t>>>8^i[255&(t^n[o])];return-1^t},en={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},tn={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Al,_tr_stored_block:ls,_tr_flush_block:Nl,_tr_tally:Ft,_tr_align:Ol}=Cl,{Z_NO_FLUSH:qt,Z_PARTIAL_FLUSH:kl,Z_FULL_FLUSH:Rl,Z_FINISH:it,Z_BLOCK:fa,Z_OK:Ne,Z_STREAM_END:pa,Z_STREAM_ERROR:vt,Z_DATA_ERROR:Dl,Z_BUF_ERROR:ds,Z_DEFAULT_COMPRESSION:Ul,Z_FILTERED:Ml,Z_HUFFMAN_ONLY:Vr,Z_RLE:Ll,Z_FIXED:Pl,Z_DEFAULT_STRATEGY:xl,Z_UNKNOWN:Fl,Z_DEFLATED:Kr}=tn,nn=258,mt=262,On=42,rn=113,ir=666,sn=(t,n)=>(t.msg=en[n],n),_a=t=>2*t-(t>4?9:0),zt=t=>{let n=t.length;for(;--n>=0;)t[n]=0},ql=t=>{let n,e,r,i=t.w_size;n=t.hash_size,r=n;do e=t.head[--r],t.head[r]=e>=i?e-i:0;while(--n);n=i,r=n;do e=t.prev[--r],t.prev[r]=e>=i?e-i:0;while(--n)};let Ht=(t,n,e)=>(n<<t.hash_shift^e)&t.hash_mask;const Xe=t=>{const n=t.state;let e=n.pending;e>t.avail_out&&(e=t.avail_out),e!==0&&(t.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+e),t.next_out),t.next_out+=e,n.pending_out+=e,t.total_out+=e,t.avail_out-=e,n.pending-=e,n.pending===0&&(n.pending_out=0))},Je=(t,n)=>{Nl(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,n),t.block_start=t.strstart,Xe(t.strm)},oe=(t,n)=>{t.pending_buf[t.pending++]=n},sr=(t,n)=>{t.pending_buf[t.pending++]=n>>>8&255,t.pending_buf[t.pending++]=255&n},hs=(t,n,e,r)=>{let i=t.avail_in;return i>r&&(i=r),i===0?0:(t.avail_in-=i,n.set(t.input.subarray(t.next_in,t.next_in+i),e),t.state.wrap===1?t.adler=rr(t.adler,n,i,e):t.state.wrap===2&&(t.adler=Ce(t.adler,n,i,e)),t.next_in+=i,t.total_in+=i,i)},va=(t,n)=>{let e,r,i=t.max_chain_length,s=t.strstart,o=t.prev_length,a=t.nice_match;const u=t.strstart>t.w_size-mt?t.strstart-(t.w_size-mt):0,c=t.window,l=t.w_mask,d=t.prev,p=t.strstart+nn;let _=c[s+o-1],v=c[s+o];t.prev_length>=t.good_match&&(i>>=2),a>t.lookahead&&(a=t.lookahead);do if(e=n,c[e+o]===v&&c[e+o-1]===_&&c[e]===c[s]&&c[++e]===c[s+1]){s+=2,e++;do;while(c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&s<p);if(r=nn-(p-s),s=p-nn,r>o){if(t.match_start=n,o=r,r>=a)break;_=c[s+o-1],v=c[s+o]}}while((n=d[n&l])>u&&--i!=0);return o<=t.lookahead?o:t.lookahead},kn=t=>{const n=t.w_size;let e,r,i;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=n+(n-mt)&&(t.window.set(t.window.subarray(n,n+n-r),0),t.match_start-=n,t.strstart-=n,t.block_start-=n,t.insert>t.strstart&&(t.insert=t.strstart),ql(t),r+=n),t.strm.avail_in===0)break;if(e=hs(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=e,t.lookahead+t.insert>=3)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=Ht(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=Ht(t,t.ins_h,t.window[i+3-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<mt&&t.strm.avail_in!==0)},ma=(t,n)=>{let e,r,i,s=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,o=0,a=t.strm.avail_in;do{if(e=65535,i=t.bi_valid+42>>3,t.strm.avail_out<i||(i=t.strm.avail_out-i,r=t.strstart-t.block_start,e>r+t.strm.avail_in&&(e=r+t.strm.avail_in),e>i&&(e=i),e<s&&(e===0&&n!==it||n===qt||e!==r+t.strm.avail_in)))break;o=n===it&&e===r+t.strm.avail_in?1:0,ls(t,0,0,o),t.pending_buf[t.pending-4]=e,t.pending_buf[t.pending-3]=e>>8,t.pending_buf[t.pending-2]=~e,t.pending_buf[t.pending-1]=~e>>8,Xe(t.strm),r&&(r>e&&(r=e),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+r),t.strm.next_out),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r,t.block_start+=r,e-=r),e&&(hs(t.strm,t.strm.output,t.strm.next_out,e),t.strm.next_out+=e,t.strm.avail_out-=e,t.strm.total_out+=e)}while(o===0);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?4:n!==qt&&n!==it&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(i=t.window_size-t.strstart,t.strm.avail_in>i&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,i+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),i>t.strm.avail_in&&(i=t.strm.avail_in),i&&(hs(t.strm,t.window,t.strstart,i),t.strstart+=i,t.insert+=i>t.w_size-t.insert?t.w_size-t.insert:i),t.high_water<t.strstart&&(t.high_water=t.strstart),i=t.bi_valid+42>>3,i=t.pending_buf_size-i>65535?65535:t.pending_buf_size-i,s=i>t.w_size?t.w_size:i,r=t.strstart-t.block_start,(r>=s||(r||n===it)&&n!==qt&&t.strm.avail_in===0&&r<=i)&&(e=r>i?i:r,o=n===it&&t.strm.avail_in===0&&e===r?1:0,ls(t,t.block_start,e,o),t.block_start+=e,Xe(t.strm)),o?3:1)},fs=(t,n)=>{let e,r;for(;;){if(t.lookahead<mt){if(kn(t),t.lookahead<mt&&n===qt)return 1;if(t.lookahead===0)break}if(e=0,t.lookahead>=3&&(t.ins_h=Ht(t,t.ins_h,t.window[t.strstart+3-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),e!==0&&t.strstart-e<=t.w_size-mt&&(t.match_length=va(t,e)),t.match_length>=3)if(r=Ft(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=Ht(t,t.ins_h,t.window[t.strstart+3-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Ht(t,t.ins_h,t.window[t.strstart+1]);else r=Ft(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(Je(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,n===it?(Je(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Je(t,!1),t.strm.avail_out===0)?1:2},Rn=(t,n)=>{let e,r,i;for(;;){if(t.lookahead<mt){if(kn(t),t.lookahead<mt&&n===qt)return 1;if(t.lookahead===0)break}if(e=0,t.lookahead>=3&&(t.ins_h=Ht(t,t.ins_h,t.window[t.strstart+3-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,e!==0&&t.prev_length<t.max_lazy_match&&t.strstart-e<=t.w_size-mt&&(t.match_length=va(t,e),t.match_length<=5&&(t.strategy===Ml||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,r=Ft(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=Ht(t,t.ins_h,t.window[t.strstart+3-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,r&&(Je(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(r=Ft(t,0,t.window[t.strstart-1]),r&&Je(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Ft(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,n===it?(Je(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Je(t,!1),t.strm.avail_out===0)?1:2};function gt(t,n,e,r,i){this.good_length=t,this.max_lazy=n,this.nice_length=e,this.max_chain=r,this.func=i}const or=[new gt(0,0,0,0,ma),new gt(4,4,8,4,fs),new gt(4,5,16,8,fs),new gt(4,6,32,32,fs),new gt(4,4,16,16,Rn),new gt(8,16,32,32,Rn),new gt(8,16,128,128,Rn),new gt(8,32,128,256,Rn),new gt(32,128,258,1024,Rn),new gt(32,258,258,4096,Rn)];function zl(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Kr,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),zt(this.dyn_ltree),zt(this.dyn_dtree),zt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),zt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),zt(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const ar=t=>{if(!t)return 1;const n=t.state;return!n||n.strm!==t||n.status!==On&&n.status!==57&&n.status!==69&&n.status!==73&&n.status!==91&&n.status!==103&&n.status!==rn&&n.status!==ir?1:0},ga=t=>{if(ar(t))return sn(t,vt);t.total_in=t.total_out=0,t.data_type=Fl;const n=t.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=n.wrap===2?57:n.wrap?On:rn,t.adler=n.wrap===2?0:1,n.last_flush=-2,Al(n),Ne},ya=t=>{const n=ga(t);var e;return n===Ne&&((e=t.state).window_size=2*e.w_size,zt(e.head),e.max_lazy_match=or[e.level].max_lazy,e.good_match=or[e.level].good_length,e.nice_match=or[e.level].nice_length,e.max_chain_length=or[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),n},ba=(t,n,e,r,i,s)=>{if(!t)return vt;let o=1;if(n===Ul&&(n=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>9||e!==Kr||r<8||r>15||n<0||n>9||s<0||s>Pl||r===8&&o!==1)return sn(t,vt);r===8&&(r=9);const a=new zl;return t.state=a,a.strm=t,a.status=On,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=n,a.strategy=s,a.method=e,ya(t)};var ur={deflateInit:(t,n)=>ba(t,n,Kr,15,8,xl),deflateInit2:ba,deflateReset:ya,deflateResetKeep:ga,deflateSetHeader:(t,n)=>ar(t)||t.state.wrap!==2?vt:(t.state.gzhead=n,Ne),deflate:(t,n)=>{if(ar(t)||n>fa||n<0)return t?sn(t,vt):vt;const e=t.state;if(!t.output||t.avail_in!==0&&!t.input||e.status===ir&&n!==it)return sn(t,t.avail_out===0?ds:vt);const r=e.last_flush;if(e.last_flush=n,e.pending!==0){if(Xe(t),t.avail_out===0)return e.last_flush=-1,Ne}else if(t.avail_in===0&&_a(n)<=_a(r)&&n!==it)return sn(t,ds);if(e.status===ir&&t.avail_in!==0)return sn(t,ds);if(e.status===On&&e.wrap===0&&(e.status=rn),e.status===On){let i=Kr+(e.w_bits-8<<4)<<8,s=-1;if(s=e.strategy>=Vr||e.level<2?0:e.level<6?1:e.level===6?2:3,i|=s<<6,e.strstart!==0&&(i|=32),i+=31-i%31,sr(e,i),e.strstart!==0&&(sr(e,t.adler>>>16),sr(e,65535&t.adler)),t.adler=1,e.status=rn,Xe(t),e.pending!==0)return e.last_flush=-1,Ne}if(e.status===57){if(t.adler=0,oe(e,31),oe(e,139),oe(e,8),e.gzhead)oe(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),oe(e,255&e.gzhead.time),oe(e,e.gzhead.time>>8&255),oe(e,e.gzhead.time>>16&255),oe(e,e.gzhead.time>>24&255),oe(e,e.level===9?2:e.strategy>=Vr||e.level<2?4:0),oe(e,255&e.gzhead.os),e.gzhead.extra&&e.gzhead.extra.length&&(oe(e,255&e.gzhead.extra.length),oe(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(t.adler=Ce(t.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=69;else if(oe(e,0),oe(e,0),oe(e,0),oe(e,0),oe(e,0),oe(e,e.level===9?2:e.strategy>=Vr||e.level<2?4:0),oe(e,3),e.status=rn,Xe(t),e.pending!==0)return e.last_flush=-1,Ne}if(e.status===69){if(e.gzhead.extra){let i=e.pending,s=(65535&e.gzhead.extra.length)-e.gzindex;for(;e.pending+s>e.pending_buf_size;){let a=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+a),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>i&&(t.adler=Ce(t.adler,e.pending_buf,e.pending-i,i)),e.gzindex+=a,Xe(t),e.pending!==0)return e.last_flush=-1,Ne;i=0,s-=a}let o=new Uint8Array(e.gzhead.extra);e.pending_buf.set(o.subarray(e.gzindex,e.gzindex+s),e.pending),e.pending+=s,e.gzhead.hcrc&&e.pending>i&&(t.adler=Ce(t.adler,e.pending_buf,e.pending-i,i)),e.gzindex=0}e.status=73}if(e.status===73){if(e.gzhead.name){let i,s=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(t.adler=Ce(t.adler,e.pending_buf,e.pending-s,s)),Xe(t),e.pending!==0)return e.last_flush=-1,Ne;s=0}i=e.gzindex<e.gzhead.name.length?255&e.gzhead.name.charCodeAt(e.gzindex++):0,oe(e,i)}while(i!==0);e.gzhead.hcrc&&e.pending>s&&(t.adler=Ce(t.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=91}if(e.status===91){if(e.gzhead.comment){let i,s=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(t.adler=Ce(t.adler,e.pending_buf,e.pending-s,s)),Xe(t),e.pending!==0)return e.last_flush=-1,Ne;s=0}i=e.gzindex<e.gzhead.comment.length?255&e.gzhead.comment.charCodeAt(e.gzindex++):0,oe(e,i)}while(i!==0);e.gzhead.hcrc&&e.pending>s&&(t.adler=Ce(t.adler,e.pending_buf,e.pending-s,s))}e.status=103}if(e.status===103){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(Xe(t),e.pending!==0))return e.last_flush=-1,Ne;oe(e,255&t.adler),oe(e,t.adler>>8&255),t.adler=0}if(e.status=rn,Xe(t),e.pending!==0)return e.last_flush=-1,Ne}if(t.avail_in!==0||e.lookahead!==0||n!==qt&&e.status!==ir){let i=e.level===0?ma(e,n):e.strategy===Vr?((s,o)=>{let a;for(;;){if(s.lookahead===0&&(kn(s),s.lookahead===0)){if(o===qt)return 1;break}if(s.match_length=0,a=Ft(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,a&&(Je(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===it?(Je(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Je(s,!1),s.strm.avail_out===0)?1:2})(e,n):e.strategy===Ll?((s,o)=>{let a,u,c,l;const d=s.window;for(;;){if(s.lookahead<=nn){if(kn(s),s.lookahead<=nn&&o===qt)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(c=s.strstart-1,u=d[c],u===d[++c]&&u===d[++c]&&u===d[++c])){l=s.strstart+nn;do;while(u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&c<l);s.match_length=nn-(l-c),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(a=Ft(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(a=Ft(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),a&&(Je(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===it?(Je(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Je(s,!1),s.strm.avail_out===0)?1:2})(e,n):or[e.level].func(e,n);if(i!==3&&i!==4||(e.status=ir),i===1||i===3)return t.avail_out===0&&(e.last_flush=-1),Ne;if(i===2&&(n===kl?Ol(e):n!==fa&&(ls(e,0,0,!1),n===Rl&&(zt(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),Xe(t),t.avail_out===0))return e.last_flush=-1,Ne}return n!==it?Ne:e.wrap<=0?pa:(e.wrap===2?(oe(e,255&t.adler),oe(e,t.adler>>8&255),oe(e,t.adler>>16&255),oe(e,t.adler>>24&255),oe(e,255&t.total_in),oe(e,t.total_in>>8&255),oe(e,t.total_in>>16&255),oe(e,t.total_in>>24&255)):(sr(e,t.adler>>>16),sr(e,65535&t.adler)),Xe(t),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?Ne:pa)},deflateEnd:t=>{if(ar(t))return vt;const n=t.state.status;return t.state=null,n===rn?sn(t,Dl):Ne},deflateSetDictionary:(t,n)=>{let e=n.length;if(ar(t))return vt;const r=t.state,i=r.wrap;if(i===2||i===1&&r.status!==On||r.lookahead)return vt;if(i===1&&(t.adler=rr(t.adler,n,e,0)),r.wrap=0,e>=r.w_size){i===0&&(zt(r.head),r.strstart=0,r.block_start=0,r.insert=0);let u=new Uint8Array(r.w_size);u.set(n.subarray(e-r.w_size,e),0),n=u,e=r.w_size}const s=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=e,t.next_in=0,t.input=n,kn(r);r.lookahead>=3;){let u=r.strstart,c=r.lookahead-2;do r.ins_h=Ht(r,r.ins_h,r.window[u+3-1]),r.prev[u&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=u,u++;while(--c);r.strstart=u,r.lookahead=2,kn(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,t.next_in=o,t.input=a,t.avail_in=s,r.wrap=i,Ne},deflateInfo:"pako deflate (from Nodeca project)"};const Hl=(t,n)=>Object.prototype.hasOwnProperty.call(t,n);var Qr={assign:function(t){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const e=n.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const r in e)Hl(e,r)&&(t[r]=e[r])}}return t},flattenChunks:t=>{let n=0;for(let r=0,i=t.length;r<i;r++)n+=t[r].length;const e=new Uint8Array(n);for(let r=0,i=0,s=t.length;r<s;r++){let o=t[r];e.set(o,i),i+=o.length}return e}};let Ea=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Ea=!1}const cr=new Uint8Array(256);for(let t=0;t<256;t++)cr[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;cr[254]=cr[254]=1;var lr={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let n,e,r,i,s,o=t.length,a=0;for(i=0;i<o;i++)e=t.charCodeAt(i),(64512&e)==55296&&i+1<o&&(r=t.charCodeAt(i+1),(64512&r)==56320&&(e=65536+(e-55296<<10)+(r-56320),i++)),a+=e<128?1:e<2048?2:e<65536?3:4;for(n=new Uint8Array(a),s=0,i=0;s<a;i++)e=t.charCodeAt(i),(64512&e)==55296&&i+1<o&&(r=t.charCodeAt(i+1),(64512&r)==56320&&(e=65536+(e-55296<<10)+(r-56320),i++)),e<128?n[s++]=e:e<2048?(n[s++]=192|e>>>6,n[s++]=128|63&e):e<65536?(n[s++]=224|e>>>12,n[s++]=128|e>>>6&63,n[s++]=128|63&e):(n[s++]=240|e>>>18,n[s++]=128|e>>>12&63,n[s++]=128|e>>>6&63,n[s++]=128|63&e);return n},buf2string:(t,n)=>{const e=n||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,n));let r,i;const s=new Array(2*e);for(i=0,r=0;r<e;){let o=t[r++];if(o<128){s[i++]=o;continue}let a=cr[o];if(a>4)s[i++]=65533,r+=a-1;else{for(o&=a===2?31:a===3?15:7;a>1&&r<e;)o=o<<6|63&t[r++],a--;a>1?s[i++]=65533:o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|1023&o)}}return((o,a)=>{if(a<65534&&o.subarray&&Ea)return String.fromCharCode.apply(null,o.length===a?o:o.subarray(0,a));let u="";for(let c=0;c<a;c++)u+=String.fromCharCode(o[c]);return u})(s,i)},utf8border:(t,n)=>{(n=n||t.length)>t.length&&(n=t.length);let e=n-1;for(;e>=0&&(192&t[e])==128;)e--;return e<0||e===0?n:e+cr[t[e]]>n?e:n}},wa=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Ia=Object.prototype.toString,{Z_NO_FLUSH:$l,Z_SYNC_FLUSH:jl,Z_FULL_FLUSH:Bl,Z_FINISH:Gl,Z_OK:Wr,Z_STREAM_END:Vl,Z_DEFAULT_COMPRESSION:Kl,Z_DEFAULT_STRATEGY:Ql,Z_DEFLATED:Wl}=tn;function dr(t){this.options=Qr.assign({level:Kl,method:Wl,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ql},t||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new wa,this.strm.avail_out=0;let e=ur.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(e!==Wr)throw new Error(en[e]);if(n.header&&ur.deflateSetHeader(this.strm,n.header),n.dictionary){let r;if(r=typeof n.dictionary=="string"?lr.string2buf(n.dictionary):Ia.call(n.dictionary)==="[object ArrayBuffer]"?new Uint8Array(n.dictionary):n.dictionary,e=ur.deflateSetDictionary(this.strm,r),e!==Wr)throw new Error(en[e]);this._dict_set=!0}}function ps(t,n){const e=new dr(n);if(e.push(t,!0),e.err)throw e.msg||en[e.err];return e.result}dr.prototype.push=function(t,n){const e=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=n===~~n?n:n===!0?Gl:$l,typeof t=="string"?e.input=lr.string2buf(t):Ia.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;)if(e.avail_out===0&&(e.output=new Uint8Array(r),e.next_out=0,e.avail_out=r),(s===jl||s===Bl)&&e.avail_out<=6)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else{if(i=ur.deflate(e,s),i===Vl)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),i=ur.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Wr;if(e.avail_out!==0){if(s>0&&e.next_out>0)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else if(e.avail_in===0)break}else this.onData(e.output)}return!0},dr.prototype.onData=function(t){this.chunks.push(t)},dr.prototype.onEnd=function(t){t===Wr&&(this.result=Qr.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Yl={Deflate:dr,deflate:ps,deflateRaw:function(t,n){return(n=n||{}).raw=!0,ps(t,n)},gzip:function(t,n){return(n=n||{}).gzip=!0,ps(t,n)},constants:tn};const Yr=16209;var Zl=function(t,n){let e,r,i,s,o,a,u,c,l,d,p,_,v,m,y,E,w,C,A,P,N,q,F,L;const U=t.state;e=t.next_in,F=t.input,r=e+(t.avail_in-5),i=t.next_out,L=t.output,s=i-(n-t.avail_out),o=i+(t.avail_out-257),a=U.dmax,u=U.wsize,c=U.whave,l=U.wnext,d=U.window,p=U.hold,_=U.bits,v=U.lencode,m=U.distcode,y=(1<<U.lenbits)-1,E=(1<<U.distbits)-1;e:do{_<15&&(p+=F[e++]<<_,_+=8,p+=F[e++]<<_,_+=8),w=v[p&y];t:for(;;){if(C=w>>>24,p>>>=C,_-=C,C=w>>>16&255,C===0)L[i++]=65535&w;else{if(!(16&C)){if(!(64&C)){w=v[(65535&w)+(p&(1<<C)-1)];continue t}if(32&C){U.mode=16191;break e}t.msg="invalid literal/length code",U.mode=Yr;break e}A=65535&w,C&=15,C&&(_<C&&(p+=F[e++]<<_,_+=8),A+=p&(1<<C)-1,p>>>=C,_-=C),_<15&&(p+=F[e++]<<_,_+=8,p+=F[e++]<<_,_+=8),w=m[p&E];n:for(;;){if(C=w>>>24,p>>>=C,_-=C,C=w>>>16&255,!(16&C)){if(!(64&C)){w=m[(65535&w)+(p&(1<<C)-1)];continue n}t.msg="invalid distance code",U.mode=Yr;break e}if(P=65535&w,C&=15,_<C&&(p+=F[e++]<<_,_+=8,_<C&&(p+=F[e++]<<_,_+=8)),P+=p&(1<<C)-1,P>a){t.msg="invalid distance too far back",U.mode=Yr;break e}if(p>>>=C,_-=C,C=i-s,P>C){if(C=P-C,C>c&&U.sane){t.msg="invalid distance too far back",U.mode=Yr;break e}if(N=0,q=d,l===0){if(N+=u-C,C<A){A-=C;do L[i++]=d[N++];while(--C);N=i-P,q=L}}else if(l<C){if(N+=u+l-C,C-=l,C<A){A-=C;do L[i++]=d[N++];while(--C);if(N=0,l<A){C=l,A-=C;do L[i++]=d[N++];while(--C);N=i-P,q=L}}}else if(N+=l-C,C<A){A-=C;do L[i++]=d[N++];while(--C);N=i-P,q=L}for(;A>2;)L[i++]=q[N++],L[i++]=q[N++],L[i++]=q[N++],A-=3;A&&(L[i++]=q[N++],A>1&&(L[i++]=q[N++]))}else{N=i-P;do L[i++]=L[N++],L[i++]=L[N++],L[i++]=L[N++],A-=3;while(A>2);A&&(L[i++]=L[N++],A>1&&(L[i++]=L[N++]))}break}}break}}while(e<r&&i<o);A=_>>3,e-=A,_-=A<<3,p&=(1<<_)-1,t.next_in=e,t.next_out=i,t.avail_in=e<r?r-e+5:5-(e-r),t.avail_out=i<o?o-i+257:257-(i-o),U.hold=p,U.bits=_};const Zr=15,Xl=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Jl=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ed=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),td=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var hr=(t,n,e,r,i,s,o,a)=>{const u=a.bits;let c,l,d,p,_,v,m=0,y=0,E=0,w=0,C=0,A=0,P=0,N=0,q=0,F=0,L=null;const U=new Uint16Array(16),K=new Uint16Array(16);let ve,we,Ct,ft=null;for(m=0;m<=Zr;m++)U[m]=0;for(y=0;y<r;y++)U[n[e+y]]++;for(C=u,w=Zr;w>=1&&U[w]===0;w--);if(C>w&&(C=w),w===0)return i[s++]=20971520,i[s++]=20971520,a.bits=1,0;for(E=1;E<w&&U[E]===0;E++);for(C<E&&(C=E),N=1,m=1;m<=Zr;m++)if(N<<=1,N-=U[m],N<0)return-1;if(N>0&&(t===0||w!==1))return-1;for(K[1]=0,m=1;m<Zr;m++)K[m+1]=K[m]+U[m];for(y=0;y<r;y++)n[e+y]!==0&&(o[K[n[e+y]]++]=y);if(t===0?(L=ft=o,v=20):t===1?(L=Xl,ft=Jl,v=257):(L=ed,ft=td,v=0),F=0,y=0,m=E,_=s,A=C,P=0,d=-1,q=1<<C,p=q-1,t===1&&q>852||t===2&&q>592)return 1;for(;;){ve=m-P,o[y]+1<v?(we=0,Ct=o[y]):o[y]>=v?(we=ft[o[y]-v],Ct=L[o[y]-v]):(we=96,Ct=0),c=1<<m-P,l=1<<A,E=l;do l-=c,i[_+(F>>P)+l]=ve<<24|we<<16|Ct|0;while(l!==0);for(c=1<<m-1;F&c;)c>>=1;if(c!==0?(F&=c-1,F+=c):F=0,y++,--U[m]==0){if(m===w)break;m=n[e+o[y]]}if(m>C&&(F&p)!==d){for(P===0&&(P=C),_+=E,A=m-P,N=1<<A;A+P<w&&(N-=U[A+P],!(N<=0));)A++,N<<=1;if(q+=1<<A,t===1&&q>852||t===2&&q>592)return 1;d=F&p,i[d]=C<<24|A<<16|_-s|0}}return F!==0&&(i[_+F]=m-P<<24|64<<16|0),a.bits=C,0};const{Z_FINISH:Ta,Z_BLOCK:nd,Z_TREES:Xr,Z_OK:on,Z_STREAM_END:rd,Z_NEED_DICT:id,Z_STREAM_ERROR:st,Z_DATA_ERROR:Ca,Z_MEM_ERROR:Sa,Z_BUF_ERROR:sd,Z_DEFLATED:Aa}=tn,Jr=16180,ei=16190,At=16191,_s=16192,vs=16194,ti=16199,ni=16200,ms=16206,pe=16209,Na=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function od(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const an=t=>{if(!t)return 1;const n=t.state;return!n||n.strm!==t||n.mode<Jr||n.mode>16211?1:0},Oa=t=>{if(an(t))return st;const n=t.state;return t.total_in=t.total_out=n.total=0,t.msg="",n.wrap&&(t.adler=1&n.wrap),n.mode=Jr,n.last=0,n.havedict=0,n.flags=-1,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(852),n.distcode=n.distdyn=new Int32Array(592),n.sane=1,n.back=-1,on},ka=t=>{if(an(t))return st;const n=t.state;return n.wsize=0,n.whave=0,n.wnext=0,Oa(t)},Ra=(t,n)=>{let e;if(an(t))return st;const r=t.state;return n<0?(e=0,n=-n):(e=5+(n>>4),n<48&&(n&=15)),n&&(n<8||n>15)?st:(r.window!==null&&r.wbits!==n&&(r.window=null),r.wrap=e,r.wbits=n,ka(t))},Da=(t,n)=>{if(!t)return st;const e=new od;t.state=e,e.strm=t,e.window=null,e.mode=Jr;const r=Ra(t,n);return r!==on&&(t.state=null),r};let gs,ys,Ua=!0;const ad=t=>{if(Ua){gs=new Int32Array(512),ys=new Int32Array(32);let n=0;for(;n<144;)t.lens[n++]=8;for(;n<256;)t.lens[n++]=9;for(;n<280;)t.lens[n++]=7;for(;n<288;)t.lens[n++]=8;for(hr(1,t.lens,0,288,gs,0,t.work,{bits:9}),n=0;n<32;)t.lens[n++]=5;hr(2,t.lens,0,32,ys,0,t.work,{bits:5}),Ua=!1}t.lencode=gs,t.lenbits=9,t.distcode=ys,t.distbits=5},Ma=(t,n,e,r)=>{let i;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(n.subarray(e-s.wsize,e),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(n.subarray(e-r,e-r+i),s.wnext),(r-=i)?(s.window.set(n.subarray(e-r,e),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var Nt={inflateReset:ka,inflateReset2:Ra,inflateResetKeep:Oa,inflateInit:t=>Da(t,15),inflateInit2:Da,inflate:(t,n)=>{let e,r,i,s,o,a,u,c,l,d,p,_,v,m,y,E,w,C,A,P,N,q,F=0;const L=new Uint8Array(4);let U,K;const ve=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(an(t)||!t.output||!t.input&&t.avail_in!==0)return st;e=t.state,e.mode===At&&(e.mode=_s),o=t.next_out,i=t.output,u=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,c=e.hold,l=e.bits,d=a,p=u,q=on;e:for(;;)switch(e.mode){case Jr:if(e.wrap===0){e.mode=_s;break}for(;l<16;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(2&e.wrap&&c===35615){e.wbits===0&&(e.wbits=15),e.check=0,L[0]=255&c,L[1]=c>>>8&255,e.check=Ce(e.check,L,2,0),c=0,l=0,e.mode=16181;break}if(e.head&&(e.head.done=!1),!(1&e.wrap)||(((255&c)<<8)+(c>>8))%31){t.msg="incorrect header check",e.mode=pe;break}if((15&c)!==Aa){t.msg="unknown compression method",e.mode=pe;break}if(c>>>=4,l-=4,N=8+(15&c),e.wbits===0&&(e.wbits=N),N>15||N>e.wbits){t.msg="invalid window size",e.mode=pe;break}e.dmax=1<<e.wbits,e.flags=0,t.adler=e.check=1,e.mode=512&c?16189:At,c=0,l=0;break;case 16181:for(;l<16;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(e.flags=c,(255&e.flags)!==Aa){t.msg="unknown compression method",e.mode=pe;break}if(57344&e.flags){t.msg="unknown header flags set",e.mode=pe;break}e.head&&(e.head.text=c>>8&1),512&e.flags&&4&e.wrap&&(L[0]=255&c,L[1]=c>>>8&255,e.check=Ce(e.check,L,2,0)),c=0,l=0,e.mode=16182;case 16182:for(;l<32;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}e.head&&(e.head.time=c),512&e.flags&&4&e.wrap&&(L[0]=255&c,L[1]=c>>>8&255,L[2]=c>>>16&255,L[3]=c>>>24&255,e.check=Ce(e.check,L,4,0)),c=0,l=0,e.mode=16183;case 16183:for(;l<16;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}e.head&&(e.head.xflags=255&c,e.head.os=c>>8),512&e.flags&&4&e.wrap&&(L[0]=255&c,L[1]=c>>>8&255,e.check=Ce(e.check,L,2,0)),c=0,l=0,e.mode=16184;case 16184:if(1024&e.flags){for(;l<16;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}e.length=c,e.head&&(e.head.extra_len=c),512&e.flags&&4&e.wrap&&(L[0]=255&c,L[1]=c>>>8&255,e.check=Ce(e.check,L,2,0)),c=0,l=0}else e.head&&(e.head.extra=null);e.mode=16185;case 16185:if(1024&e.flags&&(_=e.length,_>a&&(_=a),_&&(e.head&&(N=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(r.subarray(s,s+_),N)),512&e.flags&&4&e.wrap&&(e.check=Ce(e.check,r,_,s)),a-=_,s+=_,e.length-=_),e.length))break e;e.length=0,e.mode=16186;case 16186:if(2048&e.flags){if(a===0)break e;_=0;do N=r[s+_++],e.head&&N&&e.length<65536&&(e.head.name+=String.fromCharCode(N));while(N&&_<a);if(512&e.flags&&4&e.wrap&&(e.check=Ce(e.check,r,_,s)),a-=_,s+=_,N)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=16187;case 16187:if(4096&e.flags){if(a===0)break e;_=0;do N=r[s+_++],e.head&&N&&e.length<65536&&(e.head.comment+=String.fromCharCode(N));while(N&&_<a);if(512&e.flags&&4&e.wrap&&(e.check=Ce(e.check,r,_,s)),a-=_,s+=_,N)break e}else e.head&&(e.head.comment=null);e.mode=16188;case 16188:if(512&e.flags){for(;l<16;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(4&e.wrap&&c!==(65535&e.check)){t.msg="header crc mismatch",e.mode=pe;break}c=0,l=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),t.adler=e.check=0,e.mode=At;break;case 16189:for(;l<32;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}t.adler=e.check=Na(c),c=0,l=0,e.mode=ei;case ei:if(e.havedict===0)return t.next_out=o,t.avail_out=u,t.next_in=s,t.avail_in=a,e.hold=c,e.bits=l,id;t.adler=e.check=1,e.mode=At;case At:if(n===nd||n===Xr)break e;case _s:if(e.last){c>>>=7&l,l-=7&l,e.mode=ms;break}for(;l<3;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}switch(e.last=1&c,c>>>=1,l-=1,3&c){case 0:e.mode=16193;break;case 1:if(ad(e),e.mode=ti,n===Xr){c>>>=2,l-=2;break e}break;case 2:e.mode=16196;break;case 3:t.msg="invalid block type",e.mode=pe}c>>>=2,l-=2;break;case 16193:for(c>>>=7&l,l-=7&l;l<32;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if((65535&c)!=(c>>>16^65535)){t.msg="invalid stored block lengths",e.mode=pe;break}if(e.length=65535&c,c=0,l=0,e.mode=vs,n===Xr)break e;case vs:e.mode=16195;case 16195:if(_=e.length,_){if(_>a&&(_=a),_>u&&(_=u),_===0)break e;i.set(r.subarray(s,s+_),o),a-=_,s+=_,u-=_,o+=_,e.length-=_;break}e.mode=At;break;case 16196:for(;l<14;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(e.nlen=257+(31&c),c>>>=5,l-=5,e.ndist=1+(31&c),c>>>=5,l-=5,e.ncode=4+(15&c),c>>>=4,l-=4,e.nlen>286||e.ndist>30){t.msg="too many length or distance symbols",e.mode=pe;break}e.have=0,e.mode=16197;case 16197:for(;e.have<e.ncode;){for(;l<3;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}e.lens[ve[e.have++]]=7&c,c>>>=3,l-=3}for(;e.have<19;)e.lens[ve[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,U={bits:e.lenbits},q=hr(0,e.lens,0,19,e.lencode,0,e.work,U),e.lenbits=U.bits,q){t.msg="invalid code lengths set",e.mode=pe;break}e.have=0,e.mode=16198;case 16198:for(;e.have<e.nlen+e.ndist;){for(;F=e.lencode[c&(1<<e.lenbits)-1],y=F>>>24,E=F>>>16&255,w=65535&F,!(y<=l);){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(w<16)c>>>=y,l-=y,e.lens[e.have++]=w;else{if(w===16){for(K=y+2;l<K;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(c>>>=y,l-=y,e.have===0){t.msg="invalid bit length repeat",e.mode=pe;break}N=e.lens[e.have-1],_=3+(3&c),c>>>=2,l-=2}else if(w===17){for(K=y+3;l<K;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}c>>>=y,l-=y,N=0,_=3+(7&c),c>>>=3,l-=3}else{for(K=y+7;l<K;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}c>>>=y,l-=y,N=0,_=11+(127&c),c>>>=7,l-=7}if(e.have+_>e.nlen+e.ndist){t.msg="invalid bit length repeat",e.mode=pe;break}for(;_--;)e.lens[e.have++]=N}}if(e.mode===pe)break;if(e.lens[256]===0){t.msg="invalid code -- missing end-of-block",e.mode=pe;break}if(e.lenbits=9,U={bits:e.lenbits},q=hr(1,e.lens,0,e.nlen,e.lencode,0,e.work,U),e.lenbits=U.bits,q){t.msg="invalid literal/lengths set",e.mode=pe;break}if(e.distbits=6,e.distcode=e.distdyn,U={bits:e.distbits},q=hr(2,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,U),e.distbits=U.bits,q){t.msg="invalid distances set",e.mode=pe;break}if(e.mode=ti,n===Xr)break e;case ti:e.mode=ni;case ni:if(a>=6&&u>=258){t.next_out=o,t.avail_out=u,t.next_in=s,t.avail_in=a,e.hold=c,e.bits=l,Zl(t,p),o=t.next_out,i=t.output,u=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,c=e.hold,l=e.bits,e.mode===At&&(e.back=-1);break}for(e.back=0;F=e.lencode[c&(1<<e.lenbits)-1],y=F>>>24,E=F>>>16&255,w=65535&F,!(y<=l);){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(E&&!(240&E)){for(C=y,A=E,P=w;F=e.lencode[P+((c&(1<<C+A)-1)>>C)],y=F>>>24,E=F>>>16&255,w=65535&F,!(C+y<=l);){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}c>>>=C,l-=C,e.back+=C}if(c>>>=y,l-=y,e.back+=y,e.length=w,E===0){e.mode=16205;break}if(32&E){e.back=-1,e.mode=At;break}if(64&E){t.msg="invalid literal/length code",e.mode=pe;break}e.extra=15&E,e.mode=16201;case 16201:if(e.extra){for(K=e.extra;l<K;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}e.length+=c&(1<<e.extra)-1,c>>>=e.extra,l-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=16202;case 16202:for(;F=e.distcode[c&(1<<e.distbits)-1],y=F>>>24,E=F>>>16&255,w=65535&F,!(y<=l);){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(!(240&E)){for(C=y,A=E,P=w;F=e.distcode[P+((c&(1<<C+A)-1)>>C)],y=F>>>24,E=F>>>16&255,w=65535&F,!(C+y<=l);){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}c>>>=C,l-=C,e.back+=C}if(c>>>=y,l-=y,e.back+=y,64&E){t.msg="invalid distance code",e.mode=pe;break}e.offset=w,e.extra=15&E,e.mode=16203;case 16203:if(e.extra){for(K=e.extra;l<K;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}e.offset+=c&(1<<e.extra)-1,c>>>=e.extra,l-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){t.msg="invalid distance too far back",e.mode=pe;break}e.mode=16204;case 16204:if(u===0)break e;if(_=p-u,e.offset>_){if(_=e.offset-_,_>e.whave&&e.sane){t.msg="invalid distance too far back",e.mode=pe;break}_>e.wnext?(_-=e.wnext,v=e.wsize-_):v=e.wnext-_,_>e.length&&(_=e.length),m=e.window}else m=i,v=o-e.offset,_=e.length;_>u&&(_=u),u-=_,e.length-=_;do i[o++]=m[v++];while(--_);e.length===0&&(e.mode=ni);break;case 16205:if(u===0)break e;i[o++]=e.length,u--,e.mode=ni;break;case ms:if(e.wrap){for(;l<32;){if(a===0)break e;a--,c|=r[s++]<<l,l+=8}if(p-=u,t.total_out+=p,e.total+=p,4&e.wrap&&p&&(t.adler=e.check=e.flags?Ce(e.check,i,p,o-p):rr(e.check,i,p,o-p)),p=u,4&e.wrap&&(e.flags?c:Na(c))!==e.check){t.msg="incorrect data check",e.mode=pe;break}c=0,l=0}e.mode=16207;case 16207:if(e.wrap&&e.flags){for(;l<32;){if(a===0)break e;a--,c+=r[s++]<<l,l+=8}if(4&e.wrap&&c!==(4294967295&e.total)){t.msg="incorrect length check",e.mode=pe;break}c=0,l=0}e.mode=16208;case 16208:q=rd;break e;case pe:q=Ca;break e;case 16210:return Sa;default:return st}return t.next_out=o,t.avail_out=u,t.next_in=s,t.avail_in=a,e.hold=c,e.bits=l,(e.wsize||p!==t.avail_out&&e.mode<pe&&(e.mode<ms||n!==Ta))&&Ma(t,t.output,t.next_out,p-t.avail_out),d-=t.avail_in,p-=t.avail_out,t.total_in+=d,t.total_out+=p,e.total+=p,4&e.wrap&&p&&(t.adler=e.check=e.flags?Ce(e.check,i,p,t.next_out-p):rr(e.check,i,p,t.next_out-p)),t.data_type=e.bits+(e.last?64:0)+(e.mode===At?128:0)+(e.mode===ti||e.mode===vs?256:0),(d===0&&p===0||n===Ta)&&q===on&&(q=sd),q},inflateEnd:t=>{if(an(t))return st;let n=t.state;return n.window&&(n.window=null),t.state=null,on},inflateGetHeader:(t,n)=>{if(an(t))return st;const e=t.state;return 2&e.wrap?(e.head=n,n.done=!1,on):st},inflateSetDictionary:(t,n)=>{const e=n.length;let r,i,s;return an(t)?st:(r=t.state,r.wrap!==0&&r.mode!==ei?st:r.mode===ei&&(i=1,i=rr(i,n,e,0),i!==r.check)?Ca:(s=Ma(t,n,e,e),s?(r.mode=16210,Sa):(r.havedict=1,on)))},inflateInfo:"pako inflate (from Nodeca project)"},ud=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const La=Object.prototype.toString,{Z_NO_FLUSH:cd,Z_FINISH:ld,Z_OK:fr,Z_STREAM_END:bs,Z_NEED_DICT:Es,Z_STREAM_ERROR:dd,Z_DATA_ERROR:Pa,Z_MEM_ERROR:hd}=tn;function pr(t){this.options=Qr.assign({chunkSize:65536,windowBits:15,to:""},t||{});const n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,n.windowBits===0&&(n.windowBits=-15)),!(n.windowBits>=0&&n.windowBits<16)||t&&t.windowBits||(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&!(15&n.windowBits)&&(n.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new wa,this.strm.avail_out=0;let e=Nt.inflateInit2(this.strm,n.windowBits);if(e!==fr)throw new Error(en[e]);if(this.header=new ud,Nt.inflateGetHeader(this.strm,this.header),n.dictionary&&(typeof n.dictionary=="string"?n.dictionary=lr.string2buf(n.dictionary):La.call(n.dictionary)==="[object ArrayBuffer]"&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(e=Nt.inflateSetDictionary(this.strm,n.dictionary),e!==fr)))throw new Error(en[e])}function ws(t,n){const e=new pr(n);if(e.push(t),e.err)throw e.msg||en[e.err];return e.result}pr.prototype.push=function(t,n){const e=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(o=n===~~n?n:n===!0?ld:cd,La.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(r),e.next_out=0,e.avail_out=r),s=Nt.inflate(e,o),s===Es&&i&&(s=Nt.inflateSetDictionary(e,i),s===fr?s=Nt.inflate(e,o):s===Pa&&(s=Es));e.avail_in>0&&s===bs&&e.state.wrap>0&&t[e.next_in]!==0;)Nt.inflateReset(e),s=Nt.inflate(e,o);switch(s){case dd:case Pa:case Es:case hd:return this.onEnd(s),this.ended=!0,!1}if(a=e.avail_out,e.next_out&&(e.avail_out===0||s===bs))if(this.options.to==="string"){let u=lr.utf8border(e.output,e.next_out),c=e.next_out-u,l=lr.buf2string(e.output,u);e.next_out=c,e.avail_out=r-c,c&&e.output.set(e.output.subarray(u,u+c),0),this.onData(l)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(s!==fr||a!==0){if(s===bs)return s=Nt.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(e.avail_in===0)break}}return!0},pr.prototype.onData=function(t){this.chunks.push(t)},pr.prototype.onEnd=function(t){t===fr&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Qr.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var fd={Inflate:pr,inflate:ws,inflateRaw:function(t,n){return(n=n||{}).raw=!0,ws(t,n)},ungzip:ws,constants:tn};const{Deflate:pd,deflate:_d,deflateRaw:vd,gzip:md}=Yl,{Inflate:gd,inflate:yd,inflateRaw:bd,ungzip:Ed}=fd;var yt,wd={Deflate:pd,deflate:_d,deflateRaw:vd,gzip:md,Inflate:gd,inflate:yd,inflateRaw:bd,ungzip:Ed,constants:tn},xa=function(t){return f(void 0,void 0,void 0,function(){var n;return h(this,function(e){return n=wd.ungzip(t),[2,String.fromCharCode.apply(null,n)]})})};(function(t){t.CONNECTING="CONNECTING",t.OPEN="OPEN",t.CLOSED="CLOSED"})(yt||(yt={}));var se,Id=function(t){function n(e,r){var i=r.sdkState,s=r.dispatcher,o=r.logger,a=t.call(this)||this;return a.lastActive=0,a._iid=e,a._sdkState=i,a._dispatcher=s,a._logger=o,a}return g(n,t),Object.defineProperty(n.prototype,"isOpen",{get:function(){return this.connectionState===yt.OPEN},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"connectionState",{get:function(){if(this._ws)switch(this._ws.readyState){case 0:return yt.CONNECTING;case 1:return yt.OPEN}return yt.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"ws",{get:function(){var e;return(e=this._ws)!==null&&e!==void 0?e:null},enumerable:!1,configurable:!0}),n.prototype._handleMessage=function(e){var r=this;e.split(`
`).forEach(function(i){if(i){var s=de.createFromRawMessage(r._iid,i);if(r._logger.debug("receive websocket event",s),s.code==="LOGI")r.dispatch("message",s);else if(s.code==="PONG")r.dispatch("pong");else if(s.code==="EXPR"){if(s.payload){var o=new xt(s.payload);o.expiresIn>=0&&r._dispatcher.dispatch(o)}}else s.code==="NOOP"||r.dispatch("message",s)}})},n.prototype.connect=function(e,r){var i=this;r===void 0&&(r=""),this._ws=new WebSocket(e,encodeURIComponent(r)),this._ws.onopen=function(){i._logger.debug("websocket open"),i.dispatch("open")},this._ws.onmessage=function(s){return f(i,void 0,void 0,function(){var o,a,u,c,l=this;return h(this,function(d){switch(d.label){case 0:return!((c=this._sdkState.websocket)===null||c===void 0)&&c.compression?s.data instanceof Blob?((o=new FileReader).readAsArrayBuffer(s.data),o.onloadend=function(){return f(l,void 0,void 0,function(){var p,_;return h(this,function(v){switch(v.label){case 0:return v.trys.push([0,2,,3]),[4,xa(o.result)];case 1:return p=v.sent(),this._handleMessage(p),[3,3];case 2:return _=v.sent(),this.error(_),[3,3];case 3:return[2]}})})},[3,7]):[3,1]:[3,8];case 1:if(!(s.data instanceof ArrayBuffer))return[3,6];d.label=2;case 2:return d.trys.push([2,4,,5]),[4,xa(new Uint8Array(s.data))];case 3:return a=d.sent(),this._handleMessage(a),[3,5];case 4:return u=d.sent(),this.error(u),[3,5];case 5:return[3,7];case 6:typeof s.data=="string"&&this._handleMessage(s.data),d.label=7;case 7:return[3,9];case 8:this._handleMessage(s.data),d.label=9;case 9:return[2]}})})},this._ws.onerror=function(){i._logger.debug("websocket error"),i.dispatch("error",I.networkError)},this._ws.onclose=function(){i._logger.debug("websocket close"),i.dispatch("close")},this.lastActive=Date.now()},n.prototype.disconnect=function(){var e=this;return new Promise(function(r){e._logger.debug("websocket disconnect"),e._ws?(e._ws.onopen=B,e._ws.onmessage=B,e._ws.onerror=B,e.connectionState!==yt.CLOSED?(e._ws.onclose=function(){e.dispatch("close"),r()},e._ws.close(),e._ws=void 0):r()):r()})},n.prototype.send=function(e){if(!this._ws)throw I.connectionClosed;e.code!=="PING"?this.dispatch("ping-refresh"):this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())},n.prototype.error=function(e){this._logger.debug("websocket error",e),this.dispatch("error",e)},n}(Cn),Fa=function(t){function n(e){var r=e.all,i=e.feed,s=e.custom_types,o=e.ts,a=t.call(this)||this;return a.all=r,a.feed=i,a.customTypes=s,a.ts=o,a}return g(n,t),n}(le),Td=function(){function t(n,e){var r=e.session,i=e.sdkState,s=e.dispatcher,o=e.logger,a=e.useFetchCompat,u=a!==void 0&&a,c=this;this._ackStateMap=new Map,this._sdkState=i,this._dispatcher=s,this._logger=o,this.apiClient=new wl(n,{session:r,sdkState:i,dispatcher:s,logger:o,useFetchCompat:u}),this.websocketClient=new Id(n,{sdkState:i,dispatcher:s,logger:o}),this.websocketClient.on("message",function(l){if(l.payload.unread_cnt&&c._dispatcher.dispatch(new Fa(l.payload.unread_cnt)),l.requestId){if(c._ackStateMap.has(l.requestId)){var d=c._ackStateMap.get(l.requestId);l.code!=="EROR"?d.resolve(l):d.reject(new I({code:l.payload.code,message:l.payload.message}))}}else c._dispatcher.dispatch(l)}).on("close",function(){c._ackStateMap.forEach(function(l){l.reject(I.connectionClosed)}),c._ackStateMap.clear()})}return t.prototype._sendApiRequest=function(n){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this.apiClient.send(n)];case 1:return[2,e.sent()]}})})},t.prototype._sendWebsocketRequest=function(n){return f(this,void 0,void 0,function(){var e,r,i,s=this;return h(this,function(o){if(!this._sdkState.websocket)throw I.connectionRequired;if(e=new Ae,n.ackRequired){i=function(a,u){s._ackStateMap.has(n.requestId)&&(s._ackStateMap.delete(n.requestId),r&&(clearTimeout(r),r=null),a?(s._logger.debug("fail websocket request",n.requestId,a),e.reject(a)):(s._logger.debug("receive websocket ack",n.requestId,n),s._logger.debug("receive websocket ack",u),e.resolve(u)))};try{r=setTimeout(function(){return i(I.noAckTimeout)},this._sdkState.websocket.responseTimeout),this._ackStateMap.set(n.requestId,{resolve:function(a){return i(void 0,a)},reject:function(a){return i(a)}}),this.websocketClient.send(n)}catch(a){i(a)}}else try{this.websocketClient.send(n),e.resolve()}catch(a){e.reject(a)}return[2,e.promise]})})},t.prototype.send=function(n){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return n instanceof R?[4,this._sendApiRequest(n)]:[3,2];case 1:case 3:return[2,e.sent()];case 2:return n instanceof He?[4,this._sendWebsocketRequest(n)]:[3,4];case 4:throw I.invalidParameters}})})},t.prototype.cancel=function(n){this.apiClient.cancel(n)},t.prototype.cancelAll=function(){this.apiClient.cancelAll()},t}();(function(t){t[t.NONE=0]="NONE",t[t.INITIALIZED=1]="INITIALIZED",t[t.CONNECTING=2]="CONNECTING",t[t.CONNECTED=3]="CONNECTED",t[t.RECONNECTING=4]="RECONNECTING",t[t.INTERNAL_DISCONNECTED=5]="INTERNAL_DISCONNECTED",t[t.EXTERNAL_DISCONNECTED=6]="EXTERNAL_DISCONNECTED",t[t.LOGOUT=7]="LOGOUT"})(se||(se={}));var un=function(t){function n(e){var r=e.stateType,i=t.call(this)||this;return i.stateType=r,i}return g(n,t),n}(le),qa=function(t){function n(){return t!==null&&t.apply(this,arguments)||this}return g(n,t),n}(le),Is=function(t){function n(){return t!==null&&t.apply(this,arguments)||this}return g(n,t),n}(le),za=function(t){function n(){return t!==null&&t.apply(this,arguments)||this}return g(n,t),n}(le),Ha=function(){function t(n){var e,r,i,s;this.isEnabled=(e=n.enabled)!==null&&e!==void 0&&e,this.feedChannels=(r=n.feed_channels)!==null&&r!==void 0?r:{},this.templateListToken=(i=n.template_list_token)!==null&&i!==void 0?i:null,this.settingsUpdatedAt=(s=n.settings_updated_at)!==null&&s!==void 0?s:0}return t.payloadify=function(n){return x(H({enabled:n.isEnabled,feed_channels:n.feedChannels,template_list_token:n.templateListToken,settings_updated_at:n.settingsUpdatedAt}))},t}(),Cd=function(t){return"sendbird@".concat(t,"/changelog_include_chat_notifications")},$a=function(){function t(n){var e;this.lastUpdatedAt=(e=n.last_updated_at)!==null&&e!==void 0?e:0}return t.payloadify=function(n){return x(H({last_updated_at:n.lastUpdatedAt}))},t}(),ja=function(){function t(n){var e;this.token=(e=n.template_list_token)!==null&&e!==void 0?e:""}return t.payloadify=function(n){return x(H({template_list_token:n.token}))},t}(),Ba=1048576,Sd=5,Ga=function(){function t(n){var e,r,i,s,o;n===void 0&&(n={}),this.emojiHash=n.emoji_hash||"",this.uploadSizeLimit=n.file_upload_size_limit?n.file_upload_size_limit*Ba:Number.MAX_SAFE_INTEGER,this.useReaction=!!n.use_reaction,this.applicationAttributes=(e=n.application_attributes)!==null&&e!==void 0?e:[],this.premiumFeatureList=(r=n.premium_feature_list)!==null&&r!==void 0?r:[],this.deviceTokenCache=this.applicationAttributes.includes("sdk_device_token_cache"),this.enabledChannelMemberShipHistory=this.applicationAttributes.includes("channel_membership_history"),this.multipleFilesMessageFileCountLimit=(i=n.multiple_file_send_max_size)!==null&&i!==void 0?i:5,this.allowSdkStatsUpload=(s=n.allow_sdk_log_ingestion)===null||s===void 0||s,this.uikitConfigInfo=new $a((o=n.uikit_config)!==null&&o!==void 0?o:{}),this.notificationInfo=n.notifications?new Ha(n.notifications):null,this.messageTemplateInfo=n.message_template?new ja(n.message_template):null}return t.payloadify=function(n){return x(H({emoji_hash:n.emojiHash,file_upload_size_limit:n.uploadSizeLimit/Ba,application_attributes:n.applicationAttributes,premium_feature_list:n.premiumFeatureList,use_reaction:n.useReaction,allow_sdk_log_ingestion:n.allowSdkStatsUpload,uikit_config:n.uikitConfigInfo?$a.payloadify(n.uikitConfigInfo):null,notifications:n.notificationInfo?Ha.payloadify(n.notificationInfo):null,message_template:n.messageTemplateInfo?ja.payloadify(n.messageTemplateInfo):null}))},t}(),qe=function(){function t(n){this._iid="",this._iid=n}return t.payloadify=function(n){return{}},t}(),Ad=function(t){function n(e){var r=e.userId,i=e.metadata,s=t.call(this)||this;return s.method=k.POST,s.path="".concat(ee,"/").concat(r,"/metadata"),s.params={metadata:i},s}return g(n,t),n}(R),Nd=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.metaData=r,i}return g(n,t),n}(M),Od=function(t){function n(e){var r=e.userId,i=e.metadata,s=e.upsert,o=t.call(this)||this;return o.method=k.PUT,o.path="".concat(ee,"/").concat(r,"/metadata"),o.params={metadata:i,upsert:s},o}return g(n,t),n}(R),kd=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.metadata=r,i}return g(n,t),n}(M),Rd=function(t){function n(e){var r=e.userId,i=e.metadataKey,s=t.call(this)||this;return s.method=k.DELETE,s.path="".concat(ee,"/").concat(r,"/metadata/").concat(i),s}return g(n,t),n}(R);(function(t){function n(){return t!==null&&t.apply(this,arguments)||this}g(n,t)})(M);var Dd=function(t){function n(e){var r=e.userId,i=t.call(this)||this;return i.method=k.DELETE,i.path="".concat(ee,"/").concat(r,"/metadata"),i}return g(n,t),n}(R);(function(t){function n(){return t!==null&&t.apply(this,arguments)||this}g(n,t)})(M);var Dn,ri=function(t,n){var e=JSON.parse(JSON.stringify(t));return e._iid&&delete e._iid,n&&n(e),e},_r=function(t,n){var e=JSON.parse(JSON.stringify(t));return n&&n(e),e},D=function(t){return{do:function(n){t||n()},throw:function(n){if(!t)throw n}}};(function(t){t.ONLINE="online",t.OFFLINE="offline",t.NON_AVAILABLE="nonavailable"})(Dn||(Dn={}));var Un,V=function(t){function n(e,r){var i,s,o,a,u,c,l,d,p,_,v,m,y=this;return(y=t.call(this,e)||this).userId=(s=(i=r.guest_id)!==null&&i!==void 0?i:r.user_id)!==null&&s!==void 0?s:"",y.nickname=(a=(o=r.nickname)!==null&&o!==void 0?o:r.name)!==null&&a!==void 0?a:"",y.plainProfileUrl=(c=(u=r.profile_url)!==null&&u!==void 0?u:r.image)!==null&&c!==void 0?c:"",y.requireAuth=(l=r.require_auth_for_profile_image)!==null&&l!==void 0&&l,y.metaData=(d=r.metadata)!==null&&d!==void 0?d:{},y.connectionStatus=Dn.NON_AVAILABLE,ue(Dn,r.is_online)?y.connectionStatus=r.is_online:T("boolean",r.is_online)&&(y.connectionStatus=r.is_online?Dn.ONLINE:Dn.OFFLINE),y.isActive=(p=r.is_active)===null||p===void 0||p,y.lastSeenAt=(_=r.last_seen_at)!==null&&_!==void 0?_:null,y.preferredLanguages=r.preferred_languages?Z([],G(r.preferred_languages),!1):null,y.friendDiscoveryKey=(v=r.friend_discovery_key)!==null&&v!==void 0?v:null,y.friendName=(m=r.friend_name)!==null&&m!==void 0?m:null,y}return g(n,t),n.payloadify=function(e){return x(H(b(b({},t.payloadify.call(this,e)),{user_id:e.userId,nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth,metadata:e.metaData,is_online:e.connectionStatus,is_active:e.isActive,last_seen_at:e.lastSeenAt,preferred_languages:e.preferredLanguages,friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName})))},Object.defineProperty(n.prototype,"profileUrl",{get:function(){var e=S.of(this._iid).sessionManager;return this.requireAuth&&e.ekey?"".concat(this.plainProfileUrl,"?auth=").concat(e.ekey):this.plainProfileUrl},enumerable:!1,configurable:!0}),n.prototype.serialize=function(){return ri(this)},n.prototype._isValidMetaData=function(e){return!Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map(function(r){return e[r]}).every(function(r){return T("string",r)})},n.prototype._applyMetaData=function(e,r){var i=this;r===void 0&&(r=!1),Object.keys(e).forEach(function(s){r?delete i.metaData[s]:i.metaData[s]=e[s]})},n.prototype.createMetaData=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return D(this._isValidMetaData(e)).throw(I.invalidParameters),r=S.of(this._iid),i=r.sdkState,s=r.requestQueue,o=new Ad({userId:i.userId,metadata:e}),[4,s.send(o)];case 1:return a=c.sent(),u=a.as(Nd).metaData,this._applyMetaData(u),[2,this.metaData]}})})},n.prototype.updateMetaData=function(e,r){return r===void 0&&(r=!1),f(this,void 0,void 0,function(){var i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return D(this._isValidMetaData(e)).throw(I.invalidParameters),i=S.of(this._iid),s=i.sdkState,o=i.requestQueue,a=new Od({userId:s.userId,metadata:e,upsert:r}),[4,o.send(a)];case 1:return u=l.sent(),c=u.as(kd).metadata,this._applyMetaData(c),[2,this.metaData]}})})},n.prototype.deleteMetaData=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return D(T("string",e)).throw(I.invalidParameters),r=S.of(this._iid),i=r.sdkState,s=r.requestQueue,o=new Rd({userId:i.userId,metadataKey:e}),[4,s.send(o)];case 1:return u.sent(),this._applyMetaData(((a={})[e]=!0,a),!0),[2,this.metaData]}})})},n.prototype.deleteAllMetaData=function(){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new Dd({userId:r.userId}),[4,i.send(s)];case 1:return o.sent(),this.metaData={},[2]}})})},n}(qe),Va=function(t){function n(e){var r=e.userProfile,i=t.call(this)||this;return i.userProfile=r,i}return g(n,t),n}(le),Ts=function(){function t(n,e){var r,i,s,o,a,u,c,l,d,p,_,v,m,y;this._iid=n,this.appInfo=new Ga(e),this.user=new V(n,e),this.connectedAt=(r=e.login_ts)!==null&&r!==void 0?r:0,this.firstConnectedAt=0,this.pingInterval=(i=e.ping_interval)!==null&&i!==void 0?i:15e3,this.pongTimeout=(s=e.pong_timeout)!==null&&s!==void 0?s:5e3,this.reconnectInterval=(a=(o=e.reconnect)===null||o===void 0?void 0:o.interval)!==null&&a!==void 0?a:3e3,this.reconnectMaxInterval=(c=(u=e.reconnect)===null||u===void 0?void 0:u.max_interval)!==null&&c!==void 0?c:6e4,this.reconnectRetryCount=(d=(l=e.reconnect)===null||l===void 0?void 0:l.retry_cnt)!==null&&d!==void 0?d:5,this.reconnectIntervalMultiple=(_=(p=e.reconnect)===null||p===void 0?void 0:p.mul)!==null&&_!==void 0?_:2,this.maxUnreadCountOnSuperGroup=(v=e.max_unread_cnt_on_super_group)!==null&&v!==void 0?v:100,this.profileImageEncryption=!!e.profile_image_encryption,this.concurrentCallLimit=(m=e.concurrent_call_limit)!==null&&m!==void 0?m:5,this.backOffDelay=(y=e.back_off_delay)!==null&&y!==void 0?y:100}return t.payloadify=function(n){return x(H(b(b(b({},V.payloadify(n.user)),Ga.payloadify(n.appInfo)),{login_ts:n.connectedAt,ping_interval:n.pingInterval,pong_timeout:n.pongTimeout,reconnect:{interval:n.reconnectInterval,max_interval:n.reconnectMaxInterval,retry_cnt:n.reconnectRetryCount,mul:n.reconnectIntervalMultiple},max_unread_cnt_on_super_group:n.maxUnreadCountOnSuperGroup,profile_image_encryption:n.profileImageEncryption,concurrent_call_limit:n.concurrentCallLimit,back_off_delay:n.backOffDelay})))},t.prototype.apply=function(){var n=this.reconnectInterval,e=this.reconnectMaxInterval,r=this.reconnectIntervalMultiple,i=S.of(this._iid);i.sdkState.websocket&&(i.sdkState.websocket.pingInterval=1e3*this.pingInterval,i.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,i.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,i.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(s){return s>0?1e3*Math.min(n*Math.pow(r,s-1),e):10}}),i.appInfo=this.appInfo,i.sessionManager.currentUser=this.user,i.connectedAt=this.connectedAt,this.firstConnectedAt||(i.firstConnectedAt=this.connectedAt),i.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,i.concurrentCallLimit=this.concurrentCallLimit,i.backOffDelay=this.backOffDelay,i.dispatcher.dispatch(new Va({userProfile:this}))},t}(),Ka=function(t){function n(e){var r=e.request,i=r===void 0||r,s=e.features,o=s===void 0?{}:s,a=e.options,u=a===void 0?{}:a,c=t.call(this)||this;return c.request=i,c.features=b({localCache:!0,notification:!0},o),c.options=b({ingestion:!0},u),c}return g(n,t),n}(le),ii=function(t){function n(e,r,i){var s,o,a,u,c=this;return(c=t.call(this,e,r,i)||this).error=null,c.services=[],c.userProfile=new Ts(e,i),c.deviceTokenLastDeletedAt=(s=i.device_token_last_deleted_at)!==null&&s!==void 0?s:0,c.key=(o=i.key)!==null&&o!==void 0?o:"",c.ekey=(a=i.ekey)!==null&&a!==void 0?a:"",c.error=i.error?new I(i):null,c.services=(u=i.services)!==null&&u!==void 0?u:[],c}return g(n,t),n.asError=function(e){return new n("","LOGI",b({user_id:"",error:!0},e))},n.prototype.applyTo=function(e){return f(this,void 0,void 0,function(){var r,i,s;return h(this,function(o){switch(o.label){case 0:return this.error?[3,4]:(r=S.of(e))?(i=r.sessionManager,s=r.dispatcher,[4,i.login(this)]):[3,2];case 1:return o.sent(),this.userProfile.apply(),s.dispatch(new Ka({request:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish"),features:{localCache:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_feature_local_cache_log_publish"),notification:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_noti_stats_log_publish")},options:{ingestion:this.userProfile.appInfo.allowSdkStatsUpload}})),[3,3];case 2:throw I.lostInstance;case 3:return[3,5];case 4:throw this.error;case 5:return[2]}})})},n}(de),cn=function(){function t(){this.type=se.NONE,this.name="none"}return t.prototype.run=function(n){return f(this,void 0,void 0,function(){return h(this,function(e){return[2]})})},t.prototype.onConnect=function(n,e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2]})})},t.prototype.onReconnect=function(n,e){return e.resetReconnectCount,f(this,void 0,void 0,function(){return h(this,function(r){return[2]})})},t.prototype.onDisconnect=function(n,e){return e.error,e.autoReconnect,e.cause,f(this,void 0,void 0,function(){return h(this,function(r){return[2]})})},t.prototype.onDisconnectWebSocket=function(n,e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2]})})},t.prototype.onLogout=function(n){return f(this,void 0,void 0,function(){return h(this,function(e){return[2]})})},t}(),Q=function(t){return f(void 0,void 0,void 0,function(){var n;return h(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,t()];case 1:return e.sent(),[3,3];case 2:if(!((n=e.sent())instanceof I))throw n;return n.throwOutside(),[3,3];case 3:return[2]}})})},Oe=function(t){return f(void 0,void 0,void 0,function(){return h(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,t()];case 1:case 2:return n.sent(),[3,3];case 3:return[2]}})})},$t=function(t){function n(e){e===void 0&&(e={});var r,i=this;return(i=t.call(this)||this).type=se.LOGOUT,i.name="logout",i._wasPreviouslyConnected=(r=e.wasPreviouslyConnected)===null||r===void 0||r,i}return g(n,t),n.prototype.run=function(e){return f(this,void 0,void 0,function(){var r,i,s=this;return h(this,function(o){switch(o.label){case 0:return r=Date.now(),i=e.sdkState.userId,[4,e.logout()];case 1:return o.sent(),[4,e.changeState(new Ss,r)];case 2:return o.sent(),this._wasPreviouslyConnected&&Q(function(){return f(s,void 0,void 0,function(){return h(this,function(a){return e.connectionHandlers.forEach(function(u){u.onDisconnected&&u.onDisconnected(i)}),[2]})})}),[2]}})})},n}(cn),si=function(t){function n(){var e=t.call(this)||this;return e.type=se.EXTERNAL_DISCONNECTED,e.name="externaldisconnected",e}return g(n,t),n.prototype.run=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return[4,e.disconnect()];case 1:return r.sent(),[2]}})})},n.prototype.onConnect=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=Date.now(),[4,e.disconnect()];case 1:return s.sent(),[4,e.changeState(new ui({authToken:r}),i)];case 2:return s.sent(),[2]}})})},n.prototype.onReconnect=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new ai,r)];case 1:return i.sent(),[2]}})})},n.prototype.onLogout=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new $t,r)];case 1:return i.sent(),[2]}})})},n}(cn),oi=function(t){function n(e){var r=e.autoReconnect,i=t.call(this)||this;return i.type=se.INTERNAL_DISCONNECTED,i.name="internaldisconnected",i._autoReconnect=!1,i._autoReconnect=r,i}return g(n,t),n.prototype.run=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.disconnect()];case 1:return i.sent(),this._autoReconnect?[4,e.changeState(new ai,r)]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}})})},n.prototype.onConnect=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=Date.now(),[4,e.disconnect()];case 1:return s.sent(),[4,e.changeState(new ui({authToken:r}),i)];case 2:return s.sent(),[2]}})})},n.prototype.onReconnect=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new ai,r)];case 1:return i.sent(),[2]}})})},n.prototype.onDisconnectWebSocket=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new si,r)];case 1:return i.sent(),[2]}})})},n.prototype.onLogout=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new $t,r)];case 1:return i.sent(),[2]}})})},n}(cn),ot=function(t){return f(void 0,void 0,void 0,function(){return h(this,function(n){return[2,new Promise(function(e){return setTimeout(e,t)})]})})},Qa=function(){function t(){}return t.prototype.calcTimeout=function(){return 0},t}(),Cs=function(t,n,e){return e===void 0&&(e=new Qa),f(void 0,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:r=0,i=null,s=function(l){return i=l??new Error("Halted")},o=function(){r=0},c.label=1;case 1:if(!(n===-1||r<n))return[3,9];c.label=2;case 2:return c.trys.push([2,4,,8]),[4,t(s,o)];case 3:if(a=c.sent(),i)throw i;return[2,a];case 4:if(u=c.sent(),i)return[3,6];if(++r===n)throw u;return[4,ot(e.calcTimeout(r))];case 5:return c.sent(),[3,7];case 6:throw i;case 7:return[3,8];case 8:return[3,1];case 9:throw"It should not happen."}})})},ai=function(t){function n(){var e=t!==null&&t.apply(this,arguments)||this;return e.type=se.RECONNECTING,e.name="reconnecting",e._callbacks=[],e}return g(n,t),n.prototype._halt=function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)},n.prototype._flushCallbacks=function(e){this._haltConnect=void 0,this._resetConnect=void 0,this._callbacks.forEach(function(r){return r(e)})},n.prototype.run=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c=this;return h(this,function(l){switch(l.label){case 0:r=Date.now(),i=new Ae,this._callbacks.push(function(d){return d?i.reject(d):i.resolve()}),Q(function(){return f(c,void 0,void 0,function(){return h(this,function(d){return e.connectionHandlers.forEach(function(p){p.onReconnectStarted&&p.onReconnectStarted()}),[2]})})}),l.label=1;case 1:return l.trys.push([1,4,,9]),s=e.sdkState.websocket,o=s.reconnectMaxRetry,a=s.reconnectRetryStrategy,[4,Cs(function(d,p){return f(c,void 0,void 0,function(){var _;return h(this,function(v){switch(v.label){case 0:this._haltConnect=d,this._resetConnect=p,v.label=1;case 1:return v.trys.push([1,3,,4]),[4,e.connect()];case 2:return v.sent(),[3,4];case 3:if(_=v.sent(),e.clearLoginTimer(),_ instanceof I){if(_.code===z.CONNECTION_CANCELED)return d(_),[2];if(_.isSessionExpiredError||_.isSessionInvalidatedError)return d(_),[2]}throw _;case 4:return[2]}})})},o,a)];case 2:return l.sent(),[4,e.changeState(new Wa,r)];case 3:return l.sent(),this._flushCallbacks(),Q(function(){return f(c,void 0,void 0,function(){return h(this,function(d){return e.connectionHandlers.forEach(function(p){p.onReconnectSucceeded&&p.onReconnectSucceeded()}),[2]})})}),[3,9];case 4:return u=l.sent(),rt(u)?[3,7]:u instanceof I?u.code===z.CONNECTION_CANCELED?[3,6]:[4,e.changeState(new oi({autoReconnect:!1}),r)]:[3,6];case 5:l.sent(),l.label=6;case 6:return this._flushCallbacks(u),Q(function(){return f(c,void 0,void 0,function(){return h(this,function(d){return e.connectionHandlers.forEach(function(p){p.onReconnectFailed&&p.onReconnectFailed()}),[2]})})}),[3,8];case 7:throw u;case 8:return[3,9];case 9:return[2,i.promise]}})})},n.prototype.onConnect=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){return i=new Ae,this._halt(I.connectionCanceled),e.cancelConnectForRetry(),this._callbacks.push(function(){var o=Date.now();e.changeState(new ui({authToken:r}),o).then(function(){i.resolve()}).catch(function(a){i.reject(a)})}),[2,i.promise]})})},n.prototype.onReconnect=function(e,r){var i=r.resetReconnectCount,s=i!==void 0&&i;return f(this,void 0,void 0,function(){var o;return h(this,function(a){return o=new Ae,this._resetConnect&&s&&this._resetConnect(),this._callbacks.push(function(u){return u?o.reject(u):o.resolve()}),[2,o.promise]})})},n.prototype.onDisconnect=function(e,r){r.error;var i=r.autoReconnect,s=i===void 0||i;return f(this,void 0,void 0,function(){var o;return h(this,function(a){switch(a.label){case 0:return o=Date.now(),this._halt(I.connectionCanceled),[4,e.changeState(new oi({autoReconnect:s}),o)];case 1:return a.sent(),[2]}})})},n.prototype.onDisconnectWebSocket=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),this._halt(I.connectionCanceled),[4,e.changeState(new si,r)];case 1:return i.sent(),[2]}})})},n.prototype.onLogout=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),this._halt(I.connectionCanceled),[4,e.changeState(new $t,r)];case 1:return i.sent(),[2]}})})},n}(cn),Wa=function(t){function n(){var e=t!==null&&t.apply(this,arguments)||this;return e.type=se.CONNECTED,e.name="connected",e}return g(n,t),n.prototype.onReconnect=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.disconnect()];case 1:return i.sent(),[4,e.changeState(new ai,r)];case 2:return i.sent(),[2]}})})},n.prototype.onDisconnect=function(e,r){var i=r.autoReconnect;return f(this,void 0,void 0,function(){var s;return h(this,function(o){switch(o.label){case 0:return s=Date.now(),[4,e.changeState(new oi({autoReconnect:i}),s)];case 1:return o.sent(),[2]}})})},n.prototype.onDisconnectWebSocket=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new si,r)];case 1:return i.sent(),[2]}})})},n.prototype.onLogout=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new $t,r)];case 1:return i.sent(),[2]}})})},n}(cn);(function(t){t.ExternalSetBackground="ExternalSetBackground",t.ExternalDisconnectWebSocket="ExternalDisconnectWebSocket"})(Un||(Un={}));var Ud=function(){function t(n,e){var r=e.sdkState,i=e.cacheContext,s=e.connectionHandlers,o=e.sessionManager,a=e.websocketClient,u=e.dispatcher,c=e.logger,l=e.disableWebSocketCloseEventHandling,d=l!==void 0&&l;this._disableWebSocketCloseEventHandling=!1,this._webSocketClosedCause=null,this._logger=c,this._disableWebSocketCloseEventHandling=d,this._context=new Pd(n,{sdkState:r,cacheContext:i,connectionHandlers:s,sessionManager:o,websocketClient:a,dispatcher:u,logger:c}),this._sdkState=r,this._sessionManager=o,this._websocketClient=a}return t.prototype._registerEventDispatcher=function(){var n=this;this._disableWebSocketCloseEventHandling||(this._clearEventDispatcher(),this._sessionEventDispatcherContext=this._sessionManager.on("refresh",function(){n.isConnecting||n.isConnected||(n._logger.debug("try reconnect by session key refresh"),Oe(function(){return f(n,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this.reconnect()];case 1:return e.sent(),[2]}})})}))}),this._websocketEventDispatcherContext=this._websocketClient.on("close",function(){n._sdkState.appState!=="foreground"||n._webSocketClosedCause||Oe(function(){return f(n,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this._sessionManager.isSessionKeyRefreshing?[3,2]:(this._logger.debug("try reconnect by websocket connection closed"),[4,this.reconnect()]);case 1:return e.sent(),[3,4];case 2:return[4,this.disconnectWebSocket()];case 3:e.sent(),e.label=4;case 4:return[2]}})})})}))},t.prototype._clearEventDispatcher=function(){this._sessionEventDispatcherContext&&(this._sessionEventDispatcherContext.close(),this._sessionEventDispatcherContext=void 0),this._websocketEventDispatcherContext&&(this._websocketEventDispatcherContext.close(),this._websocketEventDispatcherContext=void 0)},Object.defineProperty(t.prototype,"isConnected",{get:function(){return this._context.currentState.type===se.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isConnecting",{get:function(){var n=this._context.currentState;return n.type===se.CONNECTING||n.type===se.RECONNECTING},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"websocketClient",{get:function(){return this._websocketClient},enumerable:!1,configurable:!0}),t.prototype.connect=function(n){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return e=this._context.currentState,this._webSocketClosedCause=null,[4,e.onConnect(this._context,n)];case 1:return r.sent(),this._registerEventDispatcher(),[2]}})})},t.prototype.reconnect=function(){return f(this,void 0,void 0,function(){var n;return h(this,function(e){switch(e.label){case 0:return n=this._context.currentState,this._webSocketClosedCause=null,[4,n.onReconnect(this._context,{})];case 1:return e.sent(),[2]}})})},t.prototype.resetAndReconnect=function(){return f(this,void 0,void 0,function(){var n;return h(this,function(e){switch(e.label){case 0:return n=this._context.currentState,this._webSocketClosedCause=null,[4,n.onReconnect(this._context,{resetReconnectCount:!0})];case 1:return e.sent(),[2]}})})},t.prototype.background=function(){return f(this,void 0,void 0,function(){var n;return h(this,function(e){switch(e.label){case 0:return n=this._context.currentState,this._webSocketClosedCause=Un.ExternalSetBackground,[4,n.onDisconnect(this._context,{autoReconnect:!1,cause:this._webSocketClosedCause})];case 1:return e.sent(),[2]}})})},t.prototype.disconnect=function(n){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{error:n,autoReconnect:!0,cause:this._webSocketClosedCause})];case 1:return e.sent(),[2]}})})},t.prototype.disconnectWebSocket=function(n){return n===void 0&&(n=!1),f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return e=this._context.currentState,n&&(this._webSocketClosedCause=Un.ExternalDisconnectWebSocket),[4,e.onDisconnectWebSocket(this._context,{cause:this._webSocketClosedCause})];case 1:return r.sent(),[2]}})})},t.prototype.logout=function(){return f(this,void 0,void 0,function(){var n;return h(this,function(e){switch(e.label){case 0:return n=this._context.currentState,this._clearEventDispatcher(),[4,n.onLogout(this._context)];case 1:return e.sent(),[2]}})})},t}(),ui=function(t){function n(e){var r=e.authToken,i=t.call(this)||this;return i.type=se.CONNECTING,i.name="connecting",i._authToken="",i._callbacks=[],i._authToken=r,i}return g(n,t),n.prototype._halt=function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)},n.prototype._flushCallbacks=function(e){this._haltConnect=void 0,this._callbacks.forEach(function(r){return r(e)})},n.prototype.run=function(e){return f(this,void 0,void 0,function(){var r,i,s,o=this;return h(this,function(a){switch(a.label){case 0:r=Date.now(),i=new Ae,this._callbacks.push(function(u){return u?i.reject(u):i.resolve()}),a.label=1;case 1:return a.trys.push([1,4,,10]),[4,Cs(function(u){return f(o,void 0,void 0,function(){var c;return h(this,function(l){switch(l.label){case 0:this._haltConnect=u,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,e.connect(this._authToken)];case 2:return l.sent(),[3,4];case 3:if(c=l.sent(),e.clearLoginTimer(),c instanceof I&&c.code===z.CONNECTION_CANCELED)return u(c),[2];throw c;case 4:return[2]}})})},e.sdkState.websocket.connectMaxRetry)];case 2:return a.sent(),[4,e.changeState(new Wa,r)];case 3:return a.sent(),Q(function(){return f(o,void 0,void 0,function(){return h(this,function(u){return this._flushCallbacks(),e.connectionHandlers.forEach(function(c){c.onConnected&&c.onConnected(e.sdkState.userId)}),[2]})})}),[3,10];case 4:return s=a.sent(),rt(s)?[3,8]:[4,e.disconnect()];case 5:return a.sent(),s instanceof I?s.code===z.CONNECTION_CANCELED?[3,7]:[4,e.changeState(new Ss,r)]:[3,7];case 6:a.sent(),a.label=7;case 7:return Q(function(){return f(o,void 0,void 0,function(){return h(this,function(u){return this._flushCallbacks(s),[2]})})}),[3,9];case 8:throw s;case 9:return[3,10];case 10:return[2,i.promise]}})})},n.prototype.onConnect=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){return r=new Ae,this._callbacks.push(function(s){return s?r.reject(s):r.resolve()}),[2,r.promise]})})},n.prototype.onDisconnect=function(e,r){var i=r.error,s=i===void 0?null:i,o=r.autoReconnect,a=o!==void 0&&o,u=r.cause,c=u===void 0?null:u;return f(this,void 0,void 0,function(){var l;return h(this,function(d){switch(d.label){case 0:return l=Date.now(),this._halt(s??Ya(c)),e.hasSession?[4,e.changeState(new oi({autoReconnect:a}),l)]:[3,2];case 1:return d.sent(),[3,4];case 2:return[4,e.changeState(new $t,l)];case 3:d.sent(),d.label=4;case 4:return[2]}})})},n.prototype.onDisconnectWebSocket=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return this._halt(Ya((r==null?void 0:r.cause)||null)),i=Date.now(),e.hasSession?[4,e.changeState(new si,i)]:[3,2];case 1:return s.sent(),[3,4];case 2:return[4,e.changeState(new $t,i)];case 3:s.sent(),s.label=4;case 4:return[2]}})})},n.prototype.onLogout=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),this._halt(I.connectionCanceled),[4,e.changeState(new $t,r)];case 1:return i.sent(),[2]}})})},n}(cn);function Ya(t){var n=I.connectionCanceled;if(t){var e=null;switch(t){case Un.ExternalSetBackground:e="Connection has been canceled due to the application having externally moved to background while in ConnectingState.";break;case Un.ExternalDisconnectWebSocket:e="Connection has been canceled because sb.disconnectWebSocket() was called while in ConnectingState."}e&&n.setDetail(e)}return n}var jt,Ss=function(t){function n(){var e=t!==null&&t.apply(this,arguments)||this;return e.type=se.INITIALIZED,e.name="initialized",e}return g(n,t),n.prototype.onConnect=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=Date.now(),[4,e.changeState(new ui({authToken:r}),i)];case 1:return s.sent(),[2]}})})},n.prototype.onLogout=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new $t({wasPreviouslyConnected:!1}),r)];case 1:return i.sent(),[2]}})})},n}(cn),Md=function(t){function n(){return t.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})||this}return g(n,t),n}(He),Ld=function(){function t(n){var e=n.pingDelegate,r=n.sdkState,i=n.logger;this.pingDelegate=e,this.sdkState=r,this._logger=i}return Object.defineProperty(t.prototype,"isWaiting",{get:function(){return!!this._pingTimeoutTimer},enumerable:!1,configurable:!0}),t.prototype.ping=function(){var n,e=this;if(!this.sdkState.websocket)throw I.connectionRequired;var r=new Md;try{var i=(n=this.sdkState.websocket.pongTimeout)!==null&&n!==void 0?n:5e3;this._pingTimeoutTimer=setTimeout(function(){e._logger.debug("pinger.ping() timeout"),e.pingDelegate.error()},i),this.pingDelegate.send(r),this._logger.debug("pinger.ping()")}catch(s){this._logger.debug("pinger.ping() error",s),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0),this.pingDelegate.error()}return r},t.prototype.pong=function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)},t.prototype.refreshTimer=function(){var n,e=this;if(!this.sdkState.websocket)throw I.connectionRequired;this._logger.debug("pinger.refreshTimer()");var r=(n=this.sdkState.websocket.pingInterval)!==null&&n!==void 0?n:15e3;this.stop(),this._pingTimer=setInterval(function(){e.ping()},r)},t.prototype.start=function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()},t.prototype.stop=function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=void 0),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)},t}(),Za=["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash","multiple_file_send_max_size","notifications","message_template"],Pd=function(t){function n(e,r){var i,s=r.sdkState,o=r.cacheContext,a=r.connectionHandlers,u=r.sessionManager,c=r.websocketClient,l=r.dispatcher,d=r.logger,p=r.entryState,_=p===void 0?new Ss:p,v=this;return(v=t.call(this)||this)._stateUpdatedAt=0,v._connectingAt=0,v._connectionRequestQueue=[],v._iid=e,v.sdkState=s,v.cacheContext=o,v.connectionHandlers=a,v._sessionManager=u,v._websocketClient=c,v._dispatcher=l,v._logger=d,v._currentState=_,!((i=v.sdkState.websocket)===null||i===void 0)&&i.pingerDisabled||(v._pinger=new Ld({pingDelegate:{send:function(m){return v._websocketClient.send(m)},error:function(m){return v._websocketClient.error(m)}},sdkState:v.sdkState,logger:d})),v._websocketClient.on("open",function(){v._tryResolveConnectionRequest()}).on("message",function(m){m.code==="LOGI"&&(v.clearLoginTimer(),v._dispatcher.dispatch(m.as(ii)))}).on("ping-refresh",function(){var m;return(m=v._pinger)===null||m===void 0?void 0:m.refreshTimer()}).on("pong",function(){var m;return(m=v._pinger)===null||m===void 0?void 0:m.pong()}).on("error",function(){var m;return(m=v._pinger)===null||m===void 0?void 0:m.stop()}).on("close",function(){v._logiProcessingTimer=setTimeout(function(){v._logiProcessingTimer=void 0,v._unresolvedLogi||v._rejectConnectionRequest(I.networkError)},500)}),v._dispatcher.on(function(m){m instanceof ii&&(v._unresolvedLogi=m,v._tryResolveConnectionRequest())}),v}return g(n,t),Object.defineProperty(n.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasSession",{get:function(){return this._sessionManager.session.hasSession},enumerable:!1,configurable:!0}),n.prototype.changeState=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){switch(i.label){case 0:return r>=this._stateUpdatedAt?(this._currentState=e,this._stateUpdatedAt=r,this._dispatcher.dispatch(new un({stateType:e.type})),this._logger.debug("connection state changes to ".concat(e.name)),[4,this._currentState.run(this)]):[3,2];case 1:return i.sent(),[2,!0];case 2:return[2,!1]}})})},n.prototype._tryResolveConnectionRequest=function(){var e;return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return r=this._unresolvedLogi,this._websocketClient.isOpen&&r?(this._unresolvedLogi=void 0,r.error?[3,2]:[4,r.applyTo(this._iid)]):[3,3];case 1:return i.sent(),this._statLogConnection(),(e=this._pinger)===null||e===void 0||e.start(),this._connectionRequestQueue.forEach(function(s){return s.resolve()}),this._connectionRequestQueue=[],this.sdkState.appState="foreground",[3,3];case 2:this._sessionManager.session.authToken=void 0,(r.error.isSessionExpiredError||r.error.isSessionInvalidatedError)&&this._dispatcher.dispatch(new xt({reason:r.error.code})),this._rejectConnectionRequest(r.error),i.label=3;case 3:return[2]}})})},n.prototype._rejectConnectionRequest=function(e){var r;if((r=this._pinger)===null||r===void 0||r.stop(),this.clearLoginTimer(),this._connectionRequestQueue.length>0){var i=this._connectionRequestQueue;this._connectionRequestQueue=[],i.forEach(function(s){return s.reject(e)}),this._statLogConnection(e)}},n.prototype._url=function(){var e,r=this.sdkState,i=r.appId,s=r.appVersion,o=r.userId,a=r.extensions,u=r.sendbirdRuntimeEnvironment,c=this.cacheContext.localCacheEnabled,l=this._sessionManager.session,d=(e=this.sdkState.websocket)===null||e===void 0?void 0:e.compression,p=!!(a??{}).sb_uikit,_=jr.userAgentWithExtension(a);return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(Pt.OS_VERSION),"&sv=").concat(encodeURIComponent(Pt.SDK_VERSION),"&ai=").concat(i).concat(s?"&av=".concat(s):"").concat(l.hasSession?"":"&user_id=".concat(encodeURIComponent(o)),"&pmce=").concat(d?1:0,"&active=1&device_token_types=").concat(encodeURIComponent(["gcm","huawei","apns"].join(",")),"&SB-User-Agent=").concat(_,"&SB-SDK-User-Agent=").concat(encodeURIComponent(jr.sendbirdSdkUserAgentWithExtension(u)),"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(Za))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=").concat(c?1:0,"&include_poll_details=1").concat(p?"&uikit_config=1":"")},n.prototype._statLogConnection=function(e){var r;this._dispatcher.dispatch(new es(new An({type:Fe.WEBSOCKET_CONNECT,data:{host_url:(r=this.sdkState.websocket)===null||r===void 0?void 0:r.host,success:!e,latency:Date.now()-this._connectingAt,error_code:e==null?void 0:e.code,error_description:e==null?void 0:e.message}})))},n.prototype.connect=function(e){var r;return e===void 0&&(e=""),f(this,void 0,void 0,function(){var i,s,o,a=this;return h(this,function(u){return this._logiProcessingTimer&&(clearTimeout(this._logiProcessingTimer),this._logiProcessingTimer=void 0,this._rejectConnectionRequest(I.connectionCanceled)),i=this._url(),s=new Ae,this._connectionRequestQueue.push(s),this._connectionRequestQueue.length===1&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout(function(){a._loginTimer=void 0,a._rejectConnectionRequest(I.loginTimeout)},(r=this.sdkState.websocket)===null||r===void 0?void 0:r.responseTimeout),o=this._sessionManager.session,e&&(o.authToken=e),this._websocketClient.connect(i,JSON.stringify(o.hasSession?{auth:o.sessionKey}:{token:e}))),[2,s.promise]})})},n.prototype.cancelConnectForRetry=function(){this._dispatcher.dispatch(ii.asError(I.connectionRenew))},n.prototype.disconnect=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this._websocketClient.disconnect()];case 1:return e.sent(),[2]}})})},n.prototype.logout=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this.sdkState.userId=void 0,this._unresolvedLogi=void 0,[4,this.disconnect()];case 1:return e.sent(),[4,this._sessionManager.clear()];case 2:return e.sent(),[2]}})})},n.prototype.clearLoginTimer=function(){this._loginTimer&&(clearTimeout(this._loginTimer),this._loginTimer=void 0)},n}(Cn),Xa=function(t){function n(e){var r=e.appId,i=e.userId,s=e.services,o=e.includeUIKitConfig,a=o!==void 0&&o,u=e.localCacheEnabled,c=u===void 0||u,l=e.expiringSession,d=l===void 0||l,p=t.call(this)||this;return p.path="".concat(ee,"/").concat(i,"/login"),p.method=k.POST,p.params=x({expiring_session:!!d,services:s,include_logi:!0,include_extra_data:String(Za),uikit_config:a,use_local_cache:c,app_id:r}),p.requireAuth=!1,p}return g(n,t),n}(R),xd=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.logi=new ii(e,"LOGI",r),i}return g(n,t),n}(M);(function(t){t[t.ALL=0]="ALL",t[t.WEBSOCKET=1]="WEBSOCKET",t[t.API=2]="API"})(jt||(jt={}));var bt,Fd=[Hr,Xa],qd=function(){function t(n,e){var r=e.session,i=e.sdkState,s=e.dispatcher,o=e.logger,a=e.useFetchCompat,u=a!==void 0&&a,c=this;this._currentConnectionStateType=se.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new Td(n,{session:r,sdkState:i,dispatcher:s,logger:o,useFetchCompat:u}),this._session=r,this._logger=o,this._dispatcher=s,this._dispatcher.on(function(l){var d,p,_,v;if(l instanceof un){var m=l.stateType;switch(c._currentConnectionStateType=m,m){case se.CONNECTED:c._resolveLazyCallQueue();break;case se.INITIALIZED:case se.INTERNAL_DISCONNECTED:case se.EXTERNAL_DISCONNECTED:case se.LOGOUT:c._rejectLazyCallQueue(!((_=c._session)===null||_===void 0)&&_.hasSession?I.connectionClosed:I.connectionRequired)}}else if(l instanceof qa)!((v=c._session.services)===null||v===void 0)&&v.includes(Wn.CHAT)||c._resolveLazyCallQueue(jt.API);else if(l instanceof Is||l instanceof za)c._rejectLazyCallQueue(I.connectionClosed);else if(l instanceof ts){var y=l.request,E=l.deferred,w=l.error;try{for(var C=$(Fd),A=C.next();!A.done;A=C.next())if(y instanceof A.value)return void E.reject(w)}catch(P){d={error:P}}finally{try{A&&!A.done&&(p=C.return)&&p.call(C)}finally{if(d)throw d.error}}c._lazyCallQueue.push({command:y,deferred:E})}})}return Object.defineProperty(t.prototype,"isReady",{get:function(){return this._currentConnectionStateType===se.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLazyCallActivated",{get:function(){return this._currentConnectionStateType===se.CONNECTING||this._currentConnectionStateType===se.RECONNECTING||this._session.isRefreshing},enumerable:!1,configurable:!0}),t.prototype._classifyLazyCallQueueByScope=function(n){var e,r=[],i=[];switch(n){case jt.ALL:e=null;break;case jt.WEBSOCKET:e=He;break;case jt.API:e=R}var s=!1;return this._lazyCallQueue.forEach(function(o){!e||o.command instanceof e||(s=!0),s?i.push(o):r.push(o)}),[r,i]},t.prototype._resolveLazyCallQueue=function(n){var e=this;n===void 0&&(n=jt.ALL);var r=G(this._classifyLazyCallQueueByScope(n),2),i=r[0],s=r[1];this._lazyCallQueue=s,i.forEach(function(o){return f(e,void 0,void 0,function(){var a,u,c,l,d;return h(this,function(p){switch(p.label){case 0:a=o.command,u=o.deferred,(c=o.timeout)&&clearTimeout(c),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.send(a)];case 2:return l=p.sent(),u.resolve(l),[3,4];case 3:return d=p.sent(),u.reject(d),[3,4];case 4:return[2]}})})})},t.prototype._rejectLazyCallQueue=function(n,e){var r=this;e===void 0&&(e=jt.ALL);var i=G(this._classifyLazyCallQueueByScope(e),2),s=i[0],o=i[1];this._lazyCallQueue=o,s.forEach(function(a){return f(r,void 0,void 0,function(){var u,c;return h(this,function(l){return u=a.deferred,c=a.timeout,clearTimeout(c),u.reject(n),[2]})})})},t.prototype.send=function(n){return f(this,void 0,void 0,function(){var e,r,i=this;return h(this,function(s){switch(s.label){case 0:return n instanceof He?this.isReady?(this._logger.debug("send websocket request",n),[4,this.commandRouter.send(n)]):[3,2]:[3,4];case 1:case 5:return[2,s.sent()];case 2:if(this.isLazyCallActivated)return this._logger.debug("wait websocket request",n),e=new Ae,this._lazyCallQueue.push({command:n,deferred:e,timeout:setTimeout(function(){return i.timeout(n.requestId)},1e4)}),[2,e.promise];throw this._logger.debug("fail websocket request"),I.connectionRequired;case 3:case 7:return[3,9];case 4:return n instanceof R?this._session.hasSession?(this._logger.debug("send api request",n),[4,this.commandRouter.send(n)]):[3,6]:[3,8];case 6:if(this.isLazyCallActivated)return this._logger.debug("wait api request",n),e=new Ae,this._lazyCallQueue.push({command:n,deferred:e,timeout:setTimeout(function(){return i.timeout(n.requestId)},1e4)}),[2,e.promise];throw r=I.connectionRequired,this._logger.debug("fail api request",r),r;case 8:throw I.invalidCommand;case 9:return[2]}})})},t.prototype.forceSend=function(n){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this._logger.debug("send forced request",n),n instanceof He||n instanceof R?[4,this.commandRouter.send(n)]:[3,2];case 1:return[2,e.sent()];case 2:throw I.invalidCommand}})})},t.prototype.timeout=function(n){this._logger.debug("timeout request",n);var e=this._lazyCallQueue.findIndex(function(r){return r.command.requestId===n});e>-1&&(this._lazyCallQueue[e].deferred.reject(I.connectionRequired),this._lazyCallQueue.splice(e,1))},t.prototype.cancel=function(n){this._logger.debug("cancel api request",n),this.commandRouter.cancel(n)},t.prototype.cancelAll=function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()},t}(),As="sendbird@devicetokens",Ns=function(){function t(n){var e=n.type,r=n.token;this.type=e,this.token=r}return t.payloadify=function(n){return x(H({type:n.type,token:n.token}))},t}(),Os=new WeakMap,zd=function(t){function n(e){var r=e._iid,i=e.session,s=e.cacheContext,o=e.sdkState,a=e.dispatcher,u=e.requestQueue,c=e.logger,l=t.call(this)||this;return l._currentConnectionStateType=se.INITIALIZED,l._isRefreshingAuthToken=!1,l.currentUser=null,l.session=i,l._iid=r,l._cacheContext=s,l._sdkState=o,l._dispatcher=a,l._requestQueue=u,l._logger=c,l._deviceTokens=[],l._dispatcher.on(function(d){var p,_;if(d instanceof un){var v=d.stateType;l._currentConnectionStateType=v}else d instanceof xt&&l.handler&&!l.isSessionKeyRefreshing&&(d.invalidateSessionToken&&(l.session.authToken=void 0),!((p=d.error)===null||p===void 0)&&p.isSessionInvalidatedError?l.handler.onSessionClosed&&l.handler.onSessionClosed():!((_=d.error)===null||_===void 0)&&_.isSessionExpiredError&&(l._logger.debug("session expired"),l.handler.onSessionExpired&&l.handler.onSessionExpired(),l.refresh().catch(function(m){if(rt(m)&&l._sdkState.appState==="foreground")throw m})))}),l}return g(n,t),Object.defineProperty(n.prototype,"ekey",{get:function(){return Os.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"deviceTokens",{get:function(){return this._deviceTokens},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"deviceTokenLastDeletedAt",{get:function(){return this._deviceTokenLastDeletedAt},enumerable:!1,configurable:!0}),n.prototype.indexOfDeviceToken=function(e,r){return this._deviceTokens.findIndex(function(i){return i.type===e&&i.token===r})},n.prototype.hasDeviceToken=function(e,r){return this.indexOfDeviceToken(e,r)>=0},n.prototype.createRefreshWebsocketCommand=function(e,r){return new gl({authToken:e,expiringSession:!0,requestId:r})},n.prototype._refreshSessionKeyByWebSocket=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return r=this.createRefreshWebsocketCommand(e),[4,this._requestQueue.forceSend(r)];case 1:if(i=u.sent(),s=i.as(bl),o=s.newKey,a=s.error)throw a;return this.session.sessionKey=o??this.session.sessionKey,[2]}})})},n.prototype._refreshSessionKeyByApi=function(e){return f(this,void 0,void 0,function(){var r,i=this;return h(this,function(s){switch(s.label){case 0:return r=new Hr({userId:this._sdkState.userId,authToken:e,services:this.session.services&&this.session.services.length>0?this.session.services:void 0,expiringSession:!0}),[4,Cs(function(o){return f(i,void 0,void 0,function(){var a,u,c,l,d;return h(this,function(p){switch(p.label){case 0:return p.trys.push([0,2,,3]),[4,this._requestQueue.forceSend(r)];case 1:return a=p.sent(),u=a.as(yl),c=u.key,l=u.services,this.session.sessionKey=c,this.session.services=l,[3,3];case 2:if(d=p.sent(),!this._isSessionRelatedError(d))throw d;return o(d),[3,3];case 3:return[2]}})})},3)];case 1:return s.sent(),[2]}})})},n.prototype._refreshSessionKey=function(e,r){return r===void 0&&(r=!0),f(this,void 0,void 0,function(){var i,s;return h(this,function(o){switch(o.label){case 0:if(this._currentConnectionStateType!==se.CONNECTED)return[3,8];o.label=1;case 1:return o.trys.push([1,3,,8]),[4,this._refreshSessionKeyByWebSocket(e)];case 2:return o.sent(),this.complete(),[2];case 3:i=o.sent(),o.label=4;case 4:return o.trys.push([4,6,,7]),[4,this._handleSessionRefreshError(i,r)];case 5:return o.sent(),[2];case 6:return o.sent(),[3,7];case 7:return[3,8];case 8:return o.trys.push([8,10,,12]),[4,this._refreshSessionKeyByApi(e)];case 9:return o.sent(),this.complete(),[3,12];case 10:return s=o.sent(),[4,this._handleSessionRefreshError(s,r)];case 11:return o.sent(),[3,12];case 12:return[2]}})})},n.prototype._receiveNewAuthToken=function(){var e,r=this,i=new Ae;if(this._isRefreshingAuthToken=!0,this.session.sessionKey=void 0,this.session.authToken=void 0,(e=this.handler)===null||e===void 0?void 0:e.onSessionTokenRequired){var s=null,o=function(){s&&(clearTimeout(s),s=null)},a=function(c){o(),r._isRefreshingAuthToken&&(r._isRefreshingAuthToken=!1,i.resolve(c))},u=function(c){o(),r._isRefreshingAuthToken&&(r._isRefreshingAuthToken=!1,i.reject(c))};s=setTimeout(function(){return u()},1e3*this._sdkState.sessionTokenRefreshTimeout),Q(function(){return f(r,void 0,void 0,function(){var c;return h(this,function(l){return!((c=this.handler)===null||c===void 0)&&c.onSessionTokenRequired&&this.handler.onSessionTokenRequired(a,u),[2]})})})}else i.resolve(null);return i.promise},n.prototype._handleSessionRefreshError=function(e,r){return r===void 0&&(r=!1),f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return e instanceof I&&(e.isSessionTokenExpiredError||e.code===z.APPLICATION_NOT_FOUND)?(this.session.authToken=void 0,r?[4,this._receiveNewAuthToken()]:[3,6]):[3,6];case 1:return(i=s.sent())?(this.session.authToken=i,[4,this._refreshSessionKey(this.session.authToken,!1)]):[3,3];case 2:return s.sent(),this.complete(),[3,5];case 3:return[4,this.clear()];case 4:s.sent(),s.label=5;case 5:return[2];case 6:throw e}})})},n.prototype._isSessionRelatedError=function(e){return e instanceof I&&(e.isSessionExpiredError||e.isSessionInvalidatedError)},Object.defineProperty(n.prototype,"isSessionKeyRefreshing",{get:function(){return this.session.isRefreshing},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isRefreshingAuthToken",{get:function(){return this._isRefreshingAuthToken},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionExpiring",{get:function(){return!!this.handler},enumerable:!1,configurable:!0}),n.prototype.authenticateFeed=function(e,r){var i;return f(this,void 0,void 0,function(){var s,o,a;return h(this,function(u){switch(u.label){case 0:return this.session.authToken=r,s=new Xa({appId:this._sdkState.appId,userId:e,services:[Wn.FEED],includeUIKitConfig:!!((i=this._sdkState.extensions)!==null&&i!==void 0?i:{}).sb_uikit,localCacheEnabled:this._cacheContext.localCacheEnabled,expiringSession:!r||this.isSessionExpiring}),[4,this._requestQueue.commandRouter.send(s)];case 1:return o=u.sent(),(a=o.as(xd).logi).error?[3,3]:[4,a.applyTo(this._iid)];case 2:return u.sent(),[3,4];case 3:throw a.error;case 4:return[2]}})})},n.prototype.login=function(e){var r;return f(this,void 0,void 0,function(){var i,s,o,a,u,c,l,d;return h(this,function(p){switch(p.label){case 0:return i=e.key,s=e.ekey,o=e.services,a=e.userProfile,u=e.deviceTokenLastDeletedAt,c=u===void 0?0:u,this.session.sessionKey=i,this.session.services=o,Os.set(this,s),this._deviceTokenCacheEnabled=(r=a==null?void 0:a.appInfo)===null||r===void 0?void 0:r.deviceTokenCache,l=this._cacheContext.preference,this._deviceTokenCacheEnabled?[4,l.get(As)]:[3,5];case 1:return!(d=p.sent())||d.lastDeletedAt<c?(this._deviceTokens=[],this._deviceTokenLastDeletedAt=c,[4,this.saveDeviceToken()]):[3,3];case 2:return p.sent(),[3,4];case 3:this._deviceTokens=d.tokens.map(function(_){return new Ns(Ns.payloadify(_))}),this._deviceTokenLastDeletedAt=d.lastDeletedAt,p.label=4;case 4:return[3,7];case 5:return[4,l.remove(As)];case 6:p.sent(),p.label=7;case 7:return[2]}})})},n.prototype.complete=function(){var e=this;this.dispatch("refresh"),this._dispatcher.dispatch(new qa),Q(function(){return f(e,void 0,void 0,function(){var r;return h(this,function(i){return this._logger.debug("session refreshed"),!((r=this.handler)===null||r===void 0)&&r.onSessionRefreshed&&this.handler.onSessionRefreshed(),[2]})})})},n.prototype.error=function(e){var r=this;Q(function(){return f(r,void 0,void 0,function(){var i;return h(this,function(s){return!((i=this.handler)===null||i===void 0)&&i.onSessionError&&this.handler.onSessionError(e),[2]})})})},n.prototype.close=function(){var e=this;this.dispatch("close"),this._dispatcher.dispatch(new za),Q(function(){return f(e,void 0,void 0,function(){var r;return h(this,function(i){return this._logger.debug("session closed"),!((r=this.handler)===null||r===void 0)&&r.onSessionClosed&&this.handler.onSessionClosed(),[2]})})})},n.prototype.refresh=function(){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:if(!this.isSessionExpiring)return[3,10];if(this.session.isRefreshing)return[3,10];if(this.session.isRefreshing=!0,this.session.authToken)return[3,7];i.label=1;case 1:return i.trys.push([1,6,,7]),[4,this._receiveNewAuthToken()];case 2:return(e=i.sent())?(this._logger.debug("session refreshing.."),this.session.authToken=e,[3,5]):[3,3];case 3:return[4,this.clear()];case 4:return i.sent(),this.session.isRefreshing=!1,[2];case 5:return[3,7];case 6:throw i.sent(),r=I.sessionTokenRequestFailed,this._dispatcher.dispatch(new Is),this.error(r),this.session.isRefreshing=!1,this._logger.debug("refresh auth token error = ",r),r;case 7:return i.trys.push([7,9,,10]),[4,this._refreshSessionKey(this.session.authToken)];case 8:return i.sent(),this.session.isRefreshing=!1,[3,10];case 9:throw i.sent(),this.session.isRefreshing=!1,r=I.sessionTokenRefreshFailed,this._dispatcher.dispatch(new Is),this.error(r),r;case 10:return[2]}})})},n.prototype.setDeviceToken=function(e,r){return this._deviceTokenCacheEnabled&&this.indexOfDeviceToken(e,r)<0?(this._deviceTokens.push(new Ns({type:e,token:r})),!0):!1},n.prototype.unsetDeviceToken=function(e,r){if(this._deviceTokenCacheEnabled){var i=this.indexOfDeviceToken(e,r);i>=0&&this._deviceTokens.splice(i,1)}},n.prototype.unsetDeviceTokens=function(e){this._deviceTokenCacheEnabled&&(this._deviceTokens=e?this._deviceTokens.filter(function(r){return r.type!==e}):[])},n.prototype.setDeviceTokenDeletedAt=function(e){e>0&&(this._deviceTokenLastDeletedAt=e)},n.prototype.saveDeviceToken=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this._deviceTokenCacheEnabled?[4,this._cacheContext.preference.set(As,{tokens:this._deviceTokens,lastDeletedAt:this._deviceTokenLastDeletedAt})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},n.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this.currentUser=null,this.session.clear(),this.close(),Os.delete(this),this._deviceTokens=[],this._deviceTokenLastDeletedAt=0,[4,this.saveDeviceToken()];case 1:return e.sent(),[2]}})})},n}(Cn),ci=function(t){function n(e){var r,i,s,o,a=e.type,u=e.data,c=e.ts,l=c===void 0?Date.now():c,d=t.call(this,{type:a,data:u,ts:l})||this;return d.date=new Date(l),d.key="".concat((r=d.date,i=r.getFullYear(),s=String(r.getMonth()+1).padStart(2,"0"),o=String(r.getDate()).padStart(2,"0"),"".concat(i).concat(s).concat(o)),"_").concat(a),d}return g(n,t),n}(An),Hd=function(t){function n(e){var r=e.deviceId,i=e.statLogs,s=t.call(this)||this;return s.method=k.POST,s.path="".concat(vl),s.params={device_id:r,log_entries:i.map(function(o){return An.payloadify(o)})},s}return g(n,t),n}(R),Ja=function(t,n){var e,r;if(t!==null&&n!==null){var i=Object.keys(t),s=Object.keys(n),o=Z([],G(new Set(Z(Z([],G(i),!1),G(s),!1))),!1),a={};try{for(var u=$(o),c=u.next();!c.done;c=u.next()){var l=c.value,d=typeof t[l],p=typeof n[l];d==="undefined"?a[l]=n[l]:p==="undefined"?a[l]=t[l]:d!==p?a[l]=n[l]:d==="object"&&t[l]&&n[l]?a[l]=Ja(t[l],n[l]):a[l]=n[l]}}catch(_){e={error:_}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}return a}return n};(function(t){t[t.PENDING=0]="PENDING",t[t.COLLECT_ONLY=1]="COLLECT_ONLY",t[t.ENABLED=2]="ENABLED",t[t.DISABLED=3]="DISABLED"})(bt||(bt={}));var Ot,$d=function(t){function n(e){var r=e.cacheContext,i=e.requestQueue,s=e.dispatcher,o=e.baseLimit,a=o===void 0?100:o,u=e.maxLimit,c=u===void 0?1e3:u,l=e.minLimit,d=l===void 0?10:l,p=t.call(this)||this;return p.queue=[],p.flushWaitQueue=[],p.enabledState=bt.PENDING,p.isFlushing=!1,p.generation=1,p.lastFlushedAt=Date.now(),p._collectRequestStat=!0,p._collectFeatureLocalCacheStat=!0,p._collectionNotificationStat=!0,p.deviceId=Xt(),p.cacheContext=r,p.requestQueue=i,p.dispatcher=s,p.baseLimit=a,p.limit=a,p.maxLimit=c,p.minLimit=d,p}return g(n,t),Object.defineProperty(n.prototype,"isEnabled",{get:function(){return this.enabledState===bt.ENABLED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isReadyToFlush",{get:function(){return this.queue.length>=this.limit||Date.now()-this.lastFlushedAt>=108e5&&this.queue.length>=this.minLimit},enumerable:!1,configurable:!0}),n.prototype._arrangeStat=function(){var e=Z([],G(this.queue),!1);this._collectRequestStat||(e=e.filter(function(r){return r.type!==Fe.API_RESULT&&r.type!==Fe.WEBSOCKET_CONNECT})),this._collectFeatureLocalCacheStat||(e=e.filter(function(r){return r.type!==Fe.FEATURE_LOCALCACHE&&r.type!==Fe.FEATURE_LOCALCACHE_EVENT})),this._collectionNotificationStat||(e=e.filter(function(r){return r.type!==Fe.NOTIFICATION})),this.queue=e},n.prototype._save=function(){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return this.isEnabled?(e=Z(Z([],G(this.queue),!1),G(this.flushWaitQueue),!1),[4,this.cacheContext.preference.set(this.key,{deviceId:this.deviceId,statLogs:e.map(function(i){return An.payloadify(i)}),generation:this.generation++,lastFlushedAt:this.lastFlushedAt})]):[3,2];case 1:r.sent(),this.dispatch("save",e),r.label=2;case 2:return[2]}})})},n.prototype._flush=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o;return h(this,function(a){switch(a.label){case 0:if(!this.isEnabled)return[3,10];if(this.isFlushing)return[3,10];this.isFlushing=!0,a.label=1;case 1:return a.trys.push([1,5,9,10]),this._arrangeStat(),e=this.queue.filter(function(u){if(u instanceof ci){var c=new Date,l=G([u.date.getFullYear(),c.getFullYear()],2),d=l[0],p=l[1];if(d<p)return!0;if(d===p){var _=G([u.date.getMonth(),c.getMonth()],2),v=_[0],m=_[1];if(v<m)return!0;if(v===m){var y=G([u.date.getDate(),c.getDate()],2);return y[0]<y[1]}}}return!1}),r=this.queue.filter(function(u){return!(u instanceof ci)}),(i=Z(Z([],G(e),!1),G(r),!1).slice(0,Math.min(this.limit,this.maxLimit))).length>0?(s=new Hd({deviceId:this.deviceId,statLogs:i}),[4,this.requestQueue.send(s)]):[3,4];case 2:return a.sent(),this.dispatch("flush",i),this.queue=Z(Z([],G(e),!1),G(r),!1).slice(i.length).concat(this.flushWaitQueue),this.flushWaitQueue=[],this.limit=this.baseLimit,this.lastFlushedAt=Date.now(),[4,this._save()];case 3:a.sent(),a.label=4;case 4:return[3,10];case 5:return(o=a.sent())instanceof I?o.code!==z.NON_AUTHORIZED?[3,7]:[4,this.clear()]:[3,8];case 6:return a.sent(),this.enabledState=bt.DISABLED,[3,8];case 7:o.code===z.STAT_UPLOAD_NOT_ALLOWED&&(this.enabledState=bt.COLLECT_ONLY),a.label=8;case 8:return this.limit=this.limit+20,[3,10];case 9:return this.isFlushing=!1,[7];case 10:return[2]}})})},n.prototype.init=function(e){return f(this,void 0,void 0,function(){var r,i,s=this;return h(this,function(o){switch(o.label){case 0:return this.key=e,[4,this.cacheContext.preference.get(this.key)];case 1:return(r=o.sent())?(this.deviceId=r.deviceId,this.queue=r.statLogs.map(function(a){var u;return a.stat_type===Fe.FEATURE_LOCALCACHE_EVENT&&(a.data=b({message_init_policy:"",starting_point:0},a.data)),a.stat_type===Fe.NOTIFICATION&&(a.data=x(b(b({},a.data),{message_id:(u=a.data.notificationId)!==null&&u!==void 0?u:a.data.message_id,notificationId:void 0}))),new An({type:a.stat_type,ts:a.ts,data:a.data})}),this.generation=r.generation,this.lastFlushedAt=r.lastFlushedAt,this.isReadyToFlush?(i=Math.min(Math.floor(18e4*Math.random()),100),[4,ot(i)]):[3,4]):[3,4];case 2:return o.sent(),[4,this._flush()];case 3:o.sent(),o.label=4;case 4:return this.commandEventContext||(this.commandEventContext=this.dispatcher.on(function(a){if(a instanceof es){var u=a.statLog;s.put(u)}else if(a instanceof Ka){var c=a.request,l=a.features,d=a.options;s._collectRequestStat=c,s._collectFeatureLocalCacheStat=l==null?void 0:l.localCache,s._collectionNotificationStat=l==null?void 0:l.notification,s._arrangeStat(),s._collectRequestStat||s._collectFeatureLocalCacheStat||s._collectionNotificationStat?s.enabledState=d.ingestion?bt.ENABLED:bt.COLLECT_ONLY:s.enabledState=bt.DISABLED,s.isEnabled?s.isReadyToFlush&&s._flush():s.clear()}})),[2]}})})},n.prototype.put=function(e){return f(this,void 0,void 0,function(){var r,i,s;return h(this,function(o){switch(o.label){case 0:if(this.enabledState===bt.DISABLED)return[3,3];if(r=this.isFlushing?this.flushWaitQueue:this.queue,e instanceof ci)this._collectFeatureLocalCacheStat&&(i=G(this.queue.filter(function(a){return a instanceof ci&&a.key===e.key}),1),(s=i[0])?s.data=Ja(s.data,e.data):r.push(e));else switch(e.type){case Fe.API_RESULT:case Fe.WEBSOCKET_CONNECT:this._collectRequestStat&&r.push(e);break;case Fe.FEATURE_LOCALCACHE:case Fe.FEATURE_LOCALCACHE_EVENT:this._collectFeatureLocalCacheStat&&r.push(e);break;case Fe.NOTIFICATION:this._collectionNotificationStat&&r.push(e)}return[4,this._save()];case 1:return o.sent(),this.isReadyToFlush?[4,this._flush()]:[3,3];case 2:o.sent(),o.label=3;case 3:return[2]}})})},n.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this.queue=[],this.flushWaitQueue=[],this.generation=1,[4,this._save()];case 1:return e.sent(),[2]}})})},n.prototype.close=function(){this.commandEventContext&&(this.commandEventContext.close(),this.commandEventContext=void 0)},n}(Cn);(function(t){t[t.VERBOSE=0]="VERBOSE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.NONE=5]="NONE"})(Ot||(Ot={}));var ne,jd=function(){function t(){this.level=Ot.WARN}return t.prototype.verbose=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];this.level<=Ot.VERBOSE&&console.log.apply(console,Z(["[verbose]"],G(n),!1))},t.prototype.debug=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];this.level<=Ot.DEBUG&&console.log.apply(console,Z(["[debug]"],G(n),!1))},t.prototype.info=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];this.level<=Ot.INFO&&console.log.apply(console,Z(["[info]"],G(n),!1))},t.prototype.warn=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];this.level<=Ot.WARN&&console.warn.apply(console,Z(["[warn]"],G(n),!1))},t.prototype.error=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];this.level<=Ot.ERROR&&console.error.apply(console,Z(["[error]"],G(n),!1))},t}(),ln={},S=function(){function t(n,e){var r,i,s,o,a,u,c,l,d,p;if(this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!ln[n]){ln[n]=this;var _=(r=e.options)!==null&&r!==void 0?r:new xo,v=this.sdkState={appId:e.appId,appVersion:(i=e.appVersion)!==null&&i!==void 0?i:"",appState:"foreground",userId:void 0,extensions:{},api:{host:(s=e.apiHost)!==null&&s!==void 0?s:"https://api-".concat(e.appId,".sendbird.com")},websocket:{host:(o=e.websocketHost)!==null&&o!==void 0?o:"wss://ws-".concat(e.appId,".sendbird.com"),pingerDisabled:!!e.noPingpong,pingInterval:void 0,pongTimeout:void 0,connectMaxRetry:2,compression:!0,reconnectMaxRetry:-1,reconnectRetryStrategy:new Qa,responseTimeout:_.websocketResponseTimeout},sessionTokenRefreshTimeout:_.sessionTokenRefreshTimeout};this.appInfo=void 0,this.subscribedUnreadMessageCount={all:0,feed:0,customTypes:{},ts:0};var m=this.logger=new jd;this.logger.level=(a=e.logLevel)!==null&&a!==void 0?a:Ot.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map;var y=this.cacheContext=new ul({encryption:e.encryption,store:e.store,localCacheEnabled:(u=e.localCacheEnabled)!==null&&u!==void 0&&u,localCacheConfig:(c=e.localCacheConfig)!==null&&c!==void 0?c:new zo});this.debugMode=(l=e.debugMode)!==null&&l!==void 0&&l,this.maxSuperGroupChannelUnreadCount=Pt.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=_.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=_.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=_.typingIndicatorThrottle,this.concurrentCallLimit=void 0,this.backOffDelay=void 0;var E=this.dispatcher=new ll,w=new cl;this.requestQueue=new qd(n,{session:w,sdkState:v,dispatcher:E,logger:m,useFetchCompat:e.useFetchCompat}),this.sessionManager=new zd({_iid:n,session:w,cacheContext:y,sdkState:v,dispatcher:E,requestQueue:this.requestQueue,logger:m}),this.connectionManager=new Ud(n,{sdkState:v,cacheContext:this.cacheContext,connectionHandlers:this.connectionHandlers,dispatcher:E,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,disableWebSocketCloseEventHandling:(d=e.disableWebSocketCloseEventHandling)!==null&&d!==void 0&&d,logger:m}),this.statLogCollector=new $d({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:E}),this.appStateToggleEnabled=(p=e.appStateToggleEnabled)===null||p===void 0||p}return ln[n]}return t.of=function(n){if(ln[n])return ln[n];throw I.lostInstance},t.clear=function(n){ln[n]&&delete ln[n]},t.prototype.hasExtension=function(n){return this.sdkState.extensions&&this.sdkState.extensions[n]},t}(),ks=function(){function t(){}return t.prototype.init=function(n,e){var r=e.sdkState,i=e.dispatcher,s=e.sessionManager,o=e.requestQueue,a=e.logger;e.onlineDetector;var u=e.cacheContext;this._iid=n,this._cacheContext=u,this._sdkState=r,this._dispatcher=i,this._sessionManager=s,this._requestQueue=o,this._logger=a},t}();(function(t){t.UNKNOWN="UNKNOWN",t.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",t.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",t.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",t.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",t.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",t.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",t.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",t.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",t.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",t.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",t.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",t.EVENT_CHANNEL_BANNED="EVENT_CHANNEL_BANNED",t.EVENT_CHANNEL_UNBANNED="EVENT_CHANNEL_UNBANNED",t.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",t.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",t.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",t.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",t.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",t.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",t.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",t.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",t.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",t.EVENT_CHANNEL_METADATA_CREATED="EVENT_CHANNEL_METADATA_CREATED",t.EVENT_CHANNEL_METADATA_UPDATED="EVENT_CHANNEL_METADATA_UPDATED",t.EVENT_CHANNEL_METADATA_DELETED="EVENT_CHANNEL_METADATA_DELETED",t.EVENT_CHANNEL_METACOUNTER_CREATED="EVENT_CHANNEL_METACOUNTER_CREATED",t.EVENT_CHANNEL_METACOUNTER_UPDATED="EVENT_CHANNEL_METACOUNTER_UPDATED",t.EVENT_CHANNEL_METACOUNTER_DELETED="EVENT_CHANNEL_METACOUNTER_DELETED",t.EVENT_THREAD_INFO_UPDATED="EVENT_THREAD_INFO_UPDATED",t.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",t.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",t.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",t.EVENT_PINNED_MESSAGE_UPDATED="EVENT_PINNED_MESSAGE_UPDATED",t.REQUEST_CHANNEL="REQUEST_CHANNEL",t.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",t.REFRESH_CHANNEL="REFRESH_CHANNEL",t.CHANNEL_LASTACCESSEDAT_UPDATED="CHANNEL_LASTACCESSEDAT_UPDATED",t.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",t.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS",t.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",t.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",t.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",t.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",t.EVENT_MESSAGE_FEEDBACK_ADDED="EVENT_MESSAGE_FEEDBACK_ADDED",t.EVENT_MESSAGE_FEEDBACK_UPDATED="EVENT_MESSAGE_FEEDBACK_UPDATED",t.EVENT_MESSAGE_FEEDBACK_DELETED="EVENT_MESSAGE_FEEDBACK_DELETED",t.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",t.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",t.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",t.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",t.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",t.REQUEST_MESSAGE="REQUEST_MESSAGE",t.EVENT_POLL_UPDATED="EVENT_POLL_UPDATED",t.EVENT_POLL_VOTED="EVENT_POLL_VOTED",t.SYNC_POLL_CHANGELOGS="SYNC_POLL_CHANGELOGS",t.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",t.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",t.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",t.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",t.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",t.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",t.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",t.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",t.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",t.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED"})(ne||(ne={}));var Mn;b({},ne);var _e=function(t){function n(e){var r=e.messages,i=e.source,s=e.isWebSocketEventComing,o=s!==void 0&&s,a=t.call(this)||this;return a.messages=r,a.source=i,a.isWebSocketEventComing=o,a}return g(n,t),n}(le),eu=function(t){function n(e){var r=e.messageIds,i=e.source,s=e.isWebSocketEventComing,o=s!==void 0&&s,a=t.call(this)||this;return a.messageIds=r,a.source=i,a.isWebSocketEventComing=o,a}return g(n,t),n}(le),Bd=function(t){function n(e){var r=e.event,i=e.source,s=e.isWebSocketEventComing,o=s!==void 0&&s,a=t.call(this)||this;return a.event=r,a.source=i,a.isWebSocketEventComing=o,a}return g(n,t),n}(le),Gd=function(t){function n(e){var r=e.event,i=e.source,s=e.isWebSocketEventComing,o=s!==void 0&&s,a=t.call(this)||this;return a.event=r,a.source=i,a.isWebSocketEventComing=o,a}return g(n,t),n}(le),Vd=function(t){function n(e){var r=e.reqId,i=e.source,s=t.call(this)||this;return s.reqId=r,s.source=i,s}return g(n,t),n}(le),tu=function(t){function n(e){var r=e.polls,i=e.source,s=t.call(this)||this;return s.polls=r,s.source=i,s}return g(n,t),n}(le),nu=function(t){function n(e){var r=e.event,i=e.source,s=t.call(this)||this;return s.event=r,s.source=i,s}return g(n,t),n}(le),Rs=function(t){function n(e){var r=e.event,i=e.source,s=t.call(this)||this;return s.event=r,s.source=i,s}return g(n,t),n}(le);(function(t){t.OPEN="open",t.CLOSED="closed"})(Mn||(Mn={}));var Kd="removed",Ds=function(t){switch(t){case"open":return Mn.OPEN;case"closed":return Mn.CLOSED;default:return null}},ru=function(t){return!t||!!t.text&&T("string",t.text)},li=function(t){function n(e,r){var i,s,o,a,u,c,l,d=this;return(d=t.call(this,e)||this).pollId=0,d.id=0,d.text=null,d.voteCount=0,d.createdBy=null,d.createdAt=0,d.updatedAt=0,d._lastVotedAt=0,d.pollId=(i=r.poll_id)!==null&&i!==void 0?i:0,d.id=(s=r.id)!==null&&s!==void 0?s:0,d.text=(o=r.text)!==null&&o!==void 0?o:null,d.voteCount=(a=r.vote_count)!==null&&a!==void 0?a:0,d.createdBy=(u=r.created_by)!==null&&u!==void 0?u:null,d.createdAt=(c=r.created_at)!==null&&c!==void 0?c:0,d.updatedAt=(l=r.updated_at)!==null&&l!==void 0?l:0,d}return g(n,t),n.payloadify=function(e){return x(H(b(b({},t.payloadify.call(this,e)),{vote_count:e.voteCount,poll_id:e.pollId,text:e.text,created_at:e.createdAt,id:e.id,created_by:e.createdBy,updated_at:e.updatedAt})))},n}(qe),at=function(t){function n(e,r){var i,s,o,a,u,c,l,d,p,_,v,m,y,E=this;return(E=t.call(this,e)||this).id=0,E.title=null,E.createdAt=0,E.updatedAt=0,E.closeAt=-1,E.status=Mn.CLOSED,E.messageId=0,E.data=null,E.voterCount=-1,E.options=[],E.createdBy=null,E.allowUserSuggestion=!1,E.allowMultipleVotes=!1,E.votedPollOptionIds=[],E.id=(i=r.id)!==null&&i!==void 0?i:0,E.title=(s=r.title)!==null&&s!==void 0?s:null,E.createdAt=(o=r.created_at)!==null&&o!==void 0?o:0,E.updatedAt=(a=r.updated_at)!==null&&a!==void 0?a:0,E.closeAt=(u=r.close_at)!==null&&u!==void 0?u:-1,E.status=(c=Ds(r.status))!==null&&c!==void 0?c:Mn.CLOSED,E.messageId=(l=r.message_id)!==null&&l!==void 0?l:0,E.data=(d=r.data)!==null&&d!==void 0?d:null,E.voterCount=(p=r.voter_count)!==null&&p!==void 0?p:-1,E.options=r.options?r.options.map(function(w){return new li(E._iid,w)}):[],E.createdBy=(_=r.created_by)!==null&&_!==void 0?_:null,E.allowUserSuggestion=(v=r.allow_user_suggestion)!==null&&v!==void 0&&v,E.allowMultipleVotes=(m=r.allow_multiple_votes)!==null&&m!==void 0&&m,E.votedPollOptionIds=(y=r.voted_option_ids)!==null&&y!==void 0?y:[],E}return g(n,t),n.prototype._applyPollUpdatePayload=function(e){var r,i,s,o,a,u,c,l,d=this;this.title=(r=e.title)!==null&&r!==void 0?r:this.title,this.updatedAt=(i=e.updated_at)!==null&&i!==void 0?i:this.updatedAt,this.closeAt=(s=e.close_at)!==null&&s!==void 0?s:this.closeAt,this.status=(o=Ds(e.status))!==null&&o!==void 0?o:this.status,this.data=(a=e.data)!==null&&a!==void 0?a:this.data,this.voterCount=(u=e.voter_count)!==null&&u!==void 0?u:this.voterCount,e.options&&(this.options=e.options.map(function(p){return new li(d._iid,p)}),this.votedPollOptionIds=e.options.filter(function(p){return p.vote_count>0}).map(function(p){return p.id})),this.allowUserSuggestion=(c=e.allow_user_suggestion)!==null&&c!==void 0?c:this.allowUserSuggestion,this.allowMultipleVotes=(l=e.allow_multiple_votes)!==null&&l!==void 0?l:this.allowMultipleVotes},n.payloadify=function(e){return x(H(b(b({},t.payloadify.call(this,e)),{id:e.id,title:e.title,created_at:e.createdAt,updated_at:e.updatedAt,close_at:e.closeAt,status:e.status,message_id:e.messageId,data:e.data,voter_count:e.voterCount,options:e.options.map(function(r){return li.payloadify(r)}),created_by:e.createdBy,allow_user_suggestion:e.allowUserSuggestion,allow_multiple_votes:e.allowMultipleVotes,voted_option_ids:e.votedPollOptionIds})))},n.prototype.applyPollUpdateEvent=function(e){var r=e._payload.poll;return!(!r||this.id!==r.id||r.updated_at<this.updatedAt)&&(this._applyPollUpdatePayload(r),!0)},n.prototype.applyPollVoteEvent=function(e){if(this.id!==e.pollId)return!1;var r=this.options,i=r.map(function(a){return a.id}),s=e._payload,o=Math.floor(s.ts/1e3);return s.updated_vote_counts.forEach(function(a){var u=i.indexOf(a.option_id);if(u>-1){var c=r[u];o>=c._lastVotedAt&&(c.voteCount=a.vote_count,c._lastVotedAt=o)}}),s.req_id&&s.voted_option_ids&&(this.votedPollOptionIds=s.voted_option_ids),typeof s.voter_count=="number"&&(this.voterCount=s.voter_count),!0},n.prototype.serialize=function(){return ri(this)},n}(qe),Ln=function(){function t(n,e){var r;this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=n,this.limit=(r=e.limit)!==null&&r!==void 0?r:20}return Object.defineProperty(t.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),t.prototype._validate=function(){return T("number",this.limit)&&this.limit>0},t}(),dn=function(t){function n(e,r,i,s){var o=t.call(this,e,s)||this;return o.channelUrl=r,o.channelType=i,o}return g(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&T("string",this.channelUrl)&&ue(W,this.channelType)},n}(Ln),Qd=function(t){this.pollId=0,this.messageId=0,this.pollId=t.poll_id,this.messageId=t.message_id,this._payload=t},Wd=function(t){function n(e){var r=e.title,i=e.optionTexts,s=e.data,o=e.allowUserSuggestion,a=e.allowMultipleVotes,u=e.closeAt,c=t.call(this)||this;return c.method=k.POST,c.path=dt,c.params={title:r,options:i,data:s,allow_user_suggestion:o,allow_multiple_votes:a,close_at:u},c}return g(n,t),n}(R),Yd=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.poll=new at(e,r),i}return g(n,t),n}(M),Zd=function(t){function n(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,o=t.call(this)||this;return o.method=k.GET,o.path="".concat(dt,"/").concat(encodeURIComponent(s)),o.params={channel_url:r,channel_type:i},o}return g(n,t),n}(R),Xd=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.poll=new at(e,r),i}return g(n,t),n}(M),Jd=function(t){function n(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,o=e.pollOptionId,a=t.call(this)||this;return a.method=k.GET,a.path="".concat(dt,"/").concat(encodeURIComponent(s),"/options/").concat(encodeURIComponent(o)),a.params={channel_url:r,channel_type:i},a}return g(n,t),n}(R),eh=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.pollOption=new li(e,r),i}return g(n,t),n}(M),th=function(t){function n(e){var r=e.channelType,i=e.channelUrl,s=e.timestamp,o=e.token,a=t.call(this)||this;return a.method=k.GET,a.path="".concat(J(r),"/").concat(encodeURIComponent(i),"/polls/changelogs"),a.params=x({change_ts:s,token:o}),a}return g(n,t),n}(R),nh=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.updatedPolls=r.updated.map(function(s){return function(o,a){return new at(o,a)}(e,s)}),i.deletedPollIds=r.deleted.map(function(s){return s}),i.hasMore=r.has_more,i.nextToken=r.next,i}return g(n,t),n}(M),rh={title:"",optionTexts:[],data:void 0,allowUserSuggestion:void 0,allowMultipleVotes:void 0,closeAt:-1},iu=function(t){return T("string",t.title)&&(n=t.optionTexts,X("string",n)&&n.every(function(e){return e.trim()!==""}))&&ru(t.data)&&T("boolean",t.allowUserSuggestion,!0)&&T("boolean",t.allowMultipleVotes,!0)&&T("number",t.closeAt,!0);var n},ih={channelUrl:"",channelType:W.BASE,pollId:0,pollOptionId:0},su=function(t){return T("string",t.channelUrl)&&t.channelUrl!==""&&ue(W,t.channelType)&&T("number",t.pollId)&&t.pollId>0&&T("number",t.pollOptionId)&&t.pollOptionId>0},sh={channelUrl:"",channelType:W.BASE,pollId:0},ou=function(t){return T("string",t.channelUrl)&&t.channelUrl!==""&&ue(W,t.channelType)&&T("number",t.pollId)},au={},Us=function(){function t(n,e){var r=e.sdkState,i=e.dispatcher,s=e.sessionManager,o=e.requestQueue,a=e.logger;this._iid=n,this._sdkState=r,this._sessionManager=s,this._requestQueue=o,this._dispatcher=i,this._logger=a,au[n]=this}return t.of=function(n){return au[n]},t.prototype.buildPollFromSerializedData=function(n){var e=_r(n);return new at(this._iid,at.payloadify(e))},t.prototype.get=function(n){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return D(ou(n)).throw(I.invalidParameters),e=new Zd(b({},n)),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(Xd).poll]}})})},t.prototype.create=function(n){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return D(iu(n)).throw(I.invalidParameters),e=new Wd(b({},n)),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(Yd).poll]}})})},t.prototype.getOption=function(n){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return D(su(n)).throw(I.invalidParameters),e=new Jd(b({},n)),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(eh).pollOption]}})})},t.prototype.getPollChangeLogs=function(n,e,r,i){return i===void 0&&(i=ne.SYNC_POLL_CHANGELOGS),f(this,void 0,void 0,function(){var s,o,a,u,c,l,d;return h(this,function(p){switch(p.label){case 0:return s=new th(H({channelType:e,channelUrl:n,timestamp:typeof r=="number"?r:null,token:typeof r=="string"?r:null})),[4,this._requestQueue.send(s)];case 1:return o=p.sent(),a=o.as(nh),u=a.updatedPolls,c=a.deletedPollIds,l=a.hasMore,d=a.nextToken,u.length>0&&this._dispatcher.dispatch(new tu({polls:u,source:i})),[2,{updatedPolls:u,deletedPollIds:c,hasMore:l,token:d}]}})})},t}(),oh=function(t){function n(e){var r=e.channelUrl,i=e.channelType,s=e.token,o=e.limit,a=t.call(this)||this;return a.method=k.GET,a.path=dt,a.params={channel_url:r,channel_type:i,token:s,limit:o},a}return g(n,t),n}(R),ah=function(t){function n(e,r){var i,s=this;return(s=t.call(this,e,r)||this).polls=((i=r.polls)!==null&&i!==void 0?i:[]).map(function(o){return new at(e,o)}),s.token=r.next,s}return g(n,t),n}(M),uu=function(t){function n(e,r){return t.call(this,e,r.channelUrl,r.channelType,r)||this}return g(n,t),n.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid).requestQueue,r=new oh(b(b({},this),{token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(ah),o=s.polls,a=s.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,o];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},n}(dn),uh=function(t){function n(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,o=e.pollOptionId,a=e.token,u=e.limit,c=t.call(this)||this;return c.method=k.GET,c.path="".concat(dt,"/").concat(encodeURIComponent(s),"/options/").concat(encodeURIComponent(o),"/voters"),c.params={channel_url:r,channel_type:i,token:a,limit:u},c}return g(n,t),n}(R),ch=function(t){function n(e,r){var i,s=this;return(s=t.call(this,e,r)||this).voters=((i=r.voters)!==null&&i!==void 0?i:[]).map(function(o){return new V(e,o)}),s.token=r.next,s}return g(n,t),n}(M),cu=function(t){function n(e,r){var i=t.call(this,e,r.channelUrl,r.channelType,r)||this;return i.pollId=r.pollId,i.pollOptionId=r.pollOptionId,i}return g(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&T("number",this.pollId)&&T("number",this.pollOptionId)},n.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid).requestQueue,r=new uh(b(b({},this),{pollId:this.pollId,pollOptionId:this.pollOptionId,token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(ch),o=s.voters,a=s.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,o];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},n}(dn),vr,Bt=function(){function t(n,e,r){var i,s;this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this._requireAuth=!1,this._iid=n,this.plainUrl=e.url,this.width=e.width,this.height=e.height,this.realWidth=(i=e.real_width)!==null&&i!==void 0?i:e.width,this.realHeight=(s=e.real_height)!==null&&s!==void 0?s:e.height,this._requireAuth=r}return t.payloadify=function(n){return x(H(n instanceof t?{url:n.plainUrl,width:n.width,height:n.height,real_width:n.realWidth,real_height:n.realHeight}:{url:"",width:n.maxWidth,height:n.maxHeight,real_width:0,real_height:0}))},Object.defineProperty(t.prototype,"url",{get:function(){var n=S.of(this._iid).sessionManager;return this._requireAuth&&n.ekey?"".concat(this.plainUrl,"?auth=").concat(n.ekey):this.plainUrl},enumerable:!1,configurable:!0}),t}(),Ms=function(t){function n(e){var r=t.call(this)||this;if(r.method=k.POST,r.path="".concat(dl),r.params=x({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(var i=0;i<e.thumbnailSizes.length;i++){var s=e.thumbnailSizes[i],o=s.maxWidth,a=s.maxHeight;r.params["thumbnail".concat(i+1)]="".concat(o,",").concat(a)}return r.requestId=e.requestId,r}return g(n,t),n}(R),Ls=function(t){function n(e,r){var i,s,o,a,u=this;return(u=t.call(this,e,r)||this).url=r.url,u.fileSize=(i=r.file_size)!==null&&i!==void 0?i:0,u.thumbnails=(o=(s=r.thumbnails)===null||s===void 0?void 0:s.map(function(c){return new Bt(e,c,!1)}))!==null&&o!==void 0?o:[],u.requireAuth=(a=r.require_auth)!==null&&a!==void 0&&a,u}return g(n,t),n}(M),Ps=function(t){function n(e,r){var i,s,o,a,u,c=this;return(c=t.call(this,e)||this).replyCount=0,c.unreadReplyCount=0,c.memberCount=0,c.lastRepliedAt=0,c.updatedAt=0,c.replyCount=(i=r.reply_count)!==null&&i!==void 0?i:0,c.unreadReplyCount=(s=r.unread_message_count)!==null&&s!==void 0?s:0,c.memberCount=(o=r.member_count)!==null&&o!==void 0?o:0,c.mostRepliedUsers=r.most_replies&&X("object",r.most_replies)?r.most_replies.map(function(l){return new V(c._iid,l)}):[],c.isPushNotificationEnabled=typeof r.push_enabled=="number"?r.push_enabled>0:void 0,c.lastRepliedAt=(a=r.last_replied_at)!==null&&a!==void 0?a:0,c.updatedAt=(u=r.updated_at)!==null&&u!==void 0?u:0,c}return g(n,t),n.payloadify=function(e){return x(H(b(b({},t.payloadify.call(this,e)),{reply_count:e.replyCount,unread_message_count:e.unreadReplyCount,member_count:e.memberCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map(function(r){return V.payloadify(r)}):[],push_enabled:typeof e.isPushNotificationEnabled=="boolean"?e.isPushNotificationEnabled?1:0:void 0,last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})))},n}(qe);(function(t){t.ADD="add",t.DELETE="delete"})(vr||(vr={}));var lu,xs=function(t){this.messageId=0,this.operation=null,this.updatedAt=0;var n=T("string",t.msg_id)?parseInt(t.msg_id):t.msg_id,e=t.user_id,r=t.operation?t.operation.toLowerCase():null,i=t.reaction,s=t.updated_at;n&&T("string",e)&&T("string",r)&&ue(vr,r)&&T("string",i)&&i&&T("number",s)&&(this.messageId=n,this.userId=e,this.key=i,this.operation=r,this.updatedAt=s)},di=function(){function t(n){var e,r,i,s=n.key,o=(i=Z([],G(n.user_ids),!1))!==null&&i!==void 0?i:[],a=n.updated_at;T("string",s)&&s&&X("string",o)&&o.length>0&&T("number",a)&&(this.key=s,this.userIds=o,this.updatedAt=a);var u={};try{for(var c=$(this.userIds),l=c.next();!l.done;l=c.next())u[l.value]=this.updatedAt}catch(d){e={error:d}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(e)throw e.error}}this._version=u}return Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this.userIds.length===0},enumerable:!1,configurable:!0}),t.payloadify=function(n){return x(H({key:n.key,user_ids:n.userIds,updated_at:n.updatedAt}))},t.prototype.applyEvent=function(n){if(n.key===this.key&&this.updatedAt<=n.updatedAt){if(!this._version[n.userId]||this._version[n.userId]<=n.updatedAt){var e=this.userIds.indexOf(n.userId);switch(n.operation){case vr.ADD:e<0&&this.userIds.push(n.userId);break;case vr.DELETE:e>=0&&this.userIds.splice(e,1)}this._version[n.userId]=n.updatedAt}this.updatedAt=Math.max(this.updatedAt,n.updatedAt)}},t}(),du=function(){function t(n){this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=n.url,n.secure_url&&(this.secureUrl=n.secure_url),n.type&&(this.type=n.type),n.width&&(this.width=n.width),n.height&&(this.height=n.height),n.alt&&(this.alt=n.alt)}return t.payloadify=function(n){var e,r;return x(H({url:n.url,secure_url:n.secureUrl,type:n.type,width:(e=n.width)!==null&&e!==void 0?e:0,height:(r=n.height)!==null&&r!==void 0?r:0,alt:n.alt}))},t}(),hu=function(){function t(n){this.title=null,this.url=null,this.description=null,this.defaultImage=null,n["og:title"]&&(this.title=n["og:title"]),n["og:url"]&&(this.url=n["og:url"]),n["og:description"]&&(this.description=n["og:description"]),n["og:image"]&&(this.defaultImage=new du(n["og:image"]))}return t.payloadify=function(n){return x(H({"og:title":n.title,"og:url":n.url,"og:description":n.description,"og:image":n.defaultImage?du.payloadify(n.defaultImage):null}))},t}(),Et=function(){function t(n){var e,r;this.volume=0,this.name=(e=n.name)!==null&&e!==void 0?e:"default",this.volume=(r=n.volume)!==null&&r!==void 0?r:1}return t.prototype.serialize=function(){return{name:this.name,volume:this.volume}},t.payloadify=function(n){return x(H({name:n.name,volume:n.volume}))},t}();(function(t){t.GOOD="good",t.BAD="bad"})(lu||(lu={}));var fu,Pn=function(){function t(n){this.id=n.id,this.rating=n.rating,this.comment=n.comment}return t.parseFeedbackStatusFromPayload=function(n){return n&&n.id!==null&&n.rating!==null?"SUBMITTED":"NOT_APPLICABLE"},t.payloadify=function(n){return x(H({id:n.id,rating:n.rating,comment:n.comment}))},t}(),xn=function(t){function n(e,r){var i,s=this;return(s=t.call(this,e,r)||this).isBlockedByMe=!1,s.role=ue(qr,r.role)?r.role:qr.NONE,s.isBlockedByMe=(i=r.is_blocked_by_me)!==null&&i!==void 0&&i,s}return g(n,t),n.payloadify=function(e){return x(H(b(b({},t.payloadify.call(this,e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})))},n}(V),et=function(){function t(n){this.key=n.key,this.value=X("string",n.value)?Z([],G(n.value),!1):[]}return t.payloadify=function(n){var e;return x(H({key:n.key,value:(e=n.value)!==null&&e!==void 0?e:[]}))},t}(),pu=function(t){switch(t){case he.BASE:return"";case he.USER:return"MESG";case he.FILE:return"FILE";case he.ADMIN:return"ADMM"}},_u=function(t){function n(e,r){var i,s,o,a,u,c,l,d,p,_,v=this;(v=t.call(this,e)||this).channelType=W.BASE,v.messageType=he.BASE,v.mentionType=null,v.mentionedUsers=null,v.mentionedUserIds=null,v.metaArrays=[],v.extendedMessage={},v.createdAt=0,v.updatedAt=0,v.channelUrl=r.channel_url,v.channelType=ue(W,r.channel_type)?r.channel_type:W.GROUP,r.channel&&(r.channel.channel_url&&(v.channelUrl=r.channel.channel_url),r.channel.channel_type&&(v.channelType=r.channel.channel_type)),v.data=(i=r.data)!==null&&i!==void 0?i:"",v.customType=(s=r.custom_type)!==null&&s!==void 0?s:"",v.mentionType=ue(xe,r.mention_type)?r.mention_type:null,v.mentionedUsers=r.mentioned_users?r.mentioned_users.map(function(C){return new V(v._iid,C)}):null,v.mentionedUserIds=(o=r.mentioned_user_ids)!==null&&o!==void 0?o:null,v.mentionedUsers&&!v.mentionedUserIds&&(v.mentionedUserIds=v.mentionedUsers.map(function(C){return C.userId})),v.mentionedMessageTemplate=(a=r.mentioned_message_template)!==null&&a!==void 0?a:"";var m=(u=r.metaarray)!==null&&u!==void 0?u:{},y=(c=r.metaarray_key_order)!==null&&c!==void 0?c:Object.keys(m).sort(function(C,A){return C.localeCompare(A)});v.metaArrays=[];for(var E=0;E<y.length;E++){var w=y[E];v.metaArrays.push(new et({key:w,value:m[w]||[]}))}return r.sorted_metaarray&&(v.metaArrays=r.sorted_metaarray.map(function(C){return new et(C)})),v.extendedMessage=(l=r.extended_message)!==null&&l!==void 0?l:{},v.extendedMessagePayload=r.extended_message_payload,v.createdAt=(p=(d=r.created_at)!==null&&d!==void 0?d:r.ts)!==null&&p!==void 0?p:0,v.updatedAt=(_=r.updated_at)!==null&&_!==void 0?_:0,v}return g(n,t),n.payloadify=function(e){var r,i;return x(H(b(b({},t.payloadify.call(this,e)),{channel_url:e.channelUrl,channel_type:e.channelType,type:pu(e.messageType),data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:(r=e.mentionedUsers)===null||r===void 0?void 0:r.map(function(s){return V.payloadify(s)}),mentioned_message_template:e.mentionedMessageTemplate,sorted_metaarray:(i=e.metaArrays)===null||i===void 0?void 0:i.map(function(s){return et.payloadify(s)}),extended_message:e.extendedMessage,extended_message_payload:e.extendedMessagePayload,created_at:e.createdAt,updated_at:e.updatedAt})))},n.prototype.isIdentical=function(e){return!0},n.prototype.isEqual=function(e){return Po(this,e)},n.prototype.isUserMessage=function(){return this.messageType===he.USER},n.prototype.isFileMessage=function(){return this.messageType===he.FILE&&!Object.prototype.hasOwnProperty.call(this,"fileInfoList")},n.prototype.isMultipleFilesMessage=function(){return this.messageType===he.FILE&&Object.prototype.hasOwnProperty.call(this,"fileInfoList")},n.prototype.isAdminMessage=function(){return this.messageType===he.ADMIN},n.prototype.hasForm=function(){var e,r;return!!(!((r=(e=this.extendedMessagePayload)===null||e===void 0?void 0:e.forms)===null||r===void 0)&&r[0])},n.prototype.serialize=function(){return ri(this)},n.prototype.getMetaArraysByKeys=function(e){return this.metaArrays.filter(function(r){return e.includes(r.key)})},n}(qe);(function(t){t.Text="text",t.Phone="phone",t.Email="email",t.Password="password"})(fu||(fu={}));var hi=function(){function t(n,e,r){this.messageId=n,this.key=e,this.fields=r,this.formKey=e}return Object.defineProperty(t.prototype,"isSubmitted",{get:function(){return this.answers!==void 0&&Object.keys(this.answers).length>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSubmittable",{get:function(){return this.fields.every(function(n){return n.isSubmittable})},enumerable:!1,configurable:!0}),t.prototype.getFieldAnswer=function(n){var e;return(e=this.answers)===null||e===void 0?void 0:e[n]},t.payloadify=function(n){var e;return x(H({key:(e=n.formKey)!==null&&e!==void 0?e:n.key,fields:n.fields.map(function(r){return vu.payloadify(r)})}))},t.isFormPayload=function(n){var e;return!!(!((e=n==null?void 0:n.forms)===null||e===void 0)&&e[0])},t}(),vu=function(){function t(n){this.key=n.key,this.inputType=n.input_type,this.title=n.title,this.required=n.required,this.regex=n.regex,this.placeholder=n.placeholder,this.fieldKey=n.key}return t.prototype.isValid=function(n){if(!this.regex)return!0;try{return new RegExp(this.regex).test(n)}catch{return!0}},Object.defineProperty(t.prototype,"isSubmittable",{get:function(){return!(this.temporaryAnswer!=null&&!this.isValid(this.temporaryAnswer)||this.required&&this.temporaryAnswer==null)},enumerable:!1,configurable:!0}),t.payloadify=function(n){var e;return x(H({key:(e=n.fieldKey)!==null&&e!==void 0?e:n.key,input_type:n.inputType,title:n.title,required:n.required,regex:n.regex,placeholder:n.placeholder}))},t}(),lh=function(t){function n(e,r){var i,s,o=this;return(o=t.call(this,e)||this).channelUrl=(i=r.channel_url)!==null&&i!==void 0?i:"",o.channelType=(s=r.channel_type)!==null&&s!==void 0?s:W.GROUP,o.reader=new V(o._iid,r.user),o.readAt=r.ts,o}return g(n,t),n}(qe);(function(t){function n(e){var r=e.channelUrl;return t.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:r}})||this}return g(n,t),n})(He),function(t){function n(e){var r=t.call(this)||this,i=e.channelUrl,s=e.channelType,o=e.userId,a=e.notificationIds;return r.method=k.PUT,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/messages/mark_as_read"),r.params=x(H({user_id:o,message_ids:a})),r}return g(n,t),n}(R),function(t){function n(e,r,i){var s=t.call(this,e,"READ",i)||this;return s.readStatus=new lh(e,i),s}return g(n,t),n}(de),function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.readAt=r.ts,i.unreadMessageCount=r.unread_message_count,i}return g(n,t),n}(M);var dh=function(t){function n(e){var r=e.channelUrl,i=e.messageId;return t.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:r,parent_message_id:i}})||this}return g(n,t),n}(He),hh=function(t){function n(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.pushEnabled,a=t.call(this)||this;return a.method=k.PUT,a.path="".concat(J(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/thread_push"),a.params={push_enabled:o},a}return g(n,t),n}(R);(function(t){function n(e,r){return t.call(this,e,r)||this}g(n,t)})(M);var mu=function(t){function n(e){var r=t.call(this)||this;return r.method=k.POST,r.path="".concat(Zi,"/").concat(encodeURIComponent(e.channelUrl),"/messages/").concat(e.messageId,"/submit_forms"),r.params=x({forms:e.forms}),r}return g(n,t),n}(R),fh=function(t){function n(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.rating,a=e.comment,u=t.call(this)||this;return u.method=k.POST,u.path="".concat(J(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/feedbacks"),u.params={rating:o,comment:a},u}return g(n,t),n}(R),ph=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.feedback=new Pn(r),i}return g(n,t),n}(M),_h=function(t){function n(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.feedbackId,a=e.rating,u=e.comment,c=t.call(this)||this;return c.method=k.PUT,c.path="".concat(J(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/feedbacks/").concat(o),c.params={rating:a,comment:u},c}return g(n,t),n}(R),vh=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.feedback=new Pn(r),i}return g(n,t),n}(M),mh=function(t){function n(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.feedbackId,a=t.call(this)||this;return a.method=k.DELETE,a.path="".concat(J(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/feedbacks/").concat(o),a}return g(n,t),n}(R);(function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.feedback=new Pn(r),i}g(n,t)})(M);var gu,Gt,Fs=function(t){function n(e,r){var i,s,o,a,u,c=this;return(c=t.call(this,e)||this).plainUrl="",c.fileName=null,c.mimeType=null,c.fileSize=0,c.thumbnails=[],c._requireAuth=!1,c.plainUrl=(i=r.url)!==null&&i!==void 0?i:"",c.fileName=(s=r.file_name)!==null&&s!==void 0?s:null,c.mimeType=(o=r.file_type)!==null&&o!==void 0?o:null,c.fileSize=(a=r.file_size)!==null&&a!==void 0?a:0,c._requireAuth=(u=r.require_auth)!==null&&u!==void 0&&u,c.thumbnails=r.thumbnails?r.thumbnails.map(function(l){var d;return new Bt(c._iid,typeof l=="string"?{url:l,width:0,height:0}:b(b({},l),{url:((d=l.url)!==null&&d!==void 0?d:"").split("auth=")[0]}),c._requireAuth)}):[],c}return g(n,t),n.payloadify=function(e){var r;return x(H({url:e.plainUrl,file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:(r=e.thumbnails)===null||r===void 0?void 0:r.map(function(i){var s;return{url:((s=i.plainUrl)!==null&&s!==void 0?s:"").split("auth=")[0],width:i.width,height:i.height,real_width:i.realWidth,real_height:i.realHeight}}),require_auth:e._requireAuth}))},Object.defineProperty(n.prototype,"url",{get:function(){var e=S.of(this._iid).sessionManager;return this._requireAuth&&e.ekey?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),n}(qe),gh=function(t){var n=t.channelUrl,e=t.channelType,r=t.parentMessage;this.channelUrl=n,this.channelType=e,this.parentMessage=r};(function(t){t.PENDING="pending",t.SENT="sent",t.FAILED="failed",t.CANCELED="canceled"})(gu||(gu={})),function(t){t.PENDING="pending",t.IN_QUEUE="in_queue",t.SENT="sent",t.FAILED="failed",t.CANCELED="canceled",t.REMOVED="removed"}(Gt||(Gt={}));var hn,tt=function(t){function n(e,r){var i,s,o,a,u,c,l,d,p,_,v=this;return(v=t.call(this,e,r)||this).parentMessage=null,v.silent=!1,v.isOperatorMessage=!1,v.threadInfo=null,v.reactions=[],v.appleCriticalAlertOptions=null,v.scheduledInfo=null,v.suggestedReplies=null,v.myFeedback=null,v.myFeedbackStatus="NOT_APPLICABLE",v.forms=null,v._isContinuousMessages=!1,v._scheduledStatus=null,v.messageId=(s=(i=r.msg_id)!==null&&i!==void 0?i:r.message_id)!==null&&s!==void 0?s:0,v.parentMessageId=(o=typeof r.parent_message_id=="string"?parseInt(r.parent_message_id):r.parent_message_id)!==null&&o!==void 0?o:0,v.threadInfo=r.thread_info?new Ps(v._iid,r.thread_info):null,v.reactions=r.reactions?r.reactions.map(function(m){return new di(m)}):[],v.ogMetaData=r.og_tag?new hu(r.og_tag):null,v.silent=(a=r.silent)!==null&&a!==void 0&&a,v.isOperatorMessage=(u=r.is_op_msg)!==null&&u!==void 0&&u,v.appleCriticalAlertOptions=r.apple_critical_alert_options?new Et(r.apple_critical_alert_options):null,typeof r.scheduled_message_id=="number"&&typeof r.scheduled_at=="number"&&r.scheduled_status&&(v.scheduledInfo={scheduledMessageId:r.scheduled_message_id,scheduledAt:r.scheduled_at},v._scheduledStatus=r.scheduled_status),v._isContinuousMessages=(c=r.is_continuous_messages)!==null&&c!==void 0&&c,v.myFeedback=!((l=r.feedback)===null||l===void 0)&&l.id?new Pn(r.feedback):null,v.myFeedbackStatus=(d=r.my_feedback_status)!==null&&d!==void 0?d:Pn.parseFeedbackStatusFromPayload(r.feedback),v.suggestedReplies=(_=(p=r.extended_message_payload)===null||p===void 0?void 0:p.suggested_replies)!==null&&_!==void 0?_:null,v.forms=hi.isFormPayload(r.extended_message_payload)?r.extended_message_payload.forms.map(function(m){return new hi(v.messageId,m.key,m.fields.map(function(y){return new vu(y)}))}):null,v}return g(n,t),n.payloadify=function(e){var r,i;return x(H(b(b({},t.payloadify.call(this,e)),{message_id:e.messageId,parent_message_id:e.parentMessageId,thread_info:e.threadInfo?Ps.payloadify(e.threadInfo):null,reactions:e.reactions.map(function(s){return di.payloadify(s)}),og_tag:e.ogMetaData?hu.payloadify(e.ogMetaData):null,silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:e.appleCriticalAlertOptions?Et.payloadify(e.appleCriticalAlertOptions):null,scheduled_message_id:(r=e.scheduledInfo)===null||r===void 0?void 0:r.scheduledMessageId,scheduled_at:(i=e.scheduledInfo)===null||i===void 0?void 0:i.scheduledAt,scheduled_status:e._scheduledStatus,feedback:e.myFeedback?Pn.payloadify(e.myFeedback):null,my_feedback_status:e.myFeedbackStatus,forms:e.forms?e.forms.map(function(s){return hi.payloadify(s)}):null})))},n._getParentMessageInfoPayload=function(e){return x(H({type:pu(e.messageType),ts:e.createdAt,user:e.sender?xn.payloadify(e.sender):null,message:e.message,file:{url:e.plainUrl,name:e.name,type:e.type,require_auth:e.requireAuth},files:Array.isArray(e.fileInfoList)?e.fileInfoList.map(function(r){return Fs.payloadify(r)}):null}))},n.prototype.isIdentical=function(e){return this.messageId===e.messageId},n.prototype.applyThreadInfoUpdateEvent=function(e){var r,i;return this.messageId===e.targetMessageId&&(e.threadInfo&&e.threadInfo.isPushNotificationEnabled===void 0&&((r=this.threadInfo)===null||r===void 0?void 0:r.isPushNotificationEnabled)!==void 0&&(e.threadInfo.isPushNotificationEnabled=(i=this.threadInfo)===null||i===void 0?void 0:i.isPushNotificationEnabled),this.threadInfo=e.threadInfo,!0)},n.prototype.applyReactionEvent=function(e){if(this.messageId===e.messageId){for(var r=!1,i=0;i<this.reactions.length;i++)if(this.reactions[i].key===e.key){this.reactions[i].applyEvent(e),this.reactions[i].isEmpty&&this.reactions.splice(i,1),r=!0;break}r||e.operation!=="add"||this.reactions.push(new di(di.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}},n.prototype.applyParentMessage=function(e){if(!this.parentMessage)return this.parentMessage=e,!0;if(this.parentMessageId===e.messageId){var r=this.parentMessage.updatedAt;if(e.updatedAt>=r)return this.parentMessage=e,!0}return!1},n.prototype._triggerThreadInfoUpdatedEvent=function(){return f(this,void 0,void 0,function(){var e;return h(this,function(r){return(e=S.of(this._iid).dispatcher).dispatch(new gh({channelType:W.GROUP,channelUrl:this.channelUrl,parentMessage:this})),e.dispatch(new _e({messages:[this],source:ne.EVENT_THREAD_INFO_UPDATED})),[2]})})},n.prototype.markThreadAsRead=function(){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return e=S.of(this._iid).requestQueue,r=new dh({channelUrl:this.channelUrl,messageId:this.messageId}),[4,e.send(r)];case 1:return i.sent(),this.threadInfo&&this.threadInfo.unreadReplyCount>0?(this.threadInfo.unreadReplyCount=0,[4,this._triggerThreadInfoUpdatedEvent()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}})})},n.prototype.setPushNotificationEnabled=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){switch(s.label){case 0:return r=S.of(this._iid).requestQueue,i=new hh({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,pushEnabled:e}),[4,r.send(i)];case 1:return s.sent(),this.threadInfo&&this.threadInfo.isPushNotificationEnabled!==e&&(this.threadInfo.isPushNotificationEnabled=e),[2]}})})},n.prototype.submitForm=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:if(D(e.form&&e.form instanceof hi||T("string",e.formId)&&T("object",e.answers)).throw(I.invalidParameters),r=S.of(this._iid),i=r.requestQueue,s=r.sdkState,o=r.logger,!e.form)return[3,2];if(!(a=e.form).isSubmittable)throw new I({code:z.INVALID_PARAMETER,message:"The given form is not submittable."});if(a.isSubmitted)throw new I({code:z.INVALID_PARAMETER,message:"The given form is already submitted."});if(a.messageId!=this.messageId)throw new I({code:z.INVALID_PARAMETER,message:"This form does not belong to the message."});return u=a.fields.reduce(function(d,p){return d[p.key]=p.temporaryAnswer,d},{}),c=new mu({userId:s.userId,channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,forms:[{form_key:a.key,data:u}]}),[4,i.send(c)];case 1:return l.sent(),[3,4];case 2:return e.formId&&e.answers?(o.warn("The submitForm method with formId and answers is deprecated. Use submitForm({ form: Form }) instead."),c=new mu({userId:s.userId,channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,forms:[{form_key:e.formId,data:e.answers}]}),[4,i.send(c)]):[3,4];case 3:l.sent(),l.label=4;case 4:return[2]}})})},n.prototype.submitFeedback=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return r=S.of(this._iid),i=r.requestQueue,s=r.dispatcher,o=new fh({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,rating:e.rating,comment:e.comment}),[4,i.send(o)];case 1:return a=c.sent(),u=a.as(ph),this.myFeedback=u.feedback,this.myFeedbackStatus="SUBMITTED",s.dispatch(new _e({messages:[this],source:ne.EVENT_MESSAGE_FEEDBACK_ADDED})),[2]}})})},n.prototype.updateFeedback=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return r=S.of(this._iid),i=r.requestQueue,s=r.dispatcher,o=new _h({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,feedbackId:e.id,rating:e.rating,comment:e.comment}),[4,i.send(o)];case 1:return a=c.sent(),u=a.as(vh),this.myFeedback=u.feedback,this.myFeedbackStatus="SUBMITTED",s.dispatch(new _e({messages:[this],source:ne.EVENT_MESSAGE_FEEDBACK_UPDATED})),[2]}})})},n.prototype.deleteFeedback=function(e){return f(this,void 0,void 0,function(){var r,i,s,o;return h(this,function(a){switch(a.label){case 0:return r=S.of(this._iid),i=r.requestQueue,s=r.dispatcher,o=new mh({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,feedbackId:e}),[4,i.send(o)];case 1:return a.sent(),this.myFeedback=null,this.myFeedbackStatus="NO_FEEDBACK",s.dispatch(new _e({messages:[this],source:ne.EVENT_MESSAGE_FEEDBACK_DELETED})),[2]}})})},n}(_u),kt=function(t){function n(e,r){var i,s,o,a,u=this;if((u=t.call(this,e,r)||this).reqId="",u.replyToChannel=!1,u.errorCode=0,u.sender=r.user?new xn(u._iid,r.user):r.sender_id,u.reqId=(s=(i=r.req_id)!==null&&i!==void 0?i:r.request_id)!==null&&s!==void 0?s:"",u.replyToChannel=(o=r.is_reply_to_channel)!==null&&o!==void 0&&o,r.request_state&&ue(ce,r.request_state)&&(u.sendingStatus=r.request_state),!u.sendingStatus)if(u.messageId>0)u.sendingStatus=ce.SUCCEEDED;else if(u.scheduledInfo)switch(r.scheduled_status&&(u._scheduledStatus=r.scheduled_status),r.scheduled_status){case Gt.SENT:case Gt.IN_QUEUE:u.sendingStatus=ce.SUCCEEDED;break;case Gt.PENDING:u.sendingStatus=ce.SCHEDULED;break;case Gt.FAILED:case Gt.REMOVED:u.sendingStatus=ce.FAILED;break;case Gt.CANCELED:u.sendingStatus=ce.CANCELED}else u.sendingStatus=ce.PENDING;return u.errorCode=(a=r.error_code)!==null&&a!==void 0?a:0,u}return g(n,t),n.payloadify=function(e){return x(H(b(b({},t.payloadify.call(this,e)),{user:xn.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode})))},Object.defineProperty(n.prototype,"isResendable",{get:function(){return(this.sendingStatus===ce.FAILED||this.sendingStatus===ce.CANCELED)&&al(this.errorCode)},enumerable:!1,configurable:!0}),n.prototype.isIdentical=function(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId},n}(tt),mr={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:Ye.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},fi=function(t){return T("number",t.prevResultSize)&&T("number",t.nextResultSize)&&T("boolean",t.isInclusive)&&T("boolean",t.reverse)&&T("string",t.messageTypeFilter)&&ue(Ye,t.messageTypeFilter)&&X("string",t.customTypesFilter,!0)&&X("string",t.senderUserIdsFilter,!0)&&T("boolean",t.includeMetaArray)&&T("boolean",t.includeReactions)&&T("boolean",t.includeParentMessageInfo)},gr=function(t){function n(e,r){var i,s,o,a,u=this;if((u=t.call(this,e,r)||this).translations={},u.message=(i=r.message)!==null&&i!==void 0?i:"",u.messageType=he.ADMIN,u.translations=(s=r.translations)!==null&&s!==void 0?s:{},r.parent_message_info){var c=r.parent_message_info;u.parentMessage=Rt(e,x(H(b(b({},c),{message_id:u.parentMessageId,channel_url:u.channelUrl,channel_type:u.channelType,file:c.file,url:(o=c.file)===null||o===void 0?void 0:o.url,require_auth:(a=c.file)===null||a===void 0?void 0:a.require_auth}))))}return u}return g(n,t),n.payloadify=function(e){return x(H(b(b({},t.payloadify.call(this,e)),{message:e.message,translations:e.translations,parent_message_info:e.parentMessage?t._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},n.prototype.getThreadedMessagesByTimestamp=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=b(b({},mr),r),D(this.messageId>0&&T("number",e)&&fi(i)).throw(I.invalidParameters),[4,Se.of(this._iid).getThreadedMessagesByTimestamp(this,e,i)];case 1:return[2,s.sent()]}})})},n}(tt),yu=function(){function t(n){var e,r;this.detail={},this.type=(e=n.type)!==null&&e!==void 0?e:"",this.vendor=(r=n.vendor)!==null&&r!==void 0?r:"",n.detail&&T("object",n.detail)&&!Array.isArray(n.detail)&&(this.detail=n.detail)}return t.payloadify=function(n){return x(H({type:n.type,vendor:n.vendor,detail:n.detail}))},t}(),bu=function(){function t(n){this.status=n.status,n.original_message_info&&(this.originalMessageInfo={createdAt:n.original_message_info.ts,messageId:n.original_message_info.id})}return t.payloadify=function(n){return x({status:n.status,original_message_info:n.originalMessageInfo?{id:n.originalMessageInfo.messageId,ts:n.originalMessageInfo.createdAt}:void 0})},t}(),$e=function(t){function n(e,r){var i,s,o,a,u,c,l,d=this;if((d=t.call(this,e,r)||this).message="",d.messageParams=null,d.translations={},d.translationTargetLanguages=[],d.messageSurvivalSeconds=-1,d.plugins=[],d._poll=null,d.message=r.message,d.messageType=he.USER,d.translations=(o=r.translations)!==null&&o!==void 0?o:{},d.translationTargetLanguages=(a=r.target_langs)!==null&&a!==void 0?a:[],Object.keys(d.translations).length===0&&d.translationTargetLanguages.length>0)try{for(var p=$(d.translationTargetLanguages),_=p.next();!_.done;_=p.next()){var v=_.value;d.translations[v]=""}}catch(y){i={error:y}}finally{try{_&&!_.done&&(s=p.return)&&s.call(p)}finally{if(i)throw i.error}}if(d.messageSurvivalSeconds=(u=r.message_survival_seconds)!==null&&u!==void 0?u:-1,d.plugins=r.plugins?r.plugins.map(function(y){return new yu(y)}):[],d._poll=r.poll?new at(d._iid,r.poll):null,r.parent_message_info){var m=r.parent_message_info;d.parentMessage=Rt(e,x(H(b(b({},m),{created_at:m.ts,message_id:d.parentMessageId,channel_url:d.channelUrl,channel_type:d.channelType,file:m.file,url:(c=m.file)===null||c===void 0?void 0:c.url,require_auth:(l=m.file)===null||l===void 0?void 0:l.require_auth}))))}return r.review_info&&(d.messageReviewInfo=new bu(r.review_info)),d}return g(n,t),n.payloadify=function(e){return x(H(b(b({},t.payloadify.call(this,e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map(function(r){return yu.payloadify(r)}),poll:e._poll?at.payloadify(e._poll):null,parent_message_info:e.parentMessage?t._getParentMessageInfoPayload.call(this,e.parentMessage):null,review_info:e.messageReviewInfo?bu.payloadify(e.messageReviewInfo):void 0})))},n.prototype.getThreadedMessagesByTimestamp=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=b(b({},mr),r),D(this.messageId>0&&T("number",e)&&fi(i)).throw(I.invalidParameters),[4,Se.of(this._iid).getThreadedMessagesByTimestamp(this,e,i)];case 1:return[2,s.sent()]}})})},n.prototype.applyPoll=function(e){return!(this._poll&&this._poll.id===e.id&&this._poll.updatedAt>e.updatedAt)&&(this._poll=e,!0)},Object.defineProperty(n.prototype,"poll",{get:function(){return this._poll},enumerable:!1,configurable:!0}),n}(kt),ut=function(t){function n(e,r){var i,s,o,a,u,c=this;if((c=t.call(this,e,r)||this).messageParams=null,c.fileInfoList=[],c.messageSurvivalSeconds=-1,c.messageType=he.FILE,c.fileInfoList=(s=(i=r.files)===null||i===void 0?void 0:i.map(function(d){return new Fs(e,d)}))!==null&&s!==void 0?s:[],c.messageSurvivalSeconds=(o=r.message_survival_seconds)!==null&&o!==void 0?o:-1,r.parent_message_info){var l=r.parent_message_info;c.parentMessage=Rt(e,x(H(b(b({},l),{created_at:l.ts,message_id:c.parentMessageId,channel_url:c.channelUrl,channel_type:c.channelType,file:l.file,url:(a=l.file)===null||a===void 0?void 0:a.url,require_auth:(u=l.file)===null||u===void 0?void 0:u.require_auth}))))}return c}return g(n,t),n.prototype.getThreadedMessagesByTimestamp=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=b(b({},mr),r),D(this.messageId>0&&T("number",e)&&fi(i)).throw(I.invalidParameters),[4,Se.of(this._iid).getThreadedMessagesByTimestamp(this,e,i)];case 1:return[2,s.sent()]}})})},n.payloadify=function(e){return x(H(b(b({},t.payloadify.call(this,e)),{files:Array.isArray(e.fileInfoList)?e.fileInfoList.map(function(r){return Fs.payloadify(r)}):null,message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?t._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},n._isMultipleFilesMessagePayload=function(e){var r=e.files;return Array.isArray(r)&&r.length>=2},n._isMultipleFilesMessageSerializedData=function(e){var r=e.fileInfoList;return Array.isArray(r)},n}(kt);(function(t){t.SENT="SENT",t.READ="READ"})(hn||(hn={}));var yr=function(t){function n(e,r){var i,s,o=this;if((o=t.call(this,e,r)||this).notificationData=null,o.notificationId=r.notification_message_id,o.messageType=he.ADMIN,o.messageStatus=(i=r.message_status)!==null&&i!==void 0?i:hn.SENT,o.priority=(s=r.priority)!==null&&s!==void 0?s:Wi.NORMAL,o.extendedMessage.sub_type===0)try{var a=JSON.parse(o.extendedMessage.sub_data),u=a.label,c=a.tags,l=c===void 0?[]:c,d=a.template_key,p=a.template_variables;o.notificationData={label:u,tags:l,templateKey:d,templateVariables:p}}catch{}return o}return g(n,t),n.payloadify=function(e){return x(H(b(b({},t.payloadify.call(this,e)),{notification_message_id:e.notificationId,message_status:e.messageStatus,priority:e.priority})))},n.prototype.isIdentical=function(e){return this.notificationId===e.notificationId},n}(_u),Rt=function(t,n){if(n.notification_message_id)return new yr(t,n);switch(n.type){case"MESG":return new $e(t,n);case"FILE":return ut._isMultipleFilesMessagePayload(n)?new ut(t,n):new ge(t,n);case"ADMM":case"BRDM":return new gr(t,n);default:return null}},ge=function(t){function n(e,r){var i,s,o,a,u,c,l,d,p,_,v,m,y,E,w=this;(w=t.call(this,e,r)||this).messageParams=null,w.plainUrl="",w.requireAuth=!1,w.thumbnails=[],w.messageSurvivalSeconds=-1,w.messageType=he.FILE;var C=r.file;if(w.plainUrl=((s=(i=C==null?void 0:C.url)!==null&&i!==void 0?i:r.url)!==null&&s!==void 0?s:"").split("?auth=")[0],w.name=(a=(o=C==null?void 0:C.name)!==null&&o!==void 0?o:r.name)!==null&&a!==void 0?a:"File",w.size=(c=(u=C==null?void 0:C.size)!==null&&u!==void 0?u:r.size)!==null&&c!==void 0?c:0,w.data=(d=(l=C==null?void 0:C.data)!==null&&l!==void 0?l:r.custom)!==null&&d!==void 0?d:"",w.type=C?(p=C.type)!==null&&p!==void 0?p:"":(_=r.type)!==null&&_!==void 0?_:"",w.requireAuth=(v=r.require_auth)!==null&&v!==void 0&&v,w.thumbnails=r.thumbnails?r.thumbnails.map(function(P){var N;return new Bt(w._iid,typeof P=="string"?{url:P,width:0,height:0}:b(b({},P),{url:((N=P.url)!==null&&N!==void 0?N:"").split("auth=")[0]}),w.requireAuth)}):[],w.messageSurvivalSeconds=(m=r.message_survival_seconds)!==null&&m!==void 0?m:-1,r.parent_message_info){var A=r.parent_message_info;w.parentMessage=Rt(e,x(H(b(b({},A),{created_at:A.ts,message_id:w.parentMessageId,channel_url:w.channelUrl,channel_type:w.channelType,file:A.file,url:(y=A.file)===null||y===void 0?void 0:y.url,require_auth:(E=A.file)===null||E===void 0?void 0:E.require_auth}))))}return w}return g(n,t),n.payloadify=function(e){var r;return x(H(b(b({},t.payloadify.call(this,e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:(r=e.thumbnails)===null||r===void 0?void 0:r.map(function(i){return{url:i.plainUrl,width:i.width,height:i.height,real_width:i.realWidth,real_height:i.realHeight}}),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?t._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},Object.defineProperty(n.prototype,"url",{get:function(){var e=S.of(this._iid).sessionManager;return this.requireAuth&&e.ekey?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),n.prototype.getThreadedMessagesByTimestamp=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=b(b({},mr),r),D(this.messageId>0&&T("number",e)&&fi(i)).throw(I.invalidParameters),[4,Se.of(this._iid).getThreadedMessagesByTimestamp(this,e,i)];case 1:return[2,s.sent()]}})})},n}(kt),pi=function(t){function n(e,r){var i=r.file,s=r.fileUrl,o=r.fileName,a=r.fileSize,u=r.mimeType,c=r.thumbnailSizes,l=r._uploadedMetaData,d=r._thumbnails,p=t.call(this,e)||this;return p._plainUrl=s,p.file=i,p.fileName=o,p.fileSize=a,p.mimeType=u,p.thumbnailSizes=c,p._uploadedMetaData=l,p._thumbnails=d,p}return g(n,t),n.getPlainUrl=function(e){return e instanceof n?e._plainUrl:e.fileUrl},Object.defineProperty(n.prototype,"fileUrl",{get:function(){var e,r=S.of(this._iid).sessionManager;return this._plainUrl&&(!((e=this._uploadedMetaData)===null||e===void 0)&&e.requireAuth)&&r.ekey?"".concat(this._plainUrl,"?auth=").concat(r.ekey):this._plainUrl},set:function(e){this._plainUrl=e},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return{file:this.file,fileUrl:this._plainUrl,fileName:this.fileName,fileSize:this.fileSize,mimeType:this.mimeType,thumbnailSizes:this.thumbnailSizes,_thumbnails:this._thumbnails,_uploadedMetaData:this._uploadedMetaData}},n}(qe),yh=function(t){function n(e){var r,i,s,o,a=[];return e.mentionType===xe.USERS&&(e.mentionedUserIds?a=e.mentionedUserIds:e.mentionedUsers&&(a=e.mentionedUsers.map(function(u){return u.userId}))),t.call(this,{code:"FILE",ackRequired:!0,payload:x(H({channel_url:e.channelUrl,files:e.files?wu(e.files):null,url:e.url,name:(r=e.fileName)!==null&&r!==void 0?r:"",type:(i=e.mimeType)!==null&&i!==void 0?i:"",size:(s=e.fileSize)!==null&&s!==void 0?s:0,custom:e.data,custom_type:e.customType,thumbnails:(o=e._thumbnails)===null||o===void 0?void 0:o.map(function(u){return Bt.payloadify(u)}),require_auth:e.requireAuth,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:a,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==pt.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions?Et.payloadify(e.appleCriticalAlertOptions):null,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:e.parentMessageId?e.parentMessageId:null,req_id:e.reqId,pin_message:e.isPinnedMessage}))})||this}return g(n,t),n}(He),bh=function(t){function n(e){var r,i,s=this;s=t.call(this)||this;var o=[];return e.mentionType===xe.USERS&&(e.mentionedUserIds?o=e.mentionedUserIds:e.mentionedUsers&&(o=e.mentionedUsers.map(function(a){return a.userId}))),s.method=k.POST,s.path="".concat(J(e.channelType),"/").concat(encodeURIComponent(e.channelUrl),"/messages"),s.params=x(H({message_type:he.FILE,user_id:e.userId,files:e.files?wu(e.files):null,url:e.fileUrl,mention_type:e.mentionType,mentioned_user_ids:o,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,data:e.data,custom_type:e.customType,thumbnails:(r=e._thumbnails)===null||r===void 0?void 0:r.map(function(a){return Bt.payloadify(a)}),require_auth:e.requireAuth,sorted_metaarray:(i=e.metaArrays)===null||i===void 0?void 0:i.map(function(a){return et.payloadify(a)}),push_option:e.pushNotificationDeliveryOption,parent_message_id:e.parentMessageId?e.parentMessageId:null,apple_critical_alert_options:e.appleCriticalAlertOptions?Et.payloadify(e.appleCriticalAlertOptions):null,reply_to_channel:e.isReplyToChannel,req_id:e.reqId,pin_message:e.isPinnedMessage})),s}return g(n,t),n}(R),Eu=function(t){function n(e,r,i){var s,o,a,u,c=this;(c=t.call(this,e,"FILE",i)||this).message=i.files&&i.files.length>=2?new ut(e,i):new ge(e,i);var l=S.of(e).sdkState;return c.isMentioned=Sn(c.message.mentionType,(a=(s=c.message.mentionedUserIds)!==null&&s!==void 0?s:(o=c.message.mentionedUsers)===null||o===void 0?void 0:o.map(function(d){return d.userId}))!==null&&a!==void 0?a:[],l.userId),c.forceUpdateLastMessage=(u=i.force_update_last_message)!==null&&u!==void 0&&u,c}return g(n,t),n}(de),Eh=function(t){function n(e,r){var i,s,o,a,u=this;(u=t.call(this,e,r)||this).message=r.files&&r.files.length>=2?new ut(e,r):new ge(e,r);var c=S.of(e).sdkState;return u.isMentioned=Sn(u.message.mentionType,(o=(i=u.message.mentionedUserIds)!==null&&i!==void 0?i:(s=u.message.mentionedUsers)===null||s===void 0?void 0:s.map(function(l){return l.userId}))!==null&&o!==void 0?o:[],c.userId),u.forceUpdateLastMessage=(a=r.force_update_last_message)!==null&&a!==void 0&&a,u}return g(n,t),n}(M);function wu(t){return t.map(function(n){var e,r;return x(H({url:pi.getPlainUrl(n),file_name:n.fileName,file_type:n.mimeType,file_size:n.fileSize,thumbnails:(e=n._thumbnails)===null||e===void 0?void 0:e.map(function(i){return Bt.payloadify(i)}),require_auth:(r=n._uploadedMetaData)===null||r===void 0?void 0:r.requireAuth}))})}var ye;(function(t){t[t.PENDING=0]="PENDING",t[t.UPLOADING=1]="UPLOADING",t[t.UPLOADED=2]="UPLOADED",t[t.SENDING=3]="SENDING",t[t.FAILED=4]="FAILED"})(ye||(ye={}));var wh=function(){function t(n,e){var r=e.sdkState,i=e.dispatcher,s=e.requestQueue,o=e.onlineDetector,a=e.cacheContext,u=this;this._queueMap=new Map,this._iid=n,this._sdkState=r,this._requestQueue=s,this._cacheContext=a,this._dispatcher=i,this._dispatcher.on(function(c){c instanceof un&&(u._connectionState=c.stateType)}),this._onlineDetector=o}return Object.defineProperty(t.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===se.CONNECTED||this._connectionState===se.CONNECTING||this._connectionState===se.RECONNECTING},enumerable:!1,configurable:!0}),t.prototype._sendFileMessage=function(n,e){return f(this,void 0,void 0,function(){var r,i,s;return h(this,function(o){switch(o.label){case 0:return r=this._createSendFileMessageRequestParams(n,e),this._shouldSendThroughWebSocket?(i=new yh(r),[4,this._requestQueue.send(i)]):[3,2];case 1:return s=o.sent(),[2,s.as(Eu).message];case 2:return i=new bh(b(b({},r),{userId:this._sdkState.userId})),[4,this._requestQueue.send(i)];case 3:return s=o.sent(),[2,s.as(Eh).message]}})})},t.prototype._createSendFileMessageRequestParams=function(n,e){var r=b(b({},e.params),{channelUrl:n.url,channelType:n.channelType,reqId:e.requestId,url:""});if(e.multipleFileUploadInfo){var i=e.params;r.files=i.fileInfoList}else i=e.params,r.url=i.fileUrl,r.requireAuth=i.requireAuth;return r},t.prototype._resolveMessageQueue=function(n){var e;return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l,d,p,_,v,m;return h(this,function(y){switch(y.label){case 0:if(!(r=this._queueMap.get(n.url)))return[3,21];if(r.isResolving)return[3,20];r.isResolving=!0,i=[],s=!0,y.label=1;case 1:y.trys.push([1,15,16,17]),o=$(r.messageQueue),a=o.next(),y.label=2;case 2:if(a.done)return[3,14];switch(u=a.value,u.state){case ye.PENDING:case ye.UPLOADING:return[3,3];case ye.UPLOADED:return[3,4];case ye.FAILED:return[3,12]}return[3,13];case 3:return s=!1,i.push(u),[3,13];case 4:if(!s)return[3,10];y.label=5;case 5:return y.trys.push([5,8,,9]),u.state=ye.SENDING,[4,this._sendFileMessage(n,u)];case 6:return c=y.sent(),u.deferred.resolve(c),[4,ot(100)];case 7:return y.sent(),[3,9];case 8:return l=y.sent(),u.deferred.reject(l),[3,9];case 9:return[3,11];case 10:i.push(u),y.label=11;case 11:return[3,13];case 12:return d=(e=u.error)!==null&&e!==void 0?e:I.unknown,u.deferred.reject(d.code===z.REQUEST_CANCELED?I.fileUploadCanceled:d),[3,13];case 13:return a=o.next(),[3,2];case 14:return[3,17];case 15:return p=y.sent(),v={error:p},[3,17];case 16:try{a&&!a.done&&(m=o.return)&&m.call(o)}finally{if(v)throw v.error}return[7];case 17:return _=r.isResolveRequestPending,r.messageQueue=i,r.isResolving=!1,r.isResolveRequestPending=!1,_?[4,this._resolveMessageQueue(n)]:[3,19];case 18:y.sent(),y.label=19;case 19:return[3,21];case 20:r.isResolveRequestPending=!0,y.label=21;case 21:return[2]}})})},t.prototype._uploadNextPendingItem=function(n){var e;return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l,d,p;return h(this,function(_){switch(_.label){case 0:return(r=this._queueMap.get(n.url))&&(i=r.messageQueue.find(function(v){return v.state===ye.PENDING}))?i.multipleFileUploadInfo?(s=i.multipleFileUploadInfo,o=s.uploadIndex,a=s.uploadCount,u=s.requestHandler,p=i.params,c=p.fileInfoList[o],!Ge(c.file)||!((e=c._uploadedMetaData)===null||e===void 0)&&e.isUploaded?[3,2]:[4,this._tryUploadNextItemAndUpdateItemState(n,r,i)]):[3,4]:[3,9];case 1:return _.sent(),[3,3];case 2:i.state=o<a-1?ye.PENDING:ye.UPLOADED,_.label=3;case 3:return l=p.fileInfoList[o],d=i.multipleFileUploadInfo.uploadIndex++,i.multipleFileUploadInfo.isCopy||u==null||u._triggerOnFileUploaded(i.requestId,d,l,i.error),[3,7];case 4:return p=i.params,Ge(p.file)?[4,this._tryUploadNextItemAndUpdateItemState(n,r,i)]:[3,6];case 5:return _.sent(),[3,7];case 6:p.thumbnailSizes=[],i.state=ye.UPLOADED,_.label=7;case 7:return this._uploadNextPendingItem(n),[4,this._resolveMessageQueue(n)];case 8:_.sent(),_.label=9;case 9:return[2]}})})},t.prototype._tryUploadNextItemAndUpdateItemState=function(n,e,r){return f(this,void 0,void 0,function(){var i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return[4,this._onlineDetector.isOnline()];case 1:if(i=l.sent(),!S.of(this._iid).sessionManager.currentUser||!i)return r.error=I.connectionRequired,r.state=ye.FAILED,[2];if(!(e.uploadQueue.length<6))return[3,9];r.state=ye.UPLOADING,e.uploadQueue.push(r),l.label=2;case 2:return l.trys.push([2,7,,8]),r.multipleFileUploadInfo?(s=r.multipleFileUploadInfo,o=s.uploadIndex,a=s.uploadCount,u=r.params,[4,this._uploadNextFileForMultipleFilesItemAndUpdateParams(n,r,u)]):[3,4];case 3:return l.sent(),r.state=o<a-1?ye.PENDING:ye.UPLOADED,[3,6];case 4:return u=r.params,[4,this._uploadNextFileForSingleFileItemAndUpdateParams(n,r,u)];case 5:l.sent(),r.state=ye.UPLOADED,l.label=6;case 6:return[3,8];case 7:switch((c=l.sent()).code){case z.REQUEST_FAILED:r.error=new I({code:z.NETWORK_ERROR,message:"Failed to upload a file."});break;case z.REQUEST_CANCELED:r.error=I.fileUploadCanceled;break;default:r.error=c}return r.state=ye.FAILED,[3,8];case 8:this._dequeueUploadItem(e,r),l.label=9;case 9:return[2]}})})},t.prototype._dequeueUploadItem=function(n,e){var r=n.uploadQueue.findIndex(function(i){return i.requestId===e.requestId});r>=0&&n.uploadQueue.splice(r,1)},t.prototype._uploadNextFileForSingleFileItemAndUpdateParams=function(n,e,r){var i,s,o;return f(this,void 0,void 0,function(){var a,u,c,l,d,p,_,v,m,y;return h(this,function(E){switch(E.label){case 0:return a=new Ms({file:r.file,channelUrl:n.url,thumbnailSizes:r.thumbnailSizes,requestId:e.requestId}),[4,this._requestQueue.send(a)];case 1:return u=E.sent(),c=u.as(Ls),l=c.url,d=c.fileSize,p=d===void 0?r.fileSize:d,_=c.thumbnails,v=_===void 0?[]:_,m=c.requireAuth,y=m!==void 0&&m,r.fileName=(i=r.fileName)!==null&&i!==void 0?i:r.file.name,r.mimeType=(s=r.mimeType)!==null&&s!==void 0?s:r.file.type,r.fileSize=(o=r.fileSize)!==null&&o!==void 0?o:r.file.size,r.fileUrl=l,r.fileSize=p,r.requireAuth=y,r._thumbnails=v,[2]}})})},t.prototype._uploadNextFileForMultipleFilesItemAndUpdateParams=function(n,e,r){var i,s,o;return f(this,void 0,void 0,function(){var a,u,c,l,d,p,_,v,m,y,E;return h(this,function(w){switch(w.label){case 0:return a=e.multipleFileUploadInfo.uploadIndex,u=r.fileInfoList[a],c=new Ms({file:u.file,channelUrl:n.url,thumbnailSizes:u.thumbnailSizes,requestId:e.requestId}),[4,this._requestQueue.send(c)];case 1:return l=w.sent(),d=l.as(Ls),p=d.url,_=d.fileSize,v=_===void 0?u.fileSize:_,m=d.thumbnails,y=d.requireAuth,E=y!==void 0&&y,u.fileName=(i=u.fileName)!==null&&i!==void 0?i:u.file.name,u.mimeType=(s=u.mimeType)!==null&&s!==void 0?s:u.file.type,u.fileSize=(o=u.fileSize)!==null&&o!==void 0?o:u.file.size,u.file=void 0,u.fileUrl=p,u.fileSize=v,u._thumbnails=m,u._uploadedMetaData=b(b({},u._uploadedMetaData),{requireAuth:E,isUploaded:!0}),u instanceof pi||(r.fileInfoList[a]=new pi(this._iid,u)),[2]}})})},t.prototype.request=function(n,e,r,i){return i===void 0&&(i={}),f(this,void 0,void 0,function(){var s,o,a,u,c;return h(this,function(l){return this._queueMap.has(n.url)||(s={messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1},this._queueMap.set(n.url,s)),o=this._queueMap.get(n.url),a=new Ae,u={requestId:e,params:r,state:ye.PENDING,deferred:a},function(d){return"fileInfoList"in d}(r)&&(c=b({uploadIndex:0,uploadCount:r.fileInfoList.length},i),u.multipleFileUploadInfo=c),o.messageQueue.push(u),this._uploadNextPendingItem(n),[2,a.promise]})})},t.prototype.cancel=function(n,e){var r,i,s=this._queueMap.get(n.url);if(s){var o=e?[s.messageQueue.find(function(v){return v.requestId===e})]:Z([],G(s.messageQueue),!1);try{for(var a=$(o),u=a.next();!u.done;u=a.next()){var c=u.value;if(c)switch(c.state){case ye.PENDING:if(c.state=ye.FAILED,c.error=I.requestCanceled,c.multipleFileUploadInfo&&!c.multipleFileUploadInfo.isCopy){var l=c.multipleFileUploadInfo,d=l.uploadIndex,p=l.requestHandler,_=c.params.fileInfoList[d];p==null||p._triggerOnFileUploaded(c.requestId,d,_,I.fileUploadCanceled)}this._resolveMessageQueue(n);break;case ye.UPLOADING:this._requestQueue.cancel(c.requestId),this._dispatcher.dispatch(new Yn({requestId:c.requestId}))}}}catch(v){r={error:v}}finally{try{u&&!u.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}}else e&&(this._requestQueue.cancel(e),this._dispatcher.dispatch(new Yn({requestId:e})))},t}(),qs,br={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:Ye.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,replyType:Ve.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},Iu=function(t){return T("number",t.prevResultSize)&&T("number",t.nextResultSize)&&T("boolean",t.isInclusive)&&T("boolean",t.reverse)&&T("string",t.messageTypeFilter)&&ue(Ye,t.messageTypeFilter)&&X("string",t.customTypesFilter,!0)&&X("string",t.senderUserIdsFilter,!0)&&ue(Ve,t.replyType)&&T("boolean",t.includeMetaArray)&&T("boolean",t.includeReactions)&&T("boolean",t.includeParentMessageInfo)&&T("boolean",t.includeThreadInfo)&&T("boolean",t.showSubchannelMessagesOnly)},zs={replyType:Ve.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1},Tu=function(t){return ue(Ve,t.replyType)&&T("boolean",t.includeReactions)&&T("boolean",t.includeMetaArray)&&T("boolean",t.includeParentMessageInfo)&&T("boolean",t.includeThreadInfo)},Ih=function(t){function n(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.includeMetaArray,a=e.includeReactions,u=e.includeThreadInfo,c=e.includeParentMessageInfo,l=t.call(this)||this;return l.method=k.GET,l.path="".concat(J(r),"/").concat(encodeURIComponent(i),"/messages/").concat(encodeURIComponent(s)),l.params={is_sdk:!0,with_sorted_meta_array:o,include_reactions:a,include_thread_info:u,include_parent_message_info:c,include_poll_details:!0},l}return g(n,t),n}(R),Th=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.message=r?Rt(e,b({},r)):null,i}return g(n,t),n}(M),_i=function(t){function n(e){var r=e.channelType,i=e.channelUrl,s=e.timestamp,o=e.token,a=e.prevResultSize,u=e.nextResultSize,c=e.isInclusive,l=e.reverse,d=e.messageTypeFilter,p=e.customTypesFilter,_=e.senderUserIdsFilter,v=e.replyType,m=e.includeMetaArray,y=e.includeReactions,E=e.parentMessageId,w=e.includeThreadInfo,C=e.includeParentMessageInfo,A=e.showSubchannelMessagesOnly,P=e.checkingHasNext,N=e.checkingContinuousMessages,q=t.call(this)||this;return q.method=k.GET,q.path="".concat(J(r),"/").concat(encodeURIComponent(i),"/messages"),q.params=x(H({is_sdk:!0,prev_limit:a,next_limit:u,include:c,reverse:l,message_ts:s,message_id:o,message_type:d??null,custom_types:p,sender_ids:_,include_reply_type:v,with_sorted_meta_array:m,include_reactions:y,parent_message_id:E,include_thread_info:w,include_parent_message_info:C,show_subchannel_message_only:A,include_poll_details:!0,checking_has_next:P,checking_continuous_messages:N})),q}return g(n,t),n}(R),vi=function(t){function n(e,r){var i=t.call(this,e,r)||this;return r.is_continuous_messages!==void 0&&(i.isContinuousMessages=r.is_continuous_messages),r.has_next!==void 0&&(i.hasNext=r.has_next),i.messages=r.messages.map(function(s){return Rt(e,s)}),i}return g(n,t),n}(M),Ch=function(t){function n(e){var r=e.channelType,i=e.channelUrl,s=e.timestamp,o=e.token,a=e.replyType,u=e.includeMetaArray,c=e.includeReactions,l=e.includeThreadInfo,d=e.includeParentMessageInfo,p=t.call(this)||this;return p.method=k.GET,p.path="".concat(J(r),"/").concat(encodeURIComponent(i),"/messages/changelogs"),p.params={change_ts:s,token:o,with_sorted_meta_array:u,include_reactions:c,include_thread_info:l,include_reply_type:a,include_parent_message_info:d,include_poll_details:!0},p}return g(n,t),n}(R),Sh=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.updatedMessages=r.updated.map(function(s){return Rt(e,s)}),i.deletedMessagesInfo=r.deleted.map(function(s){return{messageId:s.message_id,deletedAt:s.deleted_at}}),i.hasMore=r.has_more,i.nextToken=r.next,i}return g(n,t),n}(M),Ah=function(t){function n(e){var r=e.channelUrl,i=e.scheduledMessageId,s=t.call(this)||this;return s.method=k.GET,s.path="".concat(Zi,"/").concat(encodeURIComponent(r),"/scheduled_messages/").concat(encodeURIComponent(i)),s.params={},s}return g(n,t),n}(R),Nh=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.message=r?Rt(e,b({},r)):null,i}return g(n,t),n}(M);(function(t){t.MUTED="muted",t.BANNED="banned"})(qs||(qs={}));var Cu=function(){function t(n){var e,r,i,s;this.restrictionType=null,ue(qs,n.restriction_type)&&(this.restrictionType=n.restriction_type),this.description=(e=n.description)!==null&&e!==void 0?e:null,this.endAt=(i=(r=n.end_at)!==null&&r!==void 0?r:n.muted_end_at)!==null&&i!==void 0?i:-1,this.remainingDuration=(s=n.remaining_duration)!==null&&s!==void 0?s:-1}return t.payloadify=function(n){return x(H({restriction_type:n.restrictionType,description:n.description,end_at:n.endAt,remaining_duration:n.remainingDuration}))},t}(),Fn=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.restrictionInfo=new Cu(r),i}return g(n,t),n.payloadify=function(e){return x(H(b(b({},t.payloadify.call(this,e)),Cu.payloadify(e.restrictionInfo))))},n}(V),Oh=function(t){function n(e,r){var i,s=this;return(s=t.call(this,e,r)||this).isMuted=!1,s.isMuted=(i=r.is_muted)!==null&&i!==void 0&&i,s}return g(n,t),n}(V),mi=function(){function t(){this._onPending=B,this._onFailed=B,this._onSucceeded=B}return t.prototype._trigger=function(n){switch(n==null?void 0:n.sendingStatus){case ce.PENDING:n.errorCode===0&&this._onPending(n);break;case ce.SCHEDULED:case ce.SUCCEEDED:this._onSucceeded(n)}},t.prototype._triggerFailed=function(n,e){switch(e==null?void 0:e.sendingStatus){case ce.FAILED:case ce.CANCELED:this._onFailed(n,e.scheduledInfo?null:e)}},t.prototype.onPending=function(n){return this._onPending=n,this},t.prototype.onFailed=function(n){return this._onFailed=n,this},t.prototype.onSucceeded=function(n){return this._onSucceeded=n,this},t}(),gi={data:void 0,customType:void 0,mentionType:xe.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,mentionedMessageTemplate:void 0,metaArrays:void 0,parentMessageId:void 0,isReplyToChannel:!1,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0,isPinnedMessage:!1},Hs=function(t){return T("string",t.data,!0)&&T("string",t.customType,!0)&&ue(xe,t.mentionType)&&X("string",t.mentionedUserIds,!0)&&X(V,t.mentionedUsers,!0)&&T("string",t.mentionedMessageTemplate,!0)&&X(et,t.metaArrays,!0)&&T("number",t.parentMessageId,!0)&&T("boolean",t.isReplyToChannel)&&ue(pt,t.pushNotificationDeliveryOption,!0)&&T(Et,t.appleCriticalAlertOptions,!0)&&T("boolean",t.isPinnedMessage,!0)},Su=function(t){return{isReplyToChannel:t.isReplyToChannel,pushNotificationDeliveryOption:t.pushNotificationDeliveryOption,pollId:t.pollId}},Au=b(b({},gi),{message:"",translationTargetLanguages:void 0,pollId:void 0,extendedMessagePayload:void 0});function kh(t){var n,e,r;return(n=t.messageParams)!==null&&n!==void 0?n:H(b(b({},t),{mentionType:t.mentionType,mentionedUserIds:(e=t.mentionedUserIds)!==null&&e!==void 0?e:(r=t.mentionedUsers)===null||r===void 0?void 0:r.map(function(i){return i.userId}),translationTargetLanguages:Object.keys(t.translations),pushNotificationDeliveryOption:pt.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1}))}var fn,Nu=function(t){var n;return x(H({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUsers:t.mentionedUsers,mentionedUserIds:t.mentionedUserIds,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,pollId:(n=t.poll)===null||n===void 0?void 0:n.id,parentMessageId:t.parentMessageId,appleCriticalAlertOptions:t.appleCriticalAlertOptions,message:t.message,translationTargetLanguages:Object.keys(t.translations),extendedMessagePayload:t.extendedMessagePayload}))},Rh=function(t){return Hs(t)&&T("string",t.message)&&X("string",t.translationTargetLanguages,!0)&&T("number",t.pollId,!0)&&T("object",t.extendedMessagePayload,!0)};(function(t){t.FILE="file",t.BLOB="blob",t.BLOB_LIKE_OBJECT="blobLikeObject",t.URL="url"})(fn||(fn={}));var yi=function(t){return typeof window<"u"&&"Blob"in window&&typeof Blob<"u"&&t instanceof Blob},$s=function(t){return t===fn.BLOB||t===fn.FILE},Ou=function(t){return{file:t.file,fileKey:t.fileKey,fileType:t.fileType,isReplyToChannel:t.isReplyToChannel,pushNotificationDeliveryOption:t.pushNotificationDeliveryOption}},ku=b(b({},gi),{file:void 0,fileKey:void 0,fileUrl:void 0,fileName:void 0,fileType:void 0,fileSize:void 0,mimeType:void 0,thumbnailSizes:void 0,requireAuth:!1});function Dh(t){var n,e,r,i;return(n=t.messageParams)!==null&&n!==void 0?n:H(b(b({},t),{fileUrl:t.plainUrl,fileName:t.name,fileSize:t.size,mimeType:t.type,mentionType:t.mentionType,mentionedUserIds:(e=t.mentionedUserIds)!==null&&e!==void 0?e:(r=t.mentionedUsers)===null||r===void 0?void 0:r.map(function(s){return s.userId}),pushNotificationDeliveryOption:pt.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:(i=t.thumbnails)===null||i===void 0?void 0:i.map(function(s){return{maxWidth:s.width,maxHeight:s.height}}),requireAuth:t.requireAuth,isPinnedMessage:!1,_thumbnails:t.thumbnails}))}var Er,Ru=function(t,n){var e;return t.messageParams?(!t.url&&Ge(n)&&(t.messageParams.file=n),t.messageParams):x(H({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUsers:t.mentionedUsers,mentionedUserIds:t.mentionedUserIds,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,appleCriticalAlertOptions:t.appleCriticalAlertOptions,file:n,fileUrl:t.url,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:(e=t.thumbnails)===null||e===void 0?void 0:e.map(function(r){return{maxWidth:r.width,maxHeight:r.height}})}))},Du=function(t){return Hs(t)&&(Ge(t.file)||T("string",t.fileUrl))&&T("string",t.fileName,!0)&&T("string",t.mimeType,!0)&&T("number",t.fileSize,!0)&&(t.thumbnailSizes===null||t.thumbnailSizes===void 0||Array.isArray(t.thumbnailSizes)&&t.thumbnailSizes.every(function(n){return T("object",n)&&n.maxWidth>0&&n.maxHeight>0}))},Uu={data:void 0,customType:void 0,mentionType:xe.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,mentionedMessageTemplate:void 0,metaArrays:void 0,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0},Mu=function(t){return T("string",t.data,!0)&&T("string",t.customType,!0)&&ue(xe,t.mentionType)&&X("string",t.mentionedUserIds,!0)&&X(V,t.mentionedUsers,!0)&&T("string",t.mentionedMessageTemplate,!0)&&X(et,t.metaArrays,!0)&&ue(pt,t.pushNotificationDeliveryOption,!0)&&T(Et,t.appleCriticalAlertOptions,!0)},Uh=b(b({},Uu),{message:void 0,translationTargetLanguages:void 0,pollId:void 0}),Mh=function(t){return Mu(t)&&T("string",t.message,!0)&&X("string",t.translationTargetLanguages,!0)&&T("number",t.pollId,!0)},Lh=b({},Uu),Ph=function(t){function n(e){var r=e.channelUrl,i=e.channelType,s=e.token,o=e.limit,a=t.call(this)||this;return a.method=k.GET,a.path="".concat(J(i),"/").concat(encodeURIComponent(r),"/operators"),a.params={token:s,limit:o},a}return g(n,t),n}(R),xh=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.operators=r.operators.map(function(s){return new V(e,s)}),i.token=r.next,i}return g(n,t),n}(M),Fh=function(t){function n(e,r,i,s){return t.call(this,e,r,i,s)||this}return g(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)},n.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,r=S.of(this._iid).requestQueue,i=new Ph(b(b({},this),{channelUrl:this.channelUrl,token:this._token})),[4,r.send(i)]):[3,2]):[3,5];case 1:return s=c.sent(),o=s.as(xh),a=o.operators,u=o.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,[2,a];case 2:return[2,e];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},n}(dn),qh=function(t){function n(e,r,i,s){var o,a,u,c,l,d,p,_,v,m,y=this;return(y=t.call(this,e,r,i,s)||this).reverse=!1,y.messageTypeFilter=Ye.ALL,y.customTypesFilter=null,y.senderUserIdsFilter=null,y.replyType=Ve.NONE,y.includeMetaArray=!1,y.includeReactions=!1,y.includeParentMessageInfo=!1,y.includeThreadInfo=!1,y.showSubchannelMessagesOnly=!1,y._edge=Number.MAX_SAFE_INTEGER,y.reverse=(o=s.reverse)!==null&&o!==void 0&&o,y.messageTypeFilter=(a=s.messageTypeFilter)!==null&&a!==void 0?a:Ye.ALL,y.customTypesFilter=(u=s.customTypesFilter)!==null&&u!==void 0?u:null,y.senderUserIdsFilter=(c=s.senderUserIdsFilter)!==null&&c!==void 0?c:null,y.replyType=(l=s.replyType)!==null&&l!==void 0?l:Ve.NONE,y.includeMetaArray=(d=s.includeMetaArray)!==null&&d!==void 0&&d,y.includeReactions=(p=s.includeReactions)!==null&&p!==void 0&&p,y.includeParentMessageInfo=(_=s.includeParentMessageInfo)!==null&&_!==void 0&&_,y.includeThreadInfo=(v=s.includeThreadInfo)!==null&&v!==void 0&&v,y.showSubchannelMessagesOnly=(m=s.showSubchannelMessagesOnly)!==null&&m!==void 0&&m,y}return g(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&T("boolean",this.reverse)&&ue(Ye,this.messageTypeFilter)&&ue(Ve,this.replyType)&&X("string",this.customTypesFilter,!0)&&X("string",this.senderUserIdsFilter,!0)&&T("boolean",this.includeMetaArray)&&T("boolean",this.includeReactions)&&T("boolean",this.includeParentMessageInfo)&&T("boolean",this.includeThreadInfo)&&T("boolean",this.showSubchannelMessagesOnly)},n.prototype.load=function(){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,Se.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,H({prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly}))]):[3,2]:[3,5];case 1:return e=r.sent(),this._edge=Math.min.apply(Math,Z([Number.MAX_SAFE_INTEGER],G(e.map(function(i){return i.createdAt})),!1)),this._hasNext=e.length>=this.limit,this._isLoading=!1,[2,e];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},n}(dn),zh=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.limit,a=e.token;return(r=t.call(this)||this).method=k.GET,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/mute"),r.params={limit:o,token:a},r}return g(n,t),n}(R),Hh=function(t){function n(e,r){var i=t.call(this,e,r)||this;i.mutedUsers=[];var s=r.next,o=r.muted_list;return i.token=s,o&&o.length>0&&(i.mutedUsers=o.map(function(a){return new Fn(e,a)})),i}return g(n,t),n}(M),$h=function(t){function n(e,r,i,s){return t.call(this,e,r,i,s)||this}return g(n,t),n.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid).requestQueue,r=new zh(b(b({},this),{token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(Hh),o=s.mutedUsers,a=s.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,o];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},n}(dn),jh=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.limit,a=e.token;return(r=t.call(this)||this).method=k.GET,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/ban"),r.params=x({limit:o,token:a}),r}return g(n,t),n}(R),Bh=function(t){function n(e,r){var i=t.call(this,e,r)||this;i.bannedUsers=[];var s=r.next,o=r.banned_list;return i.token=s,o&&o.length>0&&(i.bannedUsers=o.map(function(a){return new Fn(e,a.user)})),i}return g(n,t),n}(M),Gh=function(t){function n(e,r,i,s){return t.call(this,e,r,i,s)||this}return g(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)},n.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid).requestQueue,r=new jh(b(b({},this),{token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(Bh),o=s.bannedUsers,a=s.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,o];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},n}(dn);(function(t){t.SPAM="spam",t.HARASSING="harassing",t.SUSPICIOUS="suspicious",t.INAPPROPRIATE="inappropriate"})(Er||(Er={}));var Vh=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.operatorUserIds;return(r=t.call(this)||this).method=k.POST,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/operators"),r.params={operator_ids:o},r}return g(n,t),n}(R);(function(t){function n(){return t!==null&&t.apply(this,arguments)||this}g(n,t)})(M);var Kh=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.operatorUserIds;return(r=t.call(this)||this).method=k.DELETE,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/operators"),r.params={operator_ids:o},r}return g(n,t),n}(R);(function(t){function n(e,r){return t.call(this,e,r)||this}g(n,t)})(M);var Qh=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.userId;return(r=t.call(this)||this).method=k.GET,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/mute/").concat(o),r}return g(n,t),n}(R),Wh=function(t){function n(e,r){var i=t.call(this,e,r)||this;i.isMuted=!1,i.startAt=0,i.endAt=0;var s=r.is_muted,o=r.start_at,a=r.end_at,u=r.remaining_duration,c=r.description;return i.isMuted=s,i.startAt=o,i.endAt=a,i.remainingDuration=u,i.description=c,i}return g(n,t),n}(M),Lu=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.keys;return(r=t.call(this)||this).method=k.GET,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={keys:o,include_ts:!0},r}return g(n,t),n}(R),Pu=function(t){function n(e,r){var i=t.call(this,e,r)||this,s=r.metadata,o=r.ts;return i.metadata=s,i.ts=o,i}return g(n,t),n}(M),Yh=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.metadata;return(r=t.call(this)||this).method=k.POST,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={metadata:o,include_ts:!0},r}return g(n,t),n}(R),Zh=function(t){function n(e,r){var i,s,o=this;return(o=t.call(this,e,r)||this).metaData=(i=r.metadata)!==null&&i!==void 0?i:{},o.ts=(s=r.ts)!==null&&s!==void 0?s:null,o}return g(n,t),n}(M),Xh=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.metadata,a=e.upsert;return(r=t.call(this)||this).method=k.PUT,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={metadata:o,include_ts:!0,upsert:a!=null&&a},r}return g(n,t),n}(R),Jh=function(t){function n(e,r){var i=t.call(this,e,r)||this,s=r.metadata,o=r.ts;return i.metadata=s,i.ts=o,i}return g(n,t),n}(M),ef=function(t){function n(e,r,i){var s=t.call(this,e,"SYEV",i)||this;return i.data&&(s.created=i.data.created,s.updated=i.data.updated,s.deleted=i.data.deleted),s}return g(n,t),n}(de),tf=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.key;return(r=t.call(this)||this).method=k.DELETE,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/metadata/").concat(o),r.params={include_ts:!0},r}return g(n,t),n}(R),nf=function(t){function n(e,r){var i=t.call(this,e,r)||this,s=r.ts;return i.ts=s,i}return g(n,t),n}(M),rf=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType;return(r=t.call(this)||this).method=k.DELETE,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={include_ts:!0},r}return g(n,t),n}(R),sf=function(t){function n(e,r){var i=t.call(this,e,r)||this,s=r.ts;return i.ts=s,i}return g(n,t),n}(M),xu=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.keys;return(r=t.call(this)||this).method=k.GET,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={keys:o},r}return g(n,t),n}(R),Fu=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.metaCounter=r,i}return g(n,t),n}(M),of=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.metaCounter;return(r=t.call(this)||this).method=k.POST,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={metacounter:o},r}return g(n,t),n}(R),af=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.metaCounter=r,i}return g(n,t),n}(M),js=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.metaCounter,a=e.upsert,u=a!==void 0&&a,c=e.mode,l=c===void 0?"set":c;return(r=t.call(this)||this).method=k.PUT,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={metacounter:o,upsert:u,mode:l},r}return g(n,t),n}(R),Bs=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.metaCounter=r,i}return g(n,t),n}(M),uf=function(t){function n(e,r,i){var s=t.call(this,e,"SYEV",i)||this;return i.data&&(s.created=i.data.created,s.updated=i.data.updated,s.deleted=i.data.deleted),s}return g(n,t),n}(de),cf=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.key;return(r=t.call(this)||this).method=k.DELETE,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/metacounter/").concat(o),r.params={},r}return g(n,t),n}(R);(function(t){function n(e,r){return t.call(this,e,r)||this}g(n,t)})(M);var lf=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType;return(r=t.call(this)||this).method=k.DELETE,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={},r}return g(n,t),n}(R);(function(t){function n(){return t!==null&&t.apply(this,arguments)||this}g(n,t)})(M);var df=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.userId,a=e.seconds,u=e.description;return(r=t.call(this)||this).method=k.POST,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/mute"),r.params={user_id:o,seconds:a,description:u},r}return g(n,t),n}(R);(function(t){function n(e,r){return t.call(this,e,r)||this}g(n,t)})(M);var hf=function(t){function n(e,r,i){var s=t.call(this,e,"SYEV",i)||this;return s.user=new Fn(e,i.data),s}return g(n,t),n}(de),ff=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.userId;return(r=t.call(this)||this).method=k.DELETE,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/mute/").concat(encodeURIComponent(o)),r}return g(n,t),n}(R);(function(t){function n(){return t!==null&&t.apply(this,arguments)||this}g(n,t)})(M);var pf=function(t){function n(e,r,i){var s=t.call(this,e,"SYEV",i)||this;return s.user=new Fn(e,i.data),s}return g(n,t),n}(de),_f=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.userId,a=e.seconds,u=e.description;return(r=t.call(this)||this).method=k.POST,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/ban"),r.params=x({user_id:o,seconds:a,description:u}),r}return g(n,t),n}(R);(function(t){function n(){return t!==null&&t.apply(this,arguments)||this}g(n,t)})(M);var vf=function(t){function n(e,r,i){var s=t.call(this,e,"SYEV",i)||this;return s.user=new Fn(e,i.data),i.data.member_count&&(s.memberCount=i.data.member_count),i.data.joined_member_count&&(s.joinedMemberCount=i.data.joined_member_count),s}return g(n,t),n}(de),mf=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.userId;return(r=t.call(this)||this).method=k.DELETE,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/ban/").concat(encodeURIComponent(o)),r}return g(n,t),n}(R);(function(t){function n(){return t!==null&&t.apply(this,arguments)||this}g(n,t)})(M);var gf=function(t){function n(e,r,i){var s=t.call(this,e,"SYEV",i)||this;return s.user=new Fn(e,i.data),s}return g(n,t),n}(de),qu=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.freezing;return(r=t.call(this)||this).method=k.PUT,r.path="".concat(J(s),"/").concat(encodeURIComponent(i),"/freeze"),r.params={freeze:o},r}return g(n,t),n}(R);(function(t){function n(){return t!==null&&t.apply(this,arguments)||this}g(n,t)})(M);var yf=function(t){function n(e,r,i){var s=t.call(this,e,"SYEV",i)||this;return s.freeze=i.data.freeze,s}return g(n,t),n}(de),bf=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.category,a=e.userId,u=e.description;return(r=t.call(this)||this).method=k.POST,r.path="".concat(Vo(s),"/").concat(encodeURIComponent(i)),r.params={report_category:o,reporting_user_id:a,report_description:u},r}return g(n,t),n}(R),Ef=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.category,a=e.userId,u=e.offendingUserId,c=e.description;return(r=t.call(this)||this).method=k.POST,r.path="".concat(Xi,"/users/").concat(u),r.params={channel_url:i,channel_type:s===W.OPEN?"open_channels":"group_channels",report_category:o,reporting_user_id:a,report_description:c},r}return g(n,t),n}(R),wf=function(t){function n(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.category,a=e.userId,u=e.offendingUserId,c=e.messageId,l=e.description;return(r=t.call(this)||this).method=k.POST,r.path="".concat(Vo(s),"/").concat(encodeURIComponent(i),"/messages/").concat(c),r.params={report_category:o,reporting_user_id:a,report_description:l,offending_user_id:u},r}return g(n,t),n}(R),If=function(t){function n(e){var r=[];return e.mentionType===xe.USERS&&(e.mentionedUserIds?r=e.mentionedUserIds:e.mentionedUsers&&(r=e.mentionedUsers.map(function(i){return i.userId}))),t.call(this,{code:"MESG",ackRequired:!0,payload:x(H({channel_url:e.channelUrl,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:r,mentioned_message_template:e.mentionedMessageTemplate,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==pt.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:e.parentMessageId?e.parentMessageId:null,req_id:e.reqId,poll_id:e.pollId,pin_message:e.isPinnedMessage,extended_message_payload:e.extendedMessagePayload}))})||this}return g(n,t),n}(He),zu=function(t){function n(e,r,i){var s,o,a,u,c=this;(c=t.call(this,e,"MESG",i)||this).message=new $e(e,i);var l=S.of(e).sdkState;return c.isMentioned=Sn(c.message.mentionType,(a=(s=c.message.mentionedUserIds)!==null&&s!==void 0?s:(o=c.message.mentionedUsers)===null||o===void 0?void 0:o.map(function(d){return d.userId}))!==null&&a!==void 0?a:[],l.userId),c.forceUpdateLastMessage=(u=i.force_update_last_message)!==null&&u!==void 0&&u,c}return g(n,t),n}(de),Hu=function(t){function n(e){var r=null;return e.mentionType===xe.USERS&&(e.mentionedUserIds?r=e.mentionedUserIds:e.mentionedUsers&&(r=e.mentionedUsers.map(function(i){return i.userId}))),t.call(this,{code:"MEDI",ackRequired:!0,payload:x(H({channel_url:e.channelUrl,msg_id:e.messageId,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:r,mentioned_message_template:e.mentionedMessageTemplate,apple_critical_alert_options:e.appleCriticalAlertOptions?Et.payloadify(e.appleCriticalAlertOptions):null,poll_id:e.pollId}))})||this}return g(n,t),n}(He),Gs=function(t){function n(e,r,i){var s,o,a,u,c,l=this;(l=t.call(this,e,"MEDI",i)||this).message=new $e(e,i);var d=S.of(e).sdkState;return l.mentionCountChange=Ji({mentionType:(s=i.old_values)===null||s===void 0?void 0:s.mention_type,mentionedUserIds:(a=(o=i.old_values)===null||o===void 0?void 0:o.mentioned_user_ids)!==null&&a!==void 0?a:[]},H({mentionType:l.message.mentionType,mentionedUserIds:(u=l.message.mentionedUserIds)!==null&&u!==void 0?u:(c=l.message.mentionedUsers)===null||c===void 0?void 0:c.map(function(p){return p.userId})}),d.userId),l}return g(n,t),n}(de),$u=function(t){function n(e){var r=null;return e.mentionType===xe.USERS&&(e.mentionedUserIds?r=e.mentionedUserIds:e.mentionedUsers&&(r=e.mentionedUsers.map(function(i){return i.userId}))),t.call(this,{code:"FEDI",ackRequired:!0,payload:x(H({channel_url:e.channelUrl,msg_id:e.messageId,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:r,apple_critical_alert_options:e.appleCriticalAlertOptions}))})||this}return g(n,t),n}(He),Vs=function(t){function n(e,r,i){var s,o,a,u,c,l=this;(l=t.call(this,e,"FEDI",i)||this).message=new ge(e,i);var d=S.of(e).sdkState;return l.mentionCountChange=Ji({mentionType:(s=i.old_values)===null||s===void 0?void 0:s.mention_type,mentionedUserIds:(a=(o=i.old_values)===null||o===void 0?void 0:o.mentioned_user_ids)!==null&&a!==void 0?a:[]},H({mentionType:l.message.mentionType,mentionedUserIds:(u=l.message.mentionedUserIds)!==null&&u!==void 0?u:(c=l.message.mentionedUsers)===null||c===void 0?void 0:c.map(function(p){return p.userId})}),d.userId),l}return g(n,t),n}(de),Tf=function(t){function n(e){var r=t.call(this)||this;return r.method=k.DELETE,r.path="".concat(J(e.channelType),"/").concat(e.channelUrl,"/messages/").concat(e.messageId),r}return g(n,t),n}(R);(function(t){function n(){return t!==null&&t.apply(this,arguments)||this}g(n,t)})(M);var Cf=function(t){function n(e,r,i){var s,o=this;return(o=t.call(this,e,"DELM",i)||this).channelUrl=i.channel_url,o.channelType=i.channel_type,o.messageId=Number(i.msg_id),o.silent=i.silent,o.messageCreatedAt=i.message_created_at?Number(i.message_created_at):-1,o.senderId=(s=i.sender_id)!==null&&s!==void 0?s:void 0,o}return g(n,t),n}(de),Sf=function(t){function n(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.reactionKey,a=t.call(this)||this;return a.method=k.POST,a.path="".concat(J(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/reactions"),a.params={reaction:o},a}return g(n,t),n}(R),Af=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.reactionEvent=new xs(r),i}return g(n,t),n}(M),Nf=function(t){function n(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.reactionKey,a=t.call(this)||this;return a.method=k.DELETE,a.path="".concat(J(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/reactions"),a.params={reaction:o},a}return g(n,t),n}(R),Of=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.reactionEvent=new xs(b({},r)),i}return g(n,t),n}(M),kf=function(t){function n(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.translationTargetLanguages,a=t.call(this)||this;return a.method=k.POST,a.path="".concat(J(r),"/").concat(encodeURIComponent(i),"/messages/").concat(encodeURIComponent(s),"/translation"),a.params={target_langs:o},a}return g(n,t),n}(R),Rf=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.message=new $e(e,r),i}return g(n,t),n}(M),Df=function(t){function n(e){var r,i=this;i=t.call(this)||this;var s=[];e.mentionType===xe.USERS&&(e.mentionedUserIds?s=e.mentionedUserIds:e.mentionedUsers&&(s=e.mentionedUsers.map(function(u){return u.userId})));var o=e.channelType,a=e.channelUrl;return i.method=k.POST,i.path="".concat(J(o),"/").concat(encodeURIComponent(a),"/scheduled_messages"),i.params=x(H({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:zr.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:s,sorted_metaarray:(r=e.metaArrays)===null||r===void 0?void 0:r.map(function(u){return et.payloadify(u)}),apple_critical_alert_options:e.appleCriticalAlertOptions?Et.payloadify(e.appleCriticalAlertOptions):null,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption})),i}return g(n,t),n}(R),Uf=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.message=new $e(e,r),i}return g(n,t),n}(M),Mf=function(t){function n(e){var r,i,s=this;s=t.call(this)||this;var o=[];e.mentionType===xe.USERS&&(e.mentionedUserIds?o=e.mentionedUserIds:e.mentionedUsers&&(o=e.mentionedUsers.map(function(c){return c.userId})));var a=e.channelType,u=e.channelUrl;return s.method=k.POST,s.path="".concat(J(a),"/").concat(encodeURIComponent(u),"/scheduled_messages"),s.params=H({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:zr.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:(r=e._thumbnails)===null||r===void 0?void 0:r.map(function(c){return Bt.payloadify(c)}),custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:o,sorted_metaarray:(i=e.metaArrays)===null||i===void 0?void 0:i.map(function(c){return et.payloadify(c)}),apple_critical_alert_options:e.appleCriticalAlertOptions?Et.payloadify(e.appleCriticalAlertOptions):null,push_option:e.pushNotificationDeliveryOption}),s}return g(n,t),n}(R),Lf=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.message=new ge(e,r),i}return g(n,t),n}(M),Pf=function(t){function n(e){var r=e.pollId,i=e.title,s=e.data,o=e.allowUserSuggestion,a=e.allowMultipleVotes,u=e.closeAt,c=t.call(this)||this;return c.method=k.PUT,c.path="".concat(dt,"/").concat(encodeURIComponent(r)),c.params={title:i,data:s,allow_user_suggestion:o,allow_multiple_votes:a,close_at:u},c}return g(n,t),n}(R),xf=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.poll=new at(e,r),i}return g(n,t),n}(M),Ff=function(t){function n(e){var r=e.pollId,i=t.call(this)||this;return i.method=k.DELETE,i.path="".concat(dt,"/").concat(encodeURIComponent(r)),i}return g(n,t),n}(R);(function(t){function n(){return t!==null&&t.apply(this,arguments)||this}g(n,t)})(M);var qf=function(t){function n(e){var r=e.pollId,i=t.call(this)||this;return i.method=k.PUT,i.path="".concat(dt,"/").concat(encodeURIComponent(r),"/close"),i}return g(n,t),n}(R),zf=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.poll=new at(e,r),i}return g(n,t),n}(M),Hf=function(t){function n(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,o=e.optionText,a=t.call(this)||this;return a.method=k.POST,a.path="".concat(dt,"/").concat(encodeURIComponent(s),"/options"),a.params={channel_url:r,channel_type:i,text:o},a}return g(n,t),n}(R),$f=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.poll=new at(e,r),i}return g(n,t),n}(M),jf=function(t){function n(e){var r=e.pollId,i=e.pollOptionId,s=e.optionText,o=t.call(this)||this;return o.method=k.PUT,o.path="".concat(dt,"/").concat(encodeURIComponent(r),"/options/").concat(encodeURIComponent(i)),o.params={text:s},o}return g(n,t),n}(R),Bf=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.poll=new at(e,r),i}return g(n,t),n}(M),Gf=function(t){function n(e){var r=e.pollId,i=e.pollOptionId,s=t.call(this)||this;return s.method=k.DELETE,s.path="".concat(dt,"/").concat(encodeURIComponent(r),"/options/").concat(encodeURIComponent(i)),s}return g(n,t),n}(R);(function(t){function n(){return t!==null&&t.apply(this,arguments)||this}g(n,t)})(M);var Vf=function(t){function n(e){var r=e.reqId,i=e.channelType,s=e.channelUrl,o=e.pollId,a=e.pollOptionIds;return t.call(this,{code:"VOTE",ackRequired:!0,payload:x({req_id:r,channel_type:i===W.OPEN?"open_channels":"group_channels",channel_url:s,poll_id:o,option_ids:a})})||this}return g(n,t),n}(He),ju=function(t){function n(e,r,i){var s=t.call(this,e,"VOTE",i)||this;return s.event=new Qd(i),s.channelUrl=i.channel_url,s.channelType=i.channel_type,s}return g(n,t),n}(de),Kf="GroupChannel",Qf="url",Ks="Message",Wf="messageId",Bu="NotificationMessage",Yf="notificationId",Zf="Poll",Xf="pollId",Jf="FeedChannel",ep="url",Qe,tp=b(b({},gi),{fileInfoList:[]}),np=function(t){return(Ge(t.file)||T("string",t.fileUrl))&&T("string",t.fileName,!0)&&T("string",t.mimeType,!0)&&T("number",t.fileSize,!0)&&(t.thumbnailSizes===void 0||Array.isArray(t.thumbnailSizes)&&t.thumbnailSizes.every(function(n){return n.maxWidth>0&&n.maxHeight>0}))},rp=function(t){function n(){var e=t!==null&&t.apply(this,arguments)||this;return e._onFileUploaded=B,e}return g(n,t),n.prototype._triggerOnFileUploaded=function(e,r,i,s){this._onFileUploaded(e,r,i,s)},n.prototype.onFileUploaded=function(e){return this._onFileUploaded=e,this},n.prototype.onPending=function(e){return t.prototype.onPending.call(this,e),this},n.prototype.onFailed=function(e){return t.prototype.onFailed.call(this,e),this},n.prototype.onSucceeded=function(e){return t.prototype.onSucceeded.call(this,e),this},n}(mi);(function(t){t.SEND="send",t.RESEND="resend",t.COPY="copy"})(Qe||(Qe={}));var ae,Gu=function(t){function n(e,r){var i,s,o,a,u,c,l=this;return(l=t.call(this,e)||this)._name="",l._createdAt=0,l.channelType=W.BASE,l.coverUrl="",l.customType="",l.data="",l.isFrozen=!1,l.isEphemeral=!1,l.creator=null,l._messageCollectionLastAccessedAt=0,l._url=r.channel_url,l._name=(i=r.name)!==null&&i!==void 0?i:"",l._createdAt=1e3*r.created_at,l.coverUrl=(s=r.cover_url)!==null&&s!==void 0?s:"",l.customType=(o=r.custom_type)!==null&&o!==void 0?o:"",l.data=(a=r.data)!==null&&a!==void 0?a:"",l.isFrozen=(u=r.freeze)!==null&&u!==void 0&&u,l.isEphemeral=(c=r.is_ephemeral)!==null&&c!==void 0&&c,l.creator=r.created_by?new V(l._iid,r.created_by):null,r.metadata&&Object.keys(r.metadata).length>0&&r.ts&&(l._cachedMetaData=new Map,Object.keys(r.metadata).forEach(function(d){l._cachedMetaData.set(d,{value:r.metadata[d],isRemoved:!1,updatedAt:r.ts})})),l}return g(n,t),Object.defineProperty(n.prototype,"url",{get:function(){return this._url},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"createdAt",{get:function(){return this._createdAt},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return b(b({},this),{url:this._url,name:this._name,createdAt:this._createdAt})},n.payloadify=function(e){return x(H(b(b({},t.payloadify.call(this,e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:e.creator?V.payloadify(e.creator):null,created_at:e.createdAt/1e3})))},n.prototype.isGroupChannel=function(){return this.channelType===W.GROUP},n.prototype.isOpenChannel=function(){return this.channelType===W.OPEN},n.prototype.isFeedChannel=function(){return this.channelType===W.FEED},Object.defineProperty(n.prototype,"cachedMetaData",{get:function(){var e={};return this._cachedMetaData&&this._cachedMetaData.forEach(function(r,i){r.isRemoved||(e[i]=r.value)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"messageCollectionLastAccessedAt",{get:function(){return this._messageCollectionLastAccessedAt},enumerable:!1,configurable:!0}),n.prototype._updateMessageCollectionLastAccessedAt=function(){this._messageCollectionLastAccessedAt=Date.now()},n.prototype._update=function(e){var r=x(e);Object.assign(this,r)},n.prototype._upsertCachedMetaData=function(e,r){var i=this;Object.keys(e).forEach(function(s){i._cachedMetaData||(i._cachedMetaData=new Map);var o=i._cachedMetaData.get(s);(!o||o.updatedAt<=r)&&i._cachedMetaData.set(s,{value:e[s],isRemoved:!1,updatedAt:r})})},n.prototype._updateCachedMetaData=function(e,r){var i=this;this._cachedMetaData?this._cachedMetaData.forEach(function(s,o){var a;s.updatedAt<=r&&i._cachedMetaData.set(o,{value:(a=e[o])!==null&&a!==void 0?a:s.value,isRemoved:!e[o],updatedAt:r})}):(this._cachedMetaData=new Map,Object.keys(e).forEach(function(s){i._cachedMetaData.set(s,{value:e[s],isRemoved:!1,updatedAt:r})}))},n.prototype._removeFromCachedMetaData=function(e,r){var i=this;this._cachedMetaData&&e.forEach(function(s){var o=i._cachedMetaData.get(s);o&&o.updatedAt<r&&(o.isRemoved=!0,o.updatedAt=r)})},n.prototype._runIfHandleableWithGroupChannel=function(e){this.isGroupChannel()?e(this):this.isFeedChannel()&&e(this.groupChannel)},n.prototype._generateRequestId=function(){return"rq-".concat(Xt())},n.prototype.isIdentical=function(e){return e&&this.url===e.url},n.prototype.isEqual=function(e){return Po(this,e)},n.prototype.createOperatorListQuery=function(e){return e===void 0&&(e={}),new Fh(this._iid,this.url,this.channelType,e)},n.prototype.createMutedUserListQuery=function(e){return e===void 0&&(e={}),new $h(this._iid,this.url,this.channelType,e)},n.prototype.createBannedUserListQuery=function(e){return e===void 0&&(e={}),new Gh(this._iid,this.url,this.channelType,e)},n.prototype.createPreviousMessageListQuery=function(e){return e===void 0&&(e={}),new qh(this._iid,this.url,this.channelType,e)},n.prototype.addOperators=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){switch(s.label){case 0:return D(X("string",e)).throw(I.invalidParameters),r=S.of(this._iid).requestQueue,i=new Vh({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},n.prototype.removeOperators=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){switch(s.label){case 0:return D(X("string",e)).throw(I.invalidParameters),r=S.of(this._iid).requestQueue,i=new Kh({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},n.prototype.getMyMutedInfo=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c,l,d,p;return h(this,function(_){switch(_.label){case 0:return e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new Qh({channelUrl:this.url,channelType:this.channelType,userId:r.userId}),[4,i.send(s)];case 1:return o=_.sent(),a=o.as(Wh),u=a.isMuted,c=a.startAt,l=a.endAt,d=a.remainingDuration,p=a.description,[2,{isMuted:u,startAt:c,endAt:l,remainingDuration:d,description:p}]}})})},n.prototype.getMetaData=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return D(X("string",e)).throw(I.invalidParameters),r=S.of(this._iid).requestQueue,i=new Lu({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,r.send(i)];case 1:return s=c.sent(),o=s.as(Pu),a=o.metadata,u=o.ts,this._upsertCachedMetaData(a,u),[2,a]}})})},n.prototype.getAllMetaData=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return e=S.of(this._iid).requestQueue,r=new Lu({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(r)];case 1:return i=u.sent(),s=i.as(Pu),o=s.metadata,a=s.ts,this._updateCachedMetaData(o,a),[2,o]}})})},n.prototype.createMetaData=function(e){return f(this,void 0,void 0,function(){var r,i,s,o;return h(this,function(a){switch(a.label){case 0:return r=S.of(this._iid).requestQueue,i=new Yh({channelUrl:this.url,channelType:this.channelType,metadata:e}),[4,r.send(i)];case 1:return s=a.sent(),o=s.as(Zh).metaData,this._upsertCachedMetaData(o,0),[2,o]}})})},n.prototype.updateMetaData=function(e,r){return r===void 0&&(r=!1),f(this,void 0,void 0,function(){var i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return i=S.of(this._iid).requestQueue,s=new Xh({channelUrl:this.url,channelType:this.channelType,metadata:e,upsert:r}),[4,i.send(s)];case 1:return o=l.sent(),a=o.as(Jh),u=a.metadata,c=a.ts,this._upsertCachedMetaData(u,c),[2,u]}})})},n.prototype.deleteMetaData=function(e){return f(this,void 0,void 0,function(){var r,i,s,o;return h(this,function(a){switch(a.label){case 0:return D(T("string",e)).throw(I.invalidParameters),r=S.of(this._iid).requestQueue,i=new tf({channelUrl:this.url,channelType:this.channelType,key:e}),[4,r.send(i)];case 1:return s=a.sent(),o=s.as(nf).ts,this._removeFromCachedMetaData([e],o),[2]}})})},n.prototype.deleteAllMetaData=function(){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return e=S.of(this._iid).requestQueue,r=new rf({channelUrl:this.url,channelType:this.channelType}),[4,e.send(r)];case 1:return i=o.sent(),s=i.as(sf).ts,this._removeFromCachedMetaData(Z([],G(this._cachedMetaData.keys()),!1),s),[2]}})})},n.prototype.getMetaCounters=function(e){return f(this,void 0,void 0,function(){var r,i,s;return h(this,function(o){switch(o.label){case 0:return D(X("string",e)).throw(I.invalidParameters),r=S.of(this._iid).requestQueue,i=new xu({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(Fu).metaCounter]}})})},n.prototype.getAllMetaCounters=function(){return f(this,void 0,void 0,function(){var e,r,i;return h(this,function(s){switch(s.label){case 0:return e=S.of(this._iid).requestQueue,r=new xu({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(r)];case 1:return i=s.sent(),[2,i.as(Fu).metaCounter]}})})},n.prototype.createMetaCounters=function(e){return f(this,void 0,void 0,function(){var r,i,s;return h(this,function(o){switch(o.label){case 0:return r=S.of(this._iid).requestQueue,i=new of({channelUrl:this.url,channelType:this.channelType,metaCounter:e}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(af).metaCounter]}})})},n.prototype.updateMetaCounters=function(e,r){return r===void 0&&(r=!1),f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){switch(a.label){case 0:return i=S.of(this._iid).requestQueue,s=new js({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:r}),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(Bs).metaCounter]}})})},n.prototype.increaseMetaCounters=function(e){return f(this,void 0,void 0,function(){var r,i,s;return h(this,function(o){switch(o.label){case 0:return r=S.of(this._iid).requestQueue,i=new js({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"increase"}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(Bs).metaCounter]}})})},n.prototype.decreaseMetaCounters=function(e){return f(this,void 0,void 0,function(){var r,i,s;return h(this,function(o){switch(o.label){case 0:return r=S.of(this._iid).requestQueue,i=new js({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"decrease"}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(Bs).metaCounter]}})})},n.prototype.deleteMetaCounter=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){switch(s.label){case 0:return D(T("string",e)).throw(I.invalidParameters),r=S.of(this._iid).requestQueue,i=new cf({channelUrl:this.url,channelType:this.channelType,key:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},n.prototype.deleteAllMetaCounters=function(){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return e=S.of(this._iid).requestQueue,r=new lf({channelUrl:this.url,channelType:this.channelType}),[4,e.send(r)];case 1:return i.sent(),[2]}})})},n.prototype.muteUser=function(e,r,i){return f(this,void 0,void 0,function(){return h(this,function(s){return[2,this.muteUserWithUserId(e.userId,r,i)]})})},n.prototype.muteUserWithUserId=function(e,r,i){return f(this,void 0,void 0,function(){var s,o;return h(this,function(a){switch(a.label){case 0:return D(T("string",e)&&T("number",r,!0)&&T("string",i,!0)).throw(I.invalidParameters),s=S.of(this._iid).requestQueue,o=new df({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:r,description:i}),[4,s.send(o)];case 1:return a.sent(),[2]}})})},n.prototype.unmuteUser=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2,this.unmuteUserWithUserId(e.userId)]})})},n.prototype.unmuteUserWithUserId=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){switch(s.label){case 0:return D(T("string",e)).throw(I.invalidParameters),r=S.of(this._iid).requestQueue,i=new ff({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},n.prototype.banUser=function(e,r,i){return f(this,void 0,void 0,function(){return h(this,function(s){return[2,this.banUserWithUserId(e.userId,r,i)]})})},n.prototype.banUserWithUserId=function(e,r,i){return f(this,void 0,void 0,function(){var s,o;return h(this,function(a){switch(a.label){case 0:return D(T("string",e)&&T("number",r,!0)&&T("string",i,!0)).throw(I.invalidParameters),s=S.of(this._iid).requestQueue,o=new _f({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:r,description:i}),[4,s.send(o)];case 1:return a.sent(),[2]}})})},n.prototype.unbanUser=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2,this.unbanUserWithUserId(e.userId)]})})},n.prototype.unbanUserWithUserId=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){switch(s.label){case 0:return D(T("string",e)).throw(I.invalidParameters),r=S.of(this._iid).requestQueue,i=new mf({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},n.prototype.freeze=function(){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return e=S.of(this._iid).requestQueue,r=new qu({channelUrl:this.url,channelType:this.channelType,freezing:!0}),[4,e.send(r)];case 1:return i.sent(),this.isFrozen=!0,[2]}})})},n.prototype.unfreeze=function(){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return e=S.of(this._iid).requestQueue,r=new qu({channelUrl:this.url,channelType:this.channelType,freezing:!1}),[4,e.send(r)];case 1:return i.sent(),this.isFrozen=!1,[2]}})})},n.prototype.getMessagesByMessageId=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=b(b({},br),r),D(T("number",e)&&Iu(i)).throw(I.invalidParameters),[4,Se.of(this._iid).getMessagesByMessageId(this.url,this.channelType,e,i)];case 1:return[2,s.sent()]}})})},n.prototype.getMessagesByTimestamp=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=b(b({},br),r),D(T("number",e)&&Iu(i)).throw(I.invalidParameters),[4,Se.of(this._iid).getMessagesByTimestamp(this.url,this.channelType,e,i)];case 1:return[2,s.sent()]}})})},n.prototype.getMessageChangeLogsSinceTimestamp=function(e,r){return r===void 0&&(r={}),f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=b(b({},zs),r),D(T("number",e)&&Tu(i)).throw(I.invalidParameters),[4,Se.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,i)];case 1:return[2,s.sent()]}})})},n.prototype.getMessageChangeLogsSinceToken=function(e,r){return r===void 0&&(r={}),f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=b(b({},zs),r),D(T("string",e)&&Tu(i)).throw(I.invalidParameters),[4,Se.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,i)];case 1:return[2,s.sent()]}})})},n.prototype._createPendingSendableMessagePayload=function(e,r,i){var s,o=S.of(this._iid).sessionManager;return x(H({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,sorted_metaarray:e.metaArrays?e.metaArrays.map(function(a){return et.payloadify(a)}):null,apple_critical_alert_options:e.appleCriticalAlertOptions?Et.payloadify(e.appleCriticalAlertOptions):null,created_at:i,user:o.currentUser?xn.payloadify(o.currentUser):null,req_id:r,request_state:ce.PENDING,mentioned_user_ids:e.mentionedUserIds,mentioned_users:(s=e.mentionedUsers)===null||s===void 0?void 0:s.map(function(a){return V.payloadify(a)})}))},n.prototype._createPendingUserMessage=function(e,r,i){var s,o,a={};if(e.translationTargetLanguages)try{for(var u=$(e.translationTargetLanguages),c=u.next();!c.done;c=u.next())a[c.value]=""}catch(p){s={error:p}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(s)throw s.error}}var l=x(b(b({},this._createPendingSendableMessagePayload(e,r,i)),{type:he.USER,message:e.message,translations:a,extended_message_payload:e.extendedMessagePayload})),d=new $e(this._iid,l);return d.messageParams=e,d},n.prototype._createPendingScheduledUserMessage=function(e,r,i){var s=this._createPendingUserMessage(e,r,i);return s.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},s},n.prototype._createPendingFileMessage=function(e,r,i){var s,o,a,u,c,l,d,p=x(b(b({},this._createPendingSendableMessagePayload(e,r,i)),{type:he.FILE,url:e.fileUrl,file:{name:(s=e.fileName)!==null&&s!==void 0?s:(o=e.file)===null||o===void 0?void 0:o.name,size:(a=e.fileSize)!==null&&a!==void 0?a:(u=e.file)===null||u===void 0?void 0:u.size,type:(c=e.mimeType)!==null&&c!==void 0?c:(l=e.file)===null||l===void 0?void 0:l.type,data:e.data},thumbnails:(d=e._thumbnails)===null||d===void 0?void 0:d.map(function(v){return Bt.payloadify(v)})})),_=new ge(this._iid,p);return _.messageParams=e,_},n.prototype._createPendingMultipleFilesMessage=function(e,r,i){var s=x(b(b({},this._createPendingSendableMessagePayload(e,r,i)),{type:he.FILE})),o=new ut(this._iid,s);return o.messageParams=e,o},n.prototype._validateFailedFileMessageHasFile=function(e,r){var i;return!!e.url||Ge(r)||Ge((i=e.messageParams)===null||i===void 0?void 0:i.file)},n.prototype._createPendingScheduledFileMessage=function(e,r,i){var s=this._createPendingFileMessage(e,r,i);return s.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},s},n.prototype._markMessageAsFailed=function(e,r,i){i===void 0&&(i=!1),e.errorCode=r.code,r.code===z.REQUEST_CANCELED||r.code===z.FILE_UPLOAD_CANCEL_FAILED?e.sendingStatus=ce.CANCELED:i||(e.sendingStatus=ce.FAILED)},n.prototype.sendUserMessage=function(e){var r=b(b({},Au),e);return D(Rh(r)).throw(I.invalidParameters),this._sendUserMessage(r)},n.prototype._sendUserMessage=function(e,r,i){var s=this;r===void 0&&(r=Qe.SEND);var o=S.of(this._iid),a=o.dispatcher,u=o.requestQueue,c=i??this._generateRequestId(),l=Date.now(),d=new mi;return ot(2).then(function(){var p=s._createPendingUserMessage(e,c,l);a.dispatch(new _e({messages:[p],source:r===Qe.RESEND?ne.LOCAL_MESSAGE_RESEND_STARTED:ne.EVENT_MESSAGE_SENT_PENDING})),Q(function(){return f(s,void 0,void 0,function(){return h(this,function(v){return[2,d._trigger(p)]})})});var _=new If(b(b({},e),{channelUrl:s.url,channelType:s.channelType,reqId:c}));u.send(_).then(function(v){var m=v.as(zu).message;a.dispatch(new _e({messages:[m],source:ne.EVENT_MESSAGE_SENT_SUCCESS})),Q(function(){return f(s,void 0,void 0,function(){return h(this,function(y){return[2,d._trigger(m)]})})})}).catch(function(v){if(rt(v))throw v;ot(2).then(function(){var m=s._createPendingUserMessage(e,c,l),y=S.of(s._iid).cacheContext,E=y.localCacheEnabled&&y.localCacheConfig.enableAutoResend&&xr(v.code);s._markMessageAsFailed(m,v,E),a.dispatch(new _e({messages:[m],source:m.sendingStatus===ce.PENDING?ne.REQUEST_RESEND_MESSAGE:ne.EVENT_MESSAGE_SENT_FAILED})),Q(function(){return f(s,void 0,void 0,function(){return h(this,function(w){return[2,d._triggerFailed(v,m)]})})})})})}),d},n.prototype._autoResendUserMessage=function(e){return D(e instanceof $e&&!!e.messageParams).throw(I.invalidParameters),this._sendUserMessage(e.messageParams,Qe.SEND,e.reqId)},n.prototype.resendUserMessage=function(e){var r;return f(this,void 0,void 0,function(){var i,s;return h(this,function(o){return D(e instanceof $e&&!e.scheduledInfo).throw(I.invalidParameters),i=new Ae,s=(r=e.messageParams)!==null&&r!==void 0?r:Nu(e),this._sendUserMessage(s,Qe.RESEND,e.reqId).onFailed(function(a){return i.reject(a)}).onSucceeded(function(a){return i.resolve(a)}),[2,i.promise]})})},n.prototype.updateUserMessage=function(e,r){return f(this,void 0,void 0,function(){var i,s,o,a;return h(this,function(u){switch(u.label){case 0:return i=b(b({},Uh),r),D(T("number",e)&&Mh(i)).throw(I.invalidParameters),s=S.of(this._iid).requestQueue,o=new Hu(b({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:i.metaArrays?{array:i.metaArrays,mode:"add",upsert:!0}:void 0},i)),[4,s.send(o)];case 1:return a=u.sent(),[2,a.as(Gs).message]}})})},n.prototype.copyUserMessage=function(e,r){var i,s,o;return f(this,void 0,void 0,function(){var a,u;return h(this,function(c){return D(e instanceof n&&r instanceof $e&&r.sendingStatus===ce.SUCCEEDED&&this.url===r.channelUrl&&!r.scheduledInfo).throw(I.invalidParameters),D(!r.poll).throw(I.notSupportedError),a=new Ae,u=(i=r.messageParams)!==null&&i!==void 0?i:H(b(b({},r),{mentionType:r.mentionType,mentionedUserIds:(s=r.mentionedUserIds)!==null&&s!==void 0?s:(o=r.mentionedUsers)===null||o===void 0?void 0:o.map(function(l){return l.userId}),translationTargetLanguages:Object.keys(r.translations),pushNotificationDeliveryOption:pt.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1})),e._sendUserMessage(u).onSucceeded(function(l){a.resolve(l)}).onFailed(function(l){return a.reject(l)}),[2,a.promise]})})},n.prototype.translateUserMessage=function(e,r){return f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){switch(a.label){case 0:return D(e instanceof $e&&e.messageId>0&&X("string",r)).throw(I.invalidParameters),i=S.of(this._iid).requestQueue,s=new kf({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,translationTargetLanguages:r}),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(Rf).message]}})})},n.prototype._createScheduledUserMessage=function(e,r){var i=this,s=S.of(this._iid).requestQueue,o=Date.now(),a=this._generateRequestId();ot(2).then(function(){var c=i._createPendingScheduledUserMessage(e,a,o);Q(function(){return f(i,void 0,void 0,function(){return h(this,function(l){return[2,r._trigger(c)]})})})});var u=new Df(b({reqId:a,channelType:this.channelType,channelUrl:this.url},e));s.send(u).then(function(c){var l=c.as(Uf).message;Q(function(){return f(i,void 0,void 0,function(){return h(this,function(d){return[2,r._trigger(l)]})})})}).catch(function(c){if(rt(c))throw c;ot(2).then(function(){var l=i._createPendingScheduledUserMessage(e,a,o);i._markMessageAsFailed(l,c),Q(function(){return f(i,void 0,void 0,function(){return h(this,function(d){return[2,r._triggerFailed(c,l)]})})})})})},n.prototype.sendFileMessage=function(e){var r=b(b({},ku),e);return D(Du(r)).throw(I.invalidParameters),this._sendFileMessage(r)},n.prototype.sendMultipleFilesMessage=function(e){var r,i=b(b({},tp),e),s=S.of(this._iid);D(function(a,u){return u===void 0&&(u=Sd),Hs(a)&&Array.isArray(a.fileInfoList)&&a.fileInfoList.length>=2&&a.fileInfoList.length<=u&&a.fileInfoList.every(function(c){return np(c)})}(i,(r=s.appInfo)===null||r===void 0?void 0:r.multipleFilesMessageFileCountLimit)).throw(I.invalidParameters);var o=!!e.fileInfoList.find(function(a){var u=s.appInfo.uploadSizeLimit;return a.file instanceof Blob&&a.file.size>u||a.fileSize>u});return D(!o).throw(I.fileSizeLimitExceededError),this._sendMultipleFilesMessage(i)},n.prototype._sendFileMessage=function(e,r,i){var s=this;r===void 0&&(r=Qe.SEND);var o=S.of(this._iid).dispatcher,a=Se.of(this._iid).fileMessageQueue,u=i??this._generateRequestId(),c=Date.now(),l=new mi;return ot(2).then(function(){var d=s._createPendingFileMessage(e,u,c);o.dispatch(new _e({messages:[d],source:r===Qe.RESEND?ne.LOCAL_MESSAGE_RESEND_STARTED:ne.EVENT_MESSAGE_SENT_PENDING})),Q(function(){return f(s,void 0,void 0,function(){return h(this,function(p){return[2,l._trigger(d)]})})}),a.request(s,u,e).then(function(p){o.dispatch(new _e({messages:[p],source:ne.EVENT_MESSAGE_SENT_SUCCESS})),Q(function(){return f(s,void 0,void 0,function(){return h(this,function(_){return[2,l._trigger(p)]})})})}).catch(function(p){if(rt(p))throw p;ot(2).then(function(){var _=s._createPendingFileMessage(e,u,c),v=S.of(s._iid).cacheContext,m=v.localCacheEnabled&&v.localCacheConfig.enableAutoResend&&xr(p.code);s._markMessageAsFailed(_,p,m),o.dispatch(new _e({messages:[_],source:_.sendingStatus===ce.PENDING?ne.REQUEST_RESEND_MESSAGE:p.code===z.FILE_UPLOAD_CANCEL_FAILED?ne.LOCAL_MESSAGE_CANCELED:ne.EVENT_MESSAGE_SENT_FAILED})),Q(function(){return f(s,void 0,void 0,function(){return h(this,function(y){return[2,l._triggerFailed(p,_)]})})})})})}),l},n.prototype._autoResendFileMessage=function(e){D(e instanceof ge&&!!e.messageParams).throw(I.invalidParameters);var r=S.of(this._iid).logger;return r.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,Qe.SEND,e.reqId).onFailed(function(i){r.debug("autoResendFileMessage failed",i)}).onSucceeded(function(i){r.debug("autoResendFileMessage success",i)})},n.prototype._sendMultipleFilesMessage=function(e,r,i){var s=this,o=S.of(this._iid).dispatcher,a=Se.of(this._iid).fileMessageQueue,u=i??this._generateRequestId(),c=Date.now(),l=new rp;return ot(2).then(function(){var d=s._createPendingMultipleFilesMessage(e,u,c);o.dispatch(new _e({messages:[d],source:r===Qe.RESEND?ne.LOCAL_MESSAGE_RESEND_STARTED:ne.EVENT_MESSAGE_SENT_PENDING})),Q(function(){return f(s,void 0,void 0,function(){return h(this,function(p){return[2,l._trigger(d)]})})}),a.request(s,u,e,{requestHandler:l,isCopy:r===Qe.COPY}).then(function(p){o.dispatch(new _e({messages:[p],source:ne.EVENT_MESSAGE_SENT_SUCCESS})),Q(function(){return f(s,void 0,void 0,function(){return h(this,function(_){return[2,l._trigger(p)]})})})}).catch(function(p){if(rt(p))throw p;ot(2).then(function(){var _=s._createPendingMultipleFilesMessage(e,u,c);s._markMessageAsFailed(_,p),o.dispatch(new _e({messages:[_],source:ne.EVENT_MESSAGE_SENT_FAILED})),Q(function(){return f(s,void 0,void 0,function(){return h(this,function(v){return[2,l._triggerFailed(p,_)]})})})})})}),l},n.prototype._createScheduledFileMessage=function(e,r,i,s){var o=this,a=S.of(this._iid).requestQueue,u=new Mf(b(b({reqId:i,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));a.send(u).then(function(c){var l=c.as(Lf).message;Q(function(){return f(o,void 0,void 0,function(){return h(this,function(d){return[2,r._trigger(l)]})})})}).catch(function(c){if(rt(c))throw c;ot(2).then(function(){var l=o._createPendingScheduledFileMessage(e,i,s);o._markMessageAsFailed(l,c),Q(function(){return f(o,void 0,void 0,function(){return h(this,function(d){return[2,r._triggerFailed(c,l)]})})})})})},n.prototype.sendFileMessages=function(e){var r,i;D(e.every(function(c){return Du(b(b({},ku),c))})).throw(I.invalidParameters);var s=new mi;try{for(var o=$(e),a=o.next();!a.done;a=o.next()){var u=a.value;this.sendFileMessage(u).onPending(function(c){return s._trigger(c)}).onFailed(function(c,l){return s._triggerFailed(c,l)}).onSucceeded(function(c){return s._trigger(c)})}}catch(c){r={error:c}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s},n.prototype.resendFileMessage=function(e,r){return f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){return i=this._validateFailedFileMessageHasFile(e,r),D(e instanceof ge&&i&&!e.scheduledInfo).throw(I.invalidParameters),s=new Ae,o=Ru(e,r),this._sendFileMessage(o,Qe.RESEND,e.reqId).onFailed(function(u){return s.reject(u)}).onSucceeded(function(u){return s.resolve(u)}),[2,s.promise]})})},n.prototype.resendMessage=function(e,r){var i,s;if(D(e instanceof kt&&!e.scheduledInfo&&e.isResendable).throw(I.invalidParameters),e.isUserMessage()){var o=(i=e.messageParams)!==null&&i!==void 0?i:Nu(e);return this._sendUserMessage(o,Qe.RESEND,e.reqId)}if(e.isFileMessage()){var a=this._validateFailedFileMessageHasFile(e,r);return D(a).throw(I.invalidParameters),o=(s=e.messageParams)!==null&&s!==void 0?s:Ru(e,r),this._sendFileMessage(o,Qe.RESEND,e.reqId)}if(e.isMultipleFilesMessage())throw I.channelTypeNotSupportedError},n.prototype.updateFileMessage=function(e,r){return f(this,void 0,void 0,function(){var i,s,o,a;return h(this,function(u){switch(u.label){case 0:return i=b(b({},Lh),r),D(T("number",e)&&function(c){return Mu(c)}(i)).throw(I.invalidParameters),s=S.of(this._iid).requestQueue,o=new $u(b({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:i.metaArrays?{array:i.metaArrays,mode:"add",upsert:!0}:void 0},i)),[4,s.send(o)];case 1:return a=u.sent(),[2,a.as(Vs).message]}})})},n.prototype.uploadFile=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return r=S.of(this._iid).requestQueue,i=Xt(),(s=new Ms({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:i})).uploadProgressHandler=e.progressHandler,e.uploadStartedHandler&&e.uploadStartedHandler(i),[4,r.send(s)];case 1:return o=l.sent(),a=o.as(Ls),u=a.url,c=a.thumbnails,[2,{requestId:i,url:u,thumbnails:c}]}})})},n.prototype.cancelUploadingFileMessage=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return D(T("string",e)).throw(I.invalidParameters),Se.of(this._iid).fileMessageQueue.cancel(this,e),[2,!0]})})},n.prototype.copyFileMessage=function(e,r){var i,s,o;return f(this,void 0,void 0,function(){var a,u;return h(this,function(c){return D(e instanceof n&&r instanceof ge&&r.sendingStatus===ce.SUCCEEDED&&this.url===r.channelUrl&&!r.scheduledInfo).throw(I.invalidParameters),a=new Ae,u=H(b(b({},r),{fileUrl:r.url,fileName:r.name,fileSize:r.size,mimeType:r.type,mentionType:r.mentionType,mentionedUserIds:(i=r.mentionedUserIds)!==null&&i!==void 0?i:(s=r.mentionedUsers)===null||s===void 0?void 0:s.map(function(l){return l.userId}),pushNotificationDeliveryOption:pt.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:(o=r.thumbnails)===null||o===void 0?void 0:o.map(function(l){return{maxWidth:l.width,maxHeight:l.height}}),requireAuth:r.requireAuth,isPinnedMessage:!1})),e._sendFileMessage(u).onSucceeded(function(l){return a.resolve(l)}).onFailed(function(l){return a.reject(l)}),[2,a.promise]})})},n.prototype.copyMessage=function(e,r){D(e instanceof n&&r instanceof kt&&r.sendingStatus===ce.SUCCEEDED&&this.url===r.channelUrl&&!r.scheduledInfo).throw(I.invalidParameters);var i=r,s=e;if(i.isUserMessage()){D(!i.poll).throw(I.notSupportedError);var o=kh(i);return s._sendUserMessage(o)}if(i.isFileMessage())return o=Dh(i),s._sendFileMessage(o);if(r.isMultipleFilesMessage())throw I.channelTypeNotSupportedError},n.prototype.deleteMessage=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){switch(s.label){case 0:return D(e instanceof tt).throw(I.invalidParameters),e.messageId>0?(r=S.of(this._iid).requestQueue,i=new Tf({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId}),[4,r.send(i)]):[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})},n.prototype.addReaction=function(e,r){return f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){switch(a.label){case 0:return D(e instanceof tt&&e.messageId>0&&T("string",r)).throw(I.invalidParameters),i=S.of(this._iid).requestQueue,s=new Sf({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:r}),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(Af).reactionEvent]}})})},n.prototype.deleteReaction=function(e,r){return f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){switch(a.label){case 0:return D(e instanceof tt&&e.messageId>0&&T("string",r)).throw(I.invalidParameters),i=S.of(this._iid).requestQueue,s=new Nf({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:r}),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(Of).reactionEvent]}})})},n.prototype._updateUserMessageMetaArray=function(e,r,i,s){return f(this,void 0,void 0,function(){var o,a,u,c,l,d;return h(this,function(p){switch(p.label){case 0:return o=S.of(this._iid),a=o.dispatcher,u=o.requestQueue,c=new Hu({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:r,mode:i,upsert:s}}),[4,u.send(c)];case 1:return l=p.sent(),d=l.as(Gs).message,a.dispatch(new _e({messages:[d],source:ne.EVENT_MESSAGE_UPDATED})),[2,d]}})})},n.prototype._updateFileMessageMetaArray=function(e,r,i,s){return f(this,void 0,void 0,function(){var o,a,u,c,l,d;return h(this,function(p){switch(p.label){case 0:return o=S.of(this._iid),a=o.dispatcher,u=o.requestQueue,c=new $u({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:r,mode:i,upsert:s}}),[4,u.send(c)];case 1:return l=p.sent(),d=l.as(Vs).message,a.dispatch(new _e({messages:[d],source:ne.EVENT_MESSAGE_UPDATED})),[2,d]}})})},n.prototype.createMessageMetaArrayKeys=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){return D(e instanceof tt&&e.messageId>0&&X("string",r)).throw(I.invalidParameters),i=r.map(function(o){return new et({key:o})}),e instanceof ge?[2,this._updateFileMessageMetaArray(e.messageId,i,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,i,"add",!0)]})})},n.prototype.deleteMessageMetaArrayKeys=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){return D(e instanceof tt&&e.messageId>0&&X("string",r)).throw(I.invalidParameters),i=r.map(function(o){return new et({key:o})}),e instanceof ge?[2,this._updateFileMessageMetaArray(e.messageId,i,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,i,"remove",!0)]})})},n.prototype.addMessageMetaArrayValues=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){return D(e instanceof tt&&e.messageId>0&&r.every(function(s){return s instanceof et})).throw(I.invalidParameters),e instanceof ge?[2,this._updateFileMessageMetaArray(e.messageId,r,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,r,"add",!0)]})})},n.prototype.removeMessageMetaArrayValues=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){return D(e instanceof tt&&e.messageId>0&&r.every(function(s){return s instanceof et})).throw(I.invalidParameters),e instanceof ge?[2,this._updateFileMessageMetaArray(e.messageId,r,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,r,"remove",!0)]})})},n.prototype.report=function(e,r){return f(this,void 0,void 0,function(){var i,s,o,a;return h(this,function(u){switch(u.label){case 0:return D(ue(Er,e)&&T("string",r)).throw(I.invalidParameters),i=S.of(this._iid),s=i.sdkState,o=i.requestQueue,a=new bf({channelUrl:this.url,channelType:this.channelType,userId:s.userId,category:e,description:r}),[4,o.send(a)];case 1:return u.sent(),[2]}})})},n.prototype.reportUser=function(e,r,i){return f(this,void 0,void 0,function(){var s,o,a,u;return h(this,function(c){switch(c.label){case 0:return D(e instanceof V&&ue(Er,r)&&T("string",i)).throw(I.invalidParameters),s=S.of(this._iid),o=s.sdkState,a=s.requestQueue,u=new Ef({channelUrl:this.url,channelType:this.channelType,userId:o.userId,offendingUserId:e.userId,category:r,description:i}),[4,a.send(u)];case 1:return c.sent(),[2]}})})},n.prototype.reportMessage=function(e,r,i){return f(this,void 0,void 0,function(){var s,o,a,u;return h(this,function(c){switch(c.label){case 0:return D(e instanceof kt&&ue(Er,r)&&T("string",i)).throw(I.invalidParameters),s=S.of(this._iid),o=s.sdkState,a=s.requestQueue,u=new wf({channelUrl:this.url,channelType:this.channelType,userId:o.userId,offendingUserId:e.sender.userId,messageId:e.messageId,category:r,description:i}),[4,a.send(u)];case 1:return c.sent(),[2]}})})},n.prototype.updatePoll=function(e,r){return f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){switch(a.label){case 0:return D(T("number",e)&&function(u){return T("string",u.title,!0)&&ru(u.data)&&T("boolean",u.allowUserSuggestion,!0)&&T("boolean",u.allowMultipleVotes,!0)&&T("number",u.closeAt,!0)}(r)).throw(I.invalidParameters),i=S.of(this._iid).requestQueue,s=new Pf(b({pollId:e},r)),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(xf).poll]}})})},n.prototype.deletePoll=function(e){return f(this,void 0,void 0,function(){var r,i,s;return h(this,function(o){switch(o.label){case 0:return r=T("number",e),D(r).throw(I.invalidParameters),i=S.of(this._iid).requestQueue,s=new Ff({pollId:e}),[4,i.send(s)];case 1:return o.sent(),[2]}})})},n.prototype.closePoll=function(e){return f(this,void 0,void 0,function(){var r,i,s,o;return h(this,function(a){switch(a.label){case 0:return r=T("number",e),D(r).throw(I.invalidParameters),i=S.of(this._iid).requestQueue,s=new qf({pollId:e}),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(zf).poll]}})})},n.prototype.addPollOption=function(e,r){return f(this,void 0,void 0,function(){var i,s,o,a;return h(this,function(u){switch(u.label){case 0:return i=T("number",e)&&T("string",r)&&r.trim()!=="",D(i).throw(I.invalidParameters),s=S.of(this._iid).requestQueue,o=new Hf({channelUrl:this.url,channelType:this.channelType,pollId:e,optionText:r}),[4,s.send(o)];case 1:return a=u.sent(),[2,a.as($f).poll]}})})},n.prototype.updatePollOption=function(e,r,i){return f(this,void 0,void 0,function(){var s,o,a,u;return h(this,function(c){switch(c.label){case 0:return s=T("number",e)&&T("number",r)&&T("string",i)&&i.trim()!=="",D(s).throw(I.invalidParameters),o=S.of(this._iid).requestQueue,a=new jf({pollId:e,pollOptionId:r,optionText:i}),[4,o.send(a)];case 1:return u=c.sent(),[2,u.as(Bf).poll]}})})},n.prototype.deletePollOption=function(e,r){return f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){switch(a.label){case 0:return i=T("number",e)&&T("number",r),D(i).throw(I.invalidParameters),s=S.of(this._iid).requestQueue,o=new Gf({pollId:e,pollOptionId:r}),[4,s.send(o)];case 1:return a.sent(),[2]}})})},n.prototype.votePoll=function(e,r){return f(this,void 0,void 0,function(){var i,s,o,a,u,c,l;return h(this,function(d){switch(d.label){case 0:return i=T("number",e)&&X("number",r),D(i).throw(I.invalidParameters),s=S.of(this._iid),o=s.requestQueue,a=s.dispatcher,u=new Vf({reqId:this._generateRequestId(),channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionIds:r}),[4,o.send(u)];case 1:return c=d.sent(),l=c.as(ju).event,a.dispatch(new Rs({event:l,source:ne.EVENT_POLL_VOTED})),[2,l]}})})},n.prototype.getPollChangeLogsSinceTimestamp=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return D(T("number",e)).throw(I.invalidParameters),[4,Us.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,r.sent()]}})})},n.prototype.getPollChangeLogsSinceToken=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return D(T("string",e,!0)),[4,Us.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,r.sent()]}})})},n.prototype.createPollListQuery=function(e){return e===void 0&&(e=10),new uu(this._iid,{channelUrl:this.url,channelType:this.channelType,limit:e})},n.prototype.createPollVoterListQuery=function(e,r,i){return i===void 0&&(i=20),new cu(this._iid,{channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionId:r,limit:i})},n}(qe),ip=function(t){function n(e){e===void 0&&(e={});var r=t.call(this)||this;return Object.keys(e).forEach(function(i){r.hasOwnProperty(i)&&(r[i]=e[i])}),r}return g(n,t),n}(function(){this.onConnected=B,this.onReconnectStarted=B,this.onReconnectSucceeded=B,this.onReconnectFailed=B,this.onDisconnected=B}),sp=function(t){function n(e){e===void 0&&(e={});var r=t.call(this)||this;return Object.keys(e).forEach(function(i){r.hasOwnProperty(i)&&(r[i]=e[i])}),r}return g(n,t),n}(function(){this.onSessionExpired=B,this.onSessionTokenRequired=function(t){return t(null)},this.onSessionError=B,this.onSessionRefreshed=B,this.onSessionClosed=B}),op=function(t){function n(e){e===void 0&&(e={});var r=t.call(this)||this;return Object.keys(e).forEach(function(i){r.hasOwnProperty(i)&&(r[i]=e[i])}),r}return g(n,t),n}(function(){this.onFriendsDiscovered=B,this.onTotalUnreadMessageCountChanged=B,this.onTotalUnreadMessageCountUpdated=B}),ap=function(t){function n(e){var r=e.limit,i=e.token,s=e.userIdsFilter,o=e.metaDataKeyFilter,a=e.metaDataValuesFilter,u=e.nicknameStartsWithFilter,c=t.call(this)||this;return c.method=k.GET,c.path=ee,c.params=x({limit:r,token:i,user_ids:s,metadatakey:o,metadatavalues_in:a,nickname_startswith:u}),c}return g(n,t),n}(R),up=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.users=r.users.map(function(s){return new V(e,s)}),i.next=r.next,i}return g(n,t),n}(M),cp=function(t){function n(e,r){var i,s,o,a=this;return(a=t.call(this,e,r)||this).userIdsFilter=null,a.metaDataKeyFilter=null,a.metaDataValuesFilter=null,a.nicknameStartsWithFilter=null,a.userIdsFilter=(i=r.userIdsFilter)!==null&&i!==void 0?i:null,a.metaDataKeyFilter=(s=r.metaDataKeyFilter)!==null&&s!==void 0?s:null,a.metaDataValuesFilter=(o=r.metaDataValuesFilter)!==null&&o!==void 0?o:null,a.nicknameStartsWithFilter=r.nicknameStartsWithFilter||null,a}return g(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&X("string",this.userIdsFilter,!0)&&T("string",this.metaDataKeyFilter,!0)&&X("string",this.metaDataValuesFilter,!0)&&T("string",this.nicknameStartsWithFilter,!0)},n.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid).requestQueue,r=new ap(H(b(b({},this),{token:this._token}))),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(up),o=s.users,a=s.next,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,o];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},n}(Ln),lp=function(t){function n(e){var r=e.userId,i=e.limit,s=e.token,o=e.userIdsFilter,a=t.call(this)||this;return a.method=k.GET,a.path="".concat(ee,"/").concat(r,"/block"),a.params=x({limit:i,token:s,user_ids:o}),a}return g(n,t),n}(R),dp=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.users=r.users.map(function(s){return new V(e,s)}),i.next=r.next,i}return g(n,t),n}(M),hp=function(t){function n(e,r){var i,s=this;return(s=t.call(this,e,r)||this).userIdsFilter=null,s.userIdsFilter=(i=r.userIdsFilter)!==null&&i!==void 0?i:null,s}return g(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&X("string",this.userIdsFilter,!0)},n.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new lp(H(b(b({},this),{userId:r.userId,token:this._token}))),[4,i.send(s)]):[3,2]:[3,5];case 1:return o=l.sent(),a=o.as(dp),u=a.users,c=a.next,this._token=c,this._hasNext=!!c,this._isLoading=!1,[2,u];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},n}(Ln),fp=function(t){function n(e){var r=e.userId,i=e.limit,s=e.token,o=t.call(this)||this;return o.method=k.GET,o.path="".concat(ee,"/").concat(encodeURIComponent(r),"/friends"),o.params={limit:i,token:s},o}return g(n,t),n}(R),pp=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.hasMore=r.has_more,i.users=r.users.map(function(s){return new V(e,s)}),i.next=r.next,i}return g(n,t),n}(M),_p=function(t){function n(){return t!==null&&t.apply(this,arguments)||this}return g(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)},n.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c,l;return h(this,function(d){switch(d.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new fp(b(b({},this),{userId:r.userId,token:this._token})),[4,i.send(s)]):[3,2]:[3,5];case 1:return o=d.sent(),a=o.as(pp),u=a.users,c=a.hasMore,l=a.next,this._token=l,this._hasNext=c,this._isLoading=!1,[2,u];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},n}(Ln),bi={},wr=function(){function t(n){var e=n.dbname,r=n.itemSizeLimit,i=r===void 0?1048576:r,s=n.cacheLimit,o=s===void 0?256:s,a=n.blockHashBase,u=a===void 0?2:a,c=n.blockHashMultiplier,l=c===void 0?10:c,d=n.blockHashConstant,p=d===void 0?11:d,_=n.transactionApplyDelay,v=_===void 0?200:_,m=n.disableLogger,y=m!==void 0&&m;return bi[e]||(this.itemSizeLimit=i,this.cacheLimit=o,this.blockHashBase=u,this.blockHashMultiplier=l,this.blockHashConstant=p,this.transactionApplyDelay=v,this.disableLogger=y,bi[e]=this),bi[e]}return t.get=function(n){return bi[n]},t}();(function(t){t[t.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",t[t.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",t[t.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",t[t.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",t[t.STORE_IS_FULL=61001003]="STORE_IS_FULL",t[t.STORE_NOT_INITIALIZED=61001004]="STORE_NOT_INITIALIZED",t[t.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",t[t.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",t[t.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",t[t.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",t[t.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",t[t.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",t[t.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",t[t.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",t[t.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",t[t.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",t[t.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",t[t.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",t[t.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",t[t.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",t[t.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",t[t.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",t[t.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",t[t.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",t[t.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",t[t.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND"})(ae||(ae={}));var pn,Y=function(t){function n(e){var r=e.code,i=r===void 0?ae.UNKNOWN_ERROR:r,s=e.message,o=s===void 0?"Unknown error occurred.":s,a=t.call(this,o)||this;return a.code=i,Object.setPrototypeOf(a,n.prototype),a}return g(n,t),Object.defineProperty(n,"storeNotDefined",{get:function(){return new n({code:ae.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeNotAvailable",{get:function(){return new n({code:ae.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeNotAvailableInPrivateBrowsing",{get:function(){return new n({code:ae.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeIsFull",{get:function(){return new n({code:ae.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeNotInitialized",{get:function(){return new n({code:ae.STORE_NOT_INITIALIZED,message:"Store is not initialized."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeKeyTypeIsInvalid",{get:function(){return new n({code:ae.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeBrokenIntegrity",{get:function(){return new n({code:ae.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeBrokenBlob",{get:function(){return new n({code:ae.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeEncryptionInvalid",{get:function(){return new n({code:ae.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeItemSizeExceeded",{get:function(){return new n({code:ae.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeReadFailed",{get:function(){return new n({code:ae.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeWriteFailed",{get:function(){return new n({code:ae.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"databaseSchemaNotOnUpgrade",{get:function(){return new n({code:ae.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionNotReady",{get:function(){return new n({code:ae.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionKeyNotMatch",{get:function(){return new n({code:ae.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionQueryNotValid",{get:function(){return new n({code:ae.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionInsertDuplicate",{get:function(){return new n({code:ae.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionKeyNotFound",{get:function(){return new n({code:ae.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionKeyNotGiven",{get:function(){return new n({code:ae.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionWriteFailed",{get:function(){return new n({code:ae.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionItemSizeExceeded",{get:function(){return new n({code:ae.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"indexTableIsRequired",{get:function(){return new n({code:ae.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"indexTypesNotMatch",{get:function(){return new n({code:ae.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"compareTypesNotMatch",{get:function(){return new n({code:ae.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"circularReferenceFound",{get:function(){return new n({code:ae.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0}),n}(Error);(function(t){t.INIT="init",t.READY="ready",t.CLOSED="closed"})(pn||(pn={}));var Vu,je=function(t,n){if(n===void 0&&(n=new WeakMap),typeof t=="object"&&t!==null){if(n.has(t))throw Y.circularReferenceFound;n.set(t,!0);var e=void 0;if(Array.isArray(t))e=t.map(function(i){return je(i,n)});else if(t instanceof RegExp)e=t;else if(t instanceof Date)e=t;else for(var r in e={},t)e[r]=je(t[r],n);return n.delete(t),e}return t},Dt=function(t,n){if(n==null)return 1;if(t==null)return-1;if(typeof t!=typeof n)throw Y.compareTypesNotMatch;var e=0;switch(typeof t){case"boolean":case"number":e=t-n;break;case"string":e=t.localeCompare(n)}return e},Ku=function(t,n){for(var e=0,r=0;r<t.length;r++)e=t.charCodeAt(r)+(e<<6)+(e<<16)-e;return(e>>>0)%n},Ei=function(t){return new Promise(function(n){setTimeout(function(){return n()},t)})},_n=function(t,n){if(!n)return!1;if(typeof t!="function"){for(var e in t)if(["/and","&&"].includes(e)){if(t[e].some(function(u){return!_n(u,n)}))return!1}else if(["/or","||"].includes(e)){if(t[e].every(function(u){return!_n(u,n)}))return!1}else if(e==="/where"){if(!(0,t[e])(n))return!1}else{var r=e;if(typeof t[r]=="object"){var i=t[r];for(var s in i)switch(s){case"/eq":case"=":if((o=n[r])!==(a=i[s]))return!1;break;case"/neq":case"!=":if((o=n[r])===(a=i[s]))return!1;break;case"/gt":case">":var o=n[r],a=i[s];if(!(Dt(o,a)>0))return!1;break;case"/gte":case">=":if(o=n[r],a=i[s],!(Dt(o,a)>=0))return!1;break;case"/lt":case"<":if(o=n[r],a=i[s],!(Dt(o,a)<0))return!1;break;case"/lte":case"<=":if(o=n[r],a=i[s],!(Dt(o,a)<=0))return!1;break;case"/in":if(o=n[r],!(a=i[s]).includes(o))return!1;break;case"/nin":if(o=n[r],(a=i[s]).includes(o))return!1;break;case"/contain":if(o=n[r],a=i[s],!o.includes(a))return!1;break;case"/regex":if(o=n[r],!(a=i[s]).test(o))return!1;break;case"/where":if(o=n[r],!(0,i[s])(o))return!1}}else if(typeof t[r]=="function"){if(!t[r](n[r]))return!1}else if(t[r]!==n[r])return!1}return!0}return t(n)},Ir=function(){},Qu=function(){return Promise.resolve()},vp=function(t){return t},Wu=function(t,n){n()};(function(t){t[t.FORWARD=0]="FORWARD",t[t.BACKWARD=1]="BACKWARD"})(Vu||(Vu={}));var vn,ke,wt,mp=function(){function t(n){var e=n.initialPrevValue,r=e===void 0?null:e,i=n.initialNextValue,s=i===void 0?null:i,o=n.iterator,a=n.map,u=a===void 0?vp:a,c=n.backward,l=c===void 0?Qu:c,d=n.forward,p=d===void 0?Qu:d,_=n.complete,v=_===void 0?Ir:_;this._prevValue=r,this._nextValue=s,this._error=null,this._map=u,this._backward=l,this._forward=p,this._iterator=o,this._complete=v}return Object.defineProperty(t.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPrevious",{get:function(){return!!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasNext",{get:function(){return!!this._nextValue},enumerable:!1,configurable:!0}),t.prototype.prev=function(){return f(this,void 0,void 0,function(){var n,e,r;return h(this,function(i){switch(i.label){case 0:if(!this.hasPrevious)return[3,6];i.label=1;case 1:return i.trys.push([1,3,,4]),n=this._prevValue,e=this,[4,this._backward()];case 2:return e._prevValue=i.sent()||null,this._nextValue=n,[3,4];case 3:return r=i.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,i.sent()];case 6:this._complete(),i.label=7;case 7:return[2]}})})},t.prototype.next=function(){return f(this,void 0,void 0,function(){var n,e,r;return h(this,function(i){switch(i.label){case 0:if(!this.hasNext)return[3,6];i.label=1;case 1:return i.trys.push([1,3,,4]),n=this._nextValue,e=this,[4,this._forward()];case 2:return e._nextValue=i.sent()||null,this._prevValue=n,[3,4];case 3:return r=i.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,i.sent()];case 6:this._complete(),i.label=7;case 7:return[2]}})})},t.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete()},t}(),Qs=function(){function t(n){var e=n.condition,r=e===void 0?{}:e,i=n.backward,s=i!==void 0&&i,o=n.blockManager,a=n.indexer;this.condition=r,this.backward=s,this._blockManager=o,this._indexer=a}return t.prototype.findOptimizedStartPosition=function(){var n=this,e=["=","/eq",">",">=","/gt","/gte"],r=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var i=this._indexer.origin.length-1;if(typeof this.condition!="function")for(var s in this._indexer.fields){var o=this._indexer.fields[s],a=1;if(o[0]==="-"&&(o=o.slice(1),a=-1),this.condition[o]){if(typeof this.condition[o]=="object"){var u=a>0?r:e;for(var c in this.condition[o])if(u.includes(c)){for(var l=i;l>=0;l--)if(a*Dt(this._indexer.origin[l].columnValues[s],this.condition[o][c])<=0){i=l;break}}}else for(l=i;l>=0;l--)if(a*Dt(this._indexer.origin[l].columnValues[s],this.condition[o])<=0){i=l;break}}}return Math.min(i+1,this._indexer.origin.length-1)}var d=0;if(typeof this.condition!="function")for(var p=function(m){var y=_._indexer.fields[m],E=1;if(y[0]==="-"&&(y=y.slice(1),E=-1),_.condition[y]){if(typeof _.condition[y]=="object")Object.keys(_.condition[y]).forEach(function(C){if((E>0?e:r).includes(C)){for(var A=d;A<n._indexer.origin.length;A++)if(E*Dt(n._indexer.origin[A].columnValues[m],n.condition[y][C])>=0){d=A;break}}});else for(var w=d;w<_._indexer.origin.length;w++)if(E*Dt(_._indexer.origin[w].columnValues[m],_.condition[y])>=0){d=w;break}}},_=this,s=0;s<this._indexer.fields.length;s++)p(s);return Math.max(d-1,0)},t.prototype.each=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c=this;return h(this,function(l){switch(l.label){case 0:if(e=this.findOptimizedStartPosition(),r=0,this.backward&&this._indexer.origin[e]&&(r=this._indexer.origin[e].keys.length-1),i=function(){if(c._indexer.origin[e]){if(!c._indexer.origin[e].keys[++r]){if(!c._indexer.origin[++e])return!1;r=0}return!0}return!1},s=function(){if(c._indexer.origin[e]){if(!c._indexer.origin[e].keys[--r]){if(!c._indexer.origin[--e])return!1;r=c._indexer.origin[e].keys.length-1}return!0}return!1},o=null,!this._indexer.origin[e])return[3,4];a=this.backward?s:i,l.label=1;case 1:return[4,this._blockManager.getFromBlock(this._indexer.origin[e].keys[r])];case 2:if((u=l.sent())&&_n(this.condition,u))return o=u,[3,4];l.label=3;case 3:if(a())return[3,1];l.label=4;case 4:return[4,new Promise(function(d){var p=new mp({initialNextValue:je(o),iterator:n,forward:function(){return f(c,void 0,void 0,function(){var _,v;return h(this,function(m){switch(m.label){case 0:_=this.backward?s:i,m.label=1;case 1:return _()?[4,this._blockManager.getFromBlock(this._indexer.origin[e].keys[r])]:[3,3];case 2:return(v=m.sent())&&_n(this.condition,v)?[2,je(v)]:[3,1];case 3:return[2,null]}})})},backward:function(){return f(c,void 0,void 0,function(){var _,v;return h(this,function(m){switch(m.label){case 0:_=this.backward?i:s,m.label=1;case 1:return _()?[4,this._blockManager.getFromBlock(this._indexer.origin[e].keys[r])]:[3,3];case 2:return(v=m.sent())&&_n(this.condition,v)?[2,je(v)]:[3,1];case 3:return[2,null]}})})},complete:d});n(p)})];case 5:return[2,l.sent()]}})})},t}(),gp=function(){function t(n){var e=n.condition,r=e===void 0?{}:e,i=n.backward,s=i!==void 0&&i,o=n.mutex,a=n.blockManager,u=n.indexer;this._mutex=o,this._iterator=new Qs({condition:r,backward:s,blockManager:a,indexer:u})}return t.prototype.fetch=function(n){return n===void 0&&(n={}),f(this,void 0,void 0,function(){var e,r,i,s,o=this;return h(this,function(a){switch(a.label){case 0:if(e=Math.max(n.offset||0,0),(r=typeof n.limit=="number"?n.limit:Number.MAX_SAFE_INTEGER)===0)return[2,[]];if(r<0)throw Y.collectionQueryNotValid;a.label=1;case 1:return a.trys.push([1,4,,5]),i=[],[4,this._mutex.lock()];case 2:return a.sent(),[4,this._iterator.each(function(u){return f(o,void 0,void 0,function(){return h(this,function(c){return u.error?u.stop():u.hasNext?e===0?(i.push(u.nextValue),0<r&&r<=i.length?u.stop():u.next()):(e--,u.next()):u.stop(),[2]})})})];case 3:return a.sent(),this._mutex.unlock(),[2,i];case 4:throw s=a.sent(),this._mutex.unlock(),s;case 5:return[2]}})})},t.prototype.count=function(){return f(this,void 0,void 0,function(){var n,e,r=this;return h(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),n=0,[4,this._mutex.lock()];case 1:return i.sent(),[4,this._iterator.each(function(s){return f(r,void 0,void 0,function(){return h(this,function(o){return s.error?s.stop():s.hasNext?(n++,s.next()):s.stop(),[2]})})})];case 2:return i.sent(),this._mutex.unlock(),[2,n];case 3:throw e=i.sent(),this._mutex.unlock(),e;case 4:return[2]}})})},t}(),Ws=function(t){return"".concat("nest","@").concat(t)},mn=function(t,n){return"".concat(Ws(t),"/").concat(n)},Ys=function(t,n){return"".concat(mn(t,n),".metadata")},Zs=function(t,n){return"".concat(mn(t,n),"/block.")},Yu=function(t,n){return"".concat(mn(t,n),"/blob.")},yp=function(){function t(n){var e=n.dbname,r=n.collectionName,i=n.store;this.dbname=e,this.collectionName=r,this.store=i}return t.prototype.get=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c,l;return h(this,function(d){switch(d.label){case 0:return[4,this.store.get(n)];case 1:return(e=d.sent())?(r=e.data,i=e.type,typeof fetch>"u"?[3,4]:[4,fetch(r)]):[3,5];case 2:return[4,d.sent().blob()];case 3:return[2,d.sent()];case 4:for(s=[],o=atob(r.split(",")[1]),a=0;a<o.length;a+=512){for(u=o.slice(a,a+512),c=new Array(u.length),l=0;l<u.length;l++)c[l]=u.charCodeAt(l);s.push(new Uint8Array(c))}return[2,new Blob(s,{type:i})];case 5:return[2,null]}})})},t.prototype.save=function(n,e){return e===void 0&&(e="".concat(Date.now())),f(this,void 0,void 0,function(){var r,i,s,o,a=this;return h(this,function(u){switch(u.label){case 0:return[4,new Promise(function(c){var l=function(p,_,v,m){return m===void 0&&(m=0),"".concat(Yu(p,_)).concat(v,".").concat(m)}(a.dbname,a.collectionName,e),d=new FileReader;d.onload=function(){c({blobId:l,data:d.result,type:n.type})},d.readAsDataURL(n)})];case 1:return r=u.sent(),i=r.blobId,s=r.data,o=r.type,[4,this.store.set({key:i,value:{data:s,type:o}})];case 2:return u.sent(),[2,i]}})})},t.prototype.remove=function(n){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this.store.remove(n)];case 1:return e.sent(),[2]}})})},t.prototype.clear=function(){return f(this,void 0,void 0,function(){var n,e,r=this;return h(this,function(i){switch(i.label){case 0:return n=Yu(this.dbname,this.collectionName),[4,this.store.getAllKeys()];case 1:return e=i.sent(),[4,Promise.all(e.filter(function(s){return s.startsWith(n)}).map(function(s){return f(r,void 0,void 0,function(){return h(this,function(o){switch(o.label){case 0:return[4,this.store.remove(s)];case 1:return[2,o.sent()]}})})}))];case 2:return i.sent(),[2]}})})},t}();(function(t){t[t.COMMIT=0]="COMMIT",t[t.WRITE=1]="WRITE",t[t.ERROR=2]="ERROR"})(vn||(vn={})),function(t){t.PENDING="pending",t.PERSISTENT="persistent",t.VOLATILE="volatile"}(ke||(ke={})),function(t){t[t.NO_CACHE=0]="NO_CACHE",t[t.DEFAULT=1]="DEFAULT",t[t.PERSISTENT=2]="PERSISTENT"}(wt||(wt={}));var Tr,Re,Zu=[ke.PENDING,ke.VOLATILE],wi={},ct=function(){function t(n){var e=n.dbname,r=n.limit,i=r===void 0?256:r;return wi[e]||(this.dbname=e,this._items=[],this._limit=i,wi[e]=this),wi[e]}return t.get=function(n){return wi[n]},Object.defineProperty(t.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),t.prototype.find=function(n,e,r){return r===void 0&&(r=wt.DEFAULT),f(this,void 0,void 0,function(){var i,s;return h(this,function(o){switch(o.label){case 0:return(i=this.get(e))?[3,2]:[4,n.get(e)];case 1:return(s=o.sent())&&(i={key:e,value:s,state:r===wt.PERSISTENT?ke.PERSISTENT:ke.VOLATILE},this.put(i)),[3,3];case 2:r===wt.PERSISTENT&&(i.state=ke.PERSISTENT),o.label=3;case 3:return[2,i]}})})},t.prototype.get=function(n,e){e===void 0&&(e=wt.DEFAULT);var r=this._items.map(function(s){return s.key}).indexOf(n);if(r>-1){var i=this._items[r];return e===wt.PERSISTENT&&(i.state=ke.PERSISTENT),e!==wt.NO_CACHE&&this.put(i),i}return null},t.prototype.put=function(n){var e,r;if(this._limit>0){var i=this._items.map(function(d){return d.key}).indexOf(n.key);if(i>-1)Zu.includes(this._items[i].state)&&Zu.includes(n.state)?(this._items.splice(i,1),this._items.push(n)):(this._items[i].state=n.state,this._items[i].value=n.value);else{this._items.push(n);var s=this._items.filter(function(d){return d.state===ke.VOLATILE}),o=s.length-this._limit;if(o>0){var a=[];try{for(var u=$(this._items),c=u.next();!c.done;c=u.next()){var l=c.value;l.state===ke.VOLATILE&&o>0?o--:a.push(l)}}catch(d){e={error:d}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}this._items=a}}}},t.prototype.remove=function(n){var e=this._items.map(function(r){return r.key}).indexOf(n);e>-1&&this._items.splice(e,1)},t.prototype.clearByCondition=function(n){this._items=this._items.filter(function(e){return!n(e)})},t.prototype.clear=function(n){n===void 0&&(n=!1),this._items=n?[]:this._items.filter(function(e){return e.state!==ke.VOLATILE})},t}(),bp=function(){function t(n){var e=n.dbname,r=n.collectionName,i=n.store;this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=e,this.collectionName=r,this.metadataKey=function(s,o){return"".concat(mn(s,o),"/trans.metadata")}(e,r),this.recordsetKey=function(s,o){return"".concat(mn(s,o),"/trans.recordset")}(e,r),this._store=i}return Object.defineProperty(t.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),t.prototype._getReducedRecordset=function(n){return n===void 0&&(n=[]),f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return[4,this._store.get(this.recordsetKey)];case 1:return(e=r.sent()||[]).push.apply(e,Z([],G(n),!1)),[2,this._reduceRecordSet(e)]}})})},t.prototype._reduceRecordSet=function(n){for(var e=[],r={},i=n.length-1;i>=0;i--){for(var s=n[i],o=[],a=s.requests.length-1;a>=0;a--){var u=s.requests[a],c=u.data;r[c.key]||(o.unshift(u),r[c.key]=!0)}o.length>0&&(s.requests=o,e.unshift(s))}return e},t.prototype._applyRecord=function(n,e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l,d;return h(this,function(p){switch(p.label){case 0:r=ct.get(this.dbname),i=e.generation,s=e.requests,o=null,p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this._store.setMany(s.map(function(_){return b(b({},_.data),{generation:i})}))];case 2:for(a=p.sent(),u=0;u<s.length;u++)a[u]instanceof Error&&(o||(o=a[u]),c=s[u].data,r.put(b(b({},c),{state:ke.PERSISTENT})));return[3,4];case 3:return l=p.sent(),o=l,[3,4];case 4:return o?[3,6]:(d=n.filter(function(_){return _.generation!==i}),[4,this._store.set({key:this.recordsetKey,value:d})]);case 5:return p.sent(),this._onWrite.forEach(function(_){_(s.map(function(v){return v.data}))}),[3,7];case 6:this._onError.forEach(function(_){o&&_(o)}),p.label=7;case 7:return[2]}})})},t.prototype.init=function(){return f(this,void 0,void 0,function(){var n,e,r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return n=this,[4,this._store.get(this.metadataKey)];case 1:return n._metadata=c.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:e=c.sent(),c.label=3;case 3:c.trys.push([3,8,9,10]),r=$(e),i=r.next(),c.label=4;case 4:return i.done?[3,7]:(s=i.value,[4,this._applyRecord(e,s)]);case 5:c.sent(),c.label=6;case 6:return i=r.next(),[3,4];case 7:return[3,10];case 8:return o=c.sent(),a={error:o},[3,10];case 9:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(a)throw a.error}return[7];case 10:return[2]}})})},t.prototype.on=function(n,e,r){switch(n){case vn.COMMIT:this._onCommit.set(e,r);break;case vn.WRITE:this._onWrite.set(e,r);break;case vn.ERROR:this._onError.set(e,r)}},t.prototype.requestWrite=function(n,e){this._requests.push({data:n,options:e}),ct.get(this.dbname).put(b({state:ke.PENDING},n))},t.prototype.requestMultipleWrite=function(n,e){var r,i,s=ct.get(this.dbname);try{for(var o=$(n),a=o.next();!a.done;a=o.next()){var u=a.value;this._requests.push({data:u,options:e}),s.put(b({state:ke.PENDING},u))}}catch(c){r={error:c}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},t.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(n){return ct.get(this.dbname).clearByCondition(function(e){return e.state===ke.PENDING}),this._requests=[],[2]})})},t.prototype.commit=function(){return f(this,void 0,void 0,function(){var n,e,r,i,s,o,a,u,c,l,d,p,_=this;return h(this,function(v){switch(v.label){case 0:if(!((n=this._requests).length>0))return[3,4];for(e=[],r={},u=n.length-1;u>=0;u--)i=n[u],l=i.data,r[l.key]||(r[l.key]=!0,e.unshift(i));return s={generation:this.generation,requests:e},[4,this._getReducedRecordset([s])];case 1:return o=v.sent(),[4,this._store.set({key:this.recordsetKey,value:o})];case 2:return v.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata})];case 3:for(v.sent(),a=ct.get(this.dbname),u=0;u<e.length;u++)c=e[u],l=c.data,d=c.options,a.put(b(b({},l),{state:d&&d.persistent?ke.PERSISTENT:ke.VOLATILE}));this._requests=[],this._onCommit.forEach(function(m){m(n.map(function(y){return y.data}))}),p=wr.get(this.dbname),setTimeout(function(){try{_._applyRecord(o,s)}catch(m){_._onError.forEach(function(y){return y(m)})}},p.transactionApplyDelay),v.label=4;case 4:return[2]}})})},t}(),Ii=function(){function t(n){var e=n.blockId,r=n.keyName,i=n.items,s=i===void 0?[]:i,o=n.limit;this.blockId=e,this.keyName=r,this.limit=o,this._items=Z([],G(s),!1)}return t.createFromCacheItem=function(n){return n?new t(n.value):null},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this._items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),t.prototype.serialize=function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},t.prototype.getItemByKey=function(n){var e=this,r=this._items.find(function(i){var s=i[e.keyName];return n===s});return r??null},t.prototype.has=function(n){var e=this;return this._items.map(function(r){return r[e.keyName]}).includes(n)},t.prototype.add=function(n){var e=this,r=this._items.map(function(i){return i[e.keyName]}).indexOf(n[this.keyName]);return r<0?this._items.length<this.limit&&(this._items.push(n),!0):(this._items[r]=n,!0)},t.prototype.remove=function(n){for(var e in this._items)if(this._items[e][this.keyName]===n)return this._items.splice(parseInt(e),1),!0;return!1},t.prototype.clear=function(){this._items=[]},t}(),Ep=function(){function t(n){var e=n.dbname,r=n.collectionName,i=n.metadata,s=n.hashFunction,o=s===void 0?Ku:s,a=n.transaction,u=n.store;this.dbname=e,this.collectionName=r,this.hashFunction=o,this.metadata=i,this._transaction=a,this._store=u}return Object.defineProperty(t.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),t.prototype.createBlockId=function(n,e){return e===void 0&&(e=this.metadata.blockLevel),r=this.dbname,i=this.collectionName,s=e,o="".concat(function(a,u,c){var l=c.base*Math.pow(c.multiplier,u)+c.constant;return(c.hashFunction||Ku)(a,l)}(n,e,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(Zs(r,i)).concat(s,".").concat(o);var r,i,s,o},t.prototype._findBlock=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o;return h(this,function(a){switch(a.label){case 0:e=ct.get(this.dbname),r=this.metadata.blockLevel,a.label=1;case 1:return r>0?(i=this.createBlockId(n,r),[4,e.find(this._store,i)]):[3,4];case 2:if((s=a.sent())&&(o=Ii.createFromCacheItem(s),o==null?void 0:o.getItemByKey(n)))return[2,o];a.label=3;case 3:return r--,[3,1];case 4:return[2,null]}})})},t.prototype.getFromBlock=function(n){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return[4,this._findBlock(n)];case 1:return[2,(e=r.sent())?e.getItemByKey(n):null]}})})},t.prototype.putToBlock=function(n,e){return f(this,void 0,void 0,function(){var r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return r=wr.get(this.dbname),i=this.createBlockId(n),s=Math.floor(this._store.itemSizeLimit/r.itemSizeLimit),[4,ct.get(this.dbname).find(this._store,i)];case 1:return o=u.sent(),(a=o?Ii.createFromCacheItem(o):new Ii({blockId:i,keyName:this.keyName,items:[],limit:s}))!=null&&a.add(e)?(this._transaction.requestWrite({key:a.blockId,value:a.serialize()}),[2,!0]):[2,!1]}})})},t.prototype.removeFromBlock=function(n){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return[4,this._findBlock(n)];case 1:return(e=r.sent())&&e.remove(n)?(this._transaction.requestWrite({key:e.blockId,value:e.serialize()}),[2,!0]):[2,!1]}})})},t.prototype.clearAllBlocks=function(){return f(this,void 0,void 0,function(){var n,e,r;return h(this,function(i){switch(i.label){case 0:return n=Zs(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return e=i.sent(),r=e.filter(function(s){return s.startsWith(n)}),[4,this._store.removeMany(r)];case 2:return i.sent(),[4,this._transaction.clear()];case 3:return i.sent(),ct.get(this.dbname).clearByCondition(function(s){return s.key.startsWith(n)}),[2]}})})},t}(),qn={},Vt=function(){function t(n){var e=n.dbname,r=n.collectionName,i=n.keyName,s=n.fields,o=n.transaction,a=n.store,u=this;this._origin=[],this._table=[];var c=function(l,d,p){return"".concat(mn(l,d),"/index.").concat(p)}(e,r,s.join(">"));return qn[c]||(this.dbname=e,this.collectionName=r,this.keyName=i,this.fields=s,this.indexerKey=c,this._transaction=o,this._store=a,this._transaction.on(vn.COMMIT,this.indexerKey,function(){return u.commit()}),this._transaction.on(vn.ERROR,this.indexerKey,function(){return u.abort()})),qn[c]}return t.createKey=function(n){return n.join(">")},t.parseKey=function(n){return n.split(">")},t.clearIndexerMap=function(){for(var n in qn)delete qn[n]},t.prototype._addItem=function(n){var e=n[this.keyName],r=this.getColumnValues(n),i=G(this.indexOf(r),2),s=i[0];return i[1]?!this._table[s].keys.includes(e)&&(this._table[s].keys.push(e),!0):(this._table.splice(s,0,{columnValues:r,keys:[e]}),!0)},t.prototype._removeItem=function(n){var e=n[this.keyName],r=this.getColumnValues(n),i=G(this.indexOf(r),2),s=i[0];if(i[1]){var o=this._table[s].keys.indexOf(e);if(o>-1)return this._table[s].keys.splice(o,1),this._table[s].keys.length===0&&this._table.splice(s,1),!0}return!1},Object.defineProperty(t.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),t.prototype.getColumnValues=function(n){var e,r,i,s,o=[];try{for(var a=$(this.fields),u=a.next();!u.done;u=a.next()){var c=u.value;if(c[0]==="-"&&(c=c.slice(1)),i=n[c],s=void 0,s=typeof i,i!==null&&s!=="undefined"&&s!=="boolean"&&s!=="number"&&s!=="string")throw Y.indexTypesNotMatch;o.push(n[c])}}catch(l){e={error:l}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return o},t.prototype.diff=function(n,e){for(var r in this.fields){var i=this.fields[r][0]==="-"?-1:1,s=Dt(n[r],e[r]);if(s!==0)return i*s}return 0},t.prototype.indexOf=function(n){if(this._table.length>0){for(var e=0,r=this._table.length-1;e<=r;){var i=Math.floor((e+r)/2),s=this.diff(n,this._table[i].columnValues);if(s>0)e=i+1;else{if(!(s<0))return[i,!0];r=i-1}}return[e,!1]}return[0,!1]},t.prototype.ensure=function(){return f(this,void 0,void 0,function(){var n,e,r,i,s,o,a,u,c,l,d,p,_,v,m,y,E;return h(this,function(w){switch(w.label){case 0:return[4,(n=ct.get(this.dbname)).find(this._store,this.indexerKey,wt.PERSISTENT)];case 1:return(e=w.sent())?[3,11]:(r=Zs(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:i=w.sent(),w.label=3;case 3:w.trys.push([3,8,9,10]),s=$(i),o=s.next(),w.label=4;case 4:return o.done?[3,7]:(a=o.value).startsWith(r)?[4,n.find(this._store,a,wt.NO_CACHE)]:[3,6];case 5:if(u=w.sent(),c=Ii.createFromCacheItem(u))try{for(y=void 0,l=$(c.items),d=l.next();!d.done;d=l.next())p=d.value,this._addItem(p)}catch(C){y={error:C}}finally{try{d&&!d.done&&(E=l.return)&&E.call(l)}finally{if(y)throw y.error}}w.label=6;case 6:return o=s.next(),[3,4];case 7:return[3,10];case 8:return _=w.sent(),v={error:_},[3,10];case 9:try{o&&!o.done&&(m=s.return)&&m.call(s)}finally{if(v)throw v.error}return[7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=e.value,this._table=je(this._origin),w.label=12;case 12:return qn[this.indexerKey]=this,[2]}})})},t.prototype.drop=function(){return f(this,void 0,void 0,function(){return h(this,function(n){switch(n.label){case 0:return ct.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return n.sent(),delete qn[this.indexerKey],[2]}})})},t.prototype.addItem=function(n){return f(this,void 0,void 0,function(){return h(this,function(e){return this._addItem(n)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},t.prototype.removeItem=function(n){return f(this,void 0,void 0,function(){return h(this,function(e){return this._removeItem(n)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},t.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(n){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},t.prototype.commit=function(){this._origin=this._table,this._table=je(this._origin)},t.prototype.abort=function(){this._table=je(this._origin)},t}(),Ti=function(){return typeof document<"u"&&typeof navigator<"u"&&navigator.product!=="ReactNative"},Xu=function(){var t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var e=(t+16*Math.random())%16|0;return t=Math.floor(t/16),(n==="x"?e:3&e|8).toString(16)})};(function(t){t[t.PROCESSING=0]="PROCESSING",t[t.DONE=1]="DONE"})(Tr||(Tr={})),function(t){t.NEWNODE="newnode",t.REMOVENODE="removenode",t.CLAIM_HOST="claimhost",t.SYNC_HOST="synchost",t.REQUEST_LOCK="requestlock",t.ACQUIRE_LOCK="acquirelock",t.RELEASE_LOCK="releaselock"}(Re||(Re={}));var ht,Xs={},Js=function(){function t(n,e){e===void 0&&(e={});var r=this;return this._state=Tr.PROCESSING,this._queue=[],this._activationQueue=[],Xs[n]&&!e.forceCreate||(this.nodeId=Xu(),this.key=n,Ti()&&(e.startAsInvisible?this.registerNode():document.visibilityState==="visible"?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",function(){document.visibilityState==="visible"&&r.claimHost()}),window.addEventListener("message",function(i){var s,o,a=i.data,u=a.nodeId,c=a.requestId,l=a.key,d=a.op,p=a.data;if(u!==r.nodeId&&l===r.key)switch(d){case Re.NEWNODE:r._sendSync();break;case Re.CLAIM_HOST:r._sendSync(),r._hostId=u;break;case Re.SYNC_HOST:if(!r.isInSync){r._activationTimeout&&clearTimeout(r._activationTimeout);var _=p,v=_.currentItemRequestId,m=_.queue,y=function(A){var P=r._queue.findIndex(function(N){return N.requestId===A.requestId});P<0&&r._requestLock({nodeId:A.nodeId,requestId:A.requestId,key:r.key,op:Re.REQUEST_LOCK,ts:A.ts})};try{for(var E=$(m),w=E.next();!w.done;w=E.next())y(w.value)}catch(A){s={error:A}}finally{try{w&&!w.done&&(o=E.return)&&o.call(E)}finally{if(s)throw s.error}}r._currentItem=r._queue.find(function(A){return A.requestId===v}),r._completeSync()}break;case Re.REMOVENODE:r._queue=r._queue.filter(function(A){return A.nodeId!==a.nodeId}),r._currentItem&&r._currentItem.nodeId===a.nodeId&&(r._currentItem=void 0,r._acquire(r._queue[0]));break;case Re.REQUEST_LOCK:r._requestLock(a);break;case Re.ACQUIRE_LOCK:var C=r._queue.find(function(A){return A.requestId===c});r._acquire(C);break;case Re.RELEASE_LOCK:r._release(c)}}),window.addEventListener("beforeunload",function(){r._send(Re.REMOVENODE)})),Xs[n]=this),Xs[n]}return Object.defineProperty(t.prototype,"locked",{get:function(){return!!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isInSync",{get:function(){return this._state==Tr.DONE},enumerable:!1,configurable:!0}),t.prototype._send=function(n,e){var r;e===void 0&&(e={});var i={nodeId:this.nodeId,requestId:(r=e==null?void 0:e.requestId)!==null&&r!==void 0?r:Xu(),key:this.key,op:n,data:e.data,ts:Date.now()};return Ti()&&window.postMessage(i,"*"),i},t.prototype._acquire=function(n){n?(this._currentItem=n,this._currentItem.onAcquired&&this._currentItem.onAcquired(n.requestId)):this._currentItem=void 0},t.prototype._release=function(n){if(this._currentItem&&this._currentItem.requestId===n){var e=this._currentItem;this._currentItem=void 0,e.nodeId===this.nodeId&&this._send(Re.RELEASE_LOCK,{requestId:e.requestId});var r=this._queue.findIndex(function(i){return i.requestId===n});r>-1&&this._queue.splice(r,1),e.onReleased&&e.onReleased(n)}},t.prototype._requestLock=function(n){var e=this;return new Promise(function(r){var i={nodeId:n.nodeId,requestId:n.requestId,ts:n.ts,onAcquired:function(a){e.isHost&&e._send(Re.ACQUIRE_LOCK,{requestId:a}),r()},onReleased:function(){e._acquire(e._queue[0])}},s=!1;for(var o in e._queue)if(e._queue[o].ts>i.ts){e._queue.splice(parseInt(o),0,i),s=!0;break}s||e._queue.push(i),e._currentItem||e._acquire(e._queue[0])})},t.prototype._sendSync=function(){var n;this.isHost&&this._send(Re.SYNC_HOST,{data:{currentItemRequestId:(n=this._currentItem)===null||n===void 0?void 0:n.requestId,queue:this._queue.map(function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}})}})},t.prototype._waitUntilSyncCompleted=function(){return f(this,void 0,void 0,function(){var n=this;return h(this,function(e){return this.isHost&&!this.isInSync?[2,new Promise(function(r){n._activationQueue.push(r)})]:[2]})})},t.prototype._waitSync=function(){var n=this;this.isInSync||(this._activationTimeout=setTimeout(function(){n._completeSync()},8))},t.prototype._completeSync=function(){this.isInSync||(this._state=Tr.DONE,this._activationQueue.forEach(function(n){return n()}),this._activationQueue=[])},t.prototype.registerNode=function(){this._send(Re.NEWNODE),this._waitSync()},t.prototype.claimHost=function(){this._hostId=this.nodeId,this._send(Re.CLAIM_HOST),this._waitSync()},t.prototype.lock=function(){return f(this,void 0,void 0,function(){var n;return h(this,function(e){switch(e.label){case 0:return[4,this._waitUntilSyncCompleted()];case 1:return e.sent(),n=this._send(Re.REQUEST_LOCK),[4,this._requestLock(n)];case 2:return e.sent(),[2]}})})},t.prototype.unlock=function(){var n;!((n=this._currentItem)===null||n===void 0)&&n.requestId&&this._release(this._currentItem.requestId)},t}(),eo=function(){function t(n){var e=n.dbname,r=n.collectionName,i=n.keyName,s=n.keyHash,o=n.indexes,a=n.store,u=this;this._state=pn.INIT,this._indexers=[],this.dbname=e,this.name=r,this.keyName=i,this.indexes=Z([[i]],G(o.filter(function(c){return Vt.createKey(c)!==u.keyName})),!1),this._keyHash=s,this._store=a,this._mutex=new Js(function(c,l){return"".concat(mn(c,l),".lock")}(e,r)),this._blobContainer=new yp({dbname:e,collectionName:r,store:a}),this._transaction=new bp({dbname:e,collectionName:r,store:a})}return t.metadataOf=function(n,e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:return i=Ys(n,e),[4,r.get(i)];case 1:return[2,s.sent()]}})})},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isReady",{get:function(){return this._state===pn.READY},enumerable:!1,configurable:!0}),t.prototype.init=function(){return f(this,void 0,void 0,function(){var n,e,r,i,s,o,a,u,c,l,d,p,_,v,m=this;return h(this,function(y){switch(y.label){case 0:return[4,this._mutex.lock()];case 1:y.sent(),y.label=2;case 2:return y.trys.push([2,9,,10]),n=wr.get(this.dbname),[4,t.metadataOf(this.dbname,this.name,this._store)];case 3:return e=y.sent(),this._metadata=e||{keyName:this.keyName,blockLevel:1,blockHashBase:n.blockHashBase,blockHashMultiplier:n.blockHashMultiplier,blockHashConstant:n.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:y.sent(),this._blockManager=new Ep({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=Z([],G(this.indexes),!1),i=[],s=r.map(function(E){return Vt.createKey(E)}),o=e?e.indexes.map(function(E){return Vt.createKey(E)}):[];try{for(a=$(o),u=a.next();!u.done;u=a.next())c=u.value,s.includes(c)||i.push(Vt.parseKey(c))}catch(E){_={error:E}}finally{try{u&&!u.done&&(v=a.return)&&v.call(a)}finally{if(_)throw _.error}}return(l=[]).push.apply(l,Z([],G(r.map(function(E){var w=new Vt({dbname:m.dbname,collectionName:m.name,keyName:m.keyName,fields:E,transaction:m._transaction,store:m._store});return m._indexers.push(w),w.ensure()})),!1)),l.push.apply(l,Z([],G(i.map(function(E){return new Vt({dbname:m.dbname,collectionName:m.name,keyName:m.keyName,fields:E,transaction:m._transaction,store:m._store}).drop()})),!1)),[4,Promise.all(l)];case 5:return y.sent(),[4,this._transaction.commit()];case 6:return y.sent(),s.sort().join(",")===o.sort().join(",")?[3,8]:(d=Ys(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:d,value:this._metadata})]);case 7:y.sent(),y.label=8;case 8:return this._state=pn.READY,this._mutex.unlock(),[3,10];case 9:throw p=y.sent(),this._mutex.unlock(),p;case 10:return[2]}})})},t.prototype.close=function(){this._state=pn.CLOSED},t.prototype._hasPropertyOfKeyName=function(n){var e=n[this.keyName];return typeof e=="string"&&!!e},t.prototype._getIndexerBy=function(n){var e,r;n===void 0&&(n=null),n||(n=[this.keyName]);var i=Vt.createKey(n);try{for(var s=$(this._indexers),o=s.next();!o.done;o=s.next()){var a=o.value;if(i===Vt.createKey(a.fields))return a}}catch(u){e={error:u}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}throw Y.indexTableIsRequired},t.prototype._upgradeBlockLevel=function(){return f(this,void 0,void 0,function(){var n;return h(this,function(e){switch(e.label){case 0:return n=Ys(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:n,value:this._metadata})];case 1:return e.sent(),[2]}})})},t.prototype._requestInsert=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return e=n[this.keyName],[4,this._blockManager.getFromBlock(e)];case 1:return u.sent()?[3,13]:[4,this._blockManager.putToBlock(e,n)];case 2:return u.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return u.sent(),[4,this._blockManager.putToBlock(e,n)];case 4:u.sent(),u.label=5;case 5:u.trys.push([5,10,11,12]),r=$(this._indexers),i=r.next(),u.label=6;case 6:return i.done?[3,9]:[4,i.value.addItem(n)];case 7:u.sent(),u.label=8;case 8:return i=r.next(),[3,6];case 9:return[3,12];case 10:return s=u.sent(),o={error:s},[3,12];case 11:try{i&&!i.done&&(a=r.return)&&a.call(r)}finally{if(o)throw o.error}return[7];case 12:return[3,14];case 13:throw Y.collectionInsertDuplicate;case 14:return[2]}})})},t.prototype._requestUpsert=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c,l,d,p,_,v;return h(this,function(m){switch(m.label){case 0:return e=n[this.keyName],[4,this._blockManager.getFromBlock(e)];case 1:return(r=m.sent())?[3,13]:[4,this._blockManager.putToBlock(e,n)];case 2:return m.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return m.sent(),[4,this._blockManager.putToBlock(e,n)];case 4:m.sent(),m.label=5;case 5:m.trys.push([5,10,11,12]),i=$(this._indexers),s=i.next(),m.label=6;case 6:return s.done?[3,9]:[4,(c=s.value).addItem(n)];case 7:m.sent(),m.label=8;case 8:return s=i.next(),[3,6];case 9:return[3,12];case 10:return o=m.sent(),d={error:o},[3,12];case 11:try{s&&!s.done&&(p=i.return)&&p.call(i)}finally{if(d)throw d.error}return[7];case 12:return[3,23];case 13:return[4,this._blockManager.putToBlock(e,n)];case 14:m.sent(),m.label=15;case 15:m.trys.push([15,21,22,23]),a=$(this._indexers),u=a.next(),m.label=16;case 16:return u.done?[3,20]:(c=u.value).diff(c.getColumnValues(r),c.getColumnValues(n))===0?[3,19]:[4,c.removeItem(r)];case 17:return m.sent(),[4,c.addItem(n)];case 18:m.sent(),m.label=19;case 19:return u=a.next(),[3,16];case 20:return[3,23];case 21:return l=m.sent(),_={error:l},[3,23];case 22:try{u&&!u.done&&(v=a.return)&&v.call(a)}finally{if(_)throw _.error}return[7];case 23:return[2]}})})},t.prototype._requestUpdate=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return e=n[this.keyName],[4,this._blockManager.getFromBlock(e)];case 1:return(r=l.sent())?[4,this._blockManager.putToBlock(e,n)]:[3,11];case 2:l.sent(),l.label=3;case 3:l.trys.push([3,9,10,11]),i=$(this._indexers),s=i.next(),l.label=4;case 4:return s.done?[3,8]:(o=s.value).diff(o.getColumnValues(r),o.getColumnValues(n))===0?[3,7]:[4,o.removeItem(r)];case 5:return l.sent(),[4,o.addItem(n)];case 6:l.sent(),l.label=7;case 7:return s=i.next(),[3,4];case 8:return[3,11];case 9:return a=l.sent(),u={error:a},[3,11];case 10:try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}return[7];case 11:return[2]}})})},t.prototype._requestRemove=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return[4,this._blockManager.getFromBlock(n)];case 1:return(e=u.sent())?[4,this._blockManager.removeFromBlock(n)]:[3,10];case 2:u.sent(),u.label=3;case 3:u.trys.push([3,8,9,10]),r=$(this._indexers),i=r.next(),u.label=4;case 4:return i.done?[3,7]:[4,i.value.removeItem(e)];case 5:u.sent(),u.label=6;case 6:return i=r.next(),[3,4];case 7:return[3,10];case 8:return s=u.sent(),o={error:s},[3,10];case 9:try{i&&!i.done&&(a=r.return)&&a.call(r)}finally{if(o)throw o.error}return[7];case 10:return[2]}})})},t.prototype._requestClear=function(){return f(this,void 0,void 0,function(){var n,e,r,i,s;return h(this,function(o){switch(o.label){case 0:return[4,this._blockManager.clearAllBlocks()];case 1:o.sent(),o.label=2;case 2:o.trys.push([2,7,8,9]),n=$(this._indexers),e=n.next(),o.label=3;case 3:return e.done?[3,6]:[4,e.value.clear()];case 4:o.sent(),o.label=5;case 5:return e=n.next(),[3,3];case 6:return[3,9];case 7:return r=o.sent(),i={error:r},[3,9];case 8:try{e&&!e.done&&(s=n.return)&&s.call(n)}finally{if(i)throw i.error}return[7];case 9:return[2]}})})},t.prototype.getByKey=function(n){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,6];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(n)];case 3:return e=i.sent(),this._mutex.unlock(),[2,je(e)];case 4:throw r=i.sent(),this._mutex.unlock(),r;case 5:return[3,7];case 6:throw Y.collectionNotReady;case 7:return[2]}})})},t.prototype.query=function(n){if(n===void 0&&(n={}),this.isReady)return new gp({condition:n.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(n.index),backward:!!n.backward});throw Y.collectionNotReady},t.prototype.insertOne=function(n){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:r.sent(),r.label=2;case 2:if(r.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(n))throw Y.collectionKeyNotGiven;return[4,this._requestInsert(je(n))];case 3:return r.sent(),[4,this._transaction.commit()];case 4:return r.sent(),this._mutex.unlock(),[2,n];case 5:return e=r.sent(),[4,this._transaction.clear()];case 6:throw r.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw Y.collectionNotReady;case 9:return[2]}})})},t.prototype.insertMany=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c=this;return h(this,function(l){switch(l.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:l.sent(),l.label=2;case 2:if(l.trys.push([2,12,,14]),n.some(function(d){return!c._hasPropertyOfKeyName(d)}))throw Y.collectionKeyNotGiven;l.label=3;case 3:l.trys.push([3,8,9,10]),e=$(n),r=e.next(),l.label=4;case 4:return r.done?[3,7]:(i=r.value,[4,this._requestInsert(je(i))]);case 5:l.sent(),l.label=6;case 6:return r=e.next(),[3,4];case 7:return[3,10];case 8:return s=l.sent(),a={error:s},[3,10];case 9:try{r&&!r.done&&(u=e.return)&&u.call(e)}finally{if(a)throw a.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return l.sent(),this._mutex.unlock(),[2,n];case 12:return o=l.sent(),[4,this._transaction.clear()];case 13:throw l.sent(),this._mutex.unlock(),o;case 14:return[3,16];case 15:throw Y.collectionNotReady;case 16:return[2]}})})},t.prototype.upsertOne=function(n){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:r.sent(),r.label=2;case 2:if(r.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(n))throw Y.collectionKeyNotGiven;return[4,this._requestUpsert(je(n))];case 3:return r.sent(),[4,this._transaction.commit()];case 4:return r.sent(),this._mutex.unlock(),[2,n];case 5:return e=r.sent(),[4,this._transaction.clear()];case 6:throw r.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw Y.collectionNotReady;case 9:return[2]}})})},t.prototype.upsertMany=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c=this;return h(this,function(l){switch(l.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:l.sent(),l.label=2;case 2:if(l.trys.push([2,12,,14]),n.some(function(d){return!c._hasPropertyOfKeyName(d)}))throw Y.collectionKeyNotGiven;l.label=3;case 3:l.trys.push([3,8,9,10]),e=$(n),r=e.next(),l.label=4;case 4:return r.done?[3,7]:(i=r.value,[4,this._requestUpsert(je(i))]);case 5:l.sent(),l.label=6;case 6:return r=e.next(),[3,4];case 7:return[3,10];case 8:return s=l.sent(),a={error:s},[3,10];case 9:try{r&&!r.done&&(u=e.return)&&u.call(e)}finally{if(a)throw a.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return l.sent(),this._mutex.unlock(),[2,n];case 12:return o=l.sent(),[4,this._transaction.clear()];case 13:throw l.sent(),this._mutex.unlock(),o;case 14:return[3,16];case 15:throw Y.collectionNotReady;case 16:return[2]}})})},t.prototype.update=function(n){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:r.sent(),r.label=2;case 2:if(r.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(n))throw Y.collectionKeyNotGiven;return[4,this._requestUpdate(je(n))];case 3:return r.sent(),[4,this._transaction.commit()];case 4:return r.sent(),this._mutex.unlock(),[2,n];case 5:return e=r.sent(),[4,this._transaction.clear()];case 6:throw r.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw Y.collectionNotReady;case 9:return[2]}})})},t.prototype.updateIf=function(n,e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l,d,p,_,v,m,y,E=this;return h(this,function(w){switch(w.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,16];case 1:w.sent(),w.label=2;case 2:return w.trys.push([2,13,,15]),r=n.where,i=r===void 0?{}:r,s=n.index,o=s===void 0?null:s,a=n.backward,u=a!==void 0&&a,c=[],[4,new Qs({condition:i,blockManager:this._blockManager,backward:u,indexer:this._getIndexerBy(o)}).each(function(C){return f(E,void 0,void 0,function(){var A,P;return h(this,function(N){if(C.error)throw C.stop(),C.error;if(C.hasNext){if(A=C.nextValue,_n(i,A)&&e.set){if(typeof e.set!="function")for(P in e.set)A[P]=e.set[P];else e.set(A);c.push(A)}C.next()}else C.stop();return[2]})})})];case 3:w.sent(),w.label=4;case 4:w.trys.push([4,9,10,11]),l=$(c),d=l.next(),w.label=5;case 5:return d.done?[3,8]:(p=d.value,[4,this._requestUpdate(je(p))]);case 6:w.sent(),w.label=7;case 7:return d=l.next(),[3,5];case 8:return[3,11];case 9:return _=w.sent(),m={error:_},[3,11];case 10:try{d&&!d.done&&(y=l.return)&&y.call(l)}finally{if(m)throw m.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return w.sent(),this._mutex.unlock(),[2,c];case 13:return v=w.sent(),[4,this._transaction.clear()];case 14:throw w.sent(),this._mutex.unlock(),v;case 15:return[3,17];case 16:throw this._transaction.clear(),Y.collectionNotReady;case 17:return[2]}})})},t.prototype.remove=function(n){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,5,,7]),[4,this._requestRemove(n)];case 3:return r.sent(),[4,this._transaction.commit()];case 4:return r.sent(),this._mutex.unlock(),[3,7];case 5:return e=r.sent(),[4,this._transaction.clear()];case 6:throw r.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw Y.collectionNotReady;case 9:return[2]}})})},t.prototype.removeIf=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c,l,d,p,_,v,m,y=this;return h(this,function(E){switch(E.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:E.sent(),E.label=2;case 2:return E.trys.push([2,13,,14]),e=n.where,r=e===void 0?{}:e,i=n.index,s=i===void 0?null:i,o=n.backward,a=o!==void 0&&o,u=[],[4,new Qs({condition:r,blockManager:this._blockManager,backward:a,indexer:this._getIndexerBy(s)}).each(function(w){return f(y,void 0,void 0,function(){var C,A;return h(this,function(P){if(w.error)throw w.stop(),w.error;return w.hasNext?(C=w.nextValue,_n(r,C)&&(A=C[this.keyName],u.push(A)),w.next()):w.stop(),[2]})})})];case 3:E.sent(),E.label=4;case 4:E.trys.push([4,9,10,11]),c=$(u),l=c.next(),E.label=5;case 5:return l.done?[3,8]:(d=l.value,[4,this._requestRemove(d)]);case 6:E.sent(),E.label=7;case 7:return l=c.next(),[3,5];case 8:return[3,11];case 9:return p=E.sent(),v={error:p},[3,11];case 10:try{l&&!l.done&&(m=c.return)&&m.call(c)}finally{if(v)throw v.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return E.sent(),this._mutex.unlock(),[2,u];case 13:throw _=E.sent(),this._mutex.unlock(),_;case 14:return[3,16];case 15:throw this._transaction.clear(),Y.collectionNotReady;case 16:return[2]}})})},t.prototype.clear=function(){return f(this,void 0,void 0,function(){var n;return h(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[3,7];case 5:return n=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),n;case 7:return[3,9];case 8:throw Y.collectionNotReady;case 9:return[2]}})})},t.prototype.getBlob=function(n){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.get(n)];case 1:return[2,e.sent()]}})})},t.prototype.saveBlob=function(n,e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return[4,this._blobContainer.save(n,e)];case 1:return[2,r.sent()]}})})},t.prototype.removeBlob=function(n){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.remove(n)];case 1:return e.sent(),[2]}})})},t.prototype.removeAllBlobs=function(){return f(this,void 0,void 0,function(){return h(this,function(n){switch(n.label){case 0:return[4,this._blobContainer.clear()];case 1:return n.sent(),[2]}})})},t}(),to="[NESTDB]",Ci=!0,gn=function(){function t(){}return t.off=function(){Ci=!1},t.log=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];Ci&&console.log.apply(console,Z(["".concat(to,"[LOG]")],G(n),!1))},t.warning=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];Ci&&console.warn.apply(console,Z(["".concat(to,"[WARNING]")],G(n),!1))},t.error=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];Ci&&console.error.apply(console,Z(["".concat(to,"[ERROR]")],G(n),!1))},t}(),wp=[{},{a:700400,n:"error"}],Si=function(){function t(n){var e,r,i;this.encryption=(e=n.encryption)!==null&&e!==void 0?e:Fo,this.itemSizeLimit=(r=n.itemSizeLimit)!==null&&r!==void 0?r:4194304,this.metadataBuffer=(i=n.metadataBuffer)!==null&&i!==void 0?i:256}return Object.defineProperty(t.prototype,"_encryptionCheckKey",{get:function(){return"".concat(this.dbname,".encrypt")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_reservedKeys",{get:function(){return[this._encryptionCheckKey]},enumerable:!1,configurable:!0}),t.prototype._getRawKey=function(n,e){return e===void 0&&(e=""),"".concat(n).concat(e)},t.prototype._generateShardPostfixArray=function(n){return n===void 0&&(n=1),Z([],G(Array(n).keys()),!1)},t.prototype._shardify=function(n){var e=this,r=n.key,i=n.value,s=JSON.stringify(this.encryption.encrypt(i)),o=Math.ceil(s.length/this.adjustedItemSizeLimit);return this._generateShardPostfixArray(o).map(function(a){var u={key:e._getRawKey(r,".".concat(a)),data:s.substring(a*e.adjustedItemSizeLimit,(a+1)*e.adjustedItemSizeLimit)};return a===0&&(u.metadata={shards:o}),u})},t.prototype._resetIfEncryptionChanged=function(){return f(this,void 0,void 0,function(){var n,e,r,i,s,o,a,u,c,l=this;return h(this,function(d){switch(d.label){case 0:return[4,this.get(this._encryptionCheckKey)];case 1:if(n=d.sent(),e={encrypted:wp.map(function(p){var _;return(_=l.encryption)===null||_===void 0?void 0:_.encrypt(p)})},!(n&&n.encrypted&&Array.isArray(n.encrypted)))return[3,6];for(s in r=n.encrypted,i=[],r)i.push(s);o=0,d.label=2;case 2:return o<i.length?(s=i[o])in r?(a=s,u=JSON.stringify(n.encrypted[a]),c=JSON.stringify(e.encrypted[a]),u===c?[3,4]:(gn.warning("Encryption algorithm has changed. Stored data would be cleared."),[4,this.clear()])):[3,4]:[3,5];case 3:return d.sent(),[3,5];case 4:return o++,[3,2];case 5:return[3,8];case 6:return[4,this.clear()];case 7:d.sent(),d.label=8;case 8:return[4,this.set({key:this._encryptionCheckKey,value:e})];case 9:return d.sent(),[2]}})})},Object.defineProperty(t.prototype,"adjustedItemSizeLimit",{get:function(){return Math.max(this.itemSizeLimit-this.metadataBuffer,4)},enumerable:!1,configurable:!0}),t.prototype.usage=function(){return f(this,void 0,void 0,function(){var n,e,r,i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return n=0,[4,this._getAllRawKeys()];case 1:e=l.sent(),l.label=2;case 2:l.trys.push([2,7,8,9]),r=$(e),i=r.next(),l.label=3;case 3:return i.done?[3,6]:(s=i.value,[4,this._getRaw(s)]);case 4:(o=l.sent())&&(n+=JSON.stringify(o).length),l.label=5;case 5:return i=r.next(),[3,3];case 6:return[3,9];case 7:return a=l.sent(),u={error:a},[3,9];case 8:try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}return[7];case 9:return[2,n]}})})},t.prototype.getAllKeys=function(){return f(this,void 0,void 0,function(){var n=this;return h(this,function(e){switch(e.label){case 0:return[4,this._getAllRawKeys()];case 1:return[2,e.sent().filter(function(r){return r.endsWith(".0")}).map(function(r){return r.replace(/\.0$/,"")}).filter(function(r){return!n._reservedKeys.includes(r)})]}})})},t.prototype.get=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u=this;return h(this,function(c){switch(c.label){case 0:return e=this._getRawKey(n,".0"),[4,this._getRaw(e)];case 1:if(!(r=c.sent()))return[3,7];c.label=2;case 2:return c.trys.push([2,6,,7]),i=r.data,(s=r.metadata)!=null&&s.shards&&s.shards>1?[4,Promise.all(this._generateShardPostfixArray(s==null?void 0:s.shards).map(function(l){return f(u,void 0,void 0,function(){var d,p;return h(this,function(_){switch(_.label){case 0:return l>0?(d=this._getRawKey(n,".".concat(l)),[4,this._getRaw(d)]):[3,2];case 1:if(!(p=_.sent()))throw Y.storeBrokenIntegrity;return[2,p.data];case 2:return[2,i]}})})}))]:[3,4];case 3:return a=c.sent(),[3,5];case 4:a=[i],c.label=5;case 5:return o=a,[2,this.encryption.decrypt(JSON.parse(o.join("")))];case 6:return c.sent(),[2,null];case 7:return[2,null]}})})},t.prototype.set=function(n){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return e=this._shardify(n),[4,this._setRaw(e)];case 1:return r.sent(),[2,b({},n.value)]}})})},t.prototype.setMany=function(n){return f(this,void 0,void 0,function(){var e,r=this;return h(this,function(i){switch(i.label){case 0:return e=[],[4,this._setRaw(e.concat.apply(e,Z([],G(n.map(function(s){return r._shardify(s)})),!1)))];case 1:return i.sent(),[2,n.map(function(s){return s.value})]}})})},t.prototype.remove=function(n){return f(this,void 0,void 0,function(){var e,r,i,s=this;return h(this,function(o){switch(o.label){case 0:return e=this._getRawKey(n,".0"),[4,this._getRaw(e)];case 1:return(r=o.sent())?(i=r.metadata,[4,this._removeRaw(this._generateShardPostfixArray(i==null?void 0:i.shards).map(function(a){return s._getRawKey(n,".".concat(a))}))]):[3,3];case 2:return o.sent(),[2,!0];case 3:return[2,!1]}})})},t.prototype.removeMany=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c,l,d=this;return h(this,function(p){switch(p.label){case 0:e=[],r=function(_){var v,m,y;return h(this,function(E){switch(E.label){case 0:return v=i._getRawKey(_,".0"),[4,i._getRaw(v)];case 1:return(m=E.sent())&&(y=m.metadata,e.push.apply(e,Z([],G(i._generateShardPostfixArray(y==null?void 0:y.shards).map(function(w){return d._getRawKey(_,".".concat(w))})),!1))),[2]}})},i=this,p.label=1;case 1:p.trys.push([1,6,7,8]),s=$(n),o=s.next(),p.label=2;case 2:return o.done?[3,5]:(a=o.value,[5,r(a)]);case 3:p.sent(),p.label=4;case 4:return o=s.next(),[3,2];case 5:return[3,8];case 6:return u=p.sent(),c={error:u},[3,8];case 7:try{o&&!o.done&&(l=s.return)&&l.call(s)}finally{if(c)throw c.error}return[7];case 8:return e.length>0?[4,this._removeRaw(e)]:[3,10];case 9:p.sent(),p.label=10;case 10:return[2,n]}})})},t}(),Be={},Kt=function(t){function n(e){e===void 0&&(e={});var r,i=this;i=t.call(this,b(b({},e),{itemSizeLimit:(r=e.itemSizeLimit)!==null&&r!==void 0?r:4194304}))||this;var s=e.delay,o=s===void 0?1:s;return i.delay=o,i.observer={},i}return g(n,t),Object.defineProperty(n.prototype,"rawData",{get:function(){return Be[this.dbname]},set:function(e){Be[this.dbname]=e},enumerable:!1,configurable:!0}),n.prototype._getAllRawKeys=function(){return f(this,void 0,void 0,function(){return h(this,function(e){if(Be[this.dbname])return[2,Object.keys(Be[this.dbname])];throw Y.storeNotAvailable})})},n.prototype._getRaw=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return Be[this.dbname]?[4,Ei(this.delay)]:[3,2];case 1:return r.sent(),[2,Be[this.dbname][e]?b({key:e},Be[this.dbname][e]):null];case 2:throw Y.storeNotAvailable}})})},n.prototype._setRaw=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l;return h(this,function(d){switch(d.label){case 0:return Be[this.dbname]?[4,Ei(this.delay)]:[3,2];case 1:d.sent();try{for(r=$(e),i=r.next();!i.done;i=r.next())s=i.value,o=s.key,a=s.data,u=s.metadata,Be[this.dbname][o]=Object.freeze({data:a,metadata:u})}catch(p){c={error:p}}finally{try{i&&!i.done&&(l=r.return)&&l.call(r)}finally{if(c)throw c.error}}return[3,3];case 2:throw Y.storeNotAvailable;case 3:return[2]}})})},n.prototype._removeRaw=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return Be[this.dbname]?[4,Ei(this.delay)]:[3,2];case 1:u.sent();try{for(r=$(e),i=r.next();!i.done;i=r.next())s=i.value,Be[this.dbname][s]&&delete Be[this.dbname][s]}catch(c){o={error:c}}finally{try{i&&!i.done&&(a=r.return)&&a.call(r)}finally{if(o)throw o.error}}return[3,3];case 2:throw Y.storeNotAvailable;case 3:return[2]}})})},n.prototype.observe=function(e,r,i){var s=this;this.observer[e]||(this.observer[e]={}),r.forEach(function(o){return s.observer[e][o]=i})},n.prototype.checkAvailability=function(){return f(this,void 0,void 0,function(){return h(this,function(e){return[2]})})},n.prototype.init=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return this.dbname=e,Be[this.dbname]||(Be[this.dbname]={}),[4,this._resetIfEncryptionChanged()];case 1:return r.sent(),[2]}})})},n.prototype.set=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){if((r=this.observer[e.key])&&typeof r.set=="function"&&(i=r.set()))throw i;return[2,t.prototype.set.call(this,e)]})})},n.prototype.setMany=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c;return h(this,function(l){try{for(r=$(e),i=r.next();!i.done;i=r.next())if(s=i.value,(o=this.observer[s.key])&&typeof o.set=="function"&&(a=o.set()))throw a}catch(d){u={error:d}}finally{try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}}return[2,t.prototype.setMany.call(this,e)]})})},n.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,Ei(this.delay)];case 1:return e.sent(),Be[this.dbname]={},[2]}})})},n}(Si),Ju="NestDBStore";(function(t){t[t.UNINITIALIZED=0]="UNINITIALIZED",t[t.OPENING=1]="OPENING",t[t.OPEN=2]="OPEN",t[t.CLOSED=3]="CLOSED"})(ht||(ht={}));var Ip=function(t){function n(e){e===void 0&&(e={});var r,i=this;return(i=t.call(this,b(b({},e),{itemSizeLimit:(r=e.itemSizeLimit)!==null&&r!==void 0?r:104857600}))||this)._storeName=Ju,i._state=ht.UNINITIALIZED,i._openJobQueue=[],i._window=typeof window<"u"?window:void 0,i._indexedDb=i._window?i._window.indexedDB||i._window.mozIndexedDB||i._window.webkitIndexedDB||i._window.msIndexedDB:void 0,i}return g(n,t),Object.defineProperty(n.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isTransactionReusable",{get:function(){var e=navigator==null?void 0:navigator.userAgent;if(e){var r="15.0.0";if(e.includes("Safari/")?r=e.split("Safari/")[0].trim().split("Version/")[1]:e.includes("AppleWebKit/")&&(r=e.split("AppleWebKit/")[0].trim().split("Version/")[1]),(r?parseInt(r.split(".")[0]):0)<=14)return!1}return!0},enumerable:!1,configurable:!0}),n.prototype._putToObjectStore=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){return[2,new Promise(function(s,o){var a=e.put(r);a.addEventListener("success",function(u){s(u.target.result)}),a.addEventListener("error",function(){o("Failed to write.")})})]})})},n.prototype._deleteFromObjectStore=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){return[2,new Promise(function(s,o){var a=e.delete(r);a.addEventListener("success",function(){return s(r)}),a.addEventListener("error",function(u){return o(u.target.error)})})]})})},n.prototype._openDatabase=function(e){var r=this;return new Promise(function(i,s){if(r._indexedDb){r._state=ht.OPENING;var o=r._indexedDb.open(e);o.addEventListener("upgradeneeded",function(a){a.target.result.createObjectStore(Ju,{keyPath:"key"})}),o.addEventListener("success",function(a){r._state=ht.OPEN,r._database=a.target.result,r._openJobQueue.forEach(function(u){return u()}),r._openJobQueue=[],r._database.onclose=function(){r._database=void 0,r._state=ht.OPENING,setTimeout(function(){r._openDatabase(e)},5)},i(r._database)}),o.addEventListener("error",function(a){r._state=ht.UNINITIALIZED,s(a.target.error)})}else s(Y.storeNotAvailable)})},n.prototype._getObjectStore=function(e){return f(this,void 0,void 0,function(){var r=this;return h(this,function(i){switch(i.label){case 0:return this._database?[2,this._database.transaction(this._storeName,e).objectStore(this._storeName)]:[3,1];case 1:switch(this._state){case ht.UNINITIALIZED:case ht.OPEN:return[3,2];case ht.OPENING:case ht.CLOSED:return[3,3]}return[3,4];case 2:throw Y.storeNotInitialized;case 3:return[2,new Promise(function(s){r._openJobQueue.push(function(){return s(r._getObjectStore(e))})})];case 4:return[4,this._getObjectStore(e)];case 5:return[2,i.sent()]}})})},n.prototype._getAllRawKeys=function(){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return[4,this._getObjectStore("readonly")];case 1:return e=r.sent(),[4,new Promise(function(i,s){var o=e.getAllKeys();o.addEventListener("success",function(a){i(a.target.result)}),o.addEventListener("error",function(a){return s(a.target.error)})})];case 2:return[2,r.sent()]}})})},n.prototype._getRaw=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return[4,this._getObjectStore("readonly")];case 1:return r=i.sent(),[4,new Promise(function(s,o){var a=r.get(e);a.addEventListener("success",function(u){var c;s((c=u==null?void 0:u.target)===null||c===void 0?void 0:c.result)}),a.addEventListener("error",function(u){return o(u.target.error)})})];case 2:return[2,i.sent()]}})})},n.prototype._setRaw=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l=this;return h(this,function(d){switch(d.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:return r=d.sent(),this.isTransactionReusable?[4,Promise.all(e.map(function(p){return l._putToObjectStore(r,p)}))]:[3,3];case 2:return d.sent(),[3,10];case 3:d.trys.push([3,8,9,10]),i=$(e),s=i.next(),d.label=4;case 4:return s.done?[3,7]:(o=s.value,[4,this._putToObjectStore(r,o)]);case 5:d.sent(),d.label=6;case 6:return s=i.next(),[3,4];case 7:return[3,10];case 8:return a=d.sent(),u={error:a},[3,10];case 9:try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}return[7];case 10:return[2]}})})},n.prototype._removeRaw=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l=this;return h(this,function(d){switch(d.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:return r=d.sent(),this.isTransactionReusable?[4,Promise.all(e.map(function(p){return l._deleteFromObjectStore(r,p)}))]:[3,3];case 2:return d.sent(),[3,10];case 3:d.trys.push([3,8,9,10]),i=$(e),s=i.next(),d.label=4;case 4:return s.done?[3,7]:(o=s.value,[4,this._deleteFromObjectStore(r,o)]);case 5:d.sent(),d.label=6;case 6:return s=i.next(),[3,4];case 7:return[3,10];case 8:return a=d.sent(),u={error:a},[3,10];case 9:try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}return[7];case 10:return[2]}})})},n.prototype._triggerDatabaseClose=function(){this._database&&this._database.onclose&&this._database.onclose(new Event("dummy"))},n.prototype.checkAvailability=function(){return f(this,void 0,void 0,function(){var e,r=this;return h(this,function(i){switch(i.label){case 0:if(!((e=typeof window<"u"?window:null)!=null&&e.indexedDB||e!=null&&e.mozIndexedDB||e!=null&&e.webkitIndexedDB||e!=null&&e.msIndexedDB))return[3,6];if(this._indexedDb=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,!this._window||!Ti())return[3,4];if(!(Ti()&&navigator.userAgent&&navigator.userAgent.includes("Edge/")))return[3,1];if(!this._window.indexedDB&&(e.PointerEvent||e.MSPointerEvent))throw Y.storeNotAvailableInPrivateBrowsing;return[3,3];case 1:return[4,new Promise(function(s,o){if(r._indexedDb)try{var a=r._indexedDb.open("_testMozilla");a.onerror=function(){return o(Y.storeNotAvailableInPrivateBrowsing)},a.onsuccess=function(u){if(u.target.result.close(),r._indexedDb){var c=r._indexedDb.deleteDatabase("_testMozilla");c.onerror=function(){return s()},c.onsuccess=function(){return s()}}else o(Y.storeNotAvailable)}}catch{o(Y.storeNotAvailableInPrivateBrowsing)}else o(Y.storeNotAvailable)})];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:throw Y.storeNotAvailable;case 5:return[3,7];case 6:throw Y.storeNotAvailable;case 7:return[2]}})})},n.prototype.init=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return this.dbname=e,[4,this.checkAvailability()];case 1:return r.sent(),[4,this._openDatabase(e)];case 2:return r.sent(),[4,this._resetIfEncryptionChanged()];case 3:return r.sent(),[2]}})})},n.prototype.clear=function(){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:return e=r.sent(),[4,new Promise(function(i,s){var o=e.clear();o.addEventListener("success",function(){return i()}),o.addEventListener("error",function(a){return s(a.target.error)})})];case 2:return[2,r.sent()]}})})},n}(Si),Tp=function(t){function n(e){var r=this,i=e.AsyncStorage,s=e.itemSizeLimit,o=s===void 0?6291456:s,a=rl(e,["AsyncStorage","itemSizeLimit"]);return(r=t.call(this,b(b({},a),{itemSizeLimit:o}))||this)._asyncStorage=i,r}return g(n,t),n.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},n.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},n.prototype._getAllRawKeys=function(){return f(this,void 0,void 0,function(){var e,r=this;return h(this,function(i){switch(i.label){case 0:return[4,this._asyncStorage.getAllKeys()];case 1:return e=i.sent(),[2,e.filter(function(s){return r._isBelonging(s)}).map(function(s){return s.substring("".concat(r.dbname,"/").length)})]}})})},n.prototype._getRaw=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return[4,this._asyncStorage.getItem(this._getActualKey(e))];case 1:return[2,(r=i.sent())?JSON.parse(r):null]}})})},n.prototype._setRaw=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:r=[];try{for(i=$(e),s=i.next();!s.done;s=i.next())o=s.value,a=o.key,o.data.length<=this.adjustedItemSizeLimit&&r.push([this._getActualKey(a),JSON.stringify(o)])}catch(d){u={error:d}}finally{try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}}return[4,this._asyncStorage.multiSet(r)];case 1:return l.sent(),[2]}})})},n.prototype._removeRaw=function(e){return f(this,void 0,void 0,function(){var r=this;return h(this,function(i){switch(i.label){case 0:return[4,this._asyncStorage.multiRemove(e.map(function(s){return r._getActualKey(s)}))];case 1:return i.sent(),[2]}})})},n.prototype.checkAvailability=function(){return f(this,void 0,void 0,function(){return h(this,function(e){if(!this._asyncStorage)throw Y.storeNotAvailable;return[2]})})},n.prototype.init=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return this.dbname=e,[4,this._resetIfEncryptionChanged()];case 1:return r.sent(),[2]}})})},n.prototype.clear=function(){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return[4,this.getAllKeys()];case 1:return e=r.sent(),[4,this.removeMany(e)];case 2:return r.sent(),[2]}})})},n}(Si);(function(t){function n(e){var r,i=this;return(i=t.call(this,b(b({},e),{itemSizeLimit:(r=e.itemSizeLimit)!==null&&r!==void 0?r:6291456}))||this)._mmkv=e.MMKV,i}g(n,t),n.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},n.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},n.prototype._getAllRawKeys=function(){return f(this,void 0,void 0,function(){var e,r=this;return h(this,function(i){switch(i.label){case 0:return[4,this._mmkv.getAllKeys()];case 1:return e=i.sent(),[2,e.filter(function(s){return r._isBelonging(s)}).map(function(s){return s.substring("".concat(r.dbname,"/").length)})]}})})},n.prototype._getRaw=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return[4,this._mmkv.getString(this._getActualKey(e))];case 1:return[2,(r=i.sent())?JSON.parse(r):null]}})})},n.prototype._setRaw=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){try{for(r=$(e),i=r.next();!i.done;i=r.next())s=i.value,o=s.key,s.data.length<=this.adjustedItemSizeLimit&&this._mmkv.set(this._getActualKey(o),JSON.stringify(s))}catch(l){a={error:l}}finally{try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(a)throw a.error}}return[2]})})},n.prototype._removeRaw=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a;return h(this,function(u){try{for(r=$(e),i=r.next();!i.done;i=r.next())s=i.value,this._mmkv.delete(this._getActualKey(s))}catch(c){o={error:c}}finally{try{i&&!i.done&&(a=r.return)&&a.call(r)}finally{if(o)throw o.error}}return[2]})})},n.prototype.checkAvailability=function(){return f(this,void 0,void 0,function(){return h(this,function(e){if(!this._mmkv)throw Y.storeNotAvailable;return[2]})})},n.prototype.init=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return this.dbname=e,[4,this._resetIfEncryptionChanged()];case 1:return r.sent(),[2]}})})},n.prototype.clear=function(){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:return[4,this.getAllKeys()];case 1:return e=r.sent(),[4,this.removeMany(e)];case 2:return r.sent(),[2]}})})}})(Si);var Ut;(function(t){t.INIT="INIT",t.OPENING="OPENING",t.OPENED="OPENED",t.CLOSED="CLOSED"})(Ut||(Ut={}));var be,Cp=function(){function t(n){var e=n.name,r=n.version,i=n.store,s=n.config;this.name=e,this._version=r,this._state=Ut.INIT,this._config=s||new wr({dbname:e}),this._store=i,this._event={success:Ir,error:Ir,storeReplaced:Ir,upgrade:Wu},this._collections=new Map,this._globalMutex=new Js("".concat(this.name,".lock")),this._config.disableLogger&&gn.off(),new ct({dbname:e,limit:this._config.cacheLimit})}return Object.defineProperty(t.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"store",{get:function(){return this._store},enumerable:!1,configurable:!0}),t.prototype.estimateUsage=function(){return f(this,void 0,void 0,function(){return h(this,function(n){switch(n.label){case 0:return[4,(e=this._store,f(void 0,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return[4,e.usage()];case 1:return[2,r.sent()]}})}))];case 1:return[2,n.sent()]}var e})})},t.prototype.commitSchema=function(n){return f(this,void 0,void 0,function(){var e=this;return h(this,function(r){switch(r.label){case 0:return this._state!==Ut.OPENING?[3,2]:[4,Promise.all(n.map(function(i){return f(e,void 0,void 0,function(){var s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return s=i.collectionName,o=i.keyName,a=i.index,u=a===void 0?[]:a,this._collections.has(s)||this._collections.set(s,new eo({dbname:this.name,collectionName:s,keyName:o,indexes:u,store:this._store})),(c=this._collections.get(s))?[4,c.init()]:[3,2];case 1:l.sent(),l.label=2;case 2:return[2]}})})}))];case 1:return r.sent(),[3,3];case 2:throw Y.databaseSchemaNotOnUpgrade;case 3:return[2]}})})},t.prototype.open=function(){var n;return f(this,void 0,void 0,function(){var e,r,i,s,o=this;return h(this,function(a){switch(a.label){case 0:return[4,this._globalMutex.lock()];case 1:if(a.sent(),this._state===Ut.OPENED)return[3,12];this._state=Ut.OPENING,a.label=2;case 2:return a.trys.push([2,5,,12]),[4,this._store.init(this.name)];case 3:return a.sent(),u=this.name,e="".concat(Ws(u),".metadata"),r={version:0,collectionNames:[]},[4,this._store.get(e)];case 4:return i=(n=a.sent())!==null&&n!==void 0?n:r,[2,new Promise(function(c,l){var d=function(_){i.version<o._version?o._event.upgrade(i.version,function(v){return f(o,void 0,void 0,function(){var m;return h(this,function(y){switch(y.label){case 0:if(v)return[3,5];i.version++,i.collectionNames=Array.from(this._collections.keys()),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,this._store.set({key:e,value:i})];case 2:return y.sent(),_({continued:!0}),[3,4];case 3:return m=y.sent(),_({continued:!1,err:m}),[3,4];case 4:return[3,6];case 5:_({continued:!1,err:v}),y.label=6;case 6:return[2]}})})}):_({continued:!1})},p=function(_){var v=_.continued,m=v!==void 0&&v,y=_.err,E=y===void 0?null:y;if(m)setTimeout(function(){return d(p)},10);else if(E)gn.error(E.message),o._globalMutex.unlock(),o._event.error(E),l(E);else{var w=[];i.collectionNames.forEach(function(C){var A=o._collections.get(C);A&&A.state===pn.READY||w.push(f(o,void 0,void 0,function(){var P,N;return h(this,function(q){switch(q.label){case 0:return[4,eo.metadataOf(this.name,C,this._store)];case 1:return(P=q.sent())?(N=new eo({dbname:this.name,collectionName:C,keyName:P.keyName,indexes:P.indexes,store:this._store}),this._collections.set(C,N),[4,N.init()]):[3,3];case 2:q.sent(),q.label=3;case 3:return[2]}})}))}),Promise.all(w).then(function(){o._state=Ut.OPENED,o._globalMutex.unlock(),o._event.success(),c()}).catch(function(C){gn.error(C.message),o._globalMutex.unlock(),o._event.error(C),l(C)})}};d(p)})];case 5:switch(s=a.sent(),s.code){case ae.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return[3,6];case ae.STORE_NOT_AVAILABLE:return[3,8]}return[3,10];case 6:return gn.warning("Access to the local storage is not allowed. Switched to MemoryStore automatically."),this._store=new Kt({}),this._globalMutex.unlock(),this._event.error(s),this._event.storeReplaced(this._store),[4,this.open()];case 7:return a.sent(),[3,11];case 8:return gn.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new Kt({}),this._globalMutex.unlock(),this._event.error(s),this._event.storeReplaced(this._store),[4,this.open()];case 9:return a.sent(),[3,11];case 10:throw gn.error(s.message),this._globalMutex.unlock(),this._event.error(s),s;case 11:return[3,12];case 12:return[2]}var u})})},t.prototype.close=function(){this._collections.forEach(function(n){return n.close()}),this._state=Ut.CLOSED},t.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(n){switch(n.label){case 0:return[4,Promise.all(Array.from(this._collections.values()).map(function(e){return e.clear()}))];case 1:return n.sent(),[2]}})})},t.prototype.reset=function(){return f(this,void 0,void 0,function(){var n,e=this;return h(this,function(r){switch(r.label){case 0:return this.close(),(n=ct.get(this.name))&&n.clearByCondition(function(i){return i.key.startsWith(Ws(e.name))}),[4,this._store.clear()];case 1:return r.sent(),[2]}})})},t.prototype.on=function(n,e){this._event[n]=e},t.prototype.off=function(n){typeof this._event[n]=="function"&&(n==="upgrade"?this._event[n]=Wu:this._event[n]=Ir)},t.prototype.collection=function(n){var e=this._collections.get(n);if(e)return e;throw Y.collectionNotReady},t}(),zn=function(){function t(n){var e,r,i,s;this.messageTypeFilter=(e=n==null?void 0:n.messageTypeFilter)!==null&&e!==void 0?e:Ye.ALL,this.customTypesFilter=(r=n==null?void 0:n.customTypesFilter)!==null&&r!==void 0?r:null,this.senderUserIdsFilter=(i=n==null?void 0:n.senderUserIdsFilter)!==null&&i!==void 0?i:null,this.replyType=(s=n==null?void 0:n.replyType)!==null&&s!==void 0?s:Ve.NONE}return t.prototype.clone=function(){var n=new t,e=JSON.parse(JSON.stringify(this));return Object.keys(e).forEach(function(r){n[r]=e[r]}),n},t.prototype.match=function(n){switch(this.messageTypeFilter){case Ye.USER:if(n.messageType!==he.USER)return!1;break;case Ye.FILE:if(n.messageType!==he.FILE)return!1;break;case Ye.ADMIN:if(n.messageType!==he.ADMIN)return!1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes("*")&&!this.customTypesFilter.includes(n.customType)||this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0&&(!(n instanceof kt)||!this.senderUserIdsFilter.includes(n.sender.userId)))return!1;if(n instanceof tt)switch(this.replyType){case Ve.NONE:if(n.parentMessageId>0)return!1;break;case Ve.ONLY_REPLY_TO_CHANNEL:if(n instanceof kt&&n.parentMessageId>0&&!n.replyToChannel)return!1}return!0},t}();(function(t){t.CHANNEL_LATEST="channel_latest",t.NEWEST_CHILD_MESSAGE="newest_child_message"})(be||(be={}));var Cr,It=function(t){switch(t){case be.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case be.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}},Sp=function(){return["channelUrl","-createdAt","-notificationId"]};b(b({},Au),{scheduledAt:void 0}),b(b({},gi),{scheduledAt:0,file:void 0,fileUrl:void 0,fileName:void 0,mimeType:void 0,fileSize:void 0,thumbnailSizes:void 0,requireAuth:!1});var ec="UnsentMessage",Ap="reqId",Ai={},Sr=function(t){function n(e){var r=t.call(this,e)||this;return r._mutex=new Js("unsendmessagecache.lock"),Ai[e]=r,r}return g(n,t),Object.defineProperty(n.prototype,"_cacheContext",{get:function(){return S.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),n.of=function(e,r){return r===void 0&&(r=!1),Ai[e]&&!r||(Ai[e]=new n(e)),Ai[e]},Object.defineProperty(n.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb,r=e==null?void 0:e.collection(ec);if(!r)throw I.databaseError;return r},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),n.prototype._serialize=function(e){if(e.messageId>0)throw I.invalidParameters;var r,i=b({},e.serialize());return e instanceof $e?(e.messageParams&&(i.messageParams=Su(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(i.scheduledInfo.scheduledMessageParams=(r=e.scheduledInfo.scheduledMessageParams,b(b({},Su(r)),{scheduledAt:r.scheduledAt})))):e instanceof ge?(e.messageParams&&(i.messageParams=Ou(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(i.scheduledInfo.scheduledMessageParams=function(s){return b(b({},Ou(s)),{scheduledAt:s.scheduledAt})}(e.scheduledInfo.scheduledMessageParams))):e instanceof ut&&e.messageParams&&(i.messageParams=function(s){return x({fileInfoList:s.fileInfoList,isReplyToChannel:s.isReplyToChannel,pushNotificationDeliveryOption:s.pushNotificationDeliveryOption})}(e.messageParams)),i},n.prototype._deserialize=function(e){return e=b(b({},e),{messageId:parseInt(e.messageId)}),Se.of(this._iid).buildMessageFromSerializedData(e)},n.prototype._deserializeWithMessageCreateParams=function(e){var r,i,s;return f(this,void 0,void 0,function(){var o,a,u,c,l,d,p=this;return h(this,function(_){switch(_.label){case 0:return o=Se.of(this._iid),a=this._deserialize(e),e.messageParams?a instanceof $e?(c=e.messageParams,a.messageParams=o.buildUserMessageCreateParamsFromSerializedData(c,a),[3,6]):[3,1]:[3,6];case 1:return a instanceof ge?(c=e.messageParams).fileKey&&typeof c.fileKey=="string"&&$s((r=c.fileType)!==null&&r!==void 0?r:"")?(u=c,[4,this.collection.getBlob(c.fileKey)]):[3,3]:[3,4];case 2:u.file=(i=_.sent())!==null&&i!==void 0?i:void 0,_.label=3;case 3:return a.messageParams=o.buildFileMessageCreateParamsFromSerializedData(c,a),[3,6];case 4:return a instanceof ut&&(c=e.messageParams)&&c.fileInfoList?(a.messageParams=o.buildMultipleFilesMessageCreateParamsFromSerializedData(c,a),[4,Promise.all(a.messageParams.fileInfoList.map(function(v){return f(p,void 0,void 0,function(){var m,y,E,w,C;return h(this,function(A){switch(A.label){case 0:return typeof((y=v._uploadedMetaData)===null||y===void 0?void 0:y.fileKey)=="string"&&$s((w=(E=v._uploadedMetaData)===null||E===void 0?void 0:E.fileType)!==null&&w!==void 0?w:"")?(m=v,[4,this.collection.getBlob(v._uploadedMetaData.fileKey)]):[3,2];case 1:m.file=(C=A.sent())!==null&&C!==void 0?C:void 0,A.label=2;case 2:return[2]}})})}))]):[3,6];case 5:_.sent(),_.label=6;case 6:return a.scheduledInfo&&e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams?a instanceof $e?(l=e.scheduledInfo.scheduledMessageParams,a.scheduledInfo.scheduledMessageParams=o.buildScheduledUserMessageCreateParamsFromSerializedData(l,a),[3,10]):[3,7]:[3,10];case 7:return a instanceof ge?(l=e.scheduledInfo.scheduledMessageParams).fileKey&&typeof l.fileKey=="string"&&typeof l.fileType=="string"&&$s(l.fileType)?(d=l,[4,this.collection.getBlob(l.fileKey)]):[3,9]:[3,10];case 8:d.file=(s=_.sent())!==null&&s!==void 0?s:void 0,_.label=9;case 9:a.scheduledInfo.scheduledMessageParams=o.buildScheduledFileMessageCreateParamsFromSerializedData(l,a),_.label=10;case 10:return[2,a]}})})},n.prototype._getFileInfoBlobKey=function(e,r){return"".concat(e,".").concat(r)},n.prototype.get=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(r=i.sent())return[2,this._deserializeWithMessageCreateParams(r)];i.label=2;case 2:return[2,void 0]}})})},n.prototype.fetch=function(e){var r=e.channelUrl,i=e.filter,s=i===void 0?new zn:i,o=e.order,a=o===void 0?be.CHANNEL_LATEST:o,u=e.sendingStatus,c=e.backward,l=c!==void 0&&c,d=e.parentMessageId;return f(this,void 0,void 0,function(){var p,_,v,m,y=this;return h(this,function(E){switch(E.label){case 0:return this.localCacheEnabled?(p=It(a),_={"/where":function(w){return!!(a!==be.NEWEST_CHILD_MESSAGE||d&&w.parentMessageId!==0&&w.parentMessageId===d)&&s.match(y._deserialize(w))}},r&&(_.channelUrl=r),u&&(_.sendingStatus=u),v={where:_,index:p,backward:l},[4,this.collection.query(v)]):[3,3];case 1:return[4,E.sent().fetch({})];case 2:return m=E.sent(),[2,Promise.all(m.map(function(w){return f(y,void 0,void 0,function(){return h(this,function(C){switch(C.label){case 0:return[4,this._deserializeWithMessageCreateParams(w)];case 1:return[2,C.sent()]}})})}))];case 3:return[2,[]]}})})},n.prototype.getAllChildMessages=function(e,r){return r===void 0&&(r=new zn),f(this,void 0,void 0,function(){return h(this,function(i){switch(i.label){case 0:return[4,this.fetch({filter:r,order:be.NEWEST_CHILD_MESSAGE,channelUrl:e.channelUrl,backward:!1,parentMessageId:e.messageId})];case 1:return[2,i.sent()]}})})},n.prototype.upsert=function(e){return f(this,void 0,void 0,function(){var r=this;return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map(function(s){return f(r,void 0,void 0,function(){var o;return h(this,function(a){switch(a.label){case 0:return s instanceof ge||s instanceof ut?[4,this._mutex.lock()]:[3,4];case 1:return a.sent(),[4,this.saveBlob(s)];case 2:return a.sent(),[4,this._mutex.unlock()];case 3:a.sent(),a.label=4;case 4:return o=this._serialize(s),[4,this.collection.upsertOne(o)];case 5:return a.sent(),[2]}})})}))]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},n.prototype.upsertChildMessages=function(e){return f(this,void 0,void 0,function(){var r=this;return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map(function(s){return f(r,void 0,void 0,function(){var o;return h(this,function(a){switch(a.label){case 0:return o=[],s.threadInfo&&s.threadInfo.replyCount>0?[4,this.getAllChildMessages(s)]:[3,2];case 1:o=a.sent(),a.label=2;case 2:return o.length>0?(o.forEach(function(u){return u.applyParentMessage(s)}),[4,this.upsert(o)]):[3,4];case 3:a.sent(),a.label=4;case 4:return[2]}})})}))]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},n.prototype.remove=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:if(!this.localCacheEnabled)return[3,8];c.label=1;case 1:c.trys.push([1,6,7,8]),r=$(e),i=r.next(),c.label=2;case 2:return i.done?[3,5]:(s=i.value,[4,this.collection.remove(s)]);case 3:c.sent(),c.label=4;case 4:return i=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),a={error:o},[3,8];case 7:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},n.prototype.removeMessagesOfChannel=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e}})]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},n.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},n.prototype.saveBlob=function(e){return f(this,void 0,void 0,function(){var r,i,s,o=this;return h(this,function(a){switch(a.label){case 0:return e instanceof ge?e.messageParams&&(s=e.messageParams).file&&yi(s.file)?[4,this.collection.saveBlob(s.file,e.reqId)]:[3,2]:[3,5];case 1:i=a.sent(),s.fileKey=i,s.fileType=fn.BLOB,a.label=2;case 2:return e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(r=e.scheduledInfo.scheduledMessageParams).file&&yi(r.file)?[4,this.collection.saveBlob(r.file,e.reqId)]:[3,4];case 3:i=a.sent(),r.fileKey=i,r.fileType=fn.BLOB,a.label=4;case 4:return[3,7];case 5:return e instanceof ut&&(s=e.messageParams)&&s.fileInfoList&&Array.isArray(s.fileInfoList)?[4,Promise.all(s.fileInfoList.map(function(u,c){return f(o,void 0,void 0,function(){var l;return h(this,function(d){switch(d.label){case 0:return u.file&&yi(u.file)?[4,this.collection.saveBlob(u.file,this._getFileInfoBlobKey(e.reqId,c))]:[3,2];case 1:l=d.sent(),u._uploadedMetaData||(u._uploadedMetaData={}),u._uploadedMetaData.fileKey=l,u._uploadedMetaData.fileType=fn.BLOB,d.label=2;case 2:return[2]}})})}))]:[3,7];case 6:a.sent(),a.label=7;case 7:return[2]}})})},n}(qe),Ni={},no=function(t){function n(e){var r=t.call(this,e)||this;return Ni[e]=r,r}return g(n,t),Object.defineProperty(n.prototype,"_sdkState",{get:function(){return S.of(this._iid).sdkState},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_cacheContext",{get:function(){return S.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_unsentMessageCache",{get:function(){return Sr.of(this._iid)},enumerable:!1,configurable:!0}),n.of=function(e,r){return r===void 0&&(r=!1),Ni[e]&&!r||(Ni[e]=new n(e)),Ni[e]},Object.defineProperty(n.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return D(!!e).throw(I.databaseError),e.collection(Ks)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),n.prototype._serialize=function(e){return b(b({},e.serialize()),{messageId:"".concat(e.messageId)})},n.prototype._deserialize=function(e){return e=b(b({},e),{messageId:parseInt(e.messageId)}),Se.of(this._iid).buildMessageFromSerializedData(e)},n.prototype.get=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(r=i.sent())return[2,this._deserialize(r)];i.label=2;case 2:return[2,void 0]}})})},n.prototype.fetch=function(e){var r=e.channelUrl,i=e.token,s=e.limit,o=s===void 0?100:s,a=e.filter,u=a===void 0?new zn:a,c=e.order,l=c===void 0?be.CHANNEL_LATEST:c,d=e.backward,p=d!==void 0&&d,_=e.parentMessageId,v=e.isPollOnly,m=v!==void 0&&v,y=e.exactMatch,E=y!==void 0&&y,w=e.inclusive,C=w===void 0||w;return f(this,void 0,void 0,function(){var A,P,N,q=this;return h(this,function(F){switch(F.label){case 0:return this.localCacheEnabled?(A=It(l),P={where:{channelUrl:r,"/where":function(L){if(i)switch(l){case be.CHANNEL_LATEST:if(E&&L.createdAt!==i)return!1;if(p){if(C&&L.createdAt<i||!C&&L.createdAt<=i)return!1}else if(C&&L.createdAt>i||!C&&L.createdAt>=i)return!1;break;case be.NEWEST_CHILD_MESSAGE:if(!_||L.parentMessageId===0||L.parentMessageId!==_)return!1}return!(m&&!L._poll)&&u.match(q._deserialize(L))}},index:A,backward:p},[4,this.collection.query(P)]):[3,3];case 1:return[4,F.sent().fetch({limit:o??void 0})];case 2:return N=F.sent(),[2,Promise.all(N.map(function(L){return f(q,void 0,void 0,function(){return h(this,function(U){return[2,this._deserialize(L)]})})}))];case 3:return[2,[]]}})})},n.prototype.getAllChildMessages=function(e,r){return r===void 0&&(r=new zn),f(this,void 0,void 0,function(){return h(this,function(i){switch(i.label){case 0:return[4,this.fetch({channelUrl:e.channelUrl,token:Date.now(),limit:null,backward:!1,filter:r,order:be.NEWEST_CHILD_MESSAGE,parentMessageId:e.messageId})];case 1:return[2,i.sent()]}})})},n.prototype.upsert=function(e){return f(this,void 0,void 0,function(){var r,i=this;return h(this,function(s){switch(s.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,5];case 1:return s.sent(),r=e.map(function(o){return i._serialize(o)}),[4,this.collection.upsertMany(r)];case 2:return s.sent(),[4,this.upsertChildMessages(e)];case 3:return s.sent(),[4,this._unsentMessageCache.upsertChildMessages(e)];case 4:s.sent(),s.label=5;case 5:return[2]}})})},n.prototype.upsertChildMessages=function(e){return f(this,void 0,void 0,function(){var r=this;return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map(function(s){return f(r,void 0,void 0,function(){var o,a;return h(this,function(u){switch(u.label){case 0:return o=[],!((a=s.threadInfo)===null||a===void 0)&&a.replyCount&&s.threadInfo.replyCount>0?[4,this.getAllChildMessages(s)]:[3,2];case 1:o=u.sent(),u.label=2;case 2:return o.length>0?(o.forEach(function(c){return c.applyParentMessage(s)}),[4,this.upsert(o)]):[3,4];case 3:u.sent(),u.label=4;case 4:return[2]}})})}))]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},n.prototype.remove=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:if(!this.localCacheEnabled)return[3,8];c.label=1;case 1:c.trys.push([1,6,7,8]),r=$(e),i=r.next(),c.label=2;case 2:return i.done?[3,5]:(s=i.value,[4,this.collection.remove("".concat(s))]);case 3:c.sent(),c.label=4;case 4:return i=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),a={error:o},[3,8];case 7:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},n.prototype.removeMessagesOfChannel=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:It(be.CHANNEL_LATEST)})]:[3,6];case 1:return i.sent(),[4,(r=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 2:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 3:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 4:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 5:i.sent(),i.label=6;case 6:return[2]}})})},n.prototype.removeUnderOffset=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":r}},index:It(be.CHANNEL_LATEST)})]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},n.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},n.prototype.countBetween=function(e,r,i){return f(this,void 0,void 0,function(){var s,o=this;return h(this,function(a){switch(a.label){case 0:return this.localCacheEnabled?(s=It(be.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:e,"/where":function(u){var c=o._deserialize(u);return i.includes(c.createdAt)&&r.match(c)}},index:s}).count()]):[3,2];case 1:return[2,a.sent()];case 2:return[2,0]}})})},n.prototype.saveBlobs=function(e){return f(this,void 0,void 0,function(){var r=this;return h(this,function(i){switch(i.label){case 0:return[4,Promise.all(e.map(function(s){return f(r,void 0,void 0,function(){var o,a;return h(this,function(u){switch(u.label){case 0:return s instanceof ge&&s.messageParams&&(o=s.messageParams).file&&yi(o.file)?[4,this.collection.saveBlob(o.file,s.reqId)]:[3,2];case 1:a=u.sent(),o.fileKey=a,u.label=2;case 2:return[2]}})})}))];case 1:return i.sent(),[2]}})})},n.prototype._getGroupChannelPreferenceSize=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return r=0,[4,(i=this._cacheContext.preference).get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 1:return s=c.sent(),[4,i.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 2:return o=c.sent(),[4,i.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 3:return a=c.sent(),[4,i.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 4:return u=c.sent(),s&&(r+=JSON.stringify(s).length),o&&(r+=JSON.stringify(o).length),a&&(r+=JSON.stringify(a).length),u&&(r+=JSON.stringify(u).length),[2,r]}})})},n}(qe),Oi={},Np=function(t){function n(e){var r=t.call(this,e)||this;return Oi[e]=r,r}return g(n,t),Object.defineProperty(n.prototype,"_sdkState",{get:function(){return S.of(this._iid).sdkState},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_cacheContext",{get:function(){return S.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),n.of=function(e,r){return r===void 0&&(r=!1),Oi[e]&&!r||(Oi[e]=new n(e)),Oi[e]},Object.defineProperty(n.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return D(!!e).throw(I.databaseError),e.collection(Bu)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),n.prototype._serialize=function(e){return b({},e.serialize())},n.prototype._deserialize=function(e){return Se.of(this._iid).buildMessageFromSerializedData(e)},n.prototype.get=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(r=i.sent())return[2,this._deserialize(r)];i.label=2;case 2:return[2,void 0]}})})},n.prototype.fetch=function(e){var r=e.channelUrl,i=e.token,s=e.limit,o=s===void 0?100:s,a=e.filter,u=a===void 0?new zn:a,c=e.backward,l=c!==void 0&&c,d=e.exactMatch,p=d!==void 0&&d,_=e.inclusive,v=_===void 0||_;return f(this,void 0,void 0,function(){var m,y=this;return h(this,function(E){switch(E.label){case 0:return this.localCacheEnabled?(m={where:{channelUrl:r,"/where":function(w){if(i){if(p&&w.createdAt!==i)return!1;if(l){if(v&&w.createdAt<i||!v&&w.createdAt<=i)return!1}else if(v&&w.createdAt>i||!v&&w.createdAt>=i)return!1}return u.match(y._deserialize(w))}},index:["channelUrl","-createdAt","-notificationId"],backward:l},[4,this.collection.query(m)]):[3,3];case 1:return[4,E.sent().fetch({limit:o??void 0})];case 2:return[2,E.sent().map(function(w){return y._deserialize(w)})];case 3:return[2,[]]}})})},n.prototype.upsert=function(e){return f(this,void 0,void 0,function(){var r,i=this;return h(this,function(s){switch(s.label){case 0:return this.localCacheEnabled?(r=e.map(function(o){return i._serialize(o)}),[4,this.collection.upsertMany(r)]):[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})},n.prototype.remove=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:if(!this.localCacheEnabled)return[3,8];c.label=1;case 1:c.trys.push([1,6,7,8]),r=$(e),i=r.next(),c.label=2;case 2:return i.done?[3,5]:(s=i.value,[4,this.collection.remove(s)]);case 3:c.sent(),c.label=4;case 4:return i=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),a={error:o},[3,8];case 7:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},n.prototype.markAsReadByTimestamp=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.updateIf({where:{channelUrl:e,messageStatus:hn.SENT,createdAt:{"<":r}}},{set:{messageStatus:hn.READ}})]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},n.prototype.markAsReadByMessageIds=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.updateIf({where:{channelUrl:e,notificationId:{"/in":r},messageStatus:hn.SENT}},{set:{messageStatus:hn.READ}})]:[3,2];case 1:return[2,i.sent().length];case 2:return[2,0]}})})},n.prototype.removeMessagesOfChannel=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:["channelUrl","-createdAt","-notificationId"]})]:[3,6];case 1:return i.sent(),[4,(r=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 2:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 3:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 4:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 5:i.sent(),i.label=6;case 6:return[2]}})})},n.prototype.removeUnderOffset=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":r}},index:It(be.CHANNEL_LATEST)})]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},n.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},n.prototype.countBetween=function(e,r,i){return f(this,void 0,void 0,function(){var s,o=this;return h(this,function(a){switch(a.label){case 0:return this.localCacheEnabled?(s=["channelUrl","-createdAt","-notificationId"],[4,this.collection.query({where:{channelUrl:e,"/where":function(u){var c=o._deserialize(u);return i.includes(c.createdAt)&&r.match(c)}},index:s}).count()]):[3,2];case 1:return[2,a.sent()];case 2:return[2,0]}})})},n}(qe),Ar={},tc=function(t){function n(e){var r=t.call(this,e)||this;return r._observers=new Map,r._dispatcherContext=r._dispatcher.on(function(i){return f(r,void 0,void 0,function(){var s,o,a,u,c,l,d,p,_,v,m,y,E,w,C,A,P,N,q,F=this;return h(this,function(L){switch(L.label){case 0:return i instanceof _e?(s=i.messages,q=i.source,l=i.isWebSocketEventComing,o=s.filter(function(U){return U instanceof tt&&U.channelType!==W.OPEN&&U.messageId>0}),a=s.filter(function(U){return U instanceof tt&&U.channelType!==W.OPEN&&U.messageId===0}),u=s.filter(function(U){return U instanceof yr}),o.length>0?[4,Oe(function(){return f(F,void 0,void 0,function(){return h(this,function(U){switch(U.label){case 0:return[4,this._messageCache.upsert(o)];case 1:return U.sent(),[4,this._unsentMessageCache.remove(o.map(function(K){return K instanceof kt?K.reqId:null}).filter(function(K){return K!==null}))];case 2:return U.sent(),[2]}})})})]:[3,2]):[3,7];case 1:L.sent(),l||this._broadcastUpdateEvent(o,q),L.label=2;case 2:return a.length>0?[4,Oe(function(){return f(F,void 0,void 0,function(){return h(this,function(U){switch(U.label){case 0:return[4,this._unsentMessageCache.upsert(a)];case 1:return U.sent(),[2]}})})})]:[3,4];case 3:L.sent(),l||this._broadcastUpdateEvent(a,q),L.label=4;case 4:return u.length>0?[4,Oe(function(){return f(F,void 0,void 0,function(){return h(this,function(U){switch(U.label){case 0:return[4,this._notificationCache.upsert(u)];case 1:return U.sent(),[2]}})})})]:[3,6];case 5:L.sent(),l||this._broadcastUpdateEvent(u,q),L.label=6;case 6:return[3,24];case 7:return i instanceof eu?(c=i.messageIds,q=i.source,l=i.isWebSocketEventComing,d=c.filter(function(U){return typeof U=="number"}),p=c.filter(function(U){return typeof U=="string"}),[4,Oe(function(){return f(F,void 0,void 0,function(){return h(this,function(U){switch(U.label){case 0:return d.length>0?[4,this._messageCache.remove(d)]:[3,2];case 1:U.sent(),U.label=2;case 2:return p.length>0?[4,this._notificationCache.remove(p)]:[3,4];case 3:U.sent(),U.label=4;case 4:return[2]}})})})]):[3,9];case 8:return L.sent(),l||this._broadcastRemoveEvent(c,q),[3,24];case 9:return i instanceof Vd?(_=i.reqId,q=i.source,[4,Oe(function(){return f(F,void 0,void 0,function(){return h(this,function(U){switch(U.label){case 0:return[4,this._unsentMessageCache.remove([_])];case 1:return U.sent(),[2]}})})})]):[3,11];case 10:return L.sent(),this._broadcastRemoveUnsentEvent(_,q),[3,24];case 11:return i instanceof tu?(v=i.polls,q=i.source,this._cacheContext.localCacheEnabled?(m=v.map(function(U){return U.messageId}),[4,Promise.all(m.map(function(U){return F._messageCache.get(U)}))]):[3,14]):[3,15];case 12:return(y=L.sent().filter(function(U){return U})).length>0&&v.forEach(function(U){var K=y.find(function(ve){return ve.messageId===U.messageId});K&&K.applyPoll(U)}),[4,Oe(function(){return f(F,void 0,void 0,function(){return h(this,function(U){switch(U.label){case 0:return[4,this._messageCache.upsert(y)];case 1:return[2,U.sent()]}})})})];case 13:L.sent(),L.label=14;case 14:return this._broadcastPollChangeLogEvent(v,q),[3,24];case 15:return i instanceof nu?(E=i.event,q=i.source,[4,this._messageCache.get(E.messageId)]):[3,19];case 16:return(w=L.sent())&&w.isUserMessage()&&w.poll&&w.poll.applyPollUpdateEvent(E)?[4,Oe(function(){return f(F,void 0,void 0,function(){return h(this,function(U){switch(U.label){case 0:return[4,this._messageCache.upsert([w])];case 1:return[2,U.sent()]}})})})]:[3,18];case 17:L.sent(),L.label=18;case 18:return this._broadcastPollUpdateEvent(E,q),[3,24];case 19:return i instanceof Rs?(C=i.event,q=i.source,[4,this._messageCache.get(C.messageId)]):[3,23];case 20:return(A=L.sent())&&A.isUserMessage()&&A.poll&&A.poll.applyPollVoteEvent(C)?[4,Oe(function(){return f(F,void 0,void 0,function(){return h(this,function(U){switch(U.label){case 0:return[4,this._messageCache.upsert([A])];case 1:return[2,U.sent()]}})})})]:[3,22];case 21:L.sent(),L.label=22;case 22:return this._broadcastPollVoteEvent(C,q),[3,24];case 23:i instanceof Bd?(P=i.event,q=i.source,P.messageId>0&&this._broadcastReactionUpdateEvent(P,q)):i instanceof Gd&&(N=i.event,q=i.source,this._broadcastThreadUpdateEvent(N,q)),L.label=24;case 24:return[2]}})})}),r}return g(n,t),Object.defineProperty(n.prototype,"_cacheContext",{get:function(){return S.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_dispatcher",{get:function(){return S.of(this._iid).dispatcher},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_messageCache",{get:function(){return no.of(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_unsentMessageCache",{get:function(){return Sr.of(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_notificationCache",{get:function(){return Np.of(this._iid)},enumerable:!1,configurable:!0}),n.of=function(e,r){var i;return r===void 0&&(r=!1),Ar[e]&&!r||(Ar[e]&&((i=Ar[e]._dispatcherContext)===null||i===void 0||i.close()),Ar[e]=new n(e)),Ar[e]},n.prototype._broadcastUpdateEvent=function(e,r){var i,s;try{for(var o=$(this._observers.values()),a=o.next();!a.done;a=o.next()){var u=a.value;u.onUpdate&&u.onUpdate(e,r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},n.prototype._broadcastPollChangeLogEvent=function(e,r){var i,s;try{for(var o=$(this._observers.values()),a=o.next();!a.done;a=o.next()){var u=a.value;u.onPollChangeLogUpdate&&u.onPollChangeLogUpdate(e,r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},n.prototype._broadcastPollUpdateEvent=function(e,r){var i,s;try{for(var o=$(this._observers.values()),a=o.next();!a.done;a=o.next()){var u=a.value;u.onPollUpdate&&u.onPollUpdate(e,r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},n.prototype._broadcastPollVoteEvent=function(e,r){var i,s;try{for(var o=$(this._observers.values()),a=o.next();!a.done;a=o.next()){var u=a.value;u.onPollVote&&u.onPollVote(e,r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},n.prototype._broadcastRemoveEvent=function(e,r){var i,s;try{for(var o=$(this._observers.values()),a=o.next();!a.done;a=o.next()){var u=a.value;u.onRemove&&u.onRemove(e,r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},n.prototype._broadcastRemoveUnsentEvent=function(e,r){var i,s;try{for(var o=$(this._observers.values()),a=o.next();!a.done;a=o.next()){var u=a.value;u.onRemoveUnsent&&u.onRemoveUnsent(e,r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},n.prototype._broadcastReactionUpdateEvent=function(e,r){var i,s;try{for(var o=$(this._observers.values()),a=o.next();!a.done;a=o.next()){var u=a.value;u.onReactionUpdate&&u.onReactionUpdate(e,r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},n.prototype._broadcastThreadUpdateEvent=function(e,r){var i,s;try{for(var o=$(this._observers.values()),a=o.next();!a.done;a=o.next()){var u=a.value;u.onThreadInfoUpdate&&u.onThreadInfoUpdate(e,r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},n.prototype.subscribe=function(e,r){this._observers.set(e,r)},n.prototype.unsubscribe=function(e){this._observers.delete(e)},n.prototype.unsubscribeAll=function(){this._observers.clear()},n}(qe),Op=function(t){function n(e){var r=this,i=e.reverse,s=i!==void 0&&i,o=e.limit,a=o===void 0?20:o,u=e.token;return(r=t.call(this)||this).method=k.GET,r.path="".concat(Go),r.params=x({token:u,limit:a,reverse:s,order:Yi.UPDATED_AT,show_ui_template:!0,show_color_variables:!0}),r}return g(n,t),n}(R),kp=function(t){function n(e,r){var i=t.call(this,e,r)||this,s=r.next,o=r.has_more,a=o!==void 0&&o,u=r.templates;return i.nextToken=s,i.hasMore=a,i.templates=u.map(function(c){return{template:JSON.stringify(c)}}),i}return g(n,t),n}(M),Rp=function(t){function n(e){var r=this,i=e.key;return(r=t.call(this)||this).method=k.GET,r.path="".concat(Go,"/").concat(i),r}return g(n,t),n}(R),Dp=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.template=JSON.stringify(r),i}return g(n,t),n}(M),nc={},Se=function(){function t(n,e){var r=e.sdkState,i=e.dispatcher,s=e.requestQueue,o=e.onlineDetector,a=e.cacheContext;this._iid=n,this._sdkState=r,this._requestQueue=s,this._dispatcher=i,this._cacheContext=a,no.of(n),Sr.of(n),tc.of(n),this.fileMessageQueue=new wh(n,{sdkState:r,dispatcher:i,requestQueue:s,onlineDetector:o,cacheContext:a}),nc[n]=this}return t.of=function(n){return nc[n]},t.prototype.buildMessageFromSerializedData=function(n){var e=_r(n);if(e.notificationId)return new yr(this._iid,yr.payloadify(e));switch(e.messageType){case he.USER:return new $e(this._iid,$e.payloadify(e));case he.FILE:return ut._isMultipleFilesMessageSerializedData(e)?new ut(this._iid,ut.payloadify(e)):new ge(this._iid,ge.payloadify(e));case he.ADMIN:return new gr(this._iid,gr.payloadify(e))}throw I.invalidParameters},t.prototype.buildUserMessageCreateParamsFromSerializedData=function(n,e){return x(H({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUserIds:e.mentionedUserIds,mentionedUsers:e.mentionedUsers,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,isReplyToChannel:n.isReplyToChannel,pushNotificationDeliveryOption:n.pushNotificationDeliveryOption,appleCriticalAlertOptions:e.appleCriticalAlertOptions,reqId:e.reqId,message:e.message,translationTargetLanguages:Object.keys(e.translations),pollId:n.pollId}))},t.prototype.buildFileMessageCreateParamsFromSerializedData=function(n,e){var r;return x(H({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUserIds:e.mentionedUserIds,mentionedUsers:e.mentionedUsers,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,isReplyToChannel:n.isReplyToChannel,pushNotificationDeliveryOption:n.pushNotificationDeliveryOption,appleCriticalAlertOptions:e.appleCriticalAlertOptions,reqId:e.reqId,file:n.file,fileKey:n.fileKey,fileUrl:e.plainUrl,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:(r=e.thumbnails)===null||r===void 0?void 0:r.map(function(i){return{maxWidth:i.width,maxHeight:i.height}}),fileType:n.fileType,requireAuth:e.requireAuth}))},t.prototype.buildMultipleFilesMessageCreateParamsFromSerializedData=function(n,e){var r=this;return x({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUserIds:e.mentionedUserIds,mentionedUsers:e.mentionedUsers,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,isReplyToChannel:n.isReplyToChannel,pushNotificationDeliveryOption:n.pushNotificationDeliveryOption,appleCriticalAlertOptions:e.appleCriticalAlertOptions,reqId:e.reqId,fileInfoList:n.fileInfoList.map(function(i){return new pi(r._iid,i)})})},t.prototype.buildScheduledUserMessageCreateParamsFromSerializedData=function(n,e){return b(b({},this.buildUserMessageCreateParamsFromSerializedData(n,e)),{scheduledAt:n.scheduledAt})},t.prototype.buildScheduledFileMessageCreateParamsFromSerializedData=function(n,e){return b(b({},this.buildFileMessageCreateParamsFromSerializedData(n,e)),{scheduledAt:n.scheduledAt})},t.prototype.buildSenderFromSerializedData=function(n){var e=_r(n);return new xn(this._iid,xn.payloadify(e))},t.prototype.getMessage=function(n){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return e=new Ih(n),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(Th).message]}})})},t.prototype.getScheduledMessage=function(n){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return e=new Ah(n),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(Nh).message]}})})},t.prototype.getMessagesByMessageId=function(n,e,r,i,s){return s===void 0&&(s=ne.REQUEST_MESSAGE),f(this,void 0,void 0,function(){var o,a,u;return h(this,function(c){switch(c.label){case 0:return o=new _i(b(b({channelType:e,channelUrl:n,token:String(r)},br),i)),[4,this._requestQueue.send(o)];case 1:return a=c.sent(),u=a.as(vi).messages,this._dispatcher.dispatch(new _e({messages:u,source:s})),[2,u]}})})},t.prototype.getMessagesByTimestamp=function(n,e,r,i,s){return s===void 0&&(s=ne.REQUEST_MESSAGE),f(this,void 0,void 0,function(){var o,a,u;return h(this,function(c){switch(c.label){case 0:return o=new _i(b(b({channelType:e,channelUrl:n,timestamp:r},br),i)),[4,this._requestQueue.send(o)];case 1:return a=c.sent(),u=a.as(vi).messages,this._dispatcher.dispatch(new _e({messages:u,source:s})),[2,u]}})})},t.prototype._getMessagesByTimestampForCollection=function(n,e,r,i,s,o,a){return s===void 0&&(s=ne.REQUEST_MESSAGE),f(this,void 0,void 0,function(){var u,c,l,d,p,_;return h(this,function(v){switch(v.label){case 0:return u=new _i(b(b(b({channelType:e,channelUrl:n,timestamp:r},br),i),{checkingHasNext:o,checkingContinuousMessages:a})),[4,this._requestQueue.send(u)];case 1:return c=v.sent(),l=c.as(vi),d=l.messages,p=l.isContinuousMessages,_=l.hasNext,this._dispatcher.dispatch(new _e({messages:d,source:s})),[2,{messages:d,isContinuousMessages:p,hasNext:_}]}})})},t.prototype.getThreadedMessagesByTimestamp=function(n,e,r,i){return i===void 0&&(i=ne.REQUEST_THREADED_MESSAGE),f(this,void 0,void 0,function(){var s,o,a,u;return h(this,function(c){switch(c.label){case 0:return s=new _i(b(b(b({channelUrl:n.channelUrl,channelType:n.channelType,timestamp:e},mr),r),{replyType:Ve.ALL,parentMessageId:n.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(s)];case 1:return o=c.sent(),a=o.as(vi).messages,(u=a.slice(1)).forEach(function(l){l.parentMessage=n}),this._dispatcher.dispatch(new _e({messages:u,source:i})),[2,{parentMessage:a[0],threadedMessages:u}]}})})},t.prototype.getMessageTemplatesByToken=function(n,e){return e===void 0&&(e={}),f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return r=new Op(b({token:n},e)),[4,this._requestQueue.send(r)];case 1:return i=c.sent(),s=i.as(kp),o=s.hasMore,a=s.nextToken,u=s.templates,[2,{hasMore:o,token:a,templates:u}]}})})},t.prototype.getMessageTemplate=function(n){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return e=new Rp({key:n}),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,{template:r.as(Dp).template}]}})})},t.prototype.getMessageChangelogs=function(n,e,r,i,s){return s===void 0&&(s=ne.REQUEST_MESSAGE_CHANGELOGS),f(this,void 0,void 0,function(){var o,a,u,c,l,d,p,_;return h(this,function(v){switch(v.label){case 0:return o=new Ch(x(H(b(b({channelType:e,channelUrl:n,timestamp:typeof r=="number"?r:null,token:typeof r=="string"?r:null},zs),i)))),[4,this._requestQueue.send(o)];case 1:return a=v.sent(),u=a.as(Sh),c=u.updatedMessages,l=u.deletedMessagesInfo,d=u.hasMore,p=u.nextToken,_=l.map(function(m){return m.messageId}),c.length>0&&this._dispatcher.dispatch(new _e({messages:c,source:s})),_.length>0&&this._dispatcher.dispatch(new eu({messageIds:_,source:s})),[2,{updatedMessages:c,deletedMessageIds:_,hasMore:d,token:p}]}})})},t}(),Up=function(t){function n(e,r){var i=t.call(this,e)||this;i.targetMessageId=0;var s=r.thread_info,o=r.parent_message_id,a=r.channel_url,u=r.channel_type;return s&&T("object",s)&&T("number",o)&&T("string",a)&&T("string",u)&&(i.threadInfo=new Ps(e,s),i.targetMessageId=o,i.channelUrl=a,i.channelType=u),i}return g(n,t),n}(qe),Mp={channelUrl:"",channelType:W.BASE,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1},Lp=function(t){function n(e){var r=e.channelCustomType,i=e.keyword,s=e.limit,o=e.reverse,a=e.exactMatch,u=e.channelUrl,c=e.order,l=e.messageTimestampFrom,d=e.messageTimestampTo,p=e.advancedQuery,_=e.targetFields,v=e.nextToken,m=t.call(this)||this;return m.method=k.GET,m.path="".concat(fl,"/messages"),m.params={custom_type:r,query:i,limit:s,reverse:o,exact_match:a,channel_url:u,message_ts_from:l,message_ts_to:d,sort_field:c,advanced_query:p,target_fields:_,after:v},m}return g(n,t),n}(R),Pp=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.messages=r.results.map(function(s){return Rt(e,s)}),i.hasNext=r.has_next,i.nextToken=r.end_cursor,i.totalCount=r.total_count,i}return g(n,t),n}(M);(function(t){t.SCORE="score",t.TIMESTAMP="ts"})(Cr||(Cr={}));var xp=function(t){function n(e,r){var i,s,o,a,u,c,l,d,p,_=this;return(_=t.call(this,e,r)||this).keyword="",_.reverse=!1,_.exactMatch=!1,_.channelUrl="",_.channelCustomType="",_.messageTimestampFrom=null,_.messageTimestampTo=null,_.order=Cr.SCORE,_.advancedQuery=!1,_.targetFields=null,_._nextToken="",_.totalCount=-1,_.keyword=r.keyword,_.reverse=(i=r.reverse)!==null&&i!==void 0&&i,_.exactMatch=(s=r.exactMatch)!==null&&s!==void 0&&s,_.channelUrl=(o=r.channelUrl)!==null&&o!==void 0?o:"",_.channelCustomType=(a=r.channelCustomType)!==null&&a!==void 0?a:"",_.messageTimestampFrom=(u=r.messageTimestampFrom)!==null&&u!==void 0?u:null,_.messageTimestampTo=(c=r.messageTimestampTo)!==null&&c!==void 0?c:null,_.order=(l=r.order)!==null&&l!==void 0?l:Cr.SCORE,_.advancedQuery=(d=r.advancedQuery)!==null&&d!==void 0&&d,_.targetFields=(p=r.targetFields)!==null&&p!==void 0?p:null,_}return g(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&T("string",this.keyword)&&this.keyword.length>0&&T("boolean",this.reverse)&&T("boolean",this.exactMatch)&&T("string",this.channelUrl)&&T("string",this.channelCustomType)&&(T("number",this.messageTimestampFrom)||this.messageTimestampFrom===null)&&(T("number",this.messageTimestampTo)||this.messageTimestampTo===null)&&ue(Cr,this.order)&&T("boolean",this.advancedQuery)&&X("string",this.targetFields,!0)},n.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid).requestQueue,r=new Lp(H(b(b({},this),{nextToken:this._nextToken?this._nextToken:null}))),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=l.sent(),s=i.as(Pp),o=s.messages,a=s.hasNext,u=s.nextToken,c=s.totalCount,this._nextToken=u,this._hasNext=a,this._isLoading=!1,this.totalCount=c,[2,o];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},n}(Ln),Fp={channelUrl:"",scheduledMessageId:0},qp={reverse:!1,limit:20},zp=function(t){function n(){var e=t!==null&&t.apply(this,arguments)||this;return e.name="message",e}return g(n,t),n.prototype.init=function(e,r){var i=r.sdkState,s=r.dispatcher,o=r.sessionManager,a=r.requestQueue,u=r.logger,c=r.onlineDetector,l=r.cacheContext;t.prototype.init.call(this,e,{sdkState:i,dispatcher:s,sessionManager:o,requestQueue:a,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Se(e,{sdkState:i,dispatcher:s,requestQueue:a,onlineDetector:c,cacheContext:l})},n.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},n.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},n.prototype.getMessage=function(e){return f(this,void 0,void 0,function(){var r,i;return h(this,function(s){switch(s.label){case 0:return r=b(b({},Mp),e),D(function(o){return T("string",o.channelUrl)&&ue(W,o.channelType)&&T("number",o.messageId)&&T("boolean",o.includeReactions,!0)&&T("boolean",o.includeMetaArray,!0)&&T("boolean",o.includeParentMessageInfo,!0)&&T("boolean",o.includeThreadInfo,!0)}(r)).throw(I.invalidParameters),[4,this._manager.getMessage(r)];case 1:if((i=s.sent())instanceof tt||i instanceof yr||i===null)return[2,i];throw"Unknown message type is given."}})})},n.prototype.getScheduledMessage=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){return r=b(b({},Fp),e),D(function(s){return T("string",s.channelUrl)&&s.channelUrl!==""&&T("number",s.scheduledMessageId)&&s.scheduledMessageId>0}(r)).throw(I.invalidParameters),[2,this._manager.getScheduledMessage(r)]})})},n.prototype.getMessageTemplatesByToken=function(e,r){return r===void 0&&(r={}),f(this,void 0,void 0,function(){var i;return h(this,function(s){return i=b(b({},qp),r),D(T("string",e,!0)&&function(o){return T("boolean",o.reverse,!0)&&T("number",o.limit,!0)}(i)).throw(I.invalidParameters),[2,this._manager.getMessageTemplatesByToken(e,i)]})})},n.prototype.getMessageTemplate=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return D(T("string",e)).throw(I.invalidParameters),[2,this._manager.getMessageTemplate(e)]})})},n}(ks),Hp=function(t,n){this.pollId=0,this.messageId=0,this.pollId=n.poll.id,this.messageId=n.poll.message_id,this._iid=t,this._payload=n},$p=function(t){function n(){var e=t!==null&&t.apply(this,arguments)||this;return e.name="poll",e}return g(n,t),n.prototype.init=function(e,r){var i=r.sdkState,s=r.dispatcher,o=r.sessionManager,a=r.requestQueue,u=r.logger,c=r.onlineDetector,l=r.cacheContext;t.prototype.init.call(this,e,{sdkState:i,dispatcher:s,sessionManager:o,requestQueue:a,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Us(e,{sdkState:i,dispatcher:s,sessionManager:o,requestQueue:a,logger:u,onlineDetector:c,cacheContext:l})},n.prototype.create=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){return r=b(b({},rh),e),D(iu(r)).throw(I.invalidParameters),[2,this._manager.create(r)]})})},n.prototype.get=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){return r=b(b({},sh),e),D(ou(r)).throw(I.invalidParameters),[2,this._manager.get(r)]})})},n.prototype.getOption=function(e){return f(this,void 0,void 0,function(){var r;return h(this,function(i){return r=b(b({},ih),e),D(su(r)).throw(I.invalidParameters),[2,this._manager.getOption(r)]})})},n.prototype.buildPollFromSerializedData=function(e){return this._manager.buildPollFromSerializedData(e)},n}(ks),Qt,rc,ic;(function(t){t.LATEST_LAST_MESSAGE="latest_last_message",t.CHRONOLOGICAL="chronological",t.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",t.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"})(Qt||(Qt={})),function(t){t.CHRONOLOGICAL="chronological",t.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",t.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"}(rc||(rc={})),function(t){t.CREATED_AT="created_at",t.SCHEDULED_AT="scheduled_at"}(ic||(ic={}));var ro,io=function(t){switch(t){case Qt.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case Qt.CHRONOLOGICAL:return["-createdAt","syncIndex"];case Qt.CHANNEL_NAME_ALPHABETICAL:return["name"];default:return["-lastMessageUpdatedAt","-createdAt","syncIndex"]}},jp=function(t){function n(e){var r=e.message,i=t.call(this)||this;return i.message=r,i}return g(n,t),n}(le),sc={},Bp=function(){function t(n,e){var r=e.localCacheEnabled,i=e.enableAutoResend,s=e.dispatcher,o=e.sdkState,a=e.logger,u=this;this._iid=n,sc[n]=this,this._localCacheEnabled=r,this._enableAutoResend=i,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=s,this._logger=a,this._sdkState=o,this._localCacheEnabled&&s.on(function(c){if(c instanceof un)switch(c.stateType){case se.CONNECTED:u._isProcessingAutoResend||u.processAutoResendRegisteredPendingMessages().then(function(){return u._processNextAutoResend()});break;case se.INTERNAL_DISCONNECTED:case se.EXTERNAL_DISCONNECTED:u._isProcessingAutoResend=!1}})}return t.of=function(n){return sc[n]},t.prototype.processNonAutoResendRegisteredPendingMessages=function(){return f(this,void 0,void 0,function(){var n,e,r,i,s,o;return h(this,function(a){switch(a.label){case 0:return this._enableAutoResend?[4,this._fetchAllCachedPendingMessages()]:[2];case 1:n=a.sent();try{for(e=$(n),r=e.next();!r.done;r=e.next())(i=r.value).errorCode===0&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",i.reqId),i.sendingStatus=ce.FAILED,i.errorCode=z.ACK_TIMEOUT,this._dispatcher.dispatch(new _e({messages:[i],source:ne.LOCAL_MESSAGE_FAILED})))}catch(u){s={error:u}}finally{try{r&&!r.done&&(o=e.return)&&o.call(e)}finally{if(s)throw s.error}}return[2]}})})},t.prototype.processAutoResendRegisteredPendingMessages=function(){return f(this,void 0,void 0,function(){var n,e,r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:n=c.sent();try{for(e=$(n),r=e.next();!r.done;r=e.next())i=r.value,this._enableAutoResend&&i.errorCode&&xr(i.errorCode)&&(s=new Date().getTime(),o=i.createdAt+2592e5,this._enableAutoResend&&s<=o?this._autoResendQueue.map(function(l){return l.reqId}).indexOf(i.reqId)<0&&this._autoResendQueue.push(i):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(o).toLocaleString()),i.sendingStatus=ce.FAILED,this._dispatcher.dispatch(new _e({messages:[i],source:ne.LOCAL_MESSAGE_FAILED}))))}catch(l){a={error:l}}finally{try{r&&!r.done&&(u=e.return)&&u.call(e)}finally{if(a)throw a.error}}return[2]}})})},t.prototype.completeCurrentAndProcessNextAutoResend=function(n){if(this._localCacheEnabled&&this._enableAutoResend&&(n.sendingStatus===ce.SUCCEEDED||n.sendingStatus===ce.FAILED&&!xr(n.errorCode))){var e=this.indexOf(n);e>=0&&this._autoResendQueue.splice(e,1),e===0&&this._processNextAutoResend()}},t.prototype._fetchAllCachedPendingMessages=function(){return f(this,void 0,void 0,function(){var n,e;return h(this,function(r){switch(r.label){case 0:return n=Sr.of(this._iid),(e=new zn).replyType=Ve.ALL,[4,n.fetch({sendingStatus:ce.PENDING,backward:!0,filter:e})];case 1:return[2,r.sent()]}})})},t.prototype.indexOf=function(n){return this._autoResendQueue.length>0?this._autoResendQueue.map(function(e){return e.reqId}).indexOf(n.reqId):-1},t.prototype._isNotInQueue=function(n){return this._autoResendQueue.map(function(e){return e.reqId}).indexOf(n.reqId)===-1},t.prototype._processNextAutoResend=function(){return f(this,void 0,void 0,function(){var n;return h(this,function(e){if(this._localCacheEnabled&&this._enableAutoResend&&this._sdkState.appState==="foreground")try{this._autoResendQueue.length>0?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),n=this._autoResendQueue[0],this._dispatcher.dispatch(new jp({message:n})),this._logger.debug("processing auto-resend for message request id: ",n.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1)}catch(r){this._logger.warn("process auto-resend error: ",r),this._isProcessingAutoResend=!1}return[2]})})},t}();(function(t){t[t.USER_BLOCK=20001]="USER_BLOCK",t[t.USER_UNBLOCK=2e4]="USER_UNBLOCK",t[t.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED"})(ro||(ro={}));var oc=function(){function t(n){this.category=n.cat,this.data=n.data}return t.getDataAsUserBlockEvent=function(n,e){var r=e.data,i=r.blocker,s=r.blockee;return{blocker:new V(n,i),blockee:new V(n,s)}},t.getDataAsFriendDiscoveredEvent=function(n,e){var r=e.data.friend_discoveries;return{friendDiscoveries:Array.isArray(r)?r.map(function(i){return new V(n,i)}):[]}},t}(),Gp=function(t){function n(e,r){var i=r.userId,s=t.call(this)||this;return s._iid=e,s.userId=i,s}return g(n,t),n}(le),Vp=function(t){function n(){return t.call(this)||this}return g(n,t),n}(le),Kp=function(t){function n(e,r,i){var s=t.call(this,e,"USEV",i)||this;return s.event=new oc(i),s}return g(n,t),n}(de),Qp=function(t){return["-lastMessageUpdatedAt","-createdAt","syncIndex"]},ac=function(t){function n(){return t!==null&&t.apply(this,arguments)||this}return g(n,t),n}(le),uc=function(t){this.key=t.key,this.url=t.url},cc=function(t){this.id=t.id,this.name=t.name,this.url=t.url,this.emojis=t.emojis?t.emojis.map(function(n){return new uc(n)}):[]},Wp=function(t){this.emojiHash=t.emoji_hash||"",this.emojiCategories=t.emoji_categories?t.emoji_categories.map(function(n){return new cc(n)}):[]},Yp={profileImage:void 0,profileUrl:void 0,nickname:void 0},lc=function(t){return function(n,e){return f(void 0,void 0,void 0,function(){var r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:switch(n){case 1:case 2:case 3:return[3,1];case 4:return[3,2];case 5:return[3,9]}return[3,13];case 1:return e(),[3,14];case 2:return u.trys.push([2,7,,8]),[4,t.clear()];case 3:return u.sent(),r=function(c){return{v2:function(){return f(void 0,void 0,void 0,function(){return h(this,function(l){switch(l.label){case 0:return[4,c.commitSchema([{collectionName:Kf,keyName:Qf,index:[io(Qt.LATEST_LAST_MESSAGE),io(Qt.CHRONOLOGICAL),io(Qt.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:Ks,keyName:Wf,index:[It(be.CHANNEL_LATEST),It(be.NEWEST_CHILD_MESSAGE)]},{collectionName:ec,keyName:Ap,index:[It(be.CHANNEL_LATEST),It(be.NEWEST_CHILD_MESSAGE)]},{collectionName:Zf,keyName:Xf}])];case 1:return[2,l.sent()]}})})},v3:function(){return f(void 0,void 0,void 0,function(){return h(this,function(l){switch(l.label){case 0:return[4,c.commitSchema([{collectionName:Jf,keyName:ep,index:[Qp()]}])];case 1:return[2,l.sent()]}})})},v4:function(){return f(void 0,void 0,void 0,function(){return h(this,function(l){switch(l.label){case 0:return[4,c.commitSchema([{collectionName:Bu,keyName:Yf,index:[Sp()]}])];case 1:return[2,l.sent()]}})})}}}(t),i=r.v2,s=r.v3,o=r.v4,[4,i()];case 4:return u.sent(),[4,s()];case 5:return u.sent(),[4,o()];case 6:return u.sent(),e(),[3,8];case 7:return a=u.sent(),e(a),[3,8];case 8:return[3,14];case 9:return u.trys.push([9,11,,12]),[4,t.collection(Ks).removeIf({where:{channelType:W.OPEN}})];case 10:case 11:return u.sent(),[3,12];case 12:return e(),[3,14];case 13:e(),u.label=14;case 14:return[2]}})})}},Zp=function(){return typeof document<"u"?document.visibilityState:"visible"},Xp=function(t){function n(e){var r=e.getVisibilityState,i=r===void 0?Zp:r,s=e.initialState,o=s===void 0?"visible":s,a=e.isEnabled,u=a===void 0||a,c=e.pauseCheckDelay,l=c===void 0?3e4:c,d=t.call(this)||this;return d._pauseCheckDelay=3e4,d._currentState="visible",d._getVisibilityState=i,d._pauseCheckDelay=l,d._currentState=o,d._isEnabled=u,d._boundToggleState=d._toggleState.bind(d),d}return g(n,t),Object.defineProperty(n.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isAvailable",{get:function(){return typeof window<"u"&&!!window.addEventListener&&!!window.removeEventListener},enumerable:!1,configurable:!0}),n.prototype._toggleState=function(){var e=this,r=this._getVisibilityState();r!=="hidden"?this._currentState==="hidden"&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=void 0),this.dispatch("resume")):this._currentState!=="hidden"&&(this._pauseDelayTimer=setTimeout(function(){e._pauseDelayTimer=void 0,e.dispatch("pause")},this._pauseCheckDelay)),this._currentState=r},n.prototype.start=function(){this._isEnabled&&this.isAvailable&&(this._boundToggleState=this._toggleState.bind(this),window.addEventListener("visibilitychange",this._boundToggleState,{capture:!0}))},n.prototype.stop=function(){this._isEnabled&&this.isAvailable&&this._boundToggleState&&window.removeEventListener("visibilitychange",this._boundToggleState,{capture:!0})},n}(Cn),Jp=function(){function t(n){var e=n.logger,r=n.connectionDelegate,i=r===void 0?null:r,s=this;this._onlineWorker=function(){var o;return(o=s.connectionDelegate)===null||o===void 0?void 0:o.reconnect()},this._offlineWorker=function(){var o;return(o=s.connectionDelegate)===null||o===void 0?void 0:o.disconnect()},this.unsubscribes=[],this._onlineListener=function(o){if(s.isAvailableOnWeb)return window.addEventListener("online",o),function(){return window.removeEventListener("online",o,!1)}},this._offlineListener=function(o){if(s.isAvailableOnWeb)return window.addEventListener("offline",o),function(){return window.removeEventListener("offline",o,!1)}},this.logger=e,i&&(this.connectionDelegate=i)}return Object.defineProperty(t.prototype,"isAvailableOnWeb",{get:function(){return typeof window<"u"&&!!window.addEventListener&&"ononline"in window&&"onoffline"in window&&typeof navigator<"u"&&navigator.onLine!==void 0},enumerable:!1,configurable:!0}),t.prototype.setOnlineListener=function(n){n&&typeof n=="function"&&(this._onlineListener=n)},t.prototype.setOfflineListener=function(n){n&&typeof n=="function"&&(this._offlineListener=n)},t.prototype.start=function(){this.unsubscribes=[this._onlineListener(this._onlineWorker),this._offlineListener(this._offlineWorker)]},t.prototype.stop=function(){var n=this;this.unsubscribes.forEach(function(e){try{e==null||e()}catch(r){n.logger.warn(r.message)}}),this.unsubscribes=[]},t.prototype.isOnline=function(){return f(this,void 0,void 0,function(){return h(this,function(n){return this.isAvailableOnWeb?[2,navigator.onLine]:[2,new Promise(function(e){fetch("https://www.google.com",{method:k.GET,mode:"no-cors"}).then(function(){return e(!0)}).catch(function(){return e(!1)})})]})})},t}(),dc=function(t){function n(e){var r=e.userId,i=e.nickname,s=e.profileUrl,o=e.profileImage,a=e.preferredLanguages,u=t.call(this)||this;return u.method=k.PUT,u.path="".concat(ee,"/").concat(encodeURIComponent(r)),u.params=x(H({nickname:i,profile_url:s,profile_file:o,preferred_languages:a})),u}return g(n,t),n}(R),hc=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.user=new V(e,b({},r)),i}return g(n,t),n}(M),e_=function(t){function n(e){var r=e.userId,i=e.token,s=t.call(this)||this;return s.method=k.POST,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/apns"),s.params={apns_device_token:i,always_push:!0},s}return g(n,t),n}(R);(function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.token=r.token,i.type=r.type?me[r.type.toLowerCase()]:me.UNKNOWN,i.user=new V(e,r.user),i}g(n,t)})(M);var t_=function(t){function n(e){var r=e.userId,i=e.token,s=t.call(this)||this;return s.method=k.POST,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/gcm"),s.params={gcm_reg_token:i,always_push:!0},s}return g(n,t),n}(R);(function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.token=r.token,i.type=r.type?me[r.type.toLowerCase()]:me.UNKNOWN,i.user=new V(e,r.user),i}g(n,t)})(M);var n_=function(t){function n(e){var r=e.userId,i=e.token,s=t.call(this)||this;return s.method=k.DELETE,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/apns/").concat(encodeURIComponent(i)),s}return g(n,t),n}(R);(function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.token=r.token,i.user=new V(e,r.user),i.lastDeletedAt=r.device_token_last_deleted_at,i}g(n,t)})(M);var r_=function(t){function n(e){var r=e.userId,i=e.token,s=t.call(this)||this;return s.method=k.DELETE,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/gcm/").concat(encodeURIComponent(i)),s}return g(n,t),n}(R);(function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.token=r.token,i.user=new V(e,r.user),i.lastDeletedAt=r.device_token_last_deleted_at,i}g(n,t)})(M);var i_=function(t){function n(e){var r=e.userId,i=t.call(this)||this;return i.method=k.DELETE,i.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/apns"),i}return g(n,t),n}(R);(function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.type=r.type?me[r.type.toLowerCase()]:me.UNKNOWN,i.user=new V(e,r.user),i.lastDeletedAt=r.device_token_last_deleted_at,i}g(n,t)})(M);var s_=function(t){function n(e){var r=e.userId,i=t.call(this)||this;return i.method=k.DELETE,i.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/gcm"),i}return g(n,t),n}(R);(function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.type=r.type?me[r.type.toLowerCase()]:me.UNKNOWN,i.user=new V(e,r.user),i.lastDeletedAt=r.device_token_last_deleted_at,i}g(n,t)})(M);var o_=function(t){function n(e){var r=e.userId,i=e.type,s=e.token,o=e.ts,a=t.call(this)||this;return a.method=k.GET,a.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/").concat(encodeURIComponent(i),"/device_tokens"),a.params={created_ts:o,token:s},a}return g(n,t),n}(R),a_=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.pushTokens={type:r.type?me[r.type.toLowerCase()]:me.UNKNOWN,deviceTokens:r.device_tokens,hasMore:r.has_more,token:r.token},i}return g(n,t),n}(M),u_=function(t){function n(e){var r=e.userId,i=t.call(this)||this;return i.method=k.GET,i.path="".concat(ee,"/").concat(encodeURIComponent(r),"/channel_invitation_preference"),i}return g(n,t),n}(R),c_=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.autoAccept=r.auto_accept,i}return g(n,t),n}(M),l_=function(t){function n(e){var r=e.userId,i=e.willAutoAccept,s=t.call(this)||this;return s.method=k.PUT,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/channel_invitation_preference"),s.params={auto_accept:i},s}return g(n,t),n}(R),d_=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.autoAccept=r.auto_accept,i}return g(n,t),n}(M),h_=function(t){function n(e){var r=e.userId,i=t.call(this)||this;return i.method=k.GET,i.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push_preference"),i}return g(n,t),n}(R),f_=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.preference={doNotDisturbOn:r.do_not_disturb,startHour:r.start_hour,startMin:r.start_min,endHour:r.end_hour,endMin:r.end_min,timezone:r.timezone},i}return g(n,t),n}(M),p_=function(t){function n(e){var r=e.userId,i=e.doNotDisturbOn,s=e.startHour,o=e.startMin,a=e.endHour,u=e.endMin,c=e.timezone,l=t.call(this)||this;return l.method=k.PUT,l.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push_preference"),l.params={do_not_disturb:i,start_hour:s,start_min:o,end_hour:a,end_min:u,timezone:c},l}return g(n,t),n}(R),__=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.preference={doNotDisturbOn:r.do_not_disturb,startHour:r.start_hour,startMin:r.start_min,endHour:r.end_hour,endMin:r.end_min,timezone:r.timezone},i}return g(n,t),n}(M),v_=function(t){function n(e){var r=e.userId,i=t.call(this)||this;return i.method=k.GET,i.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push_preference"),i}return g(n,t),n}(R),m_=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.snoozePeriod={isSnoozeOn:r.snooze_enabled},typeof r.snooze_start_ts=="number"&&(i.snoozePeriod.startTs=r.snooze_start_ts),typeof r.snooze_end_ts=="number"&&(i.snoozePeriod.endTs=r.snooze_end_ts),i}return g(n,t),n}(M),g_=function(t){function n(e){var r=e.userId,i=e.snoozeOn,s=e.startTs,o=e.endTs,a=t.call(this)||this;return a.method=k.PUT,a.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push_preference"),a.params={snooze_enabled:i,snooze_start_ts:s,snooze_end_ts:o},a}return g(n,t),n}(R),y_=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.snoozePeriod={isSnoozeOn:r.snooze_enabled},typeof r.snooze_start_ts=="number"&&(i.snoozePeriod.startTs=r.snooze_start_ts),typeof r.snooze_end_ts=="number"&&(i.snoozePeriod.endTs=r.snooze_end_ts),i}return g(n,t),n}(M),b_=function(t){function n(e){var r=e.userId,i=e.blockedUserId,s=t.call(this)||this;return s.method=k.POST,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/block"),s.params={target_id:i},s}return g(n,t),n}(R);(function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.user=new V(e,r),i}g(n,t)})(M);var E_=function(t){function n(e){var r=e.userId,i=e.unblockedUserId,s=t.call(this)||this;return s.method=k.DELETE,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/block/").concat(encodeURIComponent(i)),s}return g(n,t),n}(R);(function(t){function n(){return t!==null&&t.apply(this,arguments)||this}g(n,t)})(M);var w_=function(t){function n(e){var r=e.userId,i=t.call(this)||this;return i.method=k.GET,i.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push_preference"),i}return g(n,t),n}(R),I_=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.pushTriggerOption=r.push_trigger_option,i}return g(n,t),n}(M),T_=function(t){function n(e){var r=e.userId,i=e.pushTriggerOption,s=t.call(this)||this;return s.method=k.PUT,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push_preference"),s.params={push_trigger_option:i},s}return g(n,t),n}(R),C_=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.pushTriggerOption=r.push_trigger_option,i}return g(n,t),n}(M),S_=function(t){function n(e){var r=e.userId,i=t.call(this)||this;return i.method=k.GET,i.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/template"),i}return g(n,t),n}(R),A_=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.name=r.name,i}return g(n,t),n}(M),N_=function(t){function n(e){var r=e.userId,i=e.templateName,s=t.call(this)||this;return s.method=k.PUT,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/push/template"),s.params={name:i},s}return g(n,t),n}(R),O_=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.name=r.name,i}return g(n,t),n}(M),k_=function(t){function n(e){var r=e.userId,i=e.token,s=t.call(this)||this;return s.method=k.GET,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/friends/changelogs"),s.params={token:i},s}return g(n,t),n}(R),R_=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.changelogs={addedUsers:r.added.map(function(s){return new V(e,s)}),updatedUsers:r.updated.map(function(s){return new V(e,s)}),deletedUserIds:r.deleted,hasMore:r.has_more,token:r.next},i}return g(n,t),n}(M),D_=function(t){function n(e){var r=e.userId,i=e.discoveries,s=t.call(this)||this;return s.method=k.PUT,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/friend_discoveries"),s.params={friend_discoveries:i.map(function(o){return{friend_discovery_key:o.friendDiscoveryKey,friend_name:o.friendName}})},s}return g(n,t),n}(R),U_=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.friendDiscoveryRequestId=r.friend_discovery_request_id,i}return g(n,t),n}(M),M_=function(t){function n(e){var r=e.userId,i=e.discoveryKeys,s=t.call(this)||this;return s.method=k.DELETE,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/friend_discoveries"),s.params={friend_discovery_keys:i},s}return g(n,t),n}(R);(function(t){function n(){return t!==null&&t.apply(this,arguments)||this}g(n,t)})(M);var L_=function(t){function n(e){var r=e.userId,i=e.userIds,s=t.call(this)||this;return s.method=k.POST,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/friends"),s.params={user_ids:i},s}return g(n,t),n}(R),P_=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.users=r.users.map(function(s){return new V(e,s)}),i}return g(n,t),n}(M),x_=function(t){function n(e){var r=e.userId,i=e.userIds,s=t.call(this)||this;return s.method=k.DELETE,s.path="".concat(ee,"/").concat(encodeURIComponent(r),"/friends"),s.params={user_ids:i},s}return g(n,t),n}(R);(function(t){function n(){return t!==null&&t.apply(this,arguments)||this}g(n,t)})(M);var F_=function(t){function n(e){var r=e.userId,i=t.call(this)||this;return i.method=k.GET,i.path="".concat(ee,"/").concat(r,"/allow_friend_discovery"),i.params={},i}return g(n,t),n}(R),q_=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.allowFriendDiscovery=r.allow_friend_discovery,i}return g(n,t),n}(M),z_=function(t){function n(e){var r=e.userId,i=e.allowFriendDiscovery,s=t.call(this)||this;return s.method=k.PUT,s.path="".concat(ee,"/").concat(r,"/allow_friend_discovery"),s.params={allow_friend_discovery:i},s}return g(n,t),n}(R);(function(t){function n(){return t!==null&&t.apply(this,arguments)||this}g(n,t)})(M);var Nr,H_=function(t){function n(){var e=t.call(this)||this;return e.method=k.GET,e.path=Bo,e}return g(n,t),n}(R),$_=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.emojiContainer=new Wp(r),i}return g(n,t),n}(M),j_=function(t){function n(e){var r=e.categoryId,i=t.call(this)||this;return i.method=k.GET,i.path="".concat(Bo,"/").concat(r),i}return g(n,t),n}(R),B_=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.emojiCategory=new cc(r),i}return g(n,t),n}(M),G_=function(t){function n(e){var r=e.key,i=t.call(this)||this;return i.method=k.GET,i.path="".concat(pl,"/").concat(r),i}return g(n,t),n}(R),V_=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.emoji=new uc(r),i}return g(n,t),n}(M),K_=function(t){function n(){var e=t.call(this)||this;return e.method=k.GET,e.path="".concat(_l),e}return g(n,t),n}(R),Q_=function(t){function n(e,r){var i,s=this,o=r??{};return(s=t.call(this,e,r)||this).uikitConfiguration={string:JSON.stringify(o),json:o},s.updatedAt=(i=r==null?void 0:r.updated_at)!==null&&i!==void 0?i:0,s}return g(n,t),n}(M),W_=function(){function t(n,e,r){var i=this;this._storeInitialized=!1,this._iid=n,this.options=e;var s=S.of(n),o=s.sdkState,a=s.cacheContext,u=s.dispatcher,c=s.sessionManager,l=s.requestQueue,d=s.logger,p=s.userEventHandlers,_=s.appStateToggleEnabled;this._onlineDetector=new Jp({logger:d,connectionDelegate:{reconnect:function(){return f(i,void 0,void 0,function(){var m,y,E,w,C,A;return h(this,function(P){switch(P.label){case 0:if(m=S.of(n),y=m.sdkState,E=m.connectionManager,(w=m.sessionManager).session.hasSession)return[3,5];P.label=1;case 1:return P.trys.push([1,3,,4]),[4,E.connect(w.session.authToken)];case 2:return P.sent(),[3,4];case 3:if(C=P.sent(),rt(C))throw C;return d.debug("connect failed by reconnect event = ",C),[3,4];case 4:return[3,9];case 5:if(y.appState!=="foreground")return[3,9];P.label=6;case 6:return P.trys.push([6,8,,9]),[4,E.resetAndReconnect()];case 7:return P.sent(),[3,9];case 8:if(A=P.sent(),rt(A))throw A;return d.debug("resetAndReconnect failed by reconnect event = ",A),[3,9];case 9:return u.dispatch(new ac),[2]}})})},disconnect:function(){Oe(function(){return f(i,void 0,void 0,function(){return h(this,function(m){switch(m.label){case 0:return[4,S.of(n).connectionManager.disconnect()];case 1:return m.sent(),[2]}})})})}}});var v=new Bp(n,{localCacheEnabled:a.localCacheEnabled,enableAutoResend:a.localCacheConfig.enableAutoResend,dispatcher:u,sdkState:o,logger:d});r.forEach(function(m){m.init(n,{sdkState:o,cacheContext:a,dispatcher:u,sessionManager:c,requestQueue:l,logger:d,onlineDetector:i._onlineDetector}),i[m.name]=m}),this._appStateChangeDetector=new Xp({isEnabled:_}),this._appStateChangeDetector.on("resume",function(){d.debug("the page resumes from freeze"),i.setForegroundState()}).on("pause",function(){d.debug("the page freezes"),i.setBackgroundState()}),u.on(function(m){var y;if(m instanceof un)m.stateType===se.CONNECTED&&v.processNonAutoResendRegisteredPendingMessages();else if(m instanceof de){if(m.code==="USEV"){var E=m.as(Kp).event;if(E.category===ro.FRIEND_DISCOVERED){var w=oc.getDataAsFriendDiscoveredEvent(n,E).friendDiscoveries;Q(function(){return f(i,void 0,void 0,function(){return h(this,function(q){return[2,p.forEach(function(F){F.onFriendsDiscovered&&F.onFriendsDiscovered(w)})]})})})}}}else if(m instanceof Fa){var C=S.of(i._iid).subscribedUnreadMessageCount,A=!1,P=m.ts;if(typeof P=="number"&&P>C.ts){if(C.all!==m.all&&(A=!0),C.all=m.all>=0?m.all:0,m.customTypes)for(var N in m.customTypes)C.customTypes[N]!==m.customTypes[N]&&(A=!0),C.customTypes[N]=m.customTypes[N];A=A&&C.ts>0,C.ts=P}A&&Q(function(){return f(i,void 0,void 0,function(){return h(this,function(q){return[2,p.forEach(function(F){F.onTotalUnreadMessageCountChanged&&F.onTotalUnreadMessageCountChanged({groupChannelCount:C.all,feedChannelCount:C.feed,customTypeUnreadCount:C.customTypes}),F.onTotalUnreadMessageCountUpdated&&F.onTotalUnreadMessageCountUpdated(C.all,C.customTypes)})]})})})}else m instanceof Va?(a.preference.set(i._getUserProfileCacheKey(o.userId),Ts.payloadify(m.userProfile)),!((y=m.userProfile.appInfo.notificationInfo)===null||y===void 0)&&y.isEnabled&&a.preference.set(Cd(i.appId),{value:!0})):m instanceof xt&&m.error&&m.error.isSessionInvalidatedError&&(d.debug("session revoked."),i.disconnect())})}return t.init=function(n){var e=n.appId,r=n.appVersion,i=n.modules,s=i===void 0?[]:i,o=n.options,a=o===void 0?new xo:o,u=n.debugMode,c=u!==void 0&&u,l=n.customApiHost,d=n.customWebSocketHost,p=n.newInstance,_=p!==void 0&&p,v=n.logLevel,m=n.localCacheEnabled,y=m!==void 0&&m,E=n.localCacheConfig,w=E===void 0?new zo:E,C=n.localCacheEncryption,A=n.useAsyncStorageStore,P=A===void 0?null:A,N=n.appStateToggleEnabled,q=N===void 0||N;if(!Nr||_){var F="su-".concat(Xt()),L=C??{encrypt:function(we){return we},decrypt:function(we){return we}},U=new Kt({encryption:L});c||(U=ns()?P?new Tp({AsyncStorage:P,encryption:L}):new Kt({encryption:L}):new Ip({encryption:L})),new S(F,{appId:e,appVersion:r,options:a,apiHost:l??"https://api-".concat(e,".sendbird.com"),websocketHost:d??"wss://ws-".concat(e,".sendbird.com"),store:U,encryption:L,logLevel:v,localCacheEnabled:y,localCacheConfig:w,debugMode:c,appStateToggleEnabled:q});var K=[new zp,new $p],ve=new t(F,a,Z(Z([],G(s),!1),G(K),!1));return Nr||(Nr=ve),ve}return Nr},Object.defineProperty(t,"instance",{get:function(){return Nr},enumerable:!1,configurable:!0}),Object.defineProperty(t,"version",{get:function(){return Lo},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appId",{get:function(){return S.of(this._iid).sdkState.appId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appInfo",{get:function(){var n=S.of(this._iid).appInfo;return n??null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appVersion",{get:function(){var n;return(n=S.of(this._iid).sdkState.appVersion)!==null&&n!==void 0?n:""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"debugMode",{get:function(){return!!S.of(this._iid).debugMode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"logLevel",{get:function(){return S.of(this._iid).logger.level},set:function(n){S.of(this._iid).logger.level=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCacheEnabled",{get:function(){return S.of(this._iid).cacheContext.localCacheEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheConfig",{get:function(){var n=S.of(this._iid).cacheContext;return n.localCacheEnabled?n.localCacheConfig:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ekey",{get:function(){return S.of(this._iid).sessionManager.ekey},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentUser",{get:function(){var n;return(n=S.of(this._iid).sessionManager.currentUser)!==null&&n!==void 0?n:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connectionState",{get:function(){var n=S.of(this._iid).connectionManager;return n.isConnected?yt.OPEN:n.isConnecting?yt.CONNECTING:yt.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastConnectedAt",{get:function(){var n=S.of(this._iid),e=n.connectedAt;return n.connectionManager.isConnected?e:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fcmPushToken",{get:function(){var n;return(n=this._fcmPushToken)!==null&&n!==void 0?n:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"apnsPushToken",{get:function(){var n;return(n=this._apnsPushToken)!==null&&n!==void 0?n:null},enumerable:!1,configurable:!0}),t.prototype._getNestDBVersion=function(){return 6},t.prototype._getPreferenceCacheKey=function(n){return"sendbird@".concat(this.appId,"/").concat(n,".pref")},t.prototype._getUserProfileCacheKey=function(n){return"sendbird@".concat(this.appId,"/").concat(n,".profile")},t.prototype.getMemoryStoreForDebugging=function(){var n=S.of(this._iid),e=n.debugMode,r=n.cacheContext;if(e)return r.store instanceof Kt?r.store:null;throw I.debugModeRequired},t.prototype.addExtension=function(n,e){var r=S.of(this._iid).sdkState;["sb_uikit","sb_syncmanager","device-os-platform"].indexOf(n)>-1&&r.extensions&&(r.extensions[n]=e)},t.prototype.addSendbirdExtensions=function(n,e,r){var i,s,o=S.of(this._iid),a=o.logger,u=o.sdkState,c=new RegExp(El);if(n.length===0)return a.debug("sb.addSendbirdExtensions() has failed because the given sendbirdExtensions is empty."),!1;if(n.find(function(m){return!c.test(m.version)}))return a.debug("sb.addSendbirdExtensions() has failed because the given version did not satisfy the SemVer specification."),!1;if(r)try{for(var l=$(Object.entries(r)),d=l.next();!d.done;d=l.next()){var p=G(d.value,2),_=p[0],v=p[1];if(/&|=/.test(_)||/&|=/.test(v))return a.debug("sb.addSendbirdExtensions() has failed because the given customData includes at least one invalid character: = or &."),!1}}catch(m){i={error:m}}finally{try{d&&!d.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}return u.sendbirdRuntimeEnvironment={sendbirdExtensions:n,deviceOS:e,customData:r},!0},t.prototype.setOnlineListener=function(n){this._onlineDetector.setOnlineListener(n)},t.prototype.setOfflineListener=function(n){this._onlineDetector.setOfflineListener(n)},t.prototype._safeInitializeStore=function(n){return f(this,void 0,void 0,function(){var e;return h(this,function(r){switch(r.label){case 0:e=S.of(this._iid).cacheContext,r.label=1;case 1:return r.trys.push([1,3,,5]),[4,e.store.init(n)];case 2:return r.sent(),this._storeInitialized=!0,[3,5];case 3:return r.sent(),e.replaceStore(new Kt),[4,this._safeInitializeStore(n)];case 4:return r.sent(),[3,5];case 5:return[2]}})})},t.prototype.initializeCache=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u,c,l;return h(this,function(d){switch(d.label){case 0:if(e=S.of(this._iid),r=e.sdkState,i=e.cacheContext,s=e.dispatcher,o=e.logger,r.userId&&r.userId===n)return[3,9];if(a="sendbird@".concat(r.appId,"/").concat(n,".db"),!i.localCacheEnabled)return[3,7];d.label=1;case 1:return d.trys.push([1,4,,6]),i.nestdb&&i.nestdb.state!==Ut.CLOSED&&i.nestdb.name===a?[3,3]:(u="sendbird@".concat(r.appId,"/").concat(n,".db"),(c=i.nestdb=new Cp({name:u,version:this._getNestDBVersion(),store:i.store,config:new wr({dbname:u,itemSizeLimit:61440})})).on("upgrade",lc(c)),c.on("storeReplaced",function(p){i.replaceStore(p),i.localCacheEnabled=!1,c.on("upgrade",lc(c))}),[4,c.open()]);case 2:d.sent(),this._storeInitialized=!0,s.dispatch(new Gp(this._iid,{userId:n})),d.label=3;case 3:return r.userId=n,[3,6];case 4:return l=d.sent(),o.warn("Nest DB Open Failed. ",l),i.store instanceof Kt||(i.replaceStore(new Kt),i.localCacheEnabled=!1),[4,this._safeInitializeStore(a)];case 5:throw d.sent(),r.userId=n,I.databaseError;case 6:return[3,9];case 7:return[4,this._safeInitializeStore(a)];case 8:d.sent(),r.userId=n,d.label=9;case 9:return[2]}})})},t.prototype.getCacheDataSize=function(){return f(this,void 0,void 0,function(){var n;return h(this,function(e){switch(e.label){case 0:return(n=S.of(this._iid).cacheContext).localCacheEnabled&&n.nestdb?[4,n.nestdb.estimateUsage()]:[3,2];case 1:return[2,e.sent()];case 2:return[2,0]}})})},t.prototype.clearCachedData=function(){return f(this,void 0,void 0,function(){var n;return h(this,function(e){switch(e.label){case 0:return(n=S.of(this._iid).cacheContext).localCacheEnabled&&n.nestdb?[4,n.nestdb.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return this._storeInitialized?[4,n.preference.clear()]:[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})},t.prototype.clearCachedMessages=function(n){return f(this,void 0,void 0,function(){var e,r,i=this;return h(this,function(s){switch(s.label){case 0:return D(X("string",n)).throw(I.invalidParameters),e=no.of(this._iid),r=Sr.of(this._iid),e&&r?[4,Promise.all(n.map(function(o){return f(i,void 0,void 0,function(){return h(this,function(a){switch(a.label){case 0:return[4,e.removeMessagesOfChannel(o)];case 1:return a.sent(),[4,r.removeMessagesOfChannel(o)];case 2:return a.sent(),[2]}})})}))]:[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})},t.prototype._setupPreference=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o;return h(this,function(a){switch(a.label){case 0:return e=S.of(this._iid),r=e.sdkState,i=e.cacheContext,s=e.statLogCollector,[4,i.preference.init(this._getPreferenceCacheKey(n),this._getNestDBVersion())];case 1:return a.sent(),[4,i.preference.get(this._getUserProfileCacheKey(n))];case 2:return(o=a.sent())&&new Ts(this._iid,o).apply(),[4,s.init("sendbird@".concat(r.appId,"/").concat(n,".statlog"))];case 3:return a.sent(),[2]}})})},t.prototype._ready=function(n,e,r){return r===void 0&&(r={}),f(this,void 0,void 0,function(){var i,s,o,a,u,c;return h(this,function(l){switch(l.label){case 0:return D(T("string",n)&&T("string",e,!0)).throw(I.invalidParameters),i=S.of(this._iid),s=i.sdkState,o=i.cacheContext,a=i.connectionManager,u=r.errorForOtherUser,s.userId&&s.userId!==n?u?[3,2]:[4,a.logout()]:[3,3];case 1:return l.sent(),[3,3];case 2:throw u;case 3:return l.trys.push([3,5,6,8]),[4,this.initializeCache(n)];case 4:return l.sent(),S.of(this._iid).dispatcher.dispatch(new Vp),[3,8];case 5:return l.sent(),c=S.of(this._iid).logger,o.localCacheEnabled=!1,c.warn("Cache initialization failed - cache is not available."),[3,8];case 6:return[4,this._setupPreference(n)];case 7:return l.sent(),[7];case 8:return[2]}})})},t.prototype.authenticateFeed=function(n,e){var r;return f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){switch(a.label){case 0:return i=S.of(this._iid),s=i.sessionManager,o=i.connectionManager,[4,this._ready(n,e,{errorForOtherUser:o.isConnected?I.alreadyConnectedAsAnotherUser:void 0})];case 1:return a.sent(),!((r=s.session.services)===null||r===void 0)&&r.includes(Wn.CHAT)?[3,3]:[4,s.authenticateFeed(n,e)];case 2:a.sent(),a.label=3;case 3:return[2,this.currentUser]}})})},t.prototype.connect=function(n,e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return[4,this._ready(n,e)];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,,4,5]),[4,S.of(this._iid).connectionManager.connect(e)];case 3:return r.sent(),[3,5];case 4:return this._onlineDetector.start(),this._appStateChangeDetector.start(),[7];case 5:return[2,this.currentUser]}})})},t.prototype.reconnect=function(){var n=S.of(this._iid),e=n.connectionManager,r=n.sdkState,i=n.sessionManager.session.hasSession;return i&&(this._appStateChangeDetector.start(),this._onlineDetector.start(),e.resetAndReconnect().then(function(){r.appState="foreground"}).catch(function(){})),i},t.prototype.disconnect=function(){return f(this,void 0,void 0,function(){var n,e,r,i;return h(this,function(s){switch(s.label){case 0:return n=S.of(this._iid),e=n.connectionManager,r=n.sdkState,i=n.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),i.cancelAll(),[4,e.logout()];case 1:return s.sent(),[4,this.clearCachedData()];case 2:return s.sent(),r.appState="foreground",[2]}})})},t.prototype.disconnectWebSocket=function(){return f(this,void 0,void 0,function(){var n,e,r;return h(this,function(i){switch(i.label){case 0:return n=S.of(this._iid),e=n.connectionManager,r=n.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),r.cancelAll(),[4,e.disconnectWebSocket(!0)];case 1:return i.sent(),[2]}})})},t.prototype.setBackgroundState=function(){var n=S.of(this._iid),e=n.connectionManager,r=n.sdkState,i=n.logger;r.appState==="foreground"&&(r.appState="background",i.debug("going background state"),e.background().catch(function(s){i.debug("setBackgroundState error = ",s)}))},t.prototype.setForegroundState=function(){var n=S.of(this._iid),e=n.connectionManager,r=n.sdkState,i=n.dispatcher,s=n.logger;r.appState==="background"&&(r.appState="foreground",s.debug("going foreground state"),e.resetAndReconnect().catch(function(o){s.debug("setForgroundState error = ",o)}),i.dispatch(new ac))},t.prototype.setSessionHandler=function(n){D(n instanceof sp).throw(I.invalidParameters),S.of(this._iid).sessionManager.handler=n},t.prototype.addUserEventHandler=function(n,e){D(T("string",n)&&e instanceof op).throw(I.invalidParameters),S.of(this._iid).userEventHandlers.set(n,e)},t.prototype.removeUserEventHandler=function(n){S.of(this._iid).userEventHandlers.delete(n)},t.prototype.removeAllUserEventHandler=function(){S.of(this._iid).userEventHandlers.clear()},t.prototype.addConnectionHandler=function(n,e){D(T("string",n)&&e instanceof ip).throw(I.invalidParameters),S.of(this._iid).connectionHandlers.set(n,e)},t.prototype.removeConnectionHandler=function(n){S.of(this._iid).connectionHandlers.delete(n)},t.prototype.removeAllConnectionHandler=function(){S.of(this._iid).connectionHandlers.clear()},t.prototype.createApplicationUserListQuery=function(n){return n===void 0&&(n={}),new cp(this._iid,n)},t.prototype.createBlockedUserListQuery=function(n){return n===void 0&&(n={}),new hp(this._iid,n)},t.prototype.createFriendListQuery=function(n){return n===void 0&&(n={}),new _p(this._iid,n)},t.prototype.createMessageSearchQuery=function(n){return new xp(this._iid,n)},t.prototype.createPollListQuery=function(n){return new uu(this._iid,b({},n))},t.prototype.createPollVoterListQuery=function(n){return new cu(this._iid,b({},n))},t.prototype.buildUserFromSerializedData=function(n){var e=_r(n);return new V(this._iid,V.payloadify(e))},t.prototype.updateCurrentUserInfo=function(n){return n===void 0&&(n={}),f(this,void 0,void 0,function(){var e,r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return e=b(b({},Yp),n),D(function(l){return Ge(l.profileImage,!0)&&T("string",l.profileUrl,!0)&&T("string",l.nickname,!0)}(e)).throw(I.invalidParameters),this.currentUser?(r=S.of(this._iid),i=r.sdkState,s=r.requestQueue,o=new dc(b({userId:i.userId},e)),[4,s.send(o)]):[3,2];case 1:return a=c.sent(),u=a.as(hc).user,this.currentUser&&(e.nickname&&(this.currentUser.nickname=u.nickname),(e.profileUrl||e.profileImage)&&(this.currentUser.plainProfileUrl=u.profileUrl)),[2,u];case 2:throw I.connectionRequired}})})},t.prototype.updateCurrentUserInfoWithPreferredLanguages=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return D(X("string",n)).throw(I.invalidParameters),this.currentUser?(e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new dc({userId:r.userId,preferredLanguages:n}),[4,i.send(s)]):[3,2];case 1:return o=u.sent(),a=o.as(hc).user,this.currentUser&&(this.currentUser.preferredLanguages=a.preferredLanguages),[2,a];case 2:throw I.connectionRequired}})})},t.prototype.registerFCMPushTokenForCurrentUser=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a=this;return h(this,function(u){switch(u.label){case 0:if(D(T("string",n)).throw(I.invalidParameters),!this.currentUser)return[3,6];u.label=1;case 1:return u.trys.push([1,4,,5]),e=S.of(this._iid),r=e.sessionManager,i=e.sdkState,s=e.requestQueue,r.hasDeviceToken(me.FCM,n)?[2,Pe.SUCCESS]:(o=new t_({userId:i.userId,token:n}),[4,s.send(o)]);case 2:return u.sent(),[4,Oe(function(){return f(a,void 0,void 0,function(){return h(this,function(c){switch(c.label){case 0:return r.setDeviceToken(me.FCM,n),[4,r.saveDeviceToken()];case 1:return c.sent(),[2]}})})})];case 3:return u.sent(),this._fcmPushToken="",[2,Pe.SUCCESS];case 4:return u.sent(),[2,Pe.ERROR];case 5:return[3,7];case 6:return this._fcmPushToken=n,[2,Pe.PENDING];case 7:return[2]}})})},t.prototype.unregisterFCMPushTokenForCurrentUser=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u=this;return h(this,function(c){switch(c.label){case 0:if(D(T("string",n)).throw(I.invalidParameters),!this.currentUser)return[3,6];c.label=1;case 1:return c.trys.push([1,4,,5]),e=S.of(this._iid),r=e.sessionManager,i=e.sdkState,s=e.requestQueue,o=new r_({userId:i.userId,token:n}),[4,s.send(o)];case 2:return a=c.sent().lastDeletedAt,[4,Oe(function(){return f(u,void 0,void 0,function(){return h(this,function(l){switch(l.label){case 0:return r.unsetDeviceToken(me.FCM,n),r.setDeviceTokenDeletedAt(a),[4,r.saveDeviceToken()];case 1:return l.sent(),[2]}})})})];case 3:return c.sent(),this._fcmPushToken="",[2,Pe.SUCCESS];case 4:return c.sent(),[2,Pe.ERROR];case 5:return[3,7];case 6:return this._fcmPushToken=n,[2,Pe.PENDING];case 7:return[2]}})})},t.prototype.unregisterFCMPushTokenAllForCurrentUser=function(){return f(this,void 0,void 0,function(){var n,e,r,i,s,o,a=this;return h(this,function(u){switch(u.label){case 0:return this.currentUser?(n=S.of(this._iid),e=n.sessionManager,r=n.sdkState,i=n.requestQueue,s=new s_({userId:r.userId}),[4,i.send(s)]):[3,3];case 1:return o=u.sent().lastDeletedAt,[4,Oe(function(){return f(a,void 0,void 0,function(){return h(this,function(c){switch(c.label){case 0:return e.unsetDeviceTokens(me.FCM),e.setDeviceTokenDeletedAt(o),[4,e.saveDeviceToken()];case 1:return c.sent(),[2]}})})})];case 2:u.sent(),u.label=3;case 3:return[2]}})})},t.prototype.registerAPNSPushTokenForCurrentUser=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a=this;return h(this,function(u){switch(u.label){case 0:if(D(T("string",n)).throw(I.invalidParameters),!this.currentUser)return[3,6];u.label=1;case 1:return u.trys.push([1,4,,5]),e=S.of(this._iid),r=e.sessionManager,i=e.sdkState,s=e.requestQueue,r.hasDeviceToken(me.APNS,n)?[2,Pe.SUCCESS]:(o=new e_({userId:i.userId,token:n}),[4,s.send(o)]);case 2:return u.sent(),[4,Oe(function(){return f(a,void 0,void 0,function(){return h(this,function(c){switch(c.label){case 0:return r.setDeviceToken(me.APNS,n),[4,r.saveDeviceToken()];case 1:return c.sent(),[2]}})})})];case 3:return u.sent(),this._apnsPushToken="",[2,Pe.SUCCESS];case 4:return u.sent(),[2,Pe.ERROR];case 5:return[3,7];case 6:return this._apnsPushToken=n,[2,Pe.PENDING];case 7:return[2]}})})},t.prototype.unregisterAPNSPushTokenForCurrentUser=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o,a,u=this;return h(this,function(c){switch(c.label){case 0:if(D(T("string",n)).throw(I.invalidParameters),!this.currentUser)return[3,6];c.label=1;case 1:return c.trys.push([1,4,,5]),e=S.of(this._iid),r=e.sessionManager,i=e.sdkState,s=e.requestQueue,o=new n_({userId:i.userId,token:n}),[4,s.send(o)];case 2:return a=c.sent().lastDeletedAt,[4,Oe(function(){return f(u,void 0,void 0,function(){return h(this,function(l){switch(l.label){case 0:return r.unsetDeviceToken(me.APNS,n),r.setDeviceTokenDeletedAt(a),[4,r.saveDeviceToken()];case 1:return l.sent(),[2]}})})})];case 3:return c.sent(),this._apnsPushToken="",[2,Pe.SUCCESS];case 4:return c.sent(),[2,Pe.ERROR];case 5:return[3,7];case 6:return this._apnsPushToken=n,[2,Pe.PENDING];case 7:return[2]}})})},t.prototype.unregisterAPNSPushTokenAllForCurrentUser=function(){return f(this,void 0,void 0,function(){var n,e,r,i,s,o,a=this;return h(this,function(u){switch(u.label){case 0:return this.currentUser?(n=S.of(this._iid),e=n.sessionManager,r=n.sdkState,i=n.requestQueue,s=new i_({userId:r.userId}),[4,i.send(s)]):[3,3];case 1:return o=u.sent().lastDeletedAt,[4,Oe(function(){return f(a,void 0,void 0,function(){return h(this,function(c){switch(c.label){case 0:return e.unsetDeviceTokens(me.APNS),e.setDeviceTokenDeletedAt(o),[4,e.saveDeviceToken()];case 1:return c.sent(),[2]}})})})];case 2:u.sent(),u.label=3;case 3:return[2]}})})},t.prototype.getChannelInvitationPreference=function(){return f(this,void 0,void 0,function(){var n,e,r,i,s;return h(this,function(o){switch(o.label){case 0:return n=S.of(this._iid),e=n.sdkState,r=n.requestQueue,i=new u_({userId:e.userId}),[4,r.send(i)];case 1:return s=o.sent(),[2,{autoAccept:s.as(c_).autoAccept}]}})})},t.prototype.setChannelInvitationPreference=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o;return h(this,function(a){switch(a.label){case 0:return D(T("boolean",n)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new l_({userId:r.userId,willAutoAccept:n}),[4,i.send(s)];case 1:return o=a.sent(),[2,{autoAccept:o.as(d_).autoAccept}]}})})},t.prototype.getDoNotDisturb=function(){return f(this,void 0,void 0,function(){var n,e,r,i,s;return h(this,function(o){switch(o.label){case 0:return n=S.of(this._iid),e=n.sdkState,r=n.requestQueue,i=new h_({userId:e.userId}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(f_).preference]}})})},t.prototype.setDoNotDisturb=function(n,e,r,i,s,o){return e===void 0&&(e=0),r===void 0&&(r=0),i===void 0&&(i=0),s===void 0&&(s=0),o===void 0&&(o=""),f(this,void 0,void 0,function(){var a,u,c,l,d;return h(this,function(p){switch(p.label){case 0:return D(T("boolean",n)&&T("number",e)&&T("number",r)&&T("number",i)&&T("number",s)&&T("string",o)).throw(I.invalidParameters),a=S.of(this._iid),u=a.sdkState,c=a.requestQueue,l=new p_({userId:u.userId,doNotDisturbOn:n,startHour:e,startMin:r,endHour:i,endMin:s,timezone:o}),[4,c.send(l)];case 1:return d=p.sent(),[2,d.as(__).preference]}})})},t.prototype.getSnoozePeriod=function(){return f(this,void 0,void 0,function(){var n,e,r,i,s;return h(this,function(o){switch(o.label){case 0:return n=S.of(this._iid),e=n.sdkState,r=n.requestQueue,i=new v_({userId:e.userId}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(m_).snoozePeriod]}})})},t.prototype.setSnoozePeriod=function(n,e,r){return e===void 0&&(e=0),r===void 0&&(r=0),f(this,void 0,void 0,function(){var i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:return D(T("boolean",n)&&T("number",e)&&T("number",r)).throw(I.invalidParameters),i=S.of(this._iid),s=i.sdkState,o=i.requestQueue,a=new g_({userId:s.userId,snoozeOn:n,startTs:e,endTs:r}),[4,o.send(a)];case 1:return u=c.sent(),[2,u.as(y_).snoozePeriod]}})})},t.prototype.getMyPushTokensByToken=function(n,e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l,d,p,_,v;return h(this,function(m){switch(m.label){case 0:return D(T("string",n)&&ue(me,e)).throw(I.invalidParameters),r=S.of(this._iid),i=r.sdkState,s=r.requestQueue,o=r.sessionManager,a=new o_({userId:i.userId,type:e,token:n}),[4,s.send(a)];case 1:u=m.sent(),c=u.as(a_).pushTokens;try{for(l=$(c.deviceTokens),d=l.next();!d.done;d=l.next())p=d.value,o.setDeviceToken(c.type,p)}catch(y){_={error:y}}finally{try{d&&!d.done&&(v=l.return)&&v.call(l)}finally{if(_)throw _.error}}return[4,o.saveDeviceToken()];case 2:return m.sent(),[2,c]}})})},t.prototype.getPushTriggerOption=function(){return f(this,void 0,void 0,function(){var n,e,r,i;return h(this,function(s){switch(s.label){case 0:return n=S.of(this._iid),e=n.sdkState,r=n.requestQueue,i=new w_({userId:e.userId}),[4,r.send(i)];case 1:return[2,s.sent().as(I_).pushTriggerOption]}})})},t.prototype.setPushTriggerOption=function(n){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return D(ue(Ki,n)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new T_({userId:r.userId,pushTriggerOption:n}),[4,i.send(s)];case 1:return[2,o.sent().as(C_).pushTriggerOption]}})})},t.prototype.getPushTemplate=function(){return f(this,void 0,void 0,function(){var n,e,r,i;return h(this,function(s){switch(s.label){case 0:return n=S.of(this._iid),e=n.sdkState,r=n.requestQueue,i=new S_({userId:e.userId}),[4,r.send(i)];case 1:return[2,s.sent().as(A_).name]}})})},t.prototype.setPushTemplate=function(n){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return D(ue(Qi,n)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new N_({userId:r.userId,templateName:n}),[4,i.send(s)];case 1:return[2,o.sent().as(O_).name]}})})},t.prototype.blockUser=function(n){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return D(n instanceof V||T("string",n)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new b_({userId:r.userId,blockedUserId:n instanceof V?n.userId:n}),[4,i.send(s)];case 1:return o.sent(),[2]}})})},t.prototype.blockUserWithUserId=function(n){return f(this,void 0,void 0,function(){return h(this,function(e){return[2,this.blockUser(n)]})})},t.prototype.unblockUser=function(n){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return D(n instanceof V||T("string",n)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new E_({userId:r.userId,unblockedUserId:n instanceof V?n.userId:n}),[4,i.send(s)];case 1:return o.sent(),[2]}})})},t.prototype.unblockUserWithUserId=function(n){return f(this,void 0,void 0,function(){return h(this,function(e){return[2,this.unblockUser(n)]})})},t.prototype.getFriendChangeLogsByToken=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o;return h(this,function(a){switch(a.label){case 0:return D(T("string",n)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new k_({userId:r.userId,token:n}),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(R_).changelogs]}})})},t.prototype.getAllowFriendDiscovery=function(){return f(this,void 0,void 0,function(){var n,e,r,i,s;return h(this,function(o){switch(o.label){case 0:return n=S.of(this._iid),e=n.sdkState,r=n.requestQueue,i=new F_({userId:e.userId}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(q_).allowFriendDiscovery]}})})},t.prototype.setAllowFriendDiscovery=function(n){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return D(T("boolean",n)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new z_({userId:r.userId,allowFriendDiscovery:n}),[4,i.send(s)];case 1:return o.sent(),[2,n]}})})},t.prototype.uploadFriendDiscoveries=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o;return h(this,function(a){switch(a.label){case 0:return e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new D_({userId:r.userId,discoveries:n}),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(U_).friendDiscoveryRequestId]}})})},t.prototype.deleteFriendDiscovery=function(n){return f(this,void 0,void 0,function(){return h(this,function(e){return[2,this.deleteFriendDiscoveries([n])]})})},t.prototype.deleteFriendDiscoveries=function(n){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return D(X("string",n)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new M_({userId:r.userId,discoveryKeys:n}),[4,i.send(s)];case 1:return o.sent(),[2]}})})},t.prototype.addFriends=function(n){return f(this,void 0,void 0,function(){var e,r,i,s,o;return h(this,function(a){switch(a.label){case 0:return D(X("string",n)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new L_({userId:r.userId,userIds:n}),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(P_).users]}})})},t.prototype.deleteFriend=function(n){return f(this,void 0,void 0,function(){return h(this,function(e){return[2,this.deleteFriends([n])]})})},t.prototype.deleteFriends=function(n){return f(this,void 0,void 0,function(){var e,r,i,s;return h(this,function(o){switch(o.label){case 0:return D(X("string",n)).throw(I.invalidParameters),e=S.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new x_({userId:r.userId,userIds:n}),[4,i.send(s)];case 1:return o.sent(),[2]}})})},t.prototype.getAllEmoji=function(){return f(this,void 0,void 0,function(){var n,e,r;return h(this,function(i){switch(i.label){case 0:return n=S.of(this._iid).requestQueue,e=new H_,[4,n.send(e)];case 1:return r=i.sent(),[2,r.as($_).emojiContainer]}})})},t.prototype.getEmojiCategory=function(n){return f(this,void 0,void 0,function(){var e,r,i;return h(this,function(s){switch(s.label){case 0:return e=S.of(this._iid).requestQueue,r=new j_({categoryId:n}),[4,e.send(r)];case 1:return i=s.sent(),[2,i.as(B_).emojiCategory]}})})},t.prototype.getEmoji=function(n){return f(this,void 0,void 0,function(){var e,r,i;return h(this,function(s){switch(s.label){case 0:return e=S.of(this._iid).requestQueue,r=new G_({key:n}),[4,e.send(r)];case 1:return i=s.sent(),[2,i.as(V_).emoji]}})})},t.prototype.getUIKitConfiguration=function(){return f(this,void 0,void 0,function(){var n,e,r,i;return h(this,function(s){switch(s.label){case 0:return n=S.of(this._iid),D(n.hasExtension("sb_uikit")).throw(I.notSupportedError),e=n.requestQueue,r=new K_,[4,e.send(r)];case 1:return i=s.sent(),[2,i.as(Q_).uikitConfiguration]}})})},t}(),De;(function(t){t[t.NONE=0]="NONE",t[t.CHANNEL_ENTER=10102]="CHANNEL_ENTER",t[t.CHANNEL_EXIT=10103]="CHANNEL_EXIT",t[t.USER_CHANNEL_MUTE=10201]="USER_CHANNEL_MUTE",t[t.USER_CHANNEL_UNMUTE=10200]="USER_CHANNEL_UNMUTE",t[t.USER_CHANNEL_BAN=10601]="USER_CHANNEL_BAN",t[t.USER_CHANNEL_UNBAN=10600]="USER_CHANNEL_UNBAN",t[t.CHANNEL_FREEZE=10701]="CHANNEL_FREEZE",t[t.CHANNEL_UNFREEZE=10700]="CHANNEL_UNFREEZE",t[t.TYPING_START=10900]="TYPING_START",t[t.TYPING_END=10901]="TYPING_END",t[t.CHANNEL_JOIN=1e4]="CHANNEL_JOIN",t[t.CHANNEL_LEAVE=10001]="CHANNEL_LEAVE",t[t.CHANNEL_OPERATOR_UPDATE=10002]="CHANNEL_OPERATOR_UPDATE",t[t.CHANNEL_INVITE=10020]="CHANNEL_INVITE",t[t.CHANNEL_ACCEPT_INVITE=10021]="CHANNEL_ACCEPT_INVITE",t[t.CHANNEL_DECLINE_INVITE=10022]="CHANNEL_DECLINE_INVITE",t[t.CHANNEL_PROP_CHANGED=11e3]="CHANNEL_PROP_CHANGED",t[t.CHANNEL_DELETED=12e3]="CHANNEL_DELETED",t[t.CHANNEL_META_DATA_CHANGED=11100]="CHANNEL_META_DATA_CHANGED",t[t.CHANNEL_META_COUNTERS_CHANGED=11200]="CHANNEL_META_COUNTERS_CHANGED",t[t.CHANNEL_HIDE=13e3]="CHANNEL_HIDE",t[t.CHANNEL_UNHIDE=13001]="CHANNEL_UNHIDE",t[t.PINNED_MESSAGE_CHANGED=11300]="PINNED_MESSAGE_CHANGED"})(De||(De={}));var Y_=function(){function t(n){var e;this.channelUrl=n.channel_url,this.channelType=n.channel_type,this.category=n.cat,this.data=(e=n.data)!==null&&e!==void 0?e:{},this.ts=n.ts}return Object.defineProperty(t.prototype,"isGroupChannelEvent",{get:function(){return this.channelType===W.GROUP},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isOpenChannelEvent",{get:function(){return this.channelType===W.OPEN},enumerable:!1,configurable:!0}),t}(),ki=function(t){function n(e,r,i){var s=t.call(this,e,"SYEV",i)||this;return s.event=new Y_(i),s}return g(n,t),n}(de),Z_=function(t){function n(e,r,i){var s=t.call(this,e,r,i)||this,o=i.data.operators,a=o===void 0?[]:o;return s.operators=a.map(function(u){return new V(s._iid,u)}),s}return g(n,t),n}(ki),X_=function(t){function n(e,r){var i=t.call(this,e)||this;return i._logger=r.logger,i._sdkState=r.sdkState,i._sessionManager=r.sessionManager,i._requestQueue=r.requestQueue,i._dispatcher=r.dispatcher,i._cacheContext=r.cacheContext,i._channelType=r.channelType,i}return g(n,t),Object.defineProperty(n.prototype,"_messageBroadcast",{get:function(){return tc.of(this._iid)},enumerable:!1,configurable:!0}),n.prototype.subscribeMessageEvent=function(e,r){this._messageBroadcast.subscribe(e,r)},n.prototype.unsubscribeMessageEvent=function(e){this._messageBroadcast.unsubscribe(e)},n.prototype.getMessageFromCache=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2,null]})})},n.prototype.getExactlyMatchingMessagesForTokenFromCache=function(e,r,i){return f(this,void 0,void 0,function(){return h(this,function(s){return[2,[]]})})},n.prototype.getMessagesFromCache=function(e,r,i,s,o,a){return f(this,void 0,void 0,function(){return h(this,function(u){return[2,[]]})})},n.prototype.getPollMessagesFromCache=function(e,r,i,s){return f(this,void 0,void 0,function(){return h(this,function(o){return[2,[]]})})},n.prototype.getCachedMessageCountBetween=function(e,r,i,s){return f(this,void 0,void 0,function(){return h(this,function(o){return[2,0]})})},n.prototype.getUnsentMessagesFromCache=function(e,r){return f(this,void 0,void 0,function(){return h(this,function(i){return[2,[]]})})},n.prototype.removeFailedMessageFromCache=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2]})})},n}(qe),J_=function(t){function n(e,r,i){var s,o,a,u,c=this;(c=t.call(this,e,"ADMM",i)||this).message=new gr(e,i);var l=S.of(e).sdkState;return c.isMentioned=Sn(c.message.mentionType,(a=(s=c.message.mentionedUserIds)!==null&&s!==void 0?s:(o=c.message.mentionedUsers)===null||o===void 0?void 0:o.map(function(d){return d.userId}))!==null&&a!==void 0?a:[],l.userId),c.forceUpdateLastMessage=(u=i.force_update_last_message)!==null&&u!==void 0&&u,c}return g(n,t),n}(de),ev=function(t){function n(e,r,i){var s,o,a,u,c,l=this;(l=t.call(this,e,"AEDI",i)||this).message=new gr(e,i);var d=S.of(e).sdkState;return l.mentionCountChange=Ji({mentionType:(s=i.old_values)===null||s===void 0?void 0:s.mention_type,mentionedUserIds:(a=(o=i.old_values)===null||o===void 0?void 0:o.mentioned_user_ids)!==null&&a!==void 0?a:[]},H({mentionType:l.message.mentionType,mentionedUserIds:(u=l.message.mentionedUserIds)!==null&&u!==void 0?u:(c=l.message.mentionedUsers)===null||c===void 0?void 0:c.map(function(p){return p.userId})}),d.userId),l}return g(n,t),n}(de),tv=function(t){function n(e,r,i){var s=t.call(this,e,"MRCT",i)||this;return s.channelUrl=i.channel_url,s.channelType=i.channel_type,s.event=new xs(i),s}return g(n,t),n}(de),nv=function(t){function n(e,r,i){var s=t.call(this,e,"MTHD",i)||this;return s.event=new Up(e,i),s}return g(n,t),n}(de),rv=function(t){function n(e,r,i){var s=t.call(this,e,"MCNT",i)||this;return s.groupChannelMemberCounts=i.group_channels.map(function(o){return{channelUrl:o.channel_url,memberCount:o.member_count,joinedMemberCount:o.joined_member_count,updatedAt:o.ts}}),s.openChannelMemberCounts=i.open_channels.map(function(o){return{channelUrl:o.channel_url,participantCount:o.participant_count,updatedAt:o.ts}}),s}return g(n,t),n}(de),iv=function(t){function n(e,r,i){var s=t.call(this,e,"PEDI",i)||this;return s.event=new Hp(e,i),s.status=Ds(i.poll.status)||i.poll.status,s.channelUrl=i.channel_url,s.channelType=i.channel_type,s}return g(n,t),n}(de),sv=function(){this.onUserMuted=B,this.onUserUnmuted=B,this.onUserBanned=B,this.onUserUnbanned=B,this.onChannelChanged=B,this.onChannelDeleted=B,this.onChannelFrozen=B,this.onChannelUnfrozen=B,this.onOperatorUpdated=B,this.onChannelMemberCountChanged=B,this.onMetaDataCreated=B,this.onMetaDataUpdated=B,this.onMetaDataDeleted=B,this.onMetaCounterCreated=B,this.onMetaCounterUpdated=B,this.onMetaCounterDeleted=B,this.onMessageReceived=B,this.onMessageUpdated=B,this.onMessageDeleted=B,this.onMentionReceived=B,this.onReactionUpdated=B,this.onThreadInfoUpdated=B},ov=function(t){function n(){var e=t!==null&&t.apply(this,arguments)||this;return e._channels=new Map,e._enteredChannelUrls=[],e}return g(n,t),Object.defineProperty(n.prototype,"enteredChannels",{get:function(){var e=this;return this._enteredChannelUrls.map(function(r){return e._channels.get(r)}).filter(function(r){return!!r})},enumerable:!1,configurable:!0}),n.prototype.isEnteredChannel=function(e){return this._enteredChannelUrls.includes(e)},n.prototype.enter=function(e){this._enteredChannelUrls.indexOf(e)<0&&this._enteredChannelUrls.push(e)},n.prototype.exit=function(e){var r=this._enteredChannelUrls.indexOf(e);r>=0&&this._enteredChannelUrls.splice(r,1)},n.prototype.exitAll=function(){this._enteredChannelUrls=[]},n.prototype.get=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2,this._channels.get(e)]})})},n.prototype.upsert=function(e){return f(this,void 0,void 0,function(){var r,i=this;return h(this,function(s){return r=[],e.forEach(function(o){if(i._channels.has(o.url)){var a=i._channels.get(o.url);Object.assign(a,o),r.push(a)}else i._channels.set(o.url,o),r.push(o)}),[2,r]})})},n.prototype.remove=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return this._channels.delete(e),this.exit(e),[2]})})},n.prototype.clear=function(){return f(this,void 0,void 0,function(){return h(this,function(e){return this._channels.clear(),this._enteredChannelUrls=[],[2]})})},n}(qe),fc={channelUrl:void 0,name:void 0,coverUrlOrImage:void 0,data:void 0,customType:void 0,operatorUserIds:void 0,isEphemeral:void 0},av=function(t){function n(e){var r=e.channelUrl,i=e.isInternalCall,s=t.call(this)||this;return s.method=k.GET,s.path="".concat(i?hl:Jt,"/").concat(encodeURIComponent(r)),s}return g(n,t),n}(R),pc=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.channel=new Hn(e,r),i}return g(n,t),n}(M),uv=function(t){function n(e){var r=this,i=e.channelUrl,s=e.coverUrlOrImage,o=e.name,a=e.data,u=e.customType,c=e.operatorUserIds,l=e.isEphemeral;return(r=t.call(this)||this).method=k.POST,r.path=Jt,r.params=x(H({channel_url:i,cover_url:T("string",s)?s:null,cover_file:Ge(s)?s:null,name:o,data:a,custom_type:u,operators:c,is_ephemeral:l})),r}return g(n,t),n}(R);(function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.channel=new Hn(e,r),i}g(n,t)})(M);var cv=function(t){function n(e){var r=e.channelUrl;return t.call(this,{code:"ENTR",payload:{channel_url:r},ackRequired:!0})||this}return g(n,t),n}(He),_c=function(t){function n(e,r,i){var s,o,a=this;return a=t.call(this,e,"SYEV",i)||this,i.data&&(a.participantCount=(s=i.data.participant_count)!==null&&s!==void 0?s:0,a.user=new V(e,i.data),a.ts=(o=i.data.edge_ts)!==null&&o!==void 0?o:0),a}return g(n,t),n}(ki),lv=function(t){function n(e){var r=e.channelUrl;return t.call(this,{code:"EXIT",payload:{channel_url:r},ackRequired:!0})||this}return g(n,t),n}(He),vc=function(t){function n(e,r,i){var s,o,a=this;return a=t.call(this,e,"EXIT",i)||this,i.data&&(a.participantCount=(s=i.data.participant_count)!==null&&s!==void 0?s:0,a.user=new V(e,i.data),a.ts=(o=i.data.edge_ts)!==null&&o!==void 0?o:0),a}return g(n,t),n}(ki),so={},yn=function(t){function n(e,r){var i=t.call(this,e,b(b({},r),{channelType:W.OPEN}))||this;return i.subscribeChannelEvent=B,i.unsubscribeChannelEvent=B,i.refreshChannel=function(){return f(i,void 0,void 0,function(){return h(this,function(s){return[2,B()]})})},i._openChannelCache=new ov(e),i._openChannelHandlers=new Map,i._dispatcher.on(function(s){var o,a;if(s instanceof de)i._handleEvent(s).catch(function(d){if(rt(d)&&i._sdkState.appState==="foreground")throw d});else if(s instanceof un&&s.stateType===se.CONNECTED){var u=i._openChannelCache.enteredChannels;try{for(var c=$(u),l=c.next();!l.done;l=c.next())l.value.enter()}catch(d){o={error:d}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}}}),so[e]||(so[e]=i),i}return g(n,t),n.of=function(e){return so[e]},n.prototype.buildOpenChannelFromSerializedData=function(e){var r=_r(e);return new Hn(this._iid,Hn.payloadify(r))},n.prototype.getChannelFromCache=function(e){var r;return f(this,void 0,void 0,function(){return h(this,function(i){switch(i.label){case 0:return[4,this._openChannelCache.get(e)];case 1:return[2,(r=i.sent())!==null&&r!==void 0?r:null]}})})},n.prototype.upsertChannelsToCache=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){switch(r.label){case 0:return[4,this._openChannelCache.upsert(e)];case 1:return[2,r.sent()]}})})},n.prototype.removeChannelsFromCache=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u;return h(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),r=$(e),i=r.next(),c.label=1;case 1:return i.done?[3,4]:(s=i.value,[4,this._openChannelCache.remove(s)]);case 2:c.sent(),c.label=3;case 3:return i=r.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),a={error:o},[3,7];case 6:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(a)throw a.error}return[7];case 7:return[2]}})})},n.prototype.setEnteredToCache=function(e){this._openChannelCache.enter(e.url)},n.prototype.setExitedToCache=function(e){this._openChannelCache.exit(e.url)},n.prototype._handleEvent=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a,u,c,l,d,p,_,v,m,y,E,w,C,A,P,N,q,F,L,U,K,ve,we,Ct,ft,Rr,lt,Wt,Dc,Ie,Ui,lo,Uc,Mc,Mi,ho,Bn,Lc,Pc,Li,fo,po,_o,vo,mo,go,yo,Dr,bo,Pi,xc,En,xi,Ur,Mr,Lr,Fi,qi,Eo,wo,Io,To,Co,Fc,Te=this;return h(this,function(te){switch(te.label){case 0:switch(te.trys.push([0,57,,58]),e.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"MRCT":return[3,10];case"MTHD":return[3,13];case"MCNT":return[3,16];case"PEDI":return[3,27];case"VOTE":return[3,30];case"SYEV":return[3,33]}return[3,56];case 1:return o=null,e.code==="MESG"?o=e.as(zu):e.code==="FILE"?o=e.as(Eu):e.code!=="ADMM"&&e.code!="BRDM"||(o=e.as(J_)),o?(r=o.message,i=o.isMentioned,r.channelType!==W.OPEN?[3,3]:[4,this.getChannel(r.channelUrl,!0)]):[3,3];case 2:s=te.sent(),Q(function(){return f(Te,void 0,void 0,function(){var j,O,re,ie,fe;return h(this,function(Yt){try{for(j=$(this._openChannelHandlers.values()),O=j.next();!O.done;O=j.next())re=O.value,this._openChannelCache.isEnteredChannel(s.url)&&(re.onMessageReceived&&re.onMessageReceived(s,r),i&&re.onMentionReceived&&re.onMentionReceived(s,r))}catch(Le){ie={error:Le}}finally{try{O&&!O.done&&(fe=j.return)&&fe.call(j)}finally{if(ie)throw ie.error}}return[2]})})}),te.label=3;case 3:return[3,56];case 4:return o=null,e.code==="MEDI"?o=e.as(Gs):e.code==="FEDI"?o=e.as(Vs):e.code==="AEDI"&&(o=e.as(ev)),o?(a=o.message,u=o.mentionCountChange,a.channelType!==W.OPEN?[3,6]:[4,this.getChannel(a.channelUrl,!0)]):[3,6];case 5:c=te.sent(),Q(function(){return f(Te,void 0,void 0,function(){var j,O,re,ie,fe;return h(this,function(Yt){try{for(j=$(this._openChannelHandlers.values()),O=j.next();!O.done;O=j.next())re=O.value,this._openChannelCache.isEnteredChannel(c.url)&&(re.onMessageUpdated&&re.onMessageUpdated(c,a),u>0&&re.onMentionReceived&&re.onMentionReceived(c,a))}catch(Le){ie={error:Le}}finally{try{O&&!O.done&&(fe=j.return)&&fe.call(j)}finally{if(ie)throw ie.error}}return[2]})})}),te.label=6;case 6:return[3,56];case 7:return l=e.as(Cf),lt=l.channelUrl,Wt=l.channelType,d=l.messageId,Wt!==W.OPEN?[3,9]:[4,this.getChannel(lt,!0)];case 8:p=te.sent(),Q(function(){return f(Te,void 0,void 0,function(){var j,O,re,ie,fe;return h(this,function(Yt){try{for(j=$(this._openChannelHandlers.values()),O=j.next();!O.done;O=j.next())re=O.value,this._openChannelCache.isEnteredChannel(p.url)&&re.onMessageDeleted&&re.onMessageDeleted(p,d)}catch(Le){ie={error:Le}}finally{try{O&&!O.done&&(fe=j.return)&&fe.call(j)}finally{if(ie)throw ie.error}}return[2]})})}),te.label=9;case 9:return[3,56];case 10:return _=e.as(tv),lt=_.channelUrl,Wt=_.channelType,v=_.event,Wt!==W.OPEN?[3,12]:[4,this.getChannel(lt,!0)];case 11:m=te.sent(),Q(function(){return f(Te,void 0,void 0,function(){var j,O,re,ie,fe;return h(this,function(Yt){try{for(j=$(this._openChannelHandlers.values()),O=j.next();!O.done;O=j.next())re=O.value,this._openChannelCache.isEnteredChannel(m.url)&&re.onReactionUpdated&&re.onReactionUpdated(m,v)}catch(Le){ie={error:Le}}finally{try{O&&!O.done&&(fe=j.return)&&fe.call(j)}finally{if(ie)throw ie.error}}return[2]})})}),te.label=12;case 12:return[3,56];case 13:return(y=e.as(nv).event).channelType!==W.OPEN?[3,15]:[4,this.getChannel(y.channelUrl,!0)];case 14:E=te.sent(),Q(function(){return f(Te,void 0,void 0,function(){var j,O,re,ie,fe;return h(this,function(Yt){try{for(j=$(this._openChannelHandlers.values()),O=j.next();!O.done;O=j.next())re=O.value,this._openChannelCache.isEnteredChannel(E.url)&&re.onThreadInfoUpdated&&re.onThreadInfoUpdated(E,y)}catch(Le){ie={error:Le}}finally{try{O&&!O.done&&(fe=j.return)&&fe.call(j)}finally{if(ie)throw ie.error}}return[2]})})}),te.label=15;case 15:return[3,56];case 16:w=e.as(rv).openChannelMemberCounts,C=[],te.label=17;case 17:te.trys.push([17,22,23,24]),A=$(w),P=A.next(),te.label=18;case 18:return P.done?[3,21]:(N=P.value,lt=N.channelUrl,Bn=N.participantCount,q=N.updatedAt,[4,this.getChannelFromCache(lt)]);case 19:(F=te.sent())&&F._updateParticipantCount(Bn,q)&&C.push(F),te.label=20;case 20:return P=A.next(),[3,18];case 21:return[3,24];case 22:return L=te.sent(),Co={error:L},[3,24];case 23:try{P&&!P.done&&(Fc=A.return)&&Fc.call(A)}finally{if(Co)throw Co.error}return[7];case 24:return C.length>0?[4,this.upsertChannelsToCache(C)]:[3,26];case 25:U=te.sent(),Q(function(){return f(Te,void 0,void 0,function(){var j,O,re,ie,fe;return h(this,function(Yt){try{for(j=$(this._openChannelHandlers.values()),O=j.next();!O.done;O=j.next())(re=O.value).onChannelMemberCountChanged&&re.onChannelMemberCountChanged(U)}catch(Le){ie={error:Le}}finally{try{O&&!O.done&&(fe=j.return)&&fe.call(j)}finally{if(ie)throw ie.error}}return[2]})})}),te.label=26;case 26:return[3,56];case 27:return K=e.as(iv),ve=K.event,we=K.status,lt=K.channelUrl,Wt=K.channelType,lt&&Wt===W.OPEN?[4,this.getChannel(lt,!0)]:[3,29];case 28:Ct=te.sent(),this._dispatcher.dispatch(new nu({event:ve,source:ne.EVENT_POLL_UPDATED})),Q(we===Kd?function(){return f(Te,void 0,void 0,function(){var j,O,re,ie,fe;return h(this,function(Yt){try{for(j=$(this._openChannelHandlers.values()),O=j.next();!O.done;O=j.next())(re=O.value).onPollDeleted&&re.onPollDeleted(Ct,ve.pollId)}catch(Le){ie={error:Le}}finally{try{O&&!O.done&&(fe=j.return)&&fe.call(j)}finally{if(ie)throw ie.error}}return[2]})})}:function(){return f(Te,void 0,void 0,function(){var j,O,re,ie,fe;return h(this,function(Yt){try{for(j=$(this._openChannelHandlers.values()),O=j.next();!O.done;O=j.next())(re=O.value).onPollUpdated&&re.onPollUpdated(Ct,ve)}catch(Le){ie={error:Le}}finally{try{O&&!O.done&&(fe=j.return)&&fe.call(j)}finally{if(ie)throw ie.error}}return[2]})})}),te.label=29;case 29:return[3,56];case 30:return ft=e.as(ju),Rr=ft.event,lt=ft.channelUrl,Wt=ft.channelType,lt&&Wt===W.OPEN?[4,this.getChannel(lt,!0)]:[3,32];case 31:Dc=te.sent(),this._dispatcher.dispatch(new Rs({event:Rr,source:ne.EVENT_POLL_VOTED})),Q(function(){return f(Te,void 0,void 0,function(){var j,O,re,ie,fe;return h(this,function(Yt){try{for(j=$(this._openChannelHandlers.values()),O=j.next();!O.done;O=j.next())(re=O.value).onPollVoted&&re.onPollVoted(Dc,Rr)}catch(Le){ie={error:Le}}finally{try{O&&!O.done&&(fe=j.return)&&fe.call(j)}finally{if(ie)throw ie.error}}return[2]})})}),te.label=32;case 32:return[3,56];case 33:if(!(Ie=e.as(ki).event).isOpenChannelEvent)return[3,55];switch(Ie.category){case De.CHANNEL_ENTER:return[3,34];case De.CHANNEL_EXIT:return[3,36];case De.CHANNEL_OPERATOR_UPDATE:return[3,38];case De.USER_CHANNEL_MUTE:case De.USER_CHANNEL_UNMUTE:return[3,40];case De.USER_CHANNEL_BAN:case De.USER_CHANNEL_UNBAN:return[3,42];case De.CHANNEL_FREEZE:case De.CHANNEL_UNFREEZE:return[3,44];case De.CHANNEL_DELETED:return[3,46];case De.CHANNEL_PROP_CHANGED:return[3,49];case De.CHANNEL_META_DATA_CHANGED:return[3,51];case De.CHANNEL_META_COUNTERS_CHANGED:return[3,53]}return[3,55];case 34:return[4,this.getChannel(Ie.channelUrl,!0)];case 35:return Ui=te.sent(),lo=e.as(_c),Bn=lo.participantCount,Uc=lo.user,Mc=Ui._updateParticipantCount(Bn,Ie.ts),Q(function(){return f(Te,void 0,void 0,function(){return h(this,function(j){return this._openChannelHandlers.forEach(function(O){O.onUserEntered&&O.onUserEntered(Ui,Uc),Mc&&O.onChannelParticipantCountChanged&&O.onChannelParticipantCountChanged(Ui)}),[2]})})}),[3,55];case 36:return[4,this.getChannel(Ie.channelUrl,!0)];case 37:return Mi=te.sent(),ho=e.as(vc),Bn=ho.participantCount,Lc=ho.user,Pc=Mi._updateParticipantCount(Bn,Ie.ts),Q(function(){return f(Te,void 0,void 0,function(){return h(this,function(j){return this._openChannelHandlers.forEach(function(O){O.onUserExited&&O.onUserExited(Mi,Lc),Pc&&O.onChannelParticipantCountChanged&&O.onChannelParticipantCountChanged(Mi)}),[2]})})}),[3,55];case 38:return[4,this.getChannel(Ie.channelUrl,!0)];case 39:return Li=te.sent(),fo=e.as(Z_).operators,Li.operators=fo,this.upsertChannelsToCache([Li]),Q(function(){return f(Te,void 0,void 0,function(){return h(this,function(j){return this._openChannelHandlers.forEach(function(O){O.onOperatorUpdated&&O.onOperatorUpdated(Li,fo)}),[2]})})}),[3,55];case 40:return[4,this.getChannel(Ie.channelUrl,!0)];case 41:return po=te.sent(),_o=Ie.category===De.USER_CHANNEL_MUTE,vo=e.as(_o?hf:pf).user,Q(function(){return f(Te,void 0,void 0,function(){return h(this,function(j){return this._openChannelHandlers.forEach(function(O){_o?O.onUserMuted&&O.onUserMuted(po,vo):O.onUserUnmuted&&O.onUserUnmuted(po,vo)}),[2]})})}),[3,55];case 42:return[4,this.getChannel(Ie.channelUrl,!0)];case 43:return mo=te.sent(),go=Ie.category===De.USER_CHANNEL_BAN,yo=e.as(go?vf:gf).user,Q(function(){return f(Te,void 0,void 0,function(){return h(this,function(j){return this._openChannelHandlers.forEach(function(O){go?O.onUserBanned&&O.onUserBanned(mo,yo):O.onUserUnbanned&&O.onUserUnbanned(mo,yo)}),[2]})})}),[3,55];case 44:return[4,this.getChannel(Ie.channelUrl,!0)];case 45:return Dr=te.sent(),bo=e.as(yf).freeze,Dr.isFrozen=bo,this.upsertChannelsToCache([Dr]),Q(function(){return f(Te,void 0,void 0,function(){return h(this,function(j){return this._openChannelHandlers.forEach(function(O){bo?O.onChannelFrozen&&O.onChannelFrozen(Dr):O.onChannelUnfrozen&&O.onChannelUnfrozen(Dr)}),[2]})})}),[3,55];case 46:return[4,this.getChannel(Ie.channelUrl,!0)];case 47:return Pi=te.sent(),[4,this.removeChannelsFromCache([Pi.url])];case 48:return te.sent(),Q(function(){return f(Te,void 0,void 0,function(){return h(this,function(j){return this._openChannelHandlers.forEach(function(O){O.onChannelDeleted&&O.onChannelDeleted(Pi.url,Pi.channelType)}),[2]})})}),[3,55];case 49:return[4,this.getChannelWithoutCache(Ie.channelUrl,!0)];case 50:return xc=te.sent(),Q(function(){return f(Te,void 0,void 0,function(){return h(this,function(j){return this._openChannelHandlers.forEach(function(O){O.onChannelChanged&&O.onChannelChanged(xc)}),[2]})})}),[3,55];case 51:return[4,this.getChannel(Ie.channelUrl,!0)];case 52:return En=te.sent(),xi=e.as(ef),Ur=xi.created,Mr=xi.updated,Lr=xi.deleted,Ur&&En._upsertCachedMetaData(Ur,Ie.ts),Mr&&En._upsertCachedMetaData(Mr,Ie.ts),Lr&&En._removeFromCachedMetaData(Lr,Ie.ts),Q(function(){return f(Te,void 0,void 0,function(){return h(this,function(j){return this._openChannelHandlers.forEach(function(O){Ur&&O.onMetaDataCreated&&O.onMetaDataCreated(En,Ur),Mr&&O.onMetaDataUpdated&&O.onMetaDataUpdated(En,Mr),Lr&&O.onMetaDataDeleted&&O.onMetaDataDeleted(En,Lr)}),[2]})})}),[3,55];case 53:return[4,this.getChannel(Ie.channelUrl,!0)];case 54:return Fi=te.sent(),qi=e.as(uf),Eo=qi.created,wo=qi.updated,Io=qi.deleted,Q(function(){return f(Te,void 0,void 0,function(){return h(this,function(j){return this._openChannelHandlers.forEach(function(O){Eo&&O.onMetaCounterCreated&&O.onMetaCounterCreated(Fi,Eo),wo&&O.onMetaCounterUpdated&&O.onMetaCounterUpdated(Fi,wo),Io&&O.onMetaCounterDeleted&&O.onMetaCounterDeleted(Fi,Io)}),[2]})})}),[3,55];case 55:return[3,56];case 56:return[3,58];case 57:if(To=te.sent(),rt(To))throw To;return[3,58];case 58:return[2]}})})},n.prototype.addHandler=function(e,r){this._openChannelHandlers.set(e,r)},n.prototype.removeHandler=function(e){this._openChannelHandlers.delete(e)},n.prototype.clearHandler=function(){this._openChannelHandlers.clear()},n.prototype.getChannel=function(e,r){return f(this,void 0,void 0,function(){var i;return h(this,function(s){switch(s.label){case 0:D(T("string",e)).throw(I.invalidParameters),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.getChannelFromCache(e)];case 2:return(i=s.sent())?[2,i]:[3,4];case 3:return s.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(e)];case 5:return[2,s.sent()]}})})},n.prototype.getChannelWithoutCache=function(e,r){return r===void 0&&(r=!1),f(this,void 0,void 0,function(){var i,s,o;return h(this,function(a){switch(a.label){case 0:return D(T("string",e)).throw(I.invalidParameters),i=new av({channelUrl:e,isInternalCall:r}),[4,this._requestQueue.send(i)];case 1:return s=a.sent(),o=s.as(pc).channel,[4,this.upsertChannelsToCache([o])];case 2:return[2,a.sent()[0]]}})})},n.prototype.createChannel=function(e){return f(this,void 0,void 0,function(){var r,i,s,o;return h(this,function(a){switch(a.label){case 0:return r=b(b({},fc),e),D(function(u){return X("string",u.operatorUserIds,!0)&&(T("string",u.coverUrlOrImage,!0)||Ge(u.coverUrlOrImage,!0))&&T("string",u.name,!0)&&T("string",u.data,!0)&&T("string",u.customType,!0)&&(T("string",u.channelUrl)&&/^\w+$/.test(u.channelUrl)||u.channelUrl===null||u.channelUrl===void 0)&&T("boolean",u.isEphemeral,!0)}(r)).throw(I.invalidParameters),i=new uv(r),[4,this._requestQueue.send(i)];case 1:return s=a.sent(),o=s.as(pc).channel,this.upsertChannelsToCache([o]),[2,o]}})})},n}(X_),mc={name:void 0,coverUrlOrImage:void 0,data:void 0,customType:void 0,operatorUserIds:void 0},dv=function(t){function n(e){var r=this,i=e.channelUrl,s=e.token,o=e.limit;return(r=t.call(this)||this).method=k.GET,r.path="".concat(Jt,"/").concat(encodeURIComponent(i),"/participants"),r.params={token:s,limit:o},r}return g(n,t),n}(R),hv=function(t){function n(e,r){var i=t.call(this,e,r)||this;i.participants=[];var s=r.next,o=r.participants;return i.token=s,i.participants=o.map(function(a){return new Oh(e,a)}),i}return g(n,t),n}(M),fv=function(t){function n(e,r,i){return t.call(this,e,r,W.OPEN,i)||this}return g(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)},n.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid).requestQueue,r=new dv(b(b({},this),{token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(hv),o=s.participants,a=s.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,o];case 2:return[2,[]];case 3:throw I.queryInProgress;case 4:return[3,6];case 5:throw I.invalidParameters;case 6:return[2]}})})},n}(dn),pv=function(t){function n(e){var r=this,i=e.channelUrl,s=e.coverUrlOrImage,o=e.name,a=e.data,u=e.customType,c=e.operatorUserIds;return(r=t.call(this)||this).method=k.PUT,r.path="".concat(Jt,"/").concat(encodeURIComponent(i)),r.params=x(H({cover_url:T("string",s)?s:null,cover_file:Ge(s)?s:null,name:o,data:a,custom_type:u,operators:c})),r}return g(n,t),n}(R),_v=function(t){function n(e,r){var i=t.call(this,e,r)||this;return i.channel=new Hn(e,r),i}return g(n,t),n}(M),vv=function(t){function n(e){var r=this,i=e.channelUrl;return(r=t.call(this)||this).method=k.DELETE,r.path="".concat(Jt,"/").concat(encodeURIComponent(i)),r}return g(n,t),n}(R);(function(t){function n(e,r){return t.call(this,e,r)||this}g(n,t)})(M);var Hn=function(t){function n(e,r){var i,s=this;return(s=t.call(this,e,r)||this)._lastParticipantCountUpdated=0,s.participantCount=0,s.operators=[],s.channelType=W.OPEN,s.participantCount=(i=r.participant_count)!==null&&i!==void 0?i:0,s.operators=Array.isArray(r.operators)?r.operators.map(function(o){return new V(e,o)}):[],s}return g(n,t),n.payloadify=function(e){return x(H(b(b({},Gu.payloadify(e)),{participant_count:e.participantCount,operators:e.operators.map(function(r){return V.payloadify(r)})})))},n.prototype.serialize=function(){return ri(this)},n.prototype.isOperator=function(e){return e instanceof V?this.isOperator(e.userId):this.operators.some(function(r){return r.userId===e})},n.prototype._updateParticipantCount=function(e,r){return r>this._lastParticipantCountUpdated&&(this.participantCount=e,this._lastParticipantCountUpdated=r,!0)},n.prototype.createParticipantListQuery=function(e){return new fv(this._iid,this.url,e)},n.prototype.refresh=function(){return f(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,yn.of(this._iid).getChannelWithoutCache(this.url)];case 1:return[2,e.sent()]}})})},n.prototype.enter=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return e=S.of(this._iid).requestQueue,r=new cv({channelUrl:this.url}),[4,e.send(r)];case 1:return i=u.sent(),s=i.as(_c),o=s.participantCount,a=s.ts,this._updateParticipantCount(o,a),yn.of(this._iid).setEnteredToCache(this),[2]}})})},n.prototype.exit=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return e=S.of(this._iid).requestQueue,r=new lv({channelUrl:this.url}),[4,e.send(r)];case 1:return i=u.sent(),s=i.as(vc),o=s.participantCount,a=s.ts,this._updateParticipantCount(o,a),yn.of(this._iid).setExitedToCache(this),Se.of(this._iid).fileMessageQueue.cancel(this),[2]}})})},n.prototype.updateChannel=function(e){return f(this,void 0,void 0,function(){var r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return r=b(b({},mc),e),D(function(c){return X("string",c.operatorUserIds,!0)&&(T("string",c.coverUrlOrImage,!0)||Ge(c.coverUrlOrImage,!0))&&T("string",c.name,!0)&&T("string",c.data,!0)&&T("string",c.customType,!0)}(r)).throw(I.invalidParameters),i=S.of(this._iid).requestQueue,s=new pv(b({channelUrl:this.url},r)),[4,i.send(s)];case 1:return o=u.sent(),a=o.as(_v).channel,this._update(a),[4,yn.of(this._iid).upsertChannelsToCache([a])];case 2:return u.sent(),[2,this]}})})},n.prototype.updateChannelWithOperatorUserIds=function(e,r,i,s,o){return f(this,void 0,void 0,function(){var a;return h(this,function(u){return a=b(b({},mc),{name:e,coverUrlOrImage:r,data:i,operatorUserIds:s,customType:o}),[2,this.updateChannel(a)]})})},n.prototype.delete=function(){return f(this,void 0,void 0,function(){var e,r;return h(this,function(i){switch(i.label){case 0:return e=S.of(this._iid).requestQueue,r=new vv({channelUrl:this.url}),[4,e.send(r)];case 1:return i.sent(),[4,yn.of(this._iid).removeChannelsFromCache([this.url])];case 2:return i.sent(),[2]}})})},n.prototype.sendUserMessage=function(e){return D(!e.isPinnedMessage).throw(I.notSupportedError),t.prototype.sendUserMessage.call(this,e)},n.prototype.sendFileMessage=function(e){return D(!e.isPinnedMessage).throw(I.notSupportedError),t.prototype.sendFileMessage.call(this,e)},n}(Gu),mv=function(t){function n(e){e===void 0&&(e={});var r=t.call(this)||this;return Object.keys(e).forEach(function(i){r.hasOwnProperty(i)&&(r[i]=e[i])}),r}return g(n,t),n}(function(t){function n(){var e=t!==null&&t.apply(this,arguments)||this;return e.onUserEntered=B,e.onUserExited=B,e.onChannelParticipantCountChanged=B,e.onPollUpdated=B,e.onPollVoted=B,e.onPollDeleted=B,e}return g(n,t),n}(sv)),gv=function(t){function n(e){var r=this,i=e.token,s=e.limit,o=e.nameKeyword,a=e.urlKeyword,u=e.customTypes,c=e.includeFrozen,l=e.includeMetaData;return(r=t.call(this)||this).method=k.GET,r.path=Jt,r.params=x({token:i,limit:s,name_contains:o,url_contains:a,custom_types:u,show_frozen:c,show_metadata:l}),r}return g(n,t),n}(R),yv=function(t){function n(e,r){var i=t.call(this,e,r)||this;i.channels=[];var s=r.next,o=r.channels,a=r.ts;return i.token=s,o&&o.length>0&&(i.channels=o.map(function(u){return new Hn(e,u)})),i.ts=typeof a=="number"?a:null,i}return g(n,t),n}(M),bv=function(t){function n(e,r){var i,s,o,a,u,c=this;return(c=t.call(this,e,r)||this).includeFrozen=!0,c.includeMetaData=!0,c.nameKeyword=null,c.urlKeyword=null,c.customTypes=null,c.includeFrozen=(i=r.includeFrozen)===null||i===void 0||i,c.includeMetaData=(s=r.includeMetaData)===null||s===void 0||s,c.nameKeyword=(o=r.nameKeyword)!==null&&o!==void 0?o:null,c.urlKeyword=(a=r.urlKeyword)!==null&&a!==void 0?a:null,c.customTypes=(u=r.customTypes)!==null&&u!==void 0?u:null,c}return g(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&T("boolean",this.includeFrozen)&&T("boolean",this.includeMetaData)&&T("string",this.nameKeyword,!0)&&T("string",this.urlKeyword,!0)&&X("string",this.customTypes,!0)},n.prototype.next=function(){return f(this,void 0,void 0,function(){var e,r,i,s,o,a;return h(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,4]:this._hasNext?(this._isLoading=!0,e=S.of(this._iid).requestQueue,r=new gv(H(b(b({},this),{token:this._token}))),[4,e.send(r)]):[3,3]:[3,6];case 1:return i=u.sent(),s=i.as(yv),o=s.channels,a=s.token,this._token=a,this._hasNext=!!a,[4,yn.of(this._iid).upsertChannelsToCache(o)];case 2:return u.sent(),this._isLoading=!1,[2,o];case 3:return[2,[]];case 4:throw I.queryInProgress;case 5:return[3,7];case 6:throw I.invalidParameters;case 7:return[2]}})})},n}(Ln),Ev=function(t){function n(){var e=t!==null&&t.apply(this,arguments)||this;return e.name="openChannel",e}return g(n,t),n.prototype.init=function(e,r){var i=r.sdkState,s=r.dispatcher,o=r.sessionManager,a=r.requestQueue,u=r.logger,c=r.onlineDetector,l=r.cacheContext;t.prototype.init.call(this,e,{sdkState:i,dispatcher:s,sessionManager:o,requestQueue:a,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new yn(e,{sdkState:i,dispatcher:s,requestQueue:a,logger:u,cacheContext:l,sessionManager:o})},n.prototype.createOpenChannelListQuery=function(e){return e===void 0&&(e={}),new bv(this._iid,e)},n.prototype.addOpenChannelHandler=function(e,r){this._manager.addHandler(e,r)},n.prototype.removeOpenChannelHandler=function(e){this._manager.removeHandler(e)},n.prototype.removeAllOpenChannelHandlers=function(){this._manager.clearHandler()},n.prototype.buildOpenChannelFromSerializedData=function(e){return this._manager.buildOpenChannelFromSerializedData(e)},n.prototype.getChannel=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2,this._manager.getChannel(e)]})})},n.prototype.getChannelWithoutCache=function(e){return f(this,void 0,void 0,function(){return h(this,function(r){return[2,this._manager.getChannelWithoutCache(e)]})})},n.prototype.createChannel=function(e){return e===void 0&&(e={}),f(this,void 0,void 0,function(){return h(this,function(r){return[2,this._manager.createChannel(e)]})})},n.prototype.createChannelWithOperatorUserIds=function(e,r,i,s,o){return f(this,void 0,void 0,function(){var a;return h(this,function(u){return(a=b({},fc)).name=e,a.coverUrlOrImage=r,a.data=i,a.operatorUserIds=s,a.customType=o,[2,this._manager.createChannel(a)]})})},n}(ks);let Ri;const wv=new Uint8Array(16);function Iv(){if(!Ri&&(Ri=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ri))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ri(wv)}const Ue=[];for(let t=0;t<256;++t)Ue.push((t+256).toString(16).slice(1));function Tv(t,n=0){return Ue[t[n+0]]+Ue[t[n+1]]+Ue[t[n+2]]+Ue[t[n+3]]+"-"+Ue[t[n+4]]+Ue[t[n+5]]+"-"+Ue[t[n+6]]+Ue[t[n+7]]+"-"+Ue[t[n+8]]+Ue[t[n+9]]+"-"+Ue[t[n+10]]+Ue[t[n+11]]+Ue[t[n+12]]+Ue[t[n+13]]+Ue[t[n+14]]+Ue[t[n+15]]}const gc={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function yc(t,n,e){if(gc.randomUUID&&!n&&!t)return gc.randomUUID();t=t||{};const r=t.random||(t.rng||Iv)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,n){e=e||0;for(let i=0;i<16;++i)n[e+i]=r[i];return n}return Tv(r)}function bc(t,n,e){const r=t.slice();return r[13]=n[e],r[15]=e,r}function Ec(t){let n,e,r,i,s,o,a,u,c,l,d,p,_=Mo(t[2]),v=[];for(let m=0;m<_.length;m+=1)v[m]=wc(bc(t,_,m));return{c(){n=nt("div"),e=nt("div"),e.textContent="Docs AI Assistant",r=Vn(),i=nt("div"),s=nt("div");for(let m=0;m<v.length;m+=1)v[m].c();o=Vn(),a=nt("div"),u=nt("input"),c=Vn(),l=nt("button"),l.textContent="",Zt(e,"class","header"),Zt(u,"type","text"),Zt(u,"placeholder",""),Zt(i,"class","main-contents flex flex-col justify-between"),Zt(n,"class","flex flex-col gap-2 justify-end justify-items-end p-6 shadow-2xl rounded-lg bg-white")},m(m,y){zi(m,n,y),ze(n,e),ze(n,r),ze(n,i),ze(i,s);for(let E=0;E<v.length;E+=1)v[E]&&v[E].m(s,null);ze(i,o),ze(i,a),ze(a,u),ko(u,t[1]),ze(a,c),ze(a,l),d||(p=[Hi(u,"input",t[5]),Hi(l,"click",t[4])],d=!0)},p(m,y){if(y&4){_=Mo(m[2]);let E;for(E=0;E<_.length;E+=1){const w=bc(m,_,E);v[E]?v[E].p(w,y):(v[E]=wc(w),v[E].c(),v[E].m(s,null))}for(;E<v.length;E+=1)v[E].d(1);v.length=_.length}y&2&&u.value!==m[1]&&ko(u,m[1])},d(m){m&&Pr(n),Hc(v,m),d=!1,Gn(p)}}}function wc(t){let n,e=t[13]+"",r,i;return{c(){n=nt("div"),r=Oo(e),i=Vn()},m(s,o){zi(s,n,o),ze(n,r),ze(n,i)},p(s,o){o&4&&e!==(e=s[13]+"")&&jc(r,e)},d(s){s&&Pr(n)}}}function Cv(t){let n,e,r,i,s,o,a,u=t[0]&&Ec(t);return{c(){n=nt("main"),e=nt("div"),u&&u.c(),r=Vn(),i=nt("div"),s=nt("button"),s.innerHTML=`<img src="${nl}" class="logo svelte svelte-bl7fmt" alt="Svelte Logo"/>`,Zt(i,"class","flex justify-end"),Zt(e,"class","img-wrapper fixed bottom-9 right-9 z-50")},m(c,l){zi(c,n,l),ze(n,e),u&&u.m(e,null),ze(e,r),ze(e,i),ze(i,s),o||(a=Hi(s,"click",t[3]),o=!0)},p(c,[l]){c[0]?u?u.p(c,l):(u=Ec(c),u.c(),u.m(e,r)):u&&(u.d(1),u=null)},i:We,o:We,d(c){c&&Pr(n),u&&u.d(),o=!1,a()}}}function Sv(t,n,e){let r=!1,i="",s=null,o=[];const a=W_.init({appId:"0CBCE5B8-CABA-476F-9079-D7FCAF0A58DC",modules:[new Ev]}),u=new mv;u.onMessageReceived=(y,E)=>{l(E.message)};const c=async y=>{try{const E={nextResultSize:20,prevResultSize:0},C=(await y.getMessagesByTimestamp(0,E)).map(A=>A.message);return l(C),C}catch(E){return console.log(E),null}},l=y=>{e(2,o=typeof y=="string"?[...o,y]:[...o,...y])},d=async()=>{e(0,r=!r),r&&(await _(),s=await v(),console.log(s.cachedMetaData),s&&(await s.enter(),o.length||await c(s),a.openChannel.addOpenChannelHandler("jonouagebrgojnerjogbouabrionaojbrb",u)))},p=async()=>{if(!s)return;const y={message:i};s.sendUserMessage(y).onSucceeded(E=>{e(1,i=""),l(E.message)})},_=async()=>{try{let y=localStorage.getItem("userId");y||(y=yc(),localStorage.setItem("userId",y)),await a.connect(y)}catch{}},v=async()=>{var y;try{let E=localStorage.getItem("channelUrl");if(E)return await a.openChannel.getChannel(E);{const w={name:yc(),operatorUserIds:[((y=a==null?void 0:a.currentUser)==null?void 0:y.userId)??"unkown"]},C=await a.openChannel.createChannel(w);return localStorage.setItem("channelUrl",C.url),C}}catch{return null}};function m(){i=this.value,e(1,i)}return[r,i,o,d,p,m]}class Av extends el{constructor(n){super(),Jc(this,n,Sv,Cv,qc,{})}}const Nv=new Av({target:document.getElementById("relation-widget")});var Ov=function(t,n){return new Promise(function(e,r){if(typeof XMLHttpRequest<"u"){var i=S.of(t),s=i.dispatcher,o=i.logger,a=n.requestId,u=n.method,c=n.url,l=n.headers,d=l===void 0?{}:l,p=n.data,_=p===void 0?"":p,v=n.uploadProgressHandler,m=!1,y=new XMLHttpRequest;for(var E in y.open(u,c),d)y.setRequestHeader(E,d[E]);v&&y.upload.addEventListener("progress",function(w){w.lengthComputable?v(a,w.loaded,w.total):o.debug("Progress computing failed: `Content-Length` header is not given.")}),y.onabort=function(){r(I.requestCanceled)},y.onerror=function(w){r(I.networkError)},y.onreadystatechange=function(){if(y.readyState===XMLHttpRequest.DONE&&!m)if(y.status===0||y.status>=200&&y.status<400)try{var w=JSON.parse(y.responseText);e(new M(t,w))}catch{r(I.networkError)}else try{var C=JSON.parse(y.responseText);if(C){var A=new I(C);if(A.isSessionExpiredError){if(s.dispatch(new xt({reason:A.code})),!(y instanceof Hr)){var P=new Ae;return s.dispatch(new ts({request:y,deferred:P,error:A})),P.promise}}else A.isSessionInvalidatedError&&s.dispatch(new xt({reason:A.code}));r(A)}else r(I.requestFailed)}catch{r(I.requestFailed)}},s.on(function(w){w instanceof Yn&&(w.requestId&&w.requestId!==a||(m=!0,y.abort()))}),y.send(_)}else r(I.xmlHttpRequestNotSupported)})};const kv=Object.freeze(Object.defineProperty({__proto__:null,xmlHttpRequest:Ov},Symbol.toStringTag,{value:"Module"}));var Or=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ic={},Tc;Tc=function(){function t(p,_){if(!(p instanceof _))throw new TypeError("Cannot call a class as a function")}function n(p,_){for(var v=0;v<_.length;v++){var m=_[v];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(p,m.key,m)}}function e(p,_,v){return _&&n(p.prototype,_),v&&n(p,v),Object.defineProperty(p,"prototype",{writable:!1}),p}function r(p){return r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(_){return _.__proto__||Object.getPrototypeOf(_)},r(p)}function i(p,_){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,m){return v.__proto__=m,v},i(p,_)}function s(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}function o(p){var _=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var v,m=r(p);if(_){var y=r(this).constructor;v=Reflect.construct(m,arguments,y)}else v=m.apply(this,arguments);return function(E,w){if(w&&(typeof w=="object"||typeof w=="function"))return w;if(w!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return s(E)}(this,v)}}function a(){return a=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(p,_,v){var m=function(E,w){for(;!Object.prototype.hasOwnProperty.call(E,w)&&(E=r(E))!==null;);return E}(p,_);if(m){var y=Object.getOwnPropertyDescriptor(m,_);return y.get?y.get.call(arguments.length<3?p:v):y.value}},a.apply(this,arguments)}var u=function(){function p(){t(this,p),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return e(p,[{key:"addEventListener",value:function(_,v,m){_ in this.listeners||(this.listeners[_]=[]),this.listeners[_].push({callback:v,options:m})}},{key:"removeEventListener",value:function(_,v){if(_ in this.listeners){for(var m=this.listeners[_],y=0,E=m.length;y<E;y++)if(m[y].callback===v)return void m.splice(y,1)}}},{key:"dispatchEvent",value:function(_){if(_.type in this.listeners){for(var v=this.listeners[_.type].slice(),m=0,y=v.length;m<y;m++){var E=v[m];try{E.callback.call(this,_)}catch(w){Promise.resolve().then(function(){throw w})}E.options&&E.options.once&&this.removeEventListener(_.type,E.callback)}return!_.defaultPrevented}}}]),p}(),c=function(p){(function(m,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function");m.prototype=Object.create(y&&y.prototype,{constructor:{value:m,writable:!0,configurable:!0}}),Object.defineProperty(m,"prototype",{writable:!1}),y&&i(m,y)})(v,p);var _=o(v);function v(){var m;return t(this,v),(m=_.call(this)).listeners||u.call(s(m)),Object.defineProperty(s(m),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(s(m),"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(s(m),"reason",{value:void 0,writable:!0,configurable:!0}),m}return e(v,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(m){m.type==="abort"&&(this.aborted=!0,typeof this.onabort=="function"&&this.onabort.call(this,m)),a(r(v.prototype),"dispatchEvent",this).call(this,m)}}]),v}(u),l=function(){function p(){t(this,p),Object.defineProperty(this,"signal",{value:new c,writable:!0,configurable:!0})}return e(p,[{key:"abort",value:function(_){var v;try{v=new Event("abort")}catch{typeof document<"u"?document.createEvent?(v=document.createEvent("Event")).initEvent("abort",!1,!1):(v=document.createEventObject()).type="abort":v={type:"abort",bubbles:!1,cancelable:!1}}var m=_;if(m===void 0)if(typeof document>"u")(m=new Error("This operation was aborted")).name="AbortError";else try{m=new DOMException("signal is aborted without reason")}catch{(m=new Error("This operation was aborted")).name="AbortError"}this.signal.reason=m,this.signal.dispatchEvent(v)}},{key:"toString",value:function(){return"[object AbortController]"}}]),p}();function d(p){return p.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):typeof p.Request=="function"&&!p.Request.prototype.hasOwnProperty("signal")||!p.AbortController}typeof Symbol<"u"&&Symbol.toStringTag&&(l.prototype[Symbol.toStringTag]="AbortController",c.prototype[Symbol.toStringTag]="AbortSignal"),function(p){if(d(p))if(p.fetch){var _=function(y){typeof y=="function"&&(y={fetch:y});var E=y,w=E.fetch,C=E.Request,A=C===void 0?w.Request:C,P=E.AbortController,N=E.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL,q=N!==void 0&&N;if(!d({fetch:w,Request:A,AbortController:P,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:q}))return{fetch:w,Request:F};var F=A;(F&&!F.prototype.hasOwnProperty("signal")||q)&&((F=function(U,K){var ve;K&&K.signal&&(ve=K.signal,delete K.signal);var we=new A(U,K);return ve&&Object.defineProperty(we,"signal",{writable:!1,enumerable:!1,configurable:!0,value:ve}),we}).prototype=A.prototype);var L=w;return{fetch:function(U,K){var ve=F&&F.prototype.isPrototypeOf(U)?U.signal:K?K.signal:void 0;if(ve){var we;try{we=new DOMException("Aborted","AbortError")}catch{(we=new Error("Aborted")).name="AbortError"}if(ve.aborted)return Promise.reject(we);var Ct=new Promise(function(ft,Rr){ve.addEventListener("abort",function(){return Rr(we)},{once:!0})});return K&&K.signal&&delete K.signal,Promise.race([Ct,L(U,K)])}return L(U,K)},Request:F}}(p),v=_.fetch,m=_.Request;p.fetch=v,p.Request=m,Object.defineProperty(p,"AbortController",{writable:!0,enumerable:!1,configurable:!0,value:l}),Object.defineProperty(p,"AbortSignal",{writable:!0,enumerable:!1,configurable:!0,value:c})}else console.warn("fetch() is not available, cannot install abortcontroller-polyfill")}(typeof self<"u"?self:Or)},Tc();const Rv=Mt({__proto__:null,default:Ic},[Ic]);var Cc={},Me=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof Or<"u"&&Or||{},Sc="URLSearchParams"in Me,Ac="Symbol"in Me&&"iterator"in Symbol,kr="FileReader"in Me&&"Blob"in Me&&function(){try{return new Blob,!0}catch{return!1}}(),Nc="FormData"in Me,Di="ArrayBuffer"in Me;if(Di)var Dv=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Uv=ArrayBuffer.isView||function(t){return t&&Dv.indexOf(Object.prototype.toString.call(t))>-1};function $n(t){if(typeof t!="string"&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||t==="")throw new TypeError('Invalid character in header field name: "'+t+'"');return t.toLowerCase()}function oo(t){return typeof t!="string"&&(t=String(t)),t}function ao(t){var n={next:function(){var e=t.shift();return{done:e===void 0,value:e}}};return Ac&&(n[Symbol.iterator]=function(){return n}),n}function Ee(t){this.map={},t instanceof Ee?t.forEach(function(n,e){this.append(e,n)},this):Array.isArray(t)?t.forEach(function(n){if(n.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+n.length);this.append(n[0],n[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(n){this.append(n,t[n])},this)}function uo(t){if(!t._noBody)return t.bodyUsed?Promise.reject(new TypeError("Already read")):void(t.bodyUsed=!0)}function Oc(t){return new Promise(function(n,e){t.onload=function(){n(t.result)},t.onerror=function(){e(t.error)}})}function Mv(t){var n=new FileReader,e=Oc(n);return n.readAsArrayBuffer(t),e}function kc(t){if(t.slice)return t.slice(0);var n=new Uint8Array(t.byteLength);return n.set(new Uint8Array(t)),n.buffer}function Rc(){return this.bodyUsed=!1,this._initBody=function(t){var n;this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?typeof t=="string"?this._bodyText=t:kr&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:Nc&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:Sc&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():Di&&kr&&(n=t)&&DataView.prototype.isPrototypeOf(n)?(this._bodyArrayBuffer=kc(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):Di&&(ArrayBuffer.prototype.isPrototypeOf(t)||Uv(t))?this._bodyArrayBuffer=kc(t):this._bodyText=t=Object.prototype.toString.call(t):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof t=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):Sc&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},kr&&(this.blob=function(){var t=uo(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var t=uo(this);return t||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}if(kr)return this.blob().then(Mv);throw new Error("could not read as ArrayBuffer")},this.text=function(){var t,n,e,r,i,s=uo(this);if(s)return s;if(this._bodyBlob)return t=this._bodyBlob,n=new FileReader,e=Oc(n),r=/charset=([A-Za-z0-9_-]+)/.exec(t.type),i=r?r[1]:"utf-8",n.readAsText(t,i),e;if(this._bodyArrayBuffer)return Promise.resolve(function(o){for(var a=new Uint8Array(o),u=new Array(a.length),c=0;c<a.length;c++)u[c]=String.fromCharCode(a[c]);return u.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},Nc&&(this.formData=function(){return this.text().then(Pv)}),this.json=function(){return this.text().then(JSON.parse)},this}Ee.prototype.append=function(t,n){t=$n(t),n=oo(n);var e=this.map[t];this.map[t]=e?e+", "+n:n},Ee.prototype.delete=function(t){delete this.map[$n(t)]},Ee.prototype.get=function(t){return t=$n(t),this.has(t)?this.map[t]:null},Ee.prototype.has=function(t){return this.map.hasOwnProperty($n(t))},Ee.prototype.set=function(t,n){this.map[$n(t)]=oo(n)},Ee.prototype.forEach=function(t,n){for(var e in this.map)this.map.hasOwnProperty(e)&&t.call(n,this.map[e],e,this)},Ee.prototype.keys=function(){var t=[];return this.forEach(function(n,e){t.push(e)}),ao(t)},Ee.prototype.values=function(){var t=[];return this.forEach(function(n){t.push(n)}),ao(t)},Ee.prototype.entries=function(){var t=[];return this.forEach(function(n,e){t.push([e,n])}),ao(t)},Ac&&(Ee.prototype[Symbol.iterator]=Ee.prototype.entries);var Lv=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function bn(t,n){if(!(this instanceof bn))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var e,r,i=(n=n||{}).body;if(t instanceof bn){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,n.headers||(this.headers=new Ee(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,i||t._bodyInit==null||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=n.credentials||this.credentials||"same-origin",!n.headers&&this.headers||(this.headers=new Ee(n.headers)),this.method=(e=n.method||this.method||"GET",r=e.toUpperCase(),Lv.indexOf(r)>-1?r:e),this.mode=n.mode||this.mode||null,this.signal=n.signal||this.signal||function(){if("AbortController"in Me)return new AbortController().signal}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&i)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),!(this.method!=="GET"&&this.method!=="HEAD"||n.cache!=="no-store"&&n.cache!=="no-cache")){var s=/([?&])_=[^&]*/;s.test(this.url)?this.url=this.url.replace(s,"$1_="+new Date().getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+new Date().getTime()}}function Pv(t){var n=new FormData;return t.trim().split("&").forEach(function(e){if(e){var r=e.split("="),i=r.shift().replace(/\+/g," "),s=r.join("=").replace(/\+/g," ");n.append(decodeURIComponent(i),decodeURIComponent(s))}}),n}function Tt(t,n){if(!(this instanceof Tt))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(n||(n={}),this.type="default",this.status=n.status===void 0?200:n.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=n.statusText===void 0?"":""+n.statusText,this.headers=new Ee(n.headers),this.url=n.url||"",this._initBody(t)}bn.prototype.clone=function(){return new bn(this,{body:this._bodyInit})},Rc.call(bn.prototype),Rc.call(Tt.prototype),Tt.prototype.clone=function(){return new Tt(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Ee(this.headers),url:this.url})},Tt.error=function(){var t=new Tt(null,{status:200,statusText:""});return t.status=0,t.type="error",t};var xv=[301,302,303,307,308];Tt.redirect=function(t,n){if(xv.indexOf(n)===-1)throw new RangeError("Invalid status code");return new Tt(null,{status:n,headers:{location:t}})};var jn=Me.DOMException;try{new jn}catch{(jn=function(n,e){this.message=n,this.name=e;var r=Error(n);this.stack=r.stack}).prototype=Object.create(Error.prototype),jn.prototype.constructor=jn}function co(t,n){return new Promise(function(e,r){var i=new bn(t,n);if(i.signal&&i.signal.aborted)return r(new jn("Aborted","AbortError"));var s=new XMLHttpRequest;function o(){s.abort()}if(s.onload=function(){var u,c,l={statusText:s.statusText,headers:(u=s.getAllResponseHeaders()||"",c=new Ee,u.replace(/\r?\n[\t ]+/g," ").split("\r").map(function(p){return p.indexOf(`
`)===0?p.substr(1,p.length):p}).forEach(function(p){var _=p.split(":"),v=_.shift().trim();if(v){var m=_.join(":").trim();try{c.append(v,m)}catch(y){console.warn("Response "+y.message)}}}),c)};i.url.startsWith("file://")&&(s.status<200||s.status>599)?l.status=200:l.status=s.status,l.url="responseURL"in s?s.responseURL:l.headers.get("X-Request-URL");var d="response"in s?s.response:s.responseText;setTimeout(function(){e(new Tt(d,l))},0)},s.onerror=function(){setTimeout(function(){r(new TypeError("Network request failed"))},0)},s.ontimeout=function(){setTimeout(function(){r(new TypeError("Network request timed out"))},0)},s.onabort=function(){setTimeout(function(){r(new jn("Aborted","AbortError"))},0)},s.open(i.method,function(u){try{return u===""&&Me.location.href?Me.location.href:u}catch{return u}}(i.url),!0),i.credentials==="include"?s.withCredentials=!0:i.credentials==="omit"&&(s.withCredentials=!1),"responseType"in s&&(kr?s.responseType="blob":Di&&(s.responseType="arraybuffer")),n&&typeof n.headers=="object"&&!(n.headers instanceof Ee||Me.Headers&&n.headers instanceof Me.Headers)){var a=[];Object.getOwnPropertyNames(n.headers).forEach(function(u){a.push($n(u)),s.setRequestHeader(u,oo(n.headers[u]))}),i.headers.forEach(function(u,c){a.indexOf(c)===-1&&s.setRequestHeader(c,u)})}else i.headers.forEach(function(u,c){s.setRequestHeader(c,u)});i.signal&&(i.signal.addEventListener("abort",o),s.onreadystatechange=function(){s.readyState===4&&i.signal.removeEventListener("abort",o)}),s.send(i._bodyInit===void 0?null:i._bodyInit)})}co.polyfill=!0,Me.fetch||(Me.fetch=co,Me.Headers=Ee,Me.Request=bn,Me.Response=Tt),(typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof Or<"u"&&Or||{fetch:null}).fetch=co;const Fv=Mt({__proto__:null,default:Cc},[Cc]);return Nv}();
